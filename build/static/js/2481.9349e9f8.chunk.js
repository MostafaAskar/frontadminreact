"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[2481],{73431:(l,e,n)=>{n.d(e,{Z:()=>u});var i=n(47313),t=n(39180),d=n(2717),o=n(28830),s=n(60535),a=n(46417);const u=()=>{const l=(0,d.I0)(),{languages:e,defaultLang:n}=(0,d.v9)((l=>l.formLang),d.wU);(0,i.useEffect)((()=>{s.Z.getAllActive().then((e=>{let{data:n}=e;l((0,o.dc)(n)),l((0,o.mh)(n.find((l=>1===l.default)).locale))}))}),[]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(t.ZP.Group,{value:n,onChange:e=>{let{target:{value:n}}=e;l((0,o.mh)(n))},className:"float-right",buttonStyle:"solid",children:null===e||void 0===e?void 0:e.map((l=>(0,a.jsx)(t.ZP.Button,{value:l.locale,children:l.title},l.id)))})})}},89281:(l,e,n)=>{n.d(e,{h:()=>u});var i=n(47313),t=n(12279),d=n.n(t),o=n(74294),s=n(72652),a=n(46417);const u=l=>{let{fetchOptions:e,debounceTimeout:n=400,onClear:t,refetchOptions:u=!1,...v}=l;const[r,c]=(0,i.useState)(!1),[m,h]=(0,i.useState)([]),x=(0,i.useMemo)((()=>d()((l=>{h([]),c(!0),e(l).then((l=>{h(l),c(!1)}))}),n)),[e,n]);return(0,a.jsx)(o.Z,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:x,onClear:()=>{x(""),t&&t()},notFoundContent:r?(0,a.jsx)(s.Z,{size:"small"}):"no results",...v,options:m,onFocus:()=>{m.length&&!u||x("")}})}},17649:(l,e,n)=>{n.d(e,{Z:()=>i});n(97421);function i(l){if(null===l||void 0===l||!l.location)return{lat:47.4143302506288,lng:8.532059477976883};const e=l.location.split(", ");return{lat:Number(null===e||void 0===e?void 0:e[0]),lng:Number(null===e||void 0===e?void 0:e[1])}}},84017:(l,e,n)=>{function i(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"after";const i=Number(l).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,");return"after"===n?`${i} ${e}`:`${e} ${i}`}n.d(e,{Z:()=>i})},24077:(l,e,n)=>{n.d(e,{Z:()=>p});var i=n(47313),t=n(10976),d=n(9274),o=n(59491),s=n(68197),a=n(59624),u=n(2717),v=n(7370),r=n(90954),c=n(24511),m=n(49986),h=n(89281),x=n(46417);function p(l){var e,n,p;let{orderDetails:j,handleCancel:g}=l;const{t:f}=(0,c.$)(),{activeMenu:Z}=(0,u.v9)((l=>l.menu),u.wU),[y]=t.Z.useForm(),b=(0,u.I0)(),[S,w]=(0,i.useState)(!1);return(0,x.jsx)(d.Z,{visible:!!j,onCancel:g,footer:[(0,x.jsx)(o.Z,{type:"primary",onClick:()=>y.submit(),loading:S,children:f("save")},"saveBtn"),(0,x.jsx)(o.Z,{type:"default",onClick:g,children:f("cancel")},"cancelBtn")],children:(0,x.jsx)(t.Z,{form:y,layout:"vertical",onFinish:l=>{const e={deliveryman_id:l.deliveryman.value};w(!0),v.Z.updateDelivery(j.id,e).then((()=>{g(),b((0,r.xo)(Z))})).finally((()=>w(!1)))},initialValues:{deliveryman:{label:j.deliveryman?(null===j||void 0===j||null===(e=j.deliveryman)||void 0===e?void 0:e.firstname)+" "+(null===j||void 0===j||null===(n=j.deliveryman)||void 0===n?void 0:n.lastname):null,value:j.deliveryman?null===j||void 0===j||null===(p=j.deliveryman)||void 0===p?void 0:p.id:null}},children:(0,x.jsx)(s.Z,{gutter:12,children:(0,x.jsx)(a.Z,{span:24,children:(0,x.jsx)(t.Z.Item,{label:f("deliveryman"),name:"deliveryman",rules:[{required:!0,message:f("required")}],children:(0,x.jsx)(h.h,{className:"w-100",debounceTimeout:500,placeholder:f("select.shop"),fetchOptions:async function(l){const e={search:l.length?l:void 0,page:1,perPage:10,role:"deliveryman",exist_token:1};return m.Z.getAll(e).then((l=>{let{data:e}=l;return e.map((l=>({label:l.firstname+" "+l.lastname||"no name",value:l.id})))}))},allowClear:!0})})})})})})}},7920:(l,e,n)=>{n.d(e,{Z:()=>w});var i=n(47313),t=n(35432),d=n(10976),o=n(9274),s=n(59491),a=n(68197),u=n(59624),v=n(66672),r=n(46155),c=n(74294),m=n(2717),h=n(24511),x=n(7370),p=n(51282),j=n(73431),g=n(70816),f=n.n(g),Z=n(20052),y=n(12019),b=n(46417);const{Panel:S}=t.Z;function w(l){var e;let{orderId:n,handleCancel:g,refetchPage:w}=l;const{statusList:k}=(0,m.v9)((l=>l.orderStatus),m.wU),{defaultLang:C,languages:I}=(0,m.v9)((l=>l.formLang),m.wU),[$]=d.Z.useForm(),{t:_}=(0,h.$)(),F=(0,i.useRef)(null),[B,N]=(0,i.useState)(!1),[L,M]=(0,i.useState)(!1),[O,Y]=(0,i.useState)(null!==k&&void 0!==k&&k.length?null===k||void 0===k?void 0:k.map((l=>({value:null===l||void 0===l?void 0:l.name,label:_(null===l||void 0===l?void 0:l.name),key:null===l||void 0===l?void 0:l.id}))):[]),[z,D]=(0,i.useState)(null),[P,U]=(0,i.useState)(null),[A,E]=(0,i.useState)(null),[T,V]=(0,i.useState)(null);(0,i.useEffect)((()=>{N(!0),x.Z.getById(n).then((l=>{var e,n,i,t;D(l.data),U(null===(e=l.data)||void 0===e||null===(n=e.notes)||void 0===n?void 0:n.filter((l=>{var e;return!(null===l||void 0===l||null===(e=l.notes)||void 0===e||!e.length)}))),V(null===(i=l.data)||void 0===i?void 0:i.status),$.setFieldsValue({status:null===l||void 0===l||null===(t=l.data)||void 0===t?void 0:t.status})})).finally((()=>N(!1)))}),[n]),(0,i.useEffect)((()=>{var l,e;if("pause"===(null===z||void 0===z?void 0:z.status))return void Y(null===k||void 0===k?void 0:k.map((l=>({value:null===l||void 0===l?void 0:l.name,label:_(null===l||void 0===l?void 0:l.name),key:null===l||void 0===l?void 0:l.id}))));const n=k.findIndex((l=>l.name===(null===z||void 0===z?void 0:z.status))),i=n>=0?[k[n],n<k.length-1?"pause"===(null===(l=k[n+1])||void 0===l?void 0:l.name)?k[n+2]:k[n+1]:null]:[n<k.length-1?k[n+1]:null];var t;("on_a_way"===(null===(e=k[n])||void 0===e?void 0:e.name)&&i.push(k[n+3]),null!==k&&void 0!==k&&k.filter((l=>"pause"===(null===l||void 0===l?void 0:l.name)&&(null===l||void 0===l?void 0:l.active))))&&(null===i||void 0===i||i.push(null===k||void 0===k||null===(t=k.filter((l=>"pause"===(null===l||void 0===l?void 0:l.name)&&(null===l||void 0===l?void 0:l.active))))||void 0===t?void 0:t[0]));i.push({name:"canceled",id:8,active:!0,sort:(null===k||void 0===k?void 0:k.length)+1}),Y(i.filter(Boolean).map((l=>({value:null===l||void 0===l?void 0:l.name,label:_(null===l||void 0===l?void 0:l.name),key:null===l||void 0===l?void 0:l.id}))))}),[z]);const q=l=>{const e=Object.entries(l).filter((l=>{let[e,n]=l;return!!n}));if(0!==(null===e||void 0===e?void 0:e.length))return Object.fromEntries(e)};return(0,i.useEffect)((()=>{var l;$.setFieldsValue({[`title[${C||"en"}]`]:null===A||void 0===A||null===(l=A.title)||void 0===l?void 0:l[C||"en"]})}),[C]),(0,b.jsx)(o.Z,{visible:!!n,title:[_("order.status")],onCancel:g,footer:[(0,b.jsx)(s.Z,{type:"primary",onClick:()=>$.submit(),loading:L,children:_("save")},"save-form"),(0,b.jsx)(s.Z,{type:"default",onClick:g,children:_("cancel")},"cansel-modal")],children:B?(0,b.jsx)(p.Z,{}):(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(d.Z,{form:$,layout:"vertical",onFinish:l=>{var e;let n=null;M(!0),A&&(null===l||void 0===l?void 0:l.status)===(null===z||void 0===z?void 0:z.status)&&(n={...Object.assign({},...I.map((e=>({[e.locale]:l[`title[${e.locale}]`]}))))},n=q(n));const i=q({...Object.assign({},...I.map((e=>({[e.locale]:l[`note[${e.locale}]`]}))))}),t=i?{title:i}:null,d=(null===z||void 0===z?void 0:z.status)===(null===l||void 0===l?void 0:l.status)?null===z||void 0===z||null===(e=z.notes)||void 0===e?void 0:e.filter((e=>(null===e||void 0===e?void 0:e.status)===(null===l||void 0===l?void 0:l.status))).flatMap((l=>{var e;return null===l||void 0===l||null===(e=l.notes)||void 0===e?void 0:e.map(((l,e)=>e===(null===A||void 0===A?void 0:A.index)?{...l,title:{...null===l||void 0===l?void 0:l.title,...n}}:l))})).filter(Boolean):[],o={status:null===l||void 0===l?void 0:l.status,notes:[...d,t].filter(Boolean)};x.Z.updateStatus(z.id,o).then((()=>{g(),w()})).finally((()=>M(!1)))},name:"order-status-change-form",children:[(0,b.jsx)(a.Z,{gutter:12,style:{marginBottom:"20px"},children:(0,b.jsx)(u.Z,{span:24,children:(0,b.jsx)(j.Z,{})})}),!(null===z||void 0===z||null===(e=z.notes)||void 0===e||!e.some((l=>{var e;return!(null===l||void 0===l||null===(e=l.notes)||void 0===e||!e.length)})))&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Z,{children:null===P||void 0===P?void 0:P.map((l=>{var e;return(0,b.jsx)(S,{header:_(null===l||void 0===l?void 0:l.status),children:(null===l||void 0===l||null===(e=l.notes)||void 0===e?void 0:e.map(((e,n)=>{var i,t,o;return(0,b.jsxs)(a.Z,{style:{marginBottom:"15px",display:"flex",justifyContent:"space-between"},gutter:12,children:[(0,b.jsxs)(u.Z,{span:(null===l||void 0===l?void 0:l.status)===(null===z||void 0===z?void 0:z.status)&&T===(null===z||void 0===z?void 0:z.status)?22:24,children:[(0,b.jsxs)("div",{style:{display:"flex",columnGap:"10px"},children:[(0,b.jsxs)("span",{style:{marginTop:"3px"},children:[n+1,"."," "]}),(0,b.jsxs)("div",{style:{width:"100%"},children:[(0,b.jsx)("p",{style:{margin:0,fontSize:"15px",wordBreak:"break-all"},hidden:(null===A||void 0===A?void 0:A.orderId)===(null===l||void 0===l?void 0:l.id)&&(null===A||void 0===A?void 0:A.index)===n&&(null===z||void 0===z?void 0:z.status)===T,children:(null===e||void 0===e||null===(i=e.title)||void 0===i?void 0:i[C||"en"])||"--"}),(0,b.jsx)(d.Z.Item,{name:`title[${C||"en"}]`,hidden:(null===A||void 0===A?void 0:A.orderId)!==(null===l||void 0===l?void 0:l.id)||(null===A||void 0===A?void 0:A.index)!==n||(null===z||void 0===z?void 0:z.status)!==T,children:(0,b.jsx)(v.Z.TextArea,{maxLength:200,style:{width:"100%"},rows:Math.floor((null===e||void 0===e||null===(t=e.title)||void 0===t||null===(o=t[C||"en"])||void 0===o?void 0:o.length)/41||0)+1,ref:F},n)})]})]}),(0,b.jsx)("p",{style:{fontSize:"12px",margin:0,float:"right"},children:f()(null===e||void 0===e?void 0:e.created_at).format("DD-MM-YYYY HH:mm")})]}),(null===l||void 0===l?void 0:l.status)===(null===z||void 0===z?void 0:z.status)&&(null===z||void 0===z?void 0:z.status)===T&&(0,b.jsx)(u.Z,{span:2,children:(null===A||void 0===A?void 0:A.orderId)===(null===l||void 0===l?void 0:l.id)&&n===(null===A||void 0===A?void 0:A.index)?(0,b.jsx)(s.Z,{type:"primary",icon:(0,b.jsx)(Z.Z,{}),size:"small",onClick:()=>$.submit(),loading:L}):(null===l||void 0===l?void 0:l.status)===(null===z||void 0===z?void 0:z.status)&&(0,b.jsx)(s.Z,{icon:(0,b.jsx)(y.Z,{}),size:"small",onClick:()=>{var i;F.current.focus(),E({orderId:null===l||void 0===l?void 0:l.id,index:n,title:null===e||void 0===e?void 0:e.title}),$.setFieldsValue({[`title[${C||"en"}]`]:null===e||void 0===e||null===(i=e.title)||void 0===i?void 0:i[C||"en"]})}})})]},n)})))||"--"},null===l||void 0===l?void 0:l.id)}))}),(0,b.jsx)(r.Z,{})]}),(0,b.jsxs)(a.Z,{gutter:12,children:[(0,b.jsx)(u.Z,{span:24,children:(0,b.jsx)(d.Z.Item,{label:_("status"),name:"status",rules:[{required:!0,message:_("required")}],children:(0,b.jsx)(c.Z,{options:O,onSelect:l=>V(l)})})}),(0,b.jsx)(u.Z,{span:24,children:I.map((l=>(0,b.jsx)(d.Z.Item,{name:`note[${null===l||void 0===l?void 0:l.locale}]`,label:_("note"),hidden:(null===l||void 0===l?void 0:l.locale)!==C,children:(0,b.jsx)(v.Z.TextArea,{maxLength:200})},`note_${null===l||void 0===l?void 0:l.id}`)))})]})]})})})}},80355:(l,e,n)=>{n.d(e,{Z:()=>_});var i=n(84697),t=n(83999),d=n(9274),o=n(59491),s=n(77181),a=n(68197),u=n(59624),v=n(66204),r=n(47313),c=n(24511),m=n(7370),h=n(51282),x=n(58821),p=n(2717),j=n(97421),g=n(18478),f=n(17649),Z=n(66461),y=n(22539),b=n(3394),S=n(57864),w=n(70816),k=n.n(w),C=n(46417);const{Step:I}=t.Z,$=()=>(0,C.jsx)("div",{style:{position:"absolute",transform:"translate(-50%, -100%)"},children:(0,C.jsx)("img",{src:g,width:"50",alt:"Pin"})}),_=l=>{var e,n,g;let{id:w,handleCancel:_}=l;const{t:F}=(0,c.$)(),[B,N]=(0,r.useState)(null),[L,M]=(0,r.useState)(null),[O,Y]=(0,r.useState)(null),{settings:z}=(0,p.v9)((l=>l.globalSettings),p.wU),D=(0,f.Z)(z),[P,U]=(0,r.useState)(0),[A,E]=(0,r.useState)({lat:null===D||void 0===D?void 0:D.lat,lng:null===D||void 0===D?void 0:D.lng}),[T,V]=(0,r.useState)([{id:0,name:"new",icon:(0,C.jsx)(Z.Z,{})},{id:1,name:"accepted",icon:(0,C.jsx)(x.IQF,{})},{id:2,name:"ready",icon:(0,C.jsx)(y.TkG,{})},{id:3,name:"on_a_way",icon:(0,C.jsx)(b.Akc,{})},{id:4,name:"delivered",icon:(0,C.jsx)(b.kme,{})}]);const{google_map_key:q}=(0,p.v9)((l=>l.globalSettings.settings),p.wU);return(0,r.useEffect)((()=>{N(!0),m.Z.getById(w).then((l=>{var e,n,i,t,d,o,s;let{data:a}=l;V("canceled"===a.status?[{id:1,name:"new",icon:(0,C.jsx)(Z.Z,{})},{id:5,name:"canceled",icon:(0,C.jsx)(S.SV5,{})}]:T),U("canceled"===a.status?1:null===(e=T.find((l=>l.name===a.status)))||void 0===e?void 0:e.id);const u=null!==(n=null!==(i=null!==(t=null===a||void 0===a||null===(d=a.address)||void 0===d?void 0:d.location)&&void 0!==t?t:null===a||void 0===a||null===(o=a.my_address)||void 0===o?void 0:o.location)&&void 0!==i?i:null===a||void 0===a||null===(s=a.delivery_point)||void 0===s?void 0:s.location)&&void 0!==n?n:{latitude:null===D||void 0===D?void 0:D.lat,longitude:null===D||void 0===D?void 0:D.lng};E({lat:Number(null===u||void 0===u?void 0:u.latitude),lng:Number(null===u||void 0===u?void 0:u.longitude)}),Y("canceled"===a.status?"error":"success"),M(a)})).finally((()=>{N(!1)}))}),[]),(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(d.Z,{visible:!!w,title:F("show.locations"),onCancel:()=>_(),style:{minWidth:"80vw"},footer:[(0,C.jsx)(o.Z,{type:"default",onClick:_,children:F("cancel")},"cancelBtn")],children:B?(0,C.jsx)(h.Z,{}):(0,C.jsxs)(s.Z,{children:[(0,C.jsx)(t.Z,{current:P,status:O,className:"mb-5",children:null===T||void 0===T?void 0:T.map(((l,e)=>(0,C.jsx)(I,{title:F(l.name),icon:null===l||void 0===l?void 0:l.icon},l.id+e)))}),(0,C.jsxs)(a.Z,{gutter:12,children:[(0,C.jsxs)(u.Z,{span:12,children:[(0,C.jsxs)("h3",{children:[F("order.id")," #",null===L||void 0===L?void 0:L.id]}),(0,C.jsxs)("p",{children:[(0,C.jsx)(x.D73,{})," ",k()(null===L||void 0===L?void 0:L.created_at).format("YYYY-MM-DD HH:mm")]}),(0,C.jsxs)("p",{children:[F("scheduled.at")," ",null===L||void 0===L?void 0:L.delivery_date]})]}),(0,C.jsxs)(u.Z,{span:12,children:[(0,C.jsxs)("p",{children:[F("status")," ","new"===(null===L||void 0===L?void 0:L.status)?(0,C.jsx)(v.Z,{color:"blue",children:F(null===L||void 0===L?void 0:L.status)}):"canceled"===(null===L||void 0===L?void 0:L.status)?(0,C.jsx)(v.Z,{color:"error",children:F(null===L||void 0===L?void 0:L.status)}):(0,C.jsx)(v.Z,{color:"cyan",children:F(null===L||void 0===L?void 0:L.status)})]}),(0,C.jsxs)("p",{children:[F("payment.method")," ",(0,C.jsx)("strong",{children:null===L||void 0===L||null===(e=L.transaction)||void 0===e||null===(n=e.payment_system)||void 0===n?void 0:n.tag})]}),(0,C.jsxs)("p",{children:[F("order.type")," ",(0,C.jsx)("strong",{children:null===L||void 0===L?void 0:L.delivery_type})]}),(0,C.jsxs)("p",{children:[F("payment.type")," ",(0,C.jsx)("strong",{children:null===L||void 0===L||null===(g=L.transaction)||void 0===g?void 0:g.status})]})]}),(0,C.jsxs)(u.Z,{span:24,className:"mt-5",children:[(0,C.jsx)("h4",{children:F("map")}),(0,C.jsx)("div",{className:"map-container",style:{height:400,width:"100%"},children:(0,C.jsx)(i.ZP,{bootstrapURLKeys:{key:q?j.kr:q},defaultZoom:10,center:null!==A&&void 0!==A?A:D,options:{fullscreenControl:!1},children:(0,C.jsx)($,{lat:null===A||void 0===A?void 0:A.lat,lng:null===A||void 0===A?void 0:A.lng})})})]})]})]})})})}},18478:(l,e,n)=>{l.exports=n.p+"static/media/user.fbe7078c52acde79652d.jpg"}}]);