{"ast":null,"code":"import React,{useState}from'react';import{Button,Card,Col,Divider,Form,Input,InputNumber,Row,Select,Switch}from'antd';import TextArea from'antd/es/input/TextArea';import userService from'../../services/user';import{shallowEqual,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import categoryService from'../../services/category';import Map from'../../components/map';import AddressInput from'../../components/address-input';import MediaUpload from'../../components/upload';import{AppstoreOutlined}from'@ant-design/icons';import UserModal from'../../components/shop/user-modal';import CategoryModal from'../../components/shop/category-modal';import{RefetchSearch}from'../../components/refetch-search';import shopTagService from'../../services/shopTag';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const RestaurantAddData=_ref=>{let{logoImage,setLogoImage,backImage,setBackImage,form,location,setLocation,user}=_ref;const{t}=useTranslation();const[userModal,setUserModal]=useState(null);const[category,setCategory]=useState(null);const[userRefetch,setUserRefetch]=useState(null);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);async function fetchUserList(search){const params={search,roles:'user','empty-shop':1};setUserRefetch(false);return userService.search(params).then(res=>res.data.map(item=>({label:item.firstname+' '+(item.lastname?item.lastname:''),value:item.id})));}async function fetchRestaurantCategory(search){const params={search,type:'shop'};setUserRefetch(false);return categoryService.getAll(params).then(_ref2=>{let{data}=_ref2;return data.map(item=>{var _item$translation;return{label:((_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title)||'no name',value:item.id};});});}async function fetchShopTag(search){setUserRefetch(false);const params={search};return shopTagService.getAll(params).then(_ref3=>{let{data}=_ref3;return data.map(item=>{var _item$translation2;return{label:((_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title)||'no name',value:item.id};});});}const goToAddClient=()=>{setUserModal(true);setUserRefetch(true);};const goToAddCategory=()=>{setCategory(true);setUserRefetch(true);};const handleCancel=()=>{setUserModal(false);setCategory(false);};return/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('logo.image'),children:/*#__PURE__*/_jsx(MediaUpload,{type:\"shops/logo\",imageList:logoImage,setImageList:setLogoImage,form:form,multiple:false,name:\"logo_img\"})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('background.image'),children:/*#__PURE__*/_jsx(MediaUpload,{type:\"shops/background\",imageList:backImage,setImageList:setBackImage,form:form,multiple:false,name:\"background_img\"})})}),/*#__PURE__*/_jsx(Col,{span:10,children:/*#__PURE__*/_jsx(Form.Item,{label:t('status.note'),name:\"status_note\",children:/*#__PURE__*/_jsx(TextArea,{rows:4})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{name:\"status\",label:t('status'),children:/*#__PURE__*/_jsx(Input,{disabled:true})})}),/*#__PURE__*/_jsx(Col,{span:2,children:/*#__PURE__*/_jsx(Form.Item,{label:t('open'),name:\"open\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{disabled:true})})})]})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:t('general'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')},{min:2,message:t('title.required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'title'+idx))}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('phone'),name:\"phone\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})})]})}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:`description[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')},{min:3,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:4})},'desc'+idx))}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Form.Item,{label:t('restaurant.tags'),name:\"tags\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{mode:\"multiple\",fetchOptions:fetchShopTag,refetch:userRefetch})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Form.Item,{label:t('seller'),name:\"user\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{disabled:user,fetchOptions:fetchUserList,refetch:userRefetch,dropdownRender:menu=>/*#__PURE__*/_jsxs(_Fragment,{children:[menu,/*#__PURE__*/_jsx(Divider,{style:{margin:'8px 0'}}),/*#__PURE__*/_jsx(Button,{className:\"w-100\",disabled:user,icon:/*#__PURE__*/_jsx(AppstoreOutlined,{}),onClick:goToAddClient,children:t('add.user')})]})})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Form.Item,{label:t('categories'),name:\"categories\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{mode:\"multiple\",fetchOptions:fetchRestaurantCategory,refetch:userRefetch,dropdownRender:menu=>/*#__PURE__*/_jsxs(_Fragment,{children:[menu,/*#__PURE__*/_jsx(Divider,{style:{margin:'8px 0'}}),/*#__PURE__*/_jsx(Button,{className:\"w-100\",icon:/*#__PURE__*/_jsx(AppstoreOutlined,{}),onClick:goToAddCategory,children:t('add.category')})]})})})})]})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Card,{title:t('delivery'),children:/*#__PURE__*/_jsxs(Row,{gutter:8,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"price\",label:t('min.price'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"price_per_km\",label:t('price.per.km'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})})]})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Card,{title:t('delivery.time'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_time_type\",label:t('delivery_time_type'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsxs(Select,{className:\"w-100\",children:[/*#__PURE__*/_jsx(Select.Option,{value:\"minute\",label:t('minutes')}),/*#__PURE__*/_jsx(Select.Option,{value:\"hour\",label:t('hour')})]})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_time_from\",label:t('delivery_time_from'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_time_to\",label:t('delivery_time_to'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})})]})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Card,{title:t('order.info'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('min.amount'),name:\"min_amount\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('tax'),name:\"tax\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,addonAfter:'%',className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('admin.comission'),name:\"percentage\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\",addonAfter:'%'})})})]})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:t('address'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(AddressInput,{setLocation:setLocation,form:form,item:item,idx:idx,defaultLang:defaultLang},idx))}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Map,{location:location,setLocation:setLocation,setAddress:value=>form.setFieldsValue({[`address[${defaultLang}]`]:value})})})]})})}),userModal&&/*#__PURE__*/_jsx(UserModal,{visible:userModal,handleCancel:()=>handleCancel()}),category&&/*#__PURE__*/_jsx(CategoryModal,{visible:category,handleCancel:()=>handleCancel()})]});};export default RestaurantAddData;","map":null,"metadata":{},"sourceType":"module"}