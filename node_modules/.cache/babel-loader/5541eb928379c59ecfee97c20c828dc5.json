{"ast":null,"code":"var _jsxFileName = \"/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/banners/banner-edit.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { Form, Spin } from 'antd';\nimport { batch, shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { disableRefetch, removeFromMenu, setMenuData } from '../../redux/slices/menu';\nimport { fetchBanners } from '../../redux/slices/banner';\nimport bannerService from '../../services/banner';\nimport { useTranslation } from 'react-i18next';\nimport getTranslationFields from '../../helpers/getTranslationFields';\nimport BannerForm from './banner-form';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst BannerEdit = () => {\n  _s();\n\n  const {\n    t\n  } = useTranslation();\n  const {\n    activeMenu\n  } = useSelector(state => state.menu, shallowEqual);\n  const dispatch = useDispatch();\n  const [form] = Form.useForm();\n  const navigate = useNavigate();\n  const {\n    id\n  } = useParams();\n  const [loading, setLoading] = useState(false);\n  const {\n    languages\n  } = useSelector(state => state.formLang, shallowEqual);\n  useEffect(() => {\n    return () => {\n      const data = form.getFieldsValue(true);\n      dispatch(setMenuData({\n        activeMenu,\n        data\n      }));\n    };\n  }, []);\n\n  const createMediaFile = items => {\n    const mediaObject = {\n      images: [],\n      previews: []\n    };\n    const previews = items.filter(item => item.preview).map(item => ({\n      uid: item.id,\n      name: item.preview,\n      url: item.preview\n    }));\n    const videos = items.filter(item => item.preview).map(item => ({\n      uid: item.id,\n      name: item.path,\n      url: item.path,\n      isVideo: true\n    }));\n    mediaObject.previews = previews;\n    mediaObject.images = videos;\n    return mediaObject;\n  };\n\n  const createImages = items => items.map(item => ({\n    uid: item.id,\n    name: item.path,\n    url: item.path,\n    isVideo: Boolean(item.preview)\n  }));\n\n  function getLanguageFields(data) {\n    if (!data) {\n      return {};\n    }\n\n    const {\n      translations\n    } = data;\n    const result = languages.map(item => {\n      var _translations$find, _translations$find2;\n\n      return {\n        [`title[${item.locale}]`]: (_translations$find = translations.find(el => el.locale === item.locale)) === null || _translations$find === void 0 ? void 0 : _translations$find.title,\n        [`description[${item.locale}]`]: (_translations$find2 = translations.find(el => el.locale === item.locale)) === null || _translations$find2 === void 0 ? void 0 : _translations$find2.description\n      };\n    });\n    return Object.assign({}, ...result);\n  }\n\n  const getBanner = alias => {\n    setLoading(true);\n    bannerService.getById(alias).then(res => {\n      var _banner$products;\n\n      const banner = res.data;\n      const data = { ...banner,\n        initialMediaFile: createMediaFile(res.data.galleries),\n        img: createImages(banner.galleries),\n        products: banner === null || banner === void 0 ? void 0 : (_banner$products = banner.products) === null || _banner$products === void 0 ? void 0 : _banner$products.map(item => {\n          var _item$translation;\n\n          return {\n            label: (_item$translation = item.translation) === null || _item$translation === void 0 ? void 0 : _item$translation.title,\n            value: item.id\n          };\n        }),\n        ...getLanguageFields(banner)\n      };\n      form.setFieldsValue(data);\n      dispatch(setMenuData({\n        activeMenu,\n        data\n      }));\n    }).finally(() => {\n      dispatch(disableRefetch(activeMenu));\n      setLoading(false);\n    });\n  };\n\n  const onFinish = (values, image, mediaList) => {\n    var _values$products;\n\n    const videos = mediaList.images.map(item => item.name);\n    const previews = mediaList.previews.map(item => item.name);\n    const body = {\n      products: (_values$products = values.products) === null || _values$products === void 0 ? void 0 : _values$products.map(i => i.value),\n      images: [...videos, ...image.map(image => image.name)],\n      previews,\n      clickable: true,\n      title: getTranslationFields(languages, values, 'title'),\n      description: getTranslationFields(languages, values, 'description')\n    };\n    const nextUrl = 'banners';\n    return bannerService.update(id, body).then(() => {\n      toast.success(t('successfully.updated'));\n      batch(() => {\n        dispatch(removeFromMenu({ ...activeMenu,\n          nextUrl\n        }));\n        dispatch(fetchBanners({}));\n      });\n      navigate(`/${nextUrl}`);\n    });\n  };\n\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      getBanner(id);\n    }\n  }, [activeMenu.refetch]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: !loading ? /*#__PURE__*/_jsxDEV(BannerForm, {\n      form: form,\n      handleSubmit: onFinish\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex justify-content-center align-items-center\",\n      children: /*#__PURE__*/_jsxDEV(Spin, {\n        size: \"large\",\n        className: \"py-5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(BannerEdit, \"ep/CfslYTgS4D92YCjHzy9eyAE0=\", false, function () {\n  return [useTranslation, useSelector, useDispatch, Form.useForm, useNavigate, useParams, useSelector];\n});\n\n_c = BannerEdit;\nexport default BannerEdit;\n\nvar _c;\n\n$RefreshReg$(_c, \"BannerEdit\");","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useParams","toast","Form","Spin","batch","shallowEqual","useDispatch","useSelector","disableRefetch","removeFromMenu","setMenuData","fetchBanners","bannerService","useTranslation","getTranslationFields","BannerForm","BannerEdit","t","activeMenu","state","menu","dispatch","form","useForm","navigate","id","loading","setLoading","languages","formLang","data","getFieldsValue","createMediaFile","items","mediaObject","images","previews","filter","item","preview","map","uid","name","url","videos","path","isVideo","createImages","Boolean","getLanguageFields","translations","result","locale","find","el","title","description","Object","assign","getBanner","alias","getById","then","res","banner","initialMediaFile","galleries","img","products","label","translation","value","setFieldsValue","finally","onFinish","values","image","mediaList","body","i","clickable","nextUrl","update","success","refetch"],"sources":["/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/banners/banner-edit.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { Form, Spin } from 'antd';\nimport { batch, shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport {\n  disableRefetch,\n  removeFromMenu,\n  setMenuData,\n} from '../../redux/slices/menu';\nimport { fetchBanners } from '../../redux/slices/banner';\nimport bannerService from '../../services/banner';\nimport { useTranslation } from 'react-i18next';\nimport getTranslationFields from '../../helpers/getTranslationFields';\nimport BannerForm from './banner-form';\n\nconst BannerEdit = () => {\n  const { t } = useTranslation();\n  const { activeMenu } = useSelector((state) => state.menu, shallowEqual);\n  const dispatch = useDispatch();\n  const [form] = Form.useForm();\n  const navigate = useNavigate();\n  const { id } = useParams();\n  const [loading, setLoading] = useState(false);\n  const { languages } = useSelector((state) => state.formLang, shallowEqual);\n\n  useEffect(() => {\n    return () => {\n      const data = form.getFieldsValue(true);\n      dispatch(setMenuData({ activeMenu, data }));\n    };\n  }, []);\n\n  const createMediaFile = (items) => {\n    const mediaObject = { images: [], previews: [] };\n    const previews = items\n      .filter((item) => item.preview)\n      .map((item) => ({\n        uid: item.id,\n        name: item.preview,\n        url: item.preview,\n      }));\n    const videos = items\n      .filter((item) => item.preview)\n      .map((item) => ({\n        uid: item.id,\n        name: item.path,\n        url: item.path,\n        isVideo: true,\n      }));\n    mediaObject.previews = previews;\n    mediaObject.images = videos;\n\n    return mediaObject;\n  };\n\n  const createImages = (items) =>\n    items.map((item) => ({\n      uid: item.id,\n      name: item.path,\n      url: item.path,\n      isVideo: Boolean(item.preview),\n    }));\n\n  function getLanguageFields(data) {\n    if (!data) {\n      return {};\n    }\n    const { translations } = data;\n    const result = languages.map((item) => ({\n      [`title[${item.locale}]`]: translations.find(\n        (el) => el.locale === item.locale\n      )?.title,\n      [`description[${item.locale}]`]: translations.find(\n        (el) => el.locale === item.locale\n      )?.description,\n    }));\n    return Object.assign({}, ...result);\n  }\n\n  const getBanner = (alias) => {\n    setLoading(true);\n    bannerService\n      .getById(alias)\n      .then((res) => {\n        const banner = res.data;\n\n        const data = {\n          ...banner,\n          initialMediaFile: createMediaFile(res.data.galleries),\n          img: createImages(banner.galleries),\n          products: banner?.products?.map((item) => ({\n            label: item.translation?.title,\n            value: item.id,\n          })),\n          ...getLanguageFields(banner),\n        };\n\n        form.setFieldsValue(data);\n        dispatch(setMenuData({ activeMenu, data }));\n      })\n      .finally(() => {\n        dispatch(disableRefetch(activeMenu));\n        setLoading(false);\n      });\n  };\n\n  const onFinish = (values, image, mediaList) => {\n    const videos = mediaList.images.map((item) => item.name);\n    const previews = mediaList.previews.map((item) => item.name);\n    const body = {\n      products: values.products?.map((i) => i.value),\n      images: [...videos, ...image.map((image) => image.name)],\n      previews,\n      clickable: true,\n      title: getTranslationFields(languages, values, 'title'),\n      description: getTranslationFields(languages, values, 'description'),\n    };\n    const nextUrl = 'banners';\n\n    return bannerService.update(id, body).then(() => {\n      toast.success(t('successfully.updated'));\n      batch(() => {\n        dispatch(removeFromMenu({ ...activeMenu, nextUrl }));\n        dispatch(fetchBanners({}));\n      });\n      navigate(`/${nextUrl}`);\n    });\n  };\n\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      getBanner(id);\n    }\n  }, [activeMenu.refetch]);\n\n  return (\n    <>\n      {!loading ? (\n        <BannerForm form={form} handleSubmit={onFinish} />\n      ) : (\n        <div className='d-flex justify-content-center align-items-center'>\n          <Spin size='large' className='py-5' />\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default BannerEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}