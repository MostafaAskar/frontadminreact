{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Table,Card,Tabs,Tag,Space}from'antd';import{EditOutlined,EyeOutlined}from'@ant-design/icons';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,setMenuData}from'../../redux/slices/menu';import{useTranslation}from'react-i18next';import useDidUpdate from'../../helpers/useDidUpdate';import formatSortType from'../../helpers/formatSortType';import{DebounceSelect}from'../../components/search';import userService from'../../services/user';import{fetchTransactions}from'../../redux/slices/transaction';import TransactionShowModal from'./transactionShowModal';import numberToPrice from'../../helpers/numberToPrice';import FilterColumns from'../../components/filter-column';import moment from'moment';import StatusModal from'./status-modal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{TabPane}=Tabs;const statuses=['all','progress','paid','canceled','rejected'];export default function Transactions(){var _activeMenu$data,_activeMenu$data2,_activeMenu$data3,_activeMenu$data4;const dispatch=useDispatch();const{t}=useTranslation();const[showId,setShowId]=useState(null);const[transactionDetails,setTransactionDetails]=useState(null);const goToShow=row=>{setShowId(row.id);};const[columns,setColumns]=useState([{title:t('id'),dataIndex:'id',key:'id',sorter:true,is_show:true},{title:t('client'),dataIndex:'user',key:'user',is_show:true,render:user=>user===null?/*#__PURE__*/_jsx(Tag,{color:\"red\",children:t('deleted.user')}):/*#__PURE__*/_jsxs(\"div\",{children:[user===null||user===void 0?void 0:user.firstname,\" \",(user===null||user===void 0?void 0:user.lastname)||'']})},{title:t('amount'),dataIndex:'price',key:'price',is_show:true,render:(price,row)=>{var _row$payable,_row$payable$order,_row$payable$order$cu;return numberToPrice(price,(_row$payable=row.payable)===null||_row$payable===void 0?void 0:(_row$payable$order=_row$payable.order)===null||_row$payable$order===void 0?void 0:(_row$payable$order$cu=_row$payable$order.currency)===null||_row$payable$order$cu===void 0?void 0:_row$payable$order$cu.symbol);}},{title:t('payment.type'),dataIndex:'payment_system',key:'payment_system',is_show:true,render:paymentSystem=>paymentSystem===null||paymentSystem===void 0?void 0:paymentSystem.tag},{title:t('status'),dataIndex:'status',key:'status',is_show:true,render:(status,row)=>/*#__PURE__*/_jsxs(\"div\",{children:[status==='progress'?/*#__PURE__*/_jsx(Tag,{color:\"gold\",children:t(status)}):status==='rejected'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(status)}):status==='canceled'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(status)}),/*#__PURE__*/_jsx(EditOutlined,{onClick:()=>{setTransactionDetails(row);}})]})},{title:t('status.note'),dataIndex:'status_description',key:'status_description',is_show:true},{title:t('created.at'),dataIndex:'created_at',key:'created_at',is_show:true,render:created_at=>moment(created_at).format('DD.MM.YYYY HH:mm')},{title:t('options'),key:'options',is_show:true,render:(_,row)=>{return/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(EyeOutlined,{}),onClick:()=>goToShow(row)});}}]);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[role,setRole]=useState('all');const{transactions,meta,loading,params}=useSelector(state=>state.transaction,shallowEqual);const immutable=((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.role)||role;const data=activeMenu.data;const paramsData={sort:data===null||data===void 0?void 0:data.sort,column:data===null||data===void 0?void 0:data.column,perPage:data===null||data===void 0?void 0:data.perPage,page:data===null||data===void 0?void 0:data.page,user_id:data===null||data===void 0?void 0:data.userId,status:(data===null||data===void 0?void 0:data.role)==='all'?undefined:data===null||data===void 0?void 0:data.role};function onChangePagination(pagination,filters,sorter){const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{...data,perPage,page,column,sort}}));}useDidUpdate(()=>{dispatch(fetchTransactions(paramsData));},[activeMenu.data]);useEffect(()=>{if(activeMenu.refetch){dispatch(fetchTransactions(params));dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);const handleFilter=items=>{const data=activeMenu.data;dispatch(setMenuData({activeMenu,data:{...data,...items}}));};async function getUsers(search){const params={search,perPage:10};return userService.search(params).then(_ref=>{let{data}=_ref;return data.map(item=>({label:`${item.firstname} ${item.lastname}`,value:item.id}));});}return/*#__PURE__*/_jsxs(Card,{title:t('transactions'),extra:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[/*#__PURE__*/_jsx(DebounceSelect,{placeholder:t('select.client'),fetchOptions:getUsers,onSelect:user=>handleFilter({userId:user.value}),onDeselect:()=>handleFilter({userId:null}),style:{minWidth:200}}),/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})]}),children:[/*#__PURE__*/_jsx(Tabs,{onChange:key=>{handleFilter({role:key,page:1});setRole(key);},type:\"card\",activeKey:immutable,children:statuses.map(item=>/*#__PURE__*/_jsx(TabPane,{tab:t(item)},item))}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:transactions,loading:loading,pagination:{pageSize:params.perPage,page:((_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.page)||1,total:meta.total,defaultCurrent:(_activeMenu$data3=activeMenu.data)===null||_activeMenu$data3===void 0?void 0:_activeMenu$data3.page,current:(_activeMenu$data4=activeMenu.data)===null||_activeMenu$data4===void 0?void 0:_activeMenu$data4.page},rowKey:record=>record.id,onChange:onChangePagination}),showId&&/*#__PURE__*/_jsx(TransactionShowModal,{id:showId,handleCancel:()=>setShowId(null)}),transactionDetails&&/*#__PURE__*/_jsx(StatusModal,{transactionDetails:transactionDetails,handleCancel:()=>setTransactionDetails(null),paramsData:paramsData})]});}","map":null,"metadata":{},"sourceType":"module"}