{"ast":null,"code":"import{Button,Col,Form,Input,Row,Select,Switch}from'antd';import React,{useState,useEffect}from'react';import{useTranslation}from'react-i18next';import deliveryService from'../../services/delivery';import Loading from'../../components/loading';import{shallowEqual,useSelector}from'react-redux';import MediaUpload from'../../components/upload';import Map from'../../components/map';import getDefaultLocation from'../../helpers/getDefaultLocation';import{toast}from'react-toastify';import{DebounceSelect}from'components/search';import cityService from'services/deliveryzone/city';import countryService from'services/deliveryzone/country';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const type_of_technique=[{label:'Benzine',value:'benzine'},{label:'Diesel',value:'diesel'},{label:'Gas',value:'gas'},{label:'Motorbike',value:'motorbike'},{label:'Bike',value:'bike'},{label:'Foot',value:'foot'},{label:'Electric',value:'electric'}];const DelivertSettingCreate=_ref=>{let{id,data}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);const[image,setImage]=useState([]);const[address,setAddress]=useState('');const{settings}=useSelector(state=>state.globalSettings,shallowEqual);const[location,setLocation]=useState(getDefaultLocation(settings));const createImages=items=>items.map(item=>({uid:item.id,name:item.path,url:item.path}));const fetchDeliverySettings=id=>{setLoading(true);deliveryService.getById(id).then(res=>{var _res$data,_res$data$country,_res$data$country$tra,_res$data2,_res$data2$country,_res$data3,_res$data3$country,_res$data4,_res$data4$city,_res$data4$city$trans,_res$data5,_res$data5$city,_res$data$deliveryman,_res$data$deliveryman2,_res$data$deliveryman3,_res$data6,_res$data6$location,_res$data7,_res$data7$location,_res$data8,_res$data8$location,_res$data9,_res$data9$location;const responseData={...res.data,country:{label:(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$country=_res$data.country)===null||_res$data$country===void 0?void 0:(_res$data$country$tra=_res$data$country.translation)===null||_res$data$country$tra===void 0?void 0:_res$data$country$tra.title,value:(_res$data2=res.data)===null||_res$data2===void 0?void 0:(_res$data2$country=_res$data2.country)===null||_res$data2$country===void 0?void 0:_res$data2$country.id,key:(_res$data3=res.data)===null||_res$data3===void 0?void 0:(_res$data3$country=_res$data3.country)===null||_res$data3$country===void 0?void 0:_res$data3$country.region_id},city:{label:(_res$data4=res.data)===null||_res$data4===void 0?void 0:(_res$data4$city=_res$data4.city)===null||_res$data4$city===void 0?void 0:(_res$data4$city$trans=_res$data4$city.translation)===null||_res$data4$city$trans===void 0?void 0:_res$data4$city$trans.title,value:(_res$data5=res.data)===null||_res$data5===void 0?void 0:(_res$data5$city=_res$data5.city)===null||_res$data5$city===void 0?void 0:_res$data5$city.id},user_id:{label:((_res$data$deliveryman=res.data.deliveryman)===null||_res$data$deliveryman===void 0?void 0:_res$data$deliveryman.firstname)+' '+((_res$data$deliveryman2=res.data.deliveryman)===null||_res$data$deliveryman2===void 0?void 0:_res$data$deliveryman2.firstname),value:(_res$data$deliveryman3=res.data.deliveryman)===null||_res$data$deliveryman3===void 0?void 0:_res$data$deliveryman3.id,images:createImages(res.data.galleries),location:{lat:(_res$data6=res.data)===null||_res$data6===void 0?void 0:(_res$data6$location=_res$data6.location)===null||_res$data6$location===void 0?void 0:_res$data6$location.latitude,lng:(_res$data7=res.data)===null||_res$data7===void 0?void 0:(_res$data7$location=_res$data7.location)===null||_res$data7$location===void 0?void 0:_res$data7$location.longitude}}};setLocation({lat:(_res$data8=res.data)===null||_res$data8===void 0?void 0:(_res$data8$location=_res$data8.location)===null||_res$data8$location===void 0?void 0:_res$data8$location.latitude,lng:(_res$data9=res.data)===null||_res$data9===void 0?void 0:(_res$data9$location=_res$data9.location)===null||_res$data9$location===void 0?void 0:_res$data9$location.longitude});setImage(createImages(res.data.galleries));form.setFieldsValue(responseData);}).finally(()=>setLoading(false));};const onFinish=values=>{var _values$country,_values$city,_image$,_image$2,_values$country2,_values$city2,_values$country3;console.log(values);if(!address.includes((_values$country=values.country)===null||_values$country===void 0?void 0:_values$country.label)){toast.warn(t('please.choose.corrent.location'));return;}if(values.city&&!address.includes((_values$city=values.city)===null||_values$city===void 0?void 0:_values$city.label)){toast.warn(t('please.choose.corrent.location'));return;}setLoadingBtn(true);const params={...values,user_id:data.id,images:(_image$=image[0])!==null&&_image$!==void 0&&_image$.name?[(_image$2=image[0])===null||_image$2===void 0?void 0:_image$2.name]:undefined,country_id:values===null||values===void 0?void 0:(_values$country2=values.country)===null||_values$country2===void 0?void 0:_values$country2.value,city_id:values===null||values===void 0?void 0:(_values$city2=values.city)===null||_values$city2===void 0?void 0:_values$city2.value,region_id:values===null||values===void 0?void 0:(_values$country3=values.country)===null||_values$country3===void 0?void 0:_values$country3.key,location:{latitude:location.lat,longitude:location.lng},online:Boolean(values.online)};deliveryService.update(id,params).then(()=>toast.success(t('successfully.updated'))).finally(()=>setLoadingBtn(false));};const country=Form.useWatch('country',form);const fetchCountries=search=>{const params={search,perPage:10,page:1,has_price:1};return countryService.get(params).then(_ref2=>{let{data}=_ref2;return data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.region_id};});});};const fetchCities=search=>{const params={search,perPage:10,page:1,country_id:country===null||country===void 0?void 0:country.value,has_price:1};return cityService.get(params).then(_ref3=>{let{data}=_ref3;return data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation2;return{label:item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});};useEffect(()=>{if(id)fetchDeliverySettings(id);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);return/*#__PURE__*/_jsx(Form,{name:\"basic\",layout:\"vertical\",onFinish:onFinish,form:form,children:loading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('brand'),name:\"brand\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('model'),name:\"model\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('type.of.technique'),name:\"type_of_technique\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{options:type_of_technique})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('car.number'),name:\"number\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('car.color'),name:\"color\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"country\",label:t('country'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchCountries,placeholder:t('select.country'),onClear:()=>{form.setFieldsValue({city:[]});},autoComplete:\"none\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"city\",label:t('city'),children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchCities,placeholder:t('select.city'),refetchOptions:true,disabled:!country,autoComplete:\"none\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),name:\"images\",children:/*#__PURE__*/_jsx(MediaUpload,{type:\"deliveryman/settings\",imageList:image,setImageList:setImage,form:form,length:\"1\",multiple:true})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:t('online'),name:\"online\"// rules={[{ required: true, message: t('required') }]}\n,valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('map'),name:\"location\",children:/*#__PURE__*/_jsx(Map,{location:location,setLocation:setLocation,setAddress:setAddress})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('save')})})]})});};export default DelivertSettingCreate;","map":null,"metadata":{},"sourceType":"module"}