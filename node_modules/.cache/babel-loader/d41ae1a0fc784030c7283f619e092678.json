{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Card,Col,Form,Input,InputNumber,Row,Switch}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import productService from'../../../services/seller/product';import{replaceMenu,setMenuData}from'../../../redux/slices/menu';import{useNavigate,useParams}from'react-router-dom';import{useTranslation}from'react-i18next';import unitService from'../../../services/seller/unit';import TextArea from'antd/lib/input/TextArea';import{AsyncSelect}from'../../../components/async-select';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ProductsIndex=_ref=>{let{next,action_type=''}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const dispatch=useDispatch();const{uuid}=useParams();const navigate=useNavigate();const[error,setError]=useState(null);const{myShop:shop}=useSelector(state=>state.myShop,shallowEqual);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const[loadingBtn,setLoadingBtn]=useState(false);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,...data}}));};},[]);const onFinish=values=>{var _values$unit;setLoadingBtn(true);const params={...values,active:Number(values.active),shop_id:shop.id,unit_id:(_values$unit=values.unit)===null||_values$unit===void 0?void 0:_values$unit.value,shop:undefined,addon:Number(1)};if(action_type==='edit'){productUpdate(values,params);}else{productCreate(values,params);}};function productCreate(values,params){productService.create(params).then(_ref2=>{let{data}=_ref2;dispatch(replaceMenu({id:`addons-${data.uuid}`,url:`seller/addon/${data.uuid}`,name:t('add.addons'),data:values,refetch:false}));navigate(`/seller/addon/${data.uuid}?step=1`);}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));}function productUpdate(values,params){productService.update(uuid,params).then(()=>{dispatch(setMenuData({activeMenu,data:values}));next();}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));}function fetchUnits(search){const params={search,active:1};return unitService.getAll(params).then(_ref3=>{let{data}=_ref3;return formatUnits(data);});}function formatUnits(data){return data.map(item=>{var _item$translation;return{label:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id};});}return/*#__PURE__*/_jsxs(Form,{layout:\"vertical\",form:form,initialValues:{active:true,...activeMenu.data},onFinish:onFinish,className:'addon-menu',children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsxs(Col,{xs:24,sm:24,md:16,children:[/*#__PURE__*/_jsxs(Card,{title:t('basic.info'),children:[languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('name'),name:`title[${item.locale}]`,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'name'+item.id)),languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:`description[${item.locale}]`,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<5){return Promise.reject(new Error(t('must.be.at.least.5')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:4,span:4})},'description'+item.id))]}),/*#__PURE__*/_jsx(Card,{title:t('price'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('min.qty'),name:\"min_qty\",rules:[{required:true,message:t('required')},{type:'number',min:0,message:t('must.be.positive')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('max.qty'),name:\"max_qty\",rules:[{required:true,message:t('required')},{type:'number',min:0,message:t('must.be.positive')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('tax'),name:\"tax\",rules:[{required:true,message:t('required')},{type:'number',min:0,max:100,message:t('must.be.between.0.and.100')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",addonAfter:\"%\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})]})})]}),/*#__PURE__*/_jsx(Col,{xs:24,sm:24,md:8,children:/*#__PURE__*/_jsx(Card,{title:t('addition'),children:/*#__PURE__*/_jsx(Form.Item,{label:t('unit'),name:\"unit\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(AsyncSelect,{style:{width:'100%'},fetchOptions:fetchUnits})})})})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('next')})]});};export default ProductsIndex;","map":null,"metadata":{},"sourceType":"module"}