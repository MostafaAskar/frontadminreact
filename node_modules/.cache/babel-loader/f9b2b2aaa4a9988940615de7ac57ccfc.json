{"ast":null,"code":"import React,{useRef,useState}from'react';import{Button,Card,Col,DatePicker,Form,Row,Select}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import moment from'moment';import{getCartData}from'redux/selectors/cartSelector';import{setCartData}from'redux/slices/cart';import{DebounceSelect}from'components/search';import deliveryPointService from'services/delivery-point';import{toast}from'react-toastify';import useDidUpdate from'helpers/useDidUpdate';import deliveryPriceService from'services/delivery-price';import addressService from'../../../../services/seller/address';import{PlusCircleOutlined}from'@ant-design/icons';import DeliveryUserModal from'./delivery-user-modal';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const DeliveryInfo=_ref=>{var _shop$shop_closed_dat,_cartData$deliveryAdd5,_cartData$deliveryAdd6,_cartData$deliveries,_cartData$deliveries2;let{form}=_ref;const{t}=useTranslation();const dispatch=useDispatch();const data=useSelector(state=>getCartData(state.cart));const{myShop:shop}=useSelector(state=>state.myShop,shallowEqual);const{currentBag}=useSelector(state=>state.cart,shallowEqual);const cartData=useSelector(state=>getCartData(state.cart));const[userAddressModal,setUserAddressModal]=useState(null);const filter=shop===null||shop===void 0?void 0:(_shop$shop_closed_dat=shop.shop_closed_date)===null||_shop$shop_closed_dat===void 0?void 0:_shop$shop_closed_dat.map(date=>date.day);const addressesList=useRef([]);function disabledDate(current){const a=filter===null||filter===void 0?void 0:filter.find(date=>date===moment(current).format('YYYY-MM-DD'));const b=moment().add(-1,'days')>=current;if(a){return a;}else{return b;}}const range=(start,end)=>{const x=parseInt(start);const y=parseInt(end);const number=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24];for(let i=x;i<=y;i++){delete number[i];}return number;};const disabledDateTime=()=>({disabledHours:()=>range(moment(cartData===null||cartData===void 0?void 0:cartData.delivery_date).format('YYYYMMDD')===moment(new Date()).format('YYYYMMDD')?moment(new Date()).add(1,'hour').format('HH'):0,24),disabledMinutes:()=>[],disabledSeconds:()=>[]});const delivery=[{label:t('delivery'),value:'delivery',key:1},{label:t('pickup'),value:'point',key:0}];const setDeliveryPrice=delivery=>dispatch(setCartData({delivery_fee:delivery.value,bag_id:currentBag}));const fetchDeliveryPoints=search=>{const params={search,perPage:10,page:1};return deliveryPointService.get(params).then(_ref2=>{let{data}=_ref2;return data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});};const fetchUserAddresses=search=>{const params={search,perPage:10,page:1};return addressService.getAll(params).then(_ref3=>{let{data}=_ref3;addressesList.current=data;return data===null||data===void 0?void 0:data.map(item=>{var _item$location;return{label:(item===null||item===void 0?void 0:item.title)||((_item$location=item.location)===null||_item$location===void 0?void 0:_item$location.address),value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});};const goToAddUserDeliveryAddress=()=>{if(!data.userUuid){toast.warning(t('please.select.client'));return;}setUserAddressModal(data.userUuid);};useDidUpdate(()=>{var _cartData$deliveryAdd,_cartData$deliveryAdd2;if(cartData!==null&&cartData!==void 0&&(_cartData$deliveryAdd=cartData.deliveryAddress)!==null&&_cartData$deliveryAdd!==void 0&&_cartData$deliveryAdd.country_id&&cartData!==null&&cartData!==void 0&&(_cartData$deliveryAdd2=cartData.deliveryAddress)!==null&&_cartData$deliveryAdd2!==void 0&&_cartData$deliveryAdd2.city_id){var _cartData$deliveryAdd3,_cartData$deliveryAdd4;const body={country_id:cartData===null||cartData===void 0?void 0:(_cartData$deliveryAdd3=cartData.deliveryAddress)===null||_cartData$deliveryAdd3===void 0?void 0:_cartData$deliveryAdd3.country_id,city_id:cartData===null||cartData===void 0?void 0:(_cartData$deliveryAdd4=cartData.deliveryAddress)===null||_cartData$deliveryAdd4===void 0?void 0:_cartData$deliveryAdd4.city_id};deliveryPriceService.get(body).then(_ref4=>{var _data$;let{data}=_ref4;dispatch(setCartData({delivery_price_id:data===null||data===void 0?void 0:(_data$=data[0])===null||_data$===void 0?void 0:_data$.id,bag_id:currentBag}));});}},[cartData===null||cartData===void 0?void 0:(_cartData$deliveryAdd5=cartData.deliveryAddress)===null||_cartData$deliveryAdd5===void 0?void 0:_cartData$deliveryAdd5.country_id,cartData===null||cartData===void 0?void 0:(_cartData$deliveryAdd6=cartData.deliveryAddress)===null||_cartData$deliveryAdd6===void 0?void 0:_cartData$deliveryAdd6.city_id]);return/*#__PURE__*/_jsxs(Card,{title:t('shipping.info'),className:\"p-0\",children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery\",label:t('delivery'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{placeholder:t('delivery.type'),options:delivery,labelInValue:true,onSelect:setDeliveryPrice,onChange:deliveries=>dispatch(setCartData({delivery_type:deliveries.value,deliveries,bag_id:currentBag}))})})}),(cartData===null||cartData===void 0?void 0:(_cartData$deliveries=cartData.deliveries)===null||_cartData$deliveries===void 0?void 0:_cartData$deliveries.key)===1&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Col,{span:21,children:/*#__PURE__*/_jsx(Form.Item,{name:\"address\",label:t('address'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchUserAddresses,placeholder:t('select.address'),allowClear:false,onChange:e=>{var _selectedAddress$loca;if(e===undefined)return dispatch(setCartData({bag_id:currentBag,address:'',deliveryAddress:null}));const selectedAddress=addressesList.current.find(item=>item.id===e.value);dispatch(setCartData({bag_id:currentBag,address:e,deliveryAddress:{address:(_selectedAddress$loca=selectedAddress.location)===null||_selectedAddress$loca===void 0?void 0:_selectedAddress$loca.address,country_id:selectedAddress===null||selectedAddress===void 0?void 0:selectedAddress.country_id,city_id:selectedAddress===null||selectedAddress===void 0?void 0:selectedAddress.city_id,street_house_number:selectedAddress===null||selectedAddress===void 0?void 0:selectedAddress.street_house_number,zip_code:selectedAddress===null||selectedAddress===void 0?void 0:selectedAddress.zipcode,location:selectedAddress===null||selectedAddress===void 0?void 0:selectedAddress.location}}));},autoComplete:\"none\"})})}),/*#__PURE__*/_jsx(Col,{span:3,children:/*#__PURE__*/_jsx(Form.Item,{label:\" \",children:/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),onClick:goToAddUserDeliveryAddress})})})]}),(cartData===null||cartData===void 0?void 0:(_cartData$deliveries2=cartData.deliveries)===null||_cartData$deliveries2===void 0?void 0:_cartData$deliveries2.key)===0&&/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_point\",label:t('delivery.point'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchDeliveryPoints,placeholder:t('select.delivery.point'),onChange:delivery_point=>{dispatch(setCartData({delivery_point,bag_id:currentBag}));}})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_date\",label:t('delivery.date'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{placeholder:t('delivery.date'),className:\"w-100\",format:\"YYYY-MM-DD\",disabledDate:disabledDate,onChange:e=>{const delivery_date=moment(e).format('YYYY-MM-DD');dispatch(setCartData({delivery_date,bag_id:currentBag}));},allowClear:false})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:`${t('delivery.time')} (${t('up.to')})`,name:\"delivery_time\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{disabled:!(data!==null&&data!==void 0&&data.delivery_date),picker:\"time\",placeholder:t('start.time'),className:\"w-100\",format:'HH:mm',showNow:false,disabledTime:disabledDateTime,onChange:e=>{const delivery_time=moment(e).format('HH:mm');dispatch(setCartData({delivery_time,bag_id:currentBag}));},allowClear:false})})})]})})]}),userAddressModal&&/*#__PURE__*/_jsx(DeliveryUserModal,{visible:userAddressModal,handleCancel:()=>setUserAddressModal(null)})]});};export default DeliveryInfo;","map":null,"metadata":{},"sourceType":"module"}