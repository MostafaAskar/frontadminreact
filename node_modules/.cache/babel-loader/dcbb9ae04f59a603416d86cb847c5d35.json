{"ast":null,"code":"import React,{useState}from'react';import{Button,Card,Col,Divider,Form,Input,InputNumber,Row,Select,Switch}from'antd';import TextArea from'antd/es/input/TextArea';import Map from'../map';import MediaUpload from'../upload';import{AppstoreOutlined}from'@ant-design/icons';import{RefetchSearch}from'../refetch-search';import{useTranslation}from'react-i18next';import{shallowEqual,useSelector}from'react-redux';import shopTagService from'services/shopTag';import userService from'services/user';import UserModal from'components/shop/user-modal';import CategoryModal from'components/shop/category-modal';import AddressForm from'./address-form';import{ShopTypes}from'constants/shop-types';import{deliveryTimeTypes}from'views/shops/delivery-time-types';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const{Option}=Select;const ShopFormData=_ref=>{let{backImage,setBackImage,logoImage,setLogoImage,form,user,setLocation,location}=_ref;const{t}=useTranslation();const[userModal,setUserModal]=useState(null);const[category,setCategory]=useState(null);const[userRefetch,setUserRefetch]=useState(null);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const[value,setValue]=useState('');async function fetchUserList(search){const params={search,roles:'user','empty-shop':1};setUserRefetch(false);return userService.search(params).then(res=>res.data.map(item=>({label:(item===null||item===void 0?void 0:item.firstname)+' '+((item===null||item===void 0?void 0:item.lastname)||''),value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id})));}async function fetchShopTag(search){setUserRefetch(false);const params={search};return shopTagService.getAll(params).then(_ref2=>{let{data}=_ref2;return data.map(item=>{var _item$translation;return{label:(item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title)||'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}const goToAddClient=()=>{setUserModal(true);setUserRefetch(true);};const handleCancel=()=>{setUserModal(false);setCategory(false);};return/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('logo.image'),name:\"logo_img\",rules:[{required:!(logoImage!==null&&logoImage!==void 0&&logoImage.length),message:t('required')}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"shops/logo\",imageList:logoImage,setImageList:setLogoImage,form:form,multiple:false,name:\"logo_img\"})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('background.image'),name:\"background_img\",rules:[{required:!(backImage!==null&&backImage!==void 0&&backImage.length),message:t('required')}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"shops/background\",imageList:backImage,setImageList:setBackImage,form:form,multiple:false,name:\"background_img\"})})}),/*#__PURE__*/_jsx(Col,{span:10,children:/*#__PURE__*/_jsx(Form.Item,{label:t('status.note'),name:\"status_note\",children:/*#__PURE__*/_jsx(TextArea,{rows:4,maxLength:100})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{name:\"status\",label:t('status'),children:/*#__PURE__*/_jsx(Input,{disabled:true})})}),/*#__PURE__*/_jsx(Col,{span:2,children:/*#__PURE__*/_jsx(Form.Item,{label:t('open'),name:\"open\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{disabled:true})})})]})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:t('general'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,rules:[{required:(item===null||item===void 0?void 0:item.locale)===defaultLang,message:t('required')},{validator(_,value){var _value$trim;if(value&&(value===null||value===void 0?void 0:(_value$trim=value.trim())===null||_value$trim===void 0?void 0:_value$trim.length)<2&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{maxLength:50})},'title'+idx))}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('phone'),name:\"phone\",rules:[{required:true,message:t('required')},{type:'number',max:99999999999999999999,message:t('max.length.20')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})})]})}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:`description[${item.locale}]`,rules:[{required:(item===null||item===void 0?void 0:item.locale)===defaultLang,message:t('required')},{validator(_,value){var _value$trim2;if(value&&(value===null||value===void 0?void 0:(_value$trim2=value.trim())===null||_value$trim2===void 0?void 0:_value$trim2.length)<5&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('must.be.at.least.5')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:4,maxLength:150})},'desc'+idx))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('shop.tags'),name:\"tags\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{mode:\"multiple\",fetchOptions:fetchShopTag,refetch:userRefetch})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('shop.type'),name:\"delivery_type\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{options:ShopTypes})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('seller'),name:\"user\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{disabled:user,fetchOptions:fetchUserList,refetch:userRefetch,dropdownRender:menu=>/*#__PURE__*/_jsxs(_Fragment,{children:[menu,/*#__PURE__*/_jsx(Divider,{style:{margin:'8px 0'}}),/*#__PURE__*/_jsx(Button,{className:\"w-100\",icon:/*#__PURE__*/_jsx(AppstoreOutlined,{}),onClick:goToAddClient,children:t('add.user')})]})})})})]})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Card,{title:t('delivery.time'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_time_type\",label:t('delivery_time_type'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{className:\"w-100\",children:deliveryTimeTypes.map(item=>/*#__PURE__*/_jsx(Option,{value:item.value,label:t(item.label)},item.key))})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_time_from\",label:t('delivery_time_from'),rules:[{required:true,message:t('required')},{type:'number',max:9999999999,message:t('max.length.10')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"delivery_time_to\",label:t('delivery_time_to'),rules:[{required:true,message:t('required')},{type:'number',max:9999999999,message:t('max.length.10')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})})]})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Card,{title:t('order.info'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('tax'),name:\"tax\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:100,addonAfter:'%',className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('admin.commission'),name:\"percentage\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:100,className:\"w-100\",addonAfter:'%'})})})]})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:t('address'),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(AddressForm,{value:value,setValue:setValue,setLocation:setLocation})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Map,{location:location,setLocation:setLocation,setAddress:value=>form.setFieldsValue({[`address[${defaultLang}]`]:value})})})]})})}),userModal&&/*#__PURE__*/_jsx(UserModal,{visible:userModal,handleCancel:()=>handleCancel()}),category&&/*#__PURE__*/_jsx(CategoryModal,{visible:category,handleCancel:()=>handleCancel()})]});};export default ShopFormData;","map":null,"metadata":{},"sourceType":"module"}