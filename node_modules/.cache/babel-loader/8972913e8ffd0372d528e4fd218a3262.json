{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useParams}from'react-router-dom';import{toast}from'react-toastify';import{Card,Form}from'antd';import{batch,shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'redux/slices/menu';import{useTranslation}from'react-i18next';import moment from'moment';import{fetchBonus}from'redux/slices/product-bonus';import bonusService from'services/seller/bonus';import Loading from'components/loading';import ProductBonusForm from'./product-bonus-form';import{jsx as _jsx}from\"react/jsx-runtime\";const ProductBonusAdd=()=>{const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const navigate=useNavigate();const[loading,setLoading]=useState(false);const{id}=useParams();function getProducts(bonus){var _bonus$stock,_bonus$stock$product,_bonus$stock$product$,_bonus$stock2,_bonus$stock2$extras,_bonus$stock3,_bonus$stock3$extras,_bonus$stock4,_bonus$stock5,_bonus$bonusStock,_bonus$bonusStock$pro,_bonus$bonusStock$pro2,_bonus$bonusStock2,_bonus$bonusStock2$ex,_bonus$bonusStock3,_bonus$bonusStock3$ex,_bonus$bonusStock4,_bonus$bonusStock5;const data={status:bonus===null||bonus===void 0?void 0:bonus.status,expired_at:moment(bonus===null||bonus===void 0?void 0:bonus.expired_at,'YYYY-MM-DD'),stock:{label:(bonus===null||bonus===void 0?void 0:(_bonus$stock=bonus.stock)===null||_bonus$stock===void 0?void 0:(_bonus$stock$product=_bonus$stock.product)===null||_bonus$stock$product===void 0?void 0:(_bonus$stock$product$=_bonus$stock$product.translation)===null||_bonus$stock$product$===void 0?void 0:_bonus$stock$product$.title)+`${(bonus===null||bonus===void 0?void 0:(_bonus$stock2=bonus.stock)===null||_bonus$stock2===void 0?void 0:(_bonus$stock2$extras=_bonus$stock2.extras)===null||_bonus$stock2$extras===void 0?void 0:_bonus$stock2$extras.length)>0?`: ${bonus===null||bonus===void 0?void 0:(_bonus$stock3=bonus.stock)===null||_bonus$stock3===void 0?void 0:(_bonus$stock3$extras=_bonus$stock3.extras)===null||_bonus$stock3$extras===void 0?void 0:_bonus$stock3$extras.map(ext=>{var _ext$value;return ext===null||ext===void 0?void 0:(_ext$value=ext.value)===null||_ext$value===void 0?void 0:_ext$value.value;}).join(', ')}`:''}`,value:bonus===null||bonus===void 0?void 0:(_bonus$stock4=bonus.stock)===null||_bonus$stock4===void 0?void 0:_bonus$stock4.id,key:bonus===null||bonus===void 0?void 0:(_bonus$stock5=bonus.stock)===null||_bonus$stock5===void 0?void 0:_bonus$stock5.id},stock_quantity:bonus===null||bonus===void 0?void 0:bonus.value,bonus_stock:{label:(bonus===null||bonus===void 0?void 0:(_bonus$bonusStock=bonus.bonusStock)===null||_bonus$bonusStock===void 0?void 0:(_bonus$bonusStock$pro=_bonus$bonusStock.product)===null||_bonus$bonusStock$pro===void 0?void 0:(_bonus$bonusStock$pro2=_bonus$bonusStock$pro.translation)===null||_bonus$bonusStock$pro2===void 0?void 0:_bonus$bonusStock$pro2.title)+`${(bonus===null||bonus===void 0?void 0:(_bonus$bonusStock2=bonus.bonusStock)===null||_bonus$bonusStock2===void 0?void 0:(_bonus$bonusStock2$ex=_bonus$bonusStock2.extras)===null||_bonus$bonusStock2$ex===void 0?void 0:_bonus$bonusStock2$ex.length)>0?`: ${bonus===null||bonus===void 0?void 0:(_bonus$bonusStock3=bonus.bonusStock)===null||_bonus$bonusStock3===void 0?void 0:(_bonus$bonusStock3$ex=_bonus$bonusStock3.extras)===null||_bonus$bonusStock3$ex===void 0?void 0:_bonus$bonusStock3$ex.map(ext=>{var _ext$value2;return ext===null||ext===void 0?void 0:(_ext$value2=ext.value)===null||_ext$value2===void 0?void 0:_ext$value2.value;}).join(', ')}`:''}`,value:bonus===null||bonus===void 0?void 0:(_bonus$bonusStock4=bonus.bonusStock)===null||_bonus$bonusStock4===void 0?void 0:_bonus$bonusStock4.id,key:bonus===null||bonus===void 0?void 0:(_bonus$bonusStock5=bonus.bonusStock)===null||_bonus$bonusStock5===void 0?void 0:_bonus$bonusStock5.id},bonus_stock_quantity:bonus===null||bonus===void 0?void 0:bonus.bonus_quantity};console.log('data',data);form.setFieldsValue(data);dispatch(setMenuData({activeMenu,data:{...data,expired_at:bonus===null||bonus===void 0?void 0:bonus.expired_at}}));setLoading(false);}const getBonus=id=>{setLoading(true);bonusService.getById(id).then(res=>getProducts(res.data)).finally(()=>dispatch(disableRefetch(activeMenu)));};useEffect(()=>{if(activeMenu.refetch){getBonus(id);}},[activeMenu.refetch]);const onFinish=values=>{const nextUrl='seller/bonus/product';return bonusService.update(id,values).then(()=>{toast.success(t('successfully.created'));batch(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchBonus({}));});navigate(`/${nextUrl}`);});};return/*#__PURE__*/_jsx(Card,{title:t('edit.bonus'),className:\"h-100\",children:!loading?/*#__PURE__*/_jsx(ProductBonusForm,{form:form,handleSubmit:onFinish}):/*#__PURE__*/_jsx(Loading,{})});};export default ProductBonusAdd;","map":null,"metadata":{},"sourceType":"module"}