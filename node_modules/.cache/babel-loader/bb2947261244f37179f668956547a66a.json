{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Card,Col,DatePicker,Form,InputNumber,Row,Select,Spin}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import shopService from'../../../services/shop';import useDidUpdate from'../../../helpers/useDidUpdate';import{setMenuData}from'../../../redux/slices/menu';import{useTranslation}from'react-i18next';import moment from'moment';import RiveResult from'../../../components/rive-result';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const DeliveryInfo=_ref=>{let{form}=_ref;const{t}=useTranslation();const dispatch=useDispatch();const{orderShops,data:orderData}=useSelector(state=>state.order,shallowEqual);const activeMenu=useSelector(state=>state.menu.activeMenu,shallowEqual);const{data}=activeMenu;const[loading,setLoading]=useState(false);function getOrderDeliveries(shops,deliveries){return shops.map(item=>{const delivery=deliveries.find(el=>el.shop_id===item.id);if(delivery){return{shop_id:item.id,delivery:delivery.delivery,delivery_date:moment(delivery.delivery_date),delivery_time:delivery.delivery_time,delivery_fee:delivery.delivery_fee};}return{shop_id:item.id,delivery:'',delivery_date:'',delivery_time:'',delivery_fee:''};});}useEffect(()=>{if(data!==null&&data!==void 0&&data.length){if(orderData.deliveries.length){form.setFieldsValue({deliveries:getOrderDeliveries(data,orderData.deliveries)});return;}form.setFieldsValue({deliveries:data.map(item=>({shop_id:item.id,delivery:'',delivery_date:'',delivery_time:'',delivery_fee:''}))});}else{form.setFieldsValue({deliveries:[]});}},[data]);function getShopDeliveries(shops){setLoading(true);const params=formatShopIds(shops);shopService.getShopDeliveries(params).then(res=>dispatch(setMenuData({activeMenu,data:res.data}))).finally(()=>setLoading(false));}useDidUpdate(()=>{if(orderShops.length){getShopDeliveries(orderShops);}},[orderShops]);function formatShopIds(list){const result=list.map((item,index)=>({[`shops[${index}]`]:item.id}));return Object.assign({},...result);}function getHours(shop){if(!shop)return[];let hours=[];const timeFrom=moment(shop.open_time,'HH:mm').hour();const timeTo=moment(shop.close_time,'HH:mm').hour();for(let index=timeFrom+1;index<timeTo;index++){const hour={label:moment(index,'HH').format('HH:mm'),value:moment(index,'HH').format('HH:mm')};hours.push(hour);}return hours;}function formatDeliveries(list){if(!(list!==null&&list!==void 0&&list.length))return[];return list.map(item=>{var _item$translation;return{label:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id};});}return/*#__PURE__*/_jsxs(Card,{title:t('stores'),children:[loading&&/*#__PURE__*/_jsx(\"div\",{className:\"loader\",children:/*#__PURE__*/_jsx(Spin,{})}),/*#__PURE__*/_jsx(Form.List,{name:\"deliveries\",children:fields=>{return/*#__PURE__*/_jsx(\"div\",{children:fields.length?fields.map((field,index)=>{var _data$index,_data$index$translati,_data$index2;return/*#__PURE__*/_jsx(Card,{title:`${(_data$index=data[index])===null||_data$index===void 0?void 0:(_data$index$translati=_data$index.translation)===null||_data$index$translati===void 0?void 0:_data$index$translati.title} ${t('shop')}`,type:\"inner\",size:\"small\",children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{name:[index,'delivery'],label:t('delivery'),rules:[{required:true,message:t('required.field')}],children:/*#__PURE__*/_jsx(Select,{placeholder:t('select.delivery'),options:formatDeliveries((_data$index2=data[index])===null||_data$index2===void 0?void 0:_data$index2.deliveries),labelInValue:true})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:[index,'delivery_date'],label:t('delivery.date'),rules:[{required:true,message:t('required.field')}],children:/*#__PURE__*/_jsx(DatePicker,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:`${t('delivery.time')} (${t('up.to')})`,name:[index,'delivery_time'],rules:[{required:true,message:t('required.field')}],children:/*#__PURE__*/_jsx(Select,{options:getHours(data[index])})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('delivery.fee'),name:[index,'delivery_fee'],hidden:true,children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})})]})})]})},field.key);}):/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(RiveResult,{id:\"nosell\"})})})});}})]});};export default DeliveryInfo;","map":null,"metadata":{},"sourceType":"module"}