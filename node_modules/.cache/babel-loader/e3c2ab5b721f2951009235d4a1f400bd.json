{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{Card,Space,Row,Col,Image,Tag,Divider,Button}from'antd';import{useTranslation}from'react-i18next';import orderService from'services/order';import{disableRefetch,removeFromMenu,setRefetch}from'redux/slices/menu';import{batch,shallowEqual,useDispatch,useSelector}from'react-redux';import Loading from'components/loading';import useDidUpdate from'helpers/useDidUpdate';import numberToPrice from'helpers/numberToPrice';import ProductCards from'./product-cards';import NewProduct from'./new-product';import NoteModal from'./note-modal';import{toast}from'react-toastify';import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function ReplaceProduct(){var _data$stock2,_data$stock2$product,_data$stock3,_data$stock3$product,_data$stock3$product$,_data$stock4,_data$stock5,_data$stock5$extras,_activeMenu$data3,_activeMenu$data4;const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{order_id,stock_id}=useParams();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const[loading,setLoading]=useState(false);const[data,setData]=useState({});const[noteModal,setNoteModal]=useState(false);const fetchOrder=()=>{setLoading(true);orderService.getById(order_id).then(_ref=>{var _data$details;let{data}=_ref;const products=data===null||data===void 0?void 0:(_data$details=data.details)===null||_data$details===void 0?void 0:_data$details.filter(product=>(product===null||product===void 0?void 0:product.stock_id)===Number(stock_id));setData({...products[0],delivery_type:data===null||data===void 0?void 0:data.delivery_type,user:data===null||data===void 0?void 0:data.user});}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};useEffect(()=>{fetchOrder();},[order_id]);useDidUpdate(()=>{if(activeMenu.refetch){fetchOrder();}},[activeMenu.refetch]);const handleSubmit=values=>{var _data$stock,_activeMenu$data,_activeMenu$data$newP,_activeMenu$data$newP2,_activeMenu$data2,_activeMenu$data2$new;const nextUrl=`order/details/${order_id}`;const body={products:[{//old product\nreplace_note:values===null||values===void 0?void 0:values.note,replace_stock_id:data===null||data===void 0?void 0:(_data$stock=data.stock)===null||_data$stock===void 0?void 0:_data$stock.id,replace_quantity:data===null||data===void 0?void 0:data.quantity,//new product\nstock_id:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:(_activeMenu$data$newP=_activeMenu$data.newProduct)===null||_activeMenu$data$newP===void 0?void 0:(_activeMenu$data$newP2=_activeMenu$data$newP.stock)===null||_activeMenu$data$newP2===void 0?void 0:_activeMenu$data$newP2.id,quantity:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:(_activeMenu$data2$new=_activeMenu$data2.newProduct)===null||_activeMenu$data2$new===void 0?void 0:_activeMenu$data2$new.quantity}],currency_id:defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.id,phone:`${values===null||values===void 0?void 0:values.phone}`};if(!(values!==null&&values!==void 0&&values.phone)){delete body.phone;}return orderService.replaceProduct(order_id,body).then(()=>{setNoteModal(false);toast.success(t('successfully.replaced'));batch(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(setRefetch(activeMenu));});navigate(`/${nextUrl}`);});};return/*#__PURE__*/_jsxs(_Fragment,{children:[!loading?/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(ProductCards,{}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Card,{title:t('old.product'),bordered:true,children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:4,style:{width:'100px',height:'250px'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'100%',objectFit:'contain',overflow:'hidden',borderRadius:'15px'},children:/*#__PURE__*/_jsx(\"img\",{src:data===null||data===void 0?void 0:(_data$stock2=data.stock)===null||_data$stock2===void 0?void 0:(_data$stock2$product=_data$stock2.product)===null||_data$stock2$product===void 0?void 0:_data$stock2$product.img,placeholder:true,style:{width:'100%',height:'100%',objectFit:'contain'}})})}),/*#__PURE__*/_jsxs(Col,{span:20,children:[/*#__PURE__*/_jsx(\"h4\",{children:data===null||data===void 0?void 0:(_data$stock3=data.stock)===null||_data$stock3===void 0?void 0:(_data$stock3$product=_data$stock3.product)===null||_data$stock3$product===void 0?void 0:(_data$stock3$product$=_data$stock3$product.translation)===null||_data$stock3$product$===void 0?void 0:_data$stock3$product$.title}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[t('quantity'),\": \"]}),/*#__PURE__*/_jsx(\"p\",{children:data===null||data===void 0?void 0:data.quantity})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[t('price'),\": \"]}),/*#__PURE__*/_jsx(\"p\",{children:numberToPrice(data===null||data===void 0?void 0:(_data$stock4=data.stock)===null||_data$stock4===void 0?void 0:_data$stock4.price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Space,{wrap:true,children:data===null||data===void 0?void 0:(_data$stock5=data.stock)===null||_data$stock5===void 0?void 0:(_data$stock5$extras=_data$stock5.extras)===null||_data$stock5$extras===void 0?void 0:_data$stock5$extras.map(extra=>{var _extra$group;if((extra===null||extra===void 0?void 0:(_extra$group=extra.group)===null||_extra$group===void 0?void 0:_extra$group.type)==='color'){var _extra$value;return/*#__PURE__*/_jsx(\"span\",{style:{display:'block',width:'30px',height:'30px',backgroundColor:extra===null||extra===void 0?void 0:(_extra$value=extra.value)===null||_extra$value===void 0?void 0:_extra$value.value,border:'2px solid #909091',borderRadius:'50%'}},extra===null||extra===void 0?void 0:extra.id);}else{var _extra$value2;return/*#__PURE__*/_jsx(Tag,{children:extra===null||extra===void 0?void 0:(_extra$value2=extra.value)===null||_extra$value2===void 0?void 0:_extra$value2.value},extra===null||extra===void 0?void 0:extra.id);}})})]})]})}),/*#__PURE__*/_jsx(Divider,{}),((_activeMenu$data3=activeMenu.data)===null||_activeMenu$data3===void 0?void 0:_activeMenu$data3.newProduct)&&/*#__PURE__*/_jsx(NewProduct,{}),/*#__PURE__*/_jsx(Space,{wrap:true,children:/*#__PURE__*/_jsx(Button,{type:'primary',disabled:!((_activeMenu$data4=activeMenu.data)!==null&&_activeMenu$data4!==void 0&&_activeMenu$data4.newProduct),onClick:()=>setNoteModal(true),children:t('next')})})]},`${order_id} ${stock_id}`):/*#__PURE__*/_jsx(Loading,{}),noteModal&&/*#__PURE__*/_jsx(NoteModal,{showModal:noteModal,setShowModal:setNoteModal,handleSubmit:handleSubmit,userData:data===null||data===void 0?void 0:data.user})]});}","map":null,"metadata":{},"sourceType":"module"}