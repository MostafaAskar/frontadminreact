{"ast":null,"code":"import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import{Button,Col,Image,Modal,Space,Table}from'antd';import{useContext,useEffect,useState}from'react';import{fetchShopLocations}from'../../redux/slices/shop-locations';import{DeleteOutlined}from'@ant-design/icons';import LocationSelect from'./location-select';import shopLocationsService from'services/shop-locations';import{toast}from'react-toastify';import CustomModal from'components/modal';import{Context}from'context/context';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const ShopLocations=_ref=>{var _activeMenu$data,_activeMenu$data4;let{next,prev}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const{locations,loading}=useSelector(state=>state.shopLocations);const[ids,setIds]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const[isLocationSelectModalOpen,setIsLocationSelectModalOpen]=useState(false);const{setIsModalVisible}=useContext(Context);const columns=[{title:t('location'),dataIndex:'location',key:'location',render:(_,row)=>{var _row$country,_row$country$translat,_row$city,_row$city$translation;return/*#__PURE__*/_jsxs(\"span\",{children:[(_row$country=row.country)===null||_row$country===void 0?void 0:(_row$country$translat=_row$country.translation)===null||_row$country$translat===void 0?void 0:_row$country$translat.title,row.city?',':'',\" \",(_row$city=row.city)===null||_row$city===void 0?void 0:(_row$city$translation=_row$city.translation)===null||_row$city$translation===void 0?void 0:_row$city$translation.title]});}},{title:t('image'),dataIndex:'country',key:'image',render:country=>{var _country$translation;return/*#__PURE__*/_jsx(Image,{src:country.img,alt:country===null||country===void 0?void 0:(_country$translation=country.translation)===null||_country$translation===void 0?void 0:_country$translation.title,width:60,height:40});}},{title:t('options'),dataIndex:'options',key:'options',render:(_,row)=>/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(Button,{onClick:()=>{setIds([row.id]);setIsModalVisible(true);},type:\"primary\",danger:true,icon:/*#__PURE__*/_jsx(DeleteOutlined,{})})})}];const params={shop_id:activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.id};const locationDelete=()=>{setLoadingBtn(true);const paramsData={...Object.assign({},...ids.map((item,index)=>({[`ids[${index}]`]:item})))};shopLocationsService.delete(paramsData).then(()=>{dispatch(fetchShopLocations(params));toast.success(t('successfully.deleted'));}).finally(()=>{setIds(null);setLoadingBtn(false);setIsModalVisible(false);});};const handleAddLocation=values=>{var _activeMenu$data2;const country=values.country.value.split(',')[0];const region=values.country.value.split(',')[1];const body={country_id:country,region_id:region,shop_id:activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.id};if(values.city.value!=='all'){var _values$city;body.city_id=(_values$city=values.city)===null||_values$city===void 0?void 0:_values$city.value;}setLoadingBtn(true);shopLocationsService.create(body).then(()=>{toast.success(t('successfully.added'));dispatch(fetchShopLocations(params));setIsLocationSelectModalOpen(false);}).finally(()=>{setLoadingBtn(false);});};useEffect(()=>{var _activeMenu$data3;if(activeMenu!==null&&activeMenu!==void 0&&(_activeMenu$data3=activeMenu.data)!==null&&_activeMenu$data3!==void 0&&_activeMenu$data3.id){dispatch(fetchShopLocations(params));}},[activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data4=activeMenu.data)===null||_activeMenu$data4===void 0?void 0:_activeMenu$data4.id]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Space,{className:\"justify-content-end w-100\",children:/*#__PURE__*/_jsx(Button,{onClick:()=>setIsLocationSelectModalOpen(true),type:\"primary\",children:t('add')})}),/*#__PURE__*/_jsx(Table,{loading:loading,dataSource:locations,columns:columns}),/*#__PURE__*/_jsx(Modal,{footer:null,visible:isLocationSelectModalOpen,destroyOnClose:true,onCancel:()=>setIsLocationSelectModalOpen(false),children:/*#__PURE__*/_jsx(LocationSelect,{onClose:()=>setIsLocationSelectModalOpen(false),onSubmit:handleAddLocation,isButtonLoading:loadingBtn})}),/*#__PURE__*/_jsx(CustomModal,{click:locationDelete,text:t('delete.location'),setText:setIds,loading:loadingBtn}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"button\",onClick:()=>next(),children:t('next')}),/*#__PURE__*/_jsx(Button,{htmlType:\"button\",onClick:()=>prev(),children:t('prev')})]})})]});};export default ShopLocations;","map":null,"metadata":{},"sourceType":"module"}