{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Avatar,Card,Col,Row,Select}from'antd';import{useTranslation}from'react-i18next';import{shallowEqual,useDispatch,useSelector}from'react-redux';import getDefaultLocation from'helpers/getDefaultLocation';import{IMG_URL}from'configs/app-global';import{fetchDelivery}from'redux/slices/deliveries';import{disableRefetch}from'redux/slices/menu';import Loading from'components/loading';import useDidUpdate from'helpers/useDidUpdate';import UserData from'./user-data';import UserCard from'./user-card';import{UserOutlined}from'@ant-design/icons';import MapCustomMarker from'components/map-custom-marker';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const deliveryType=[{label:'All',value:'all',key:1},{label:'Online',value:'1',key:2},{label:'Offline',value:'0',key:3}];const Marker=props=>/*#__PURE__*/_jsx(Avatar,{src:props.url,icon:/*#__PURE__*/_jsx(UserOutlined,{}),style:{color:'#1a3353'},onClick:props.onClick});export default function DeliveriesMap(){const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[active,setActive]=useState(undefined);const[userData,setUserData]=useState(null);const{settings}=useSelector(state=>state.globalSettings,shallowEqual);const center=getDefaultLocation(settings);const{delivery,loading}=useSelector(state=>state.deliveries,shallowEqual);const paramsData={page:1,perPage:100,online:active,'statuses[0]':'new','statuses[1]':'accepted','statuses[2]':'ready','statuses[3]':'on_a_way'};useDidUpdate(()=>{if(active==='all')delete paramsData.online;dispatch(fetchDelivery(paramsData));},[active]);const handleLoadMap=(map,maps)=>{const markers=delivery.map(item=>{var _item$delivery_man_se,_item$delivery_man_se2;return{lat:Number((item===null||item===void 0?void 0:(_item$delivery_man_se=item.delivery_man_setting)===null||_item$delivery_man_se===void 0?void 0:_item$delivery_man_se.location.latitude)||'0'),lng:Number((item===null||item===void 0?void 0:(_item$delivery_man_se2=item.delivery_man_setting)===null||_item$delivery_man_se2===void 0?void 0:_item$delivery_man_se2.location.longitude)||'0')};});let bounds=new maps.LatLngBounds();for(var i=0;i<markers.length;i++){bounds.extend(markers[i]);}map.fitBounds(bounds);};const onMapClick=e=>{setUserData(e);};const onCloseDeliverymanDetails=()=>{setUserData(null);};useEffect(()=>{if(activeMenu!==null&&activeMenu!==void 0&&activeMenu.refetch){if(active==='all')delete paramsData.online;dispatch(fetchDelivery(paramsData));dispatch(disableRefetch(activeMenu));}},[activeMenu===null||activeMenu===void 0?void 0:activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:t('deliveries'),className:\"delivery\",extra:/*#__PURE__*/_jsx(Select,{options:deliveryType,defaultValue:'all',loading:loading,onChange:e=>setActive(e),style:{width:'200px'}}),children:!loading?/*#__PURE__*/_jsxs(Row,{gutter:8,children:[/*#__PURE__*/_jsx(Col,{span:18,children:/*#__PURE__*/_jsxs(\"div\",{className:\"map-container\",style:{height:'73vh',width:'100%'},children:[!!userData&&/*#__PURE__*/_jsx(Card,{className:\"map-user-card\",children:/*#__PURE__*/_jsx(UserData,{data:userData,handleClose:onCloseDeliverymanDetails})}),/*#__PURE__*/_jsx(MapCustomMarker,{center:center,handleLoadMap:handleLoadMap,children:delivery.map(item=>{var _item$delivery_man_se3,_item$delivery_man_se4,_item$delivery_man_se5,_item$delivery_man_se6;return/*#__PURE__*/_jsx(Marker,{lat:Number((item===null||item===void 0?void 0:(_item$delivery_man_se3=item.delivery_man_setting)===null||_item$delivery_man_se3===void 0?void 0:(_item$delivery_man_se4=_item$delivery_man_se3.location)===null||_item$delivery_man_se4===void 0?void 0:_item$delivery_man_se4.latitude)||'0'),lng:Number((item===null||item===void 0?void 0:(_item$delivery_man_se5=item.delivery_man_setting)===null||_item$delivery_man_se5===void 0?void 0:(_item$delivery_man_se6=_item$delivery_man_se5.location)===null||_item$delivery_man_se6===void 0?void 0:_item$delivery_man_se6.longitude)||'0'),url:IMG_URL+item.img,onClick:()=>onMapClick(item)},item.id);})})]})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(\"div\",{className:\"order-list\",style:{height:'75vh'},children:delivery.map((item,index)=>/*#__PURE__*/_jsx(UserCard,{data:item},item.id+index))})})]}):/*#__PURE__*/_jsx(Loading,{})});}","map":null,"metadata":{},"sourceType":"module"}