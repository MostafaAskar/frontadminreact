{"ast":null,"code":"import List from'../List/index';import{DragDropContext,Draggable}from'react-beautiful-dnd';import{useState}from'react';import{Spin}from'antd';import Scrollbars from'react-custom-scrollbars';import{clearCurrentOrders,clearItems,setItems}from'redux/slices/sellerOrders';import{shallowEqual,useDispatch}from'react-redux';import{useSelector}from'react-redux';import{LoadingOutlined}from'@ant-design/icons';import{useEffect}from'react';import{mockOrderList}from'../../../../../constants';import OrderCardLoader from'components/order-card-loader';import{toast}from'react-toastify';import orderService from'services/seller/order';import OrderCardSeller from'components/order-card-seller';import Loading from'components/loading';import OrderNoteModal from'../../../../order/orderNoteModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Incorporate=_ref=>{let{goToEdit,goToShow,fetchOrderAllItem,fetchOrders,setLocationsMap,setId,setIsModalVisible,setText,setDowloadModal,setType,orderType}=_ref;const dispatch=useDispatch();const{statusList,loading}=useSelector(state=>state.orderStatus,shallowEqual);const statuses=statusList===null||statusList===void 0?void 0:statusList.map(status=>status===null||status===void 0?void 0:status.name);const{items}=useSelector(state=>state.sellerOrders,shallowEqual);const{isEnabledStatusChange}=useSelector(state=>state.myShop,shallowEqual);const orders=useSelector(state=>state.sellerOrders,shallowEqual);const[key,setKey]=useState('');const[current,setCurrent]=useState({});const[currentCId,setCurrentCId]=useState({});const[statusChangedOrder,setStatusChangedOrder]=useState(null);const[modalNoteType,setModalNoteType]=useState('');const[result,setResult]=useState({});const removeFromList=(list,index)=>{const result=Array.from(list);const[removed]=result.splice(index,1);return[removed,result];};const addToList=(list,index,element)=>{const result=Array.from(list);result.splice(index,0,element);return result;};const changeStatus=(id,params)=>{orderService.updateStatus(id,params).then(()=>{toast.success(`#${id} order status changed`);});};const changeColumnData=result=>{const listCopy={...items};const sourceList=listCopy[result.source.droppableId];const[removedElement,newSourceList]=removeFromList(sourceList,result.source.index);listCopy[result.source.droppableId]=newSourceList;const destinationList=listCopy[result.destination.droppableId];listCopy[result.destination.droppableId]=addToList(destinationList,result.destination.index,removedElement);dispatch(setItems(listCopy));setCurrentCId(null);};const onDragStart=task=>{const id=statuses===null||statuses===void 0?void 0:statuses.findIndex(item=>{var _task$source;return item===(task===null||task===void 0?void 0:(_task$source=task.source)===null||_task$source===void 0?void 0:_task$source.droppableId);});setCurrent(task);setCurrentCId(id);};const onDragEnd=result=>{if(!result.destination){return;}setResult(result);if(result.destination.droppableId==='pause'){setModalNoteType('pause');setStatusChangedOrder(result.draggableId);}else if(result.destination&&current.source.droppableId!==result.destination.droppableId){changeStatus(result.draggableId,{status:result.destination.droppableId});changeColumnData(result);}};const handleScroll=(event,key)=>{const lastProductLoaded=event.target.lastChild;const pageOffset=event.target.clientHeight+event.target.scrollTop;if(lastProductLoaded){const lastProductLoadedOffset=lastProductLoaded.offsetTop+lastProductLoaded.clientHeight+19.9;if(pageOffset>lastProductLoadedOffset){var _orders$key;if(orders[key].meta.last_page>orders[key].meta.current_page&&!((_orders$key=orders[key])!==null&&_orders$key!==void 0&&_orders$key.loading)){setKey(key);fetchOrders({page:orders[key].meta.current_page+1,perPage:5,status:key});}}}};// const checkIsEmpty = () => {\n//   const array = Object.keys(items).map((item) => {\n//     return items[item].length === 0;\n//   });\n//\n//   return array.includes(true);\n// };\nconst checkDisable=index=>{if(index===0&&currentCId===(statuses===null||statuses===void 0?void 0:statuses.length)-1)return false;return Boolean(currentCId>index);};useEffect(()=>{dispatch(clearItems());// if (checkIsEmpty()) {\nfetchOrderAllItem();// }\n},[]);const reloadOrder=item=>{dispatch(clearCurrentOrders(item));fetchOrders({status:item});};return/*#__PURE__*/_jsxs(_Fragment,{children:[loading?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Loading,{})}):/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:onDragEnd,onDragStart:onDragStart,children:/*#__PURE__*/_jsx(\"div\",{className:\"order-board\",children:statuses===null||statuses===void 0?void 0:statuses.map((item,index)=>{var _items$item,_orders$item,_orders$item2,_items$item2,_items$item3,_mockOrderList$item,_orders$item3;return/*#__PURE__*/_jsx(\"div\",{className:\"dnd-column\",children:/*#__PURE__*/_jsx(List,{title:item,onDragEnd:onDragEnd,name:item,isDropDisabled:checkDisable(index),total:(_items$item=items[item])===null||_items$item===void 0?void 0:_items$item.length,loading:(_orders$item=orders[item])===null||_orders$item===void 0?void 0:_orders$item.loading,reloadOrder:()=>reloadOrder(item),children:/*#__PURE__*/_jsxs(Scrollbars,{onScroll:e=>handleScroll(e,item),autoHeight:true,autoHeightMin:'75vh',autoHeightMax:'75vh',autoHide:true,id:item,children:[!Boolean(((_orders$item2=orders[item])===null||_orders$item2===void 0?void 0:_orders$item2.loading)&&!((_items$item2=items[item])!==null&&_items$item2!==void 0&&_items$item2.length))?(_items$item3=items[item])===null||_items$item3===void 0?void 0:_items$item3.map((data,index)=>/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Draggable,{draggableId:data.id.toString(),index:index,isDragDisabled:!isEnabledStatusChange,children:provided=>/*#__PURE__*/_jsx(\"div\",{ref:provided.innerRef,...provided.draggableProps,...provided.dragHandleProps,children:/*#__PURE__*/_jsx(OrderCardSeller,{data:data,goToEdit:goToEdit,goToShow:goToShow,setLocationsMap:setLocationsMap,setId:setId,setIsModalVisible:setIsModalVisible,setText:setText,setDowloadModal:setDowloadModal,setType:setType,orderType:orderType})})},data.id)})):(_mockOrderList$item=mockOrderList[item])===null||_mockOrderList$item===void 0?void 0:_mockOrderList$item.map(()=>/*#__PURE__*/_jsx(OrderCardLoader,{loading:true})),((_orders$item3=orders[item])===null||_orders$item3===void 0?void 0:_orders$item3.loading)&&item===key&&/*#__PURE__*/_jsx(Spin,{indicator:/*#__PURE__*/_jsx(LoadingOutlined,{style:{fontSize:24},spin:true})})]})})},item);})})}),statusChangedOrder&&/*#__PURE__*/_jsx(OrderNoteModal,{result:result,changeColumnData:changeColumnData,statusChangedOrder:statusChangedOrder,setStatusChangedOrder:setStatusChangedOrder,modalNoteType:modalNoteType})]});};export default Incorporate;","map":null,"metadata":{},"sourceType":"module"}