{"ast":null,"code":"import React,{useState}from'react';import{Upload,Modal,Row,Col,Space,Button,Image,Form}from'antd';import{PlusOutlined,DeleteOutlined}from'@ant-design/icons';import MediaUpload from'./upload';import galleryService from'services/gallery';import{useTranslation}from'react-i18next';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const VideoUploaderWithModal=_ref=>{var _mediaList$previews;let{// form,\nmediaList,setMediaList,name='products'}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const[videoPreview,setVideoPreview]=useState(null);const[imgPreview,setImgPreview]=useState([]);const[modalVisible,setModalVisible]=useState(false);const[imgPreviewModal,setImgPreviewModal]=useState(false);const handlePreview=async _ref2=>{let{file,type}=_ref2;if(file.name){if(type==='video')setVideoPreview(/*#__PURE__*/_jsx(\"video\",{controls:true,src:file.name,width:450,height:450}));else setVideoPreview(/*#__PURE__*/_jsx(Image,{src:file.name,width:\"100%\",height:450,alt:\"preview-img\"}));setModalVisible(true);}else{setVideoPreview(null);}};const handleModalClose=()=>{setModalVisible(false);};const createImage=file=>{return{uid:file.title,name:file.title,status:'done',// done, uploading, error\nurl:file.title,created:true};};const handleUpload=_ref3=>{let{file,onSuccess}=_ref3;setImgPreviewModal(true);const formData=new FormData();formData.append('image',file);formData.append('type',name);galleryService.upload(formData).then(_ref4=>{let{data}=_ref4;setMediaList(prev=>({...prev,images:[...prev.images,{...createImage(data),isVideo:true}]}));onSuccess('ok');});};const handleSave=()=>{setMediaList(prev=>({...prev,previews:[...prev.previews,...imgPreview]}));setImgPreview([]);setImgPreviewModal(false);};const removeImg=initialIndex=>{const nextImages=mediaList.images.filter((item,index)=>{if(index!==initialIndex){return item;}});const nextPreviews=mediaList.previews.filter((item,index)=>{if(index!==initialIndex){return item;}});setMediaList({images:nextImages,previews:nextPreviews});};return/*#__PURE__*/_jsxs(Row,{gutter:[24,24],children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Space,{className:\"align-items-start\",children:/*#__PURE__*/_jsx(Upload,{customRequest:handleUpload,accept:\"video/*\",listType:\"text\",className:\"video-upload\",multiple:false,fileList:[],children:/*#__PURE__*/_jsxs(\"div\",{className:\"media-upload\",children:[/*#__PURE__*/_jsx(PlusOutlined,{}),\" \",/*#__PURE__*/_jsx(\"span\",{children:t('upload.video')})]})})})}),/*#__PURE__*/_jsx(Col,{span:24,children:mediaList===null||mediaList===void 0?void 0:(_mediaList$previews=mediaList.previews)===null||_mediaList$previews===void 0?void 0:_mediaList$previews.map((item,index)=>{var _mediaList$previews$i,_mediaList$images$ind;return/*#__PURE__*/_jsxs(Space,{className:\"uploaded-file\",wrap:true,children:[/*#__PURE__*/_jsx(\"span\",{className:\"media-item\",onClick:()=>handlePreview({type:'img',file:mediaList===null||mediaList===void 0?void 0:mediaList.previews[index]}),children:mediaList===null||mediaList===void 0?void 0:(_mediaList$previews$i=mediaList.previews[index])===null||_mediaList$previews$i===void 0?void 0:_mediaList$previews$i.name}),/*#__PURE__*/_jsx(\"span\",{className:\"media-item\",onClick:()=>handlePreview({type:'video',file:mediaList===null||mediaList===void 0?void 0:mediaList.images[index]}),children:mediaList===null||mediaList===void 0?void 0:(_mediaList$images$ind=mediaList.images[index])===null||_mediaList$images$ind===void 0?void 0:_mediaList$images$ind.name}),/*#__PURE__*/_jsx(DeleteOutlined,{className:\"delete-media-item\",onClick:()=>removeImg(index)})]});})}),/*#__PURE__*/_jsx(Modal,{title:\"Video Preview\",visible:modalVisible,onCancel:handleModalClose,footer:null,children:videoPreview}),/*#__PURE__*/_jsx(Modal,{title:\"Preview image\",visible:imgPreviewModal,footer:null,children:/*#__PURE__*/_jsx(Form,{form:form,onFinish:handleSave,layout:\"vertical\",children:/*#__PURE__*/_jsxs(Row,{gutter:[24,24],children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('preview.image'),name:\"preview-image\",rules:[{required:!(imgPreview!==null&&imgPreview!==void 0&&imgPreview.length),message:t('required')}],children:/*#__PURE__*/_jsx(MediaUpload,{type:name,imageList:imgPreview,setImageList:setImgPreview,multiple:false,text:\"upload.image\",form:form})})}),/*#__PURE__*/_jsx(Col,{span:24,className:\"d-flex justify-content-end\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),children:t('save')})})]})})})]});};export default VideoUploaderWithModal;","map":null,"metadata":{},"sourceType":"module"}