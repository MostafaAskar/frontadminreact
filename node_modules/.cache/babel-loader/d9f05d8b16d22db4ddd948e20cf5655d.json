{"ast":null,"code":"import{DeleteOutlined,EditOutlined,PlusCircleOutlined,ShoppingCartOutlined}from'@ant-design/icons';import{Button,Card,Rate,Select,Space,Table}from'antd';import React,{useState,useEffect,useContext}from'react';import{useTranslation}from'react-i18next';import{batch,shallowEqual,useDispatch,useSelector}from'react-redux';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import DeleteButton from'components/delete-button';import FilterColumns from'components/filter-column';import{Context}from'context/context';import{fetchDelivery}from'redux/slices/deliveries';import{addMenu,disableRefetch,setMenuData}from'redux/slices/menu';import deliveryService from'services/delivery';import CustomModal from'components/modal';import numberToPrice from'helpers/numberToPrice';import{BiMap}from'react-icons/bi';import ShowLocationsMap from'./show-locations.map';import DeliverySettingCreate from'./add-delivery-settings';import SearchInput from'components/search-input';import useDidUpdate from'helpers/useDidUpdate';import formatSortType from'helpers/formatSortType';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const type_of_technique=[{label:'Benzine',value:'benzine'},{label:'Diesel',value:'diesel'},{label:'Gas',value:'gas'},{label:'Motorbike',value:'motorbike'},{label:'Bike',value:'bike'},{label:'Foot',value:'foot'}];const DeliveriesList=()=>{var _activeMenu$data,_activeMenu$data2,_activeMenu$data3;const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{setIsModalVisible}=useContext(Context);const[id,setId]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const[text,setText]=useState(null);const[locationsMap,setLocationsMap]=useState(null);const[deliveryModal,setDeliveryModal]=useState(null);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const data=activeMenu===null||activeMenu===void 0?void 0:activeMenu.data;const paramsData={search:data!==null&&data!==void 0&&data.search?data.search:undefined,type_of_technique:data===null||data===void 0?void 0:data.type,sort:data===null||data===void 0?void 0:data.sort,column:data===null||data===void 0?void 0:data.column,pageSize:data===null||data===void 0?void 0:data.per_page,page:(data===null||data===void 0?void 0:data.page)||1};const{delivery,loading,meta}=useSelector(state=>state.deliveries,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const goToEdit=row=>{dispatch(addMenu({url:`user/delivery/${row.uuid}`,id:'delivery_edit',name:t('delivery.edit')}));navigate(`/user/delivery/${row.uuid}`);};const goToOrder=row=>{dispatch(addMenu({name:'delivery.orders',id:'delivery_orders',url:`delivery/orders/${row.id}`}));navigate(`/delivery/orders/${row.id}`);};const goToAddDeliveryman=()=>{dispatch(addMenu({id:'user-add-role',url:`add/user/delivery/${'deliveryman'}`,name:t(`add.${'deliveryman'}`)}));navigate(`/add/user/delivery/${'deliveryman'}`);};const handleCloseModal=()=>{setLocationsMap(null);setDeliveryModal(null);};const[columns,setColumns]=useState([{title:t('id'),dataIndex:'id',key:'id',is_show:true},{title:t('name'),dataIndex:'name',key:'name',is_show:true,render:(_,data)=>(data===null||data===void 0?void 0:data.firstname)+' '+(data===null||data===void 0?void 0:data.lastname)},{title:t('orders'),dataIndex:'count',key:'count',is_show:true,sorter:true,render:(_,data)=>data===null||data===void 0?void 0:data.deliveryman_orders.length},{title:t('rate'),dataIndex:'rating',key:'rating',is_show:true,sorter:true,render:(_,data)=>{var _data$r_avg;return/*#__PURE__*/_jsx(Rate,{className:\"mt-3 ml-3\",disabled:true,allowHalf:true,value:(_data$r_avg=data===null||data===void 0?void 0:data.r_avg)!==null&&_data$r_avg!==void 0?_data$r_avg:0});}},{title:t('wallet'),dataIndex:'wallet_sum',key:'wallet_sum',is_show:true,sorter:true,render:(_,data)=>{var _data$wallet;return numberToPrice(data===null||data===void 0?void 0:(_data$wallet=data.wallet)===null||_data$wallet===void 0?void 0:_data$wallet.price,defaultCurrency.symbol);}},{title:t('delivery.man.setting'),dataIndex:'setting',key:'setting',is_show:true,render:(_,data)=>{var _data$delivery_man_se,_data$delivery_man_se2,_data$delivery_man_se3,_data$delivery_man_se4,_data$delivery_man_se5;return(data===null||data===void 0?void 0:data.delivery_man_setting)===null?/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),onClick:()=>setDeliveryModal({id:data===null||data===void 0?void 0:data.id}),children:t('add.settings')}):/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"span\",{children:[t('brand'),\": \",data===null||data===void 0?void 0:(_data$delivery_man_se=data.delivery_man_setting)===null||_data$delivery_man_se===void 0?void 0:_data$delivery_man_se.brand,/*#__PURE__*/_jsx(\"br\",{}),t('model'),\": \",data===null||data===void 0?void 0:(_data$delivery_man_se2=data.delivery_man_setting)===null||_data$delivery_man_se2===void 0?void 0:_data$delivery_man_se2.model,/*#__PURE__*/_jsx(\"br\",{}),t('number'),\": \",data===null||data===void 0?void 0:(_data$delivery_man_se3=data.delivery_man_setting)===null||_data$delivery_man_se3===void 0?void 0:_data$delivery_man_se3.number,/*#__PURE__*/_jsx(\"br\",{}),t('color'),\": \",data===null||data===void 0?void 0:(_data$delivery_man_se4=data.delivery_man_setting)===null||_data$delivery_man_se4===void 0?void 0:_data$delivery_man_se4.color]}),data!==null&&data!==void 0&&(_data$delivery_man_se5=data.delivery_man_setting)!==null&&_data$delivery_man_se5!==void 0&&_data$delivery_man_se5.id?/*#__PURE__*/_jsx(EditOutlined,{onClick:()=>{var _data$delivery_man_se6;return setDeliveryModal({settingsId:data===null||data===void 0?void 0:(_data$delivery_man_se6=data.delivery_man_setting)===null||_data$delivery_man_se6===void 0?void 0:_data$delivery_man_se6.id,id:data===null||data===void 0?void 0:data.id});}}):'']});}},{title:t('options'),key:'options',dataIndex:'options',is_show:true,render:(_,row)=>{return/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(BiMap,{}),onClick:()=>setLocationsMap(row)}),/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(EditOutlined,{}),onClick:()=>goToEdit(row)}),/*#__PURE__*/_jsx(DeleteButton,{icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),onClick:()=>{setId([row.id]);setIsModalVisible(true);setText(true);}})]});}}]);const deliveryDelete=()=>{setLoadingBtn(true);const params={...Object.assign({},...id.map((item,index)=>({[`ids[${index}]`]:item})))};deliveryService.delete(params).then(()=>{toast.success(t('successfully.deleted'));dispatch(fetchDelivery(paramsData));setIsModalVisible(false);setText(null);setId(null);}).finally(()=>{setLoadingBtn(false);});};useEffect(()=>{if(activeMenu.refetch){batch(()=>{dispatch(fetchDelivery(paramsData));dispatch(disableRefetch(activeMenu));});}},[activeMenu.refetch]);useDidUpdate(()=>{dispatch(fetchDelivery(paramsData));},[activeMenu.data]);function onChangePagination(pagination,filters,sorter){const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{...data,perPage,page,column,sort}}));}const rowSelection={selectedRowKeys:id,onChange:key=>{setId(key);}};const allDelete=()=>{if(id===null||id.length===0){toast.warning(t('select.the.product'));}else{setIsModalVisible(true);setText(false);}};const handleFilter=(item,name)=>{dispatch(setMenuData({activeMenu,data:{...activeMenu.data,[name]:item}}));};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Card,{title:t('delivery'),extra:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Select,{placeholder:t('type.of.technique'),style:{width:'150px'},options:type_of_technique,onChange:e=>handleFilter(e,'type'),allowClear:true}),/*#__PURE__*/_jsx(DeleteButton,{size:\"\",onClick:allDelete,children:t('delete.selected')}),/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),onClick:goToAddDeliveryman,children:t('add.delivery')}),/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})]}),children:[/*#__PURE__*/_jsx(SearchInput,{placeholder:t('search'),className:\"w-25\",handleChange:search=>handleFilter(search,'search'),resetSearch:!((_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.search),defaultValue:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.search}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},rowSelection:rowSelection,columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:delivery,pagination:{pageSize:meta.per_page,page:(data===null||data===void 0?void 0:data.page)||1,total:meta.total,defaultCurrent:data===null||data===void 0?void 0:data.page,current:(_activeMenu$data3=activeMenu.data)===null||_activeMenu$data3===void 0?void 0:_activeMenu$data3.page},rowKey:res=>res.id,onChange:onChangePagination,loading:loading}),/*#__PURE__*/_jsx(CustomModal,{click:deliveryDelete,text:text?t('delete'):t('all.delete'),setText:setId,loading:loadingBtn}),locationsMap&&/*#__PURE__*/_jsx(ShowLocationsMap,{id:locationsMap,handleCancel:handleCloseModal}),deliveryModal&&/*#__PURE__*/_jsx(DeliverySettingCreate,{id:deliveryModal.id,data:deliveryModal,handleCancel:handleCloseModal})]})});};export default DeliveriesList;","map":null,"metadata":{},"sourceType":"module"}