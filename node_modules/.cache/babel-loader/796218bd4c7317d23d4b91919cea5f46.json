{"ast":null,"code":"var _jsxFileName = \"/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/restaurant/main.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { Button, Form, Space } from 'antd';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport RestaurantAddData from './restaurant-add-data';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { replaceMenu, setMenuData } from '../../redux/slices/menu';\nimport restaurantService from '../../services/restaurant';\nimport { useTranslation } from 'react-i18next';\nimport getDefaultLocation from '../../helpers/getDefaultLocation';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst RestaurantMain = _ref => {\n  _s();\n\n  var _activeMenu$data, _activeMenu$data2, _activeMenu$data3, _activeMenu$data4, _activeMenu$data5, _activeMenu$data6, _activeMenu$data6$loc, _activeMenu$data7, _activeMenu$data7$loc;\n\n  let {\n    next,\n    action_type = '',\n    user\n  } = _ref;\n  const {\n    t\n  } = useTranslation();\n  const [form] = Form.useForm();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    uuid\n  } = useParams();\n  const {\n    activeMenu\n  } = useSelector(state => state.menu, shallowEqual);\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const [logoImage, setLogoImage] = useState((_activeMenu$data = activeMenu.data) !== null && _activeMenu$data !== void 0 && _activeMenu$data.logo_img ? [(_activeMenu$data2 = activeMenu.data) === null || _activeMenu$data2 === void 0 ? void 0 : _activeMenu$data2.logo_img] : []);\n  const [backImage, setBackImage] = useState((_activeMenu$data3 = activeMenu.data) !== null && _activeMenu$data3 !== void 0 && _activeMenu$data3.background_img ? [(_activeMenu$data4 = activeMenu.data) === null || _activeMenu$data4 === void 0 ? void 0 : _activeMenu$data4.background_img] : []);\n  const {\n    settings\n  } = useSelector(state => state.globalSettings, shallowEqual);\n  const [location, setLocation] = useState(activeMenu !== null && activeMenu !== void 0 && (_activeMenu$data5 = activeMenu.data) !== null && _activeMenu$data5 !== void 0 && _activeMenu$data5.location ? {\n    lat: parseFloat(activeMenu === null || activeMenu === void 0 ? void 0 : (_activeMenu$data6 = activeMenu.data) === null || _activeMenu$data6 === void 0 ? void 0 : (_activeMenu$data6$loc = _activeMenu$data6.location) === null || _activeMenu$data6$loc === void 0 ? void 0 : _activeMenu$data6$loc.latitude),\n    lng: parseFloat(activeMenu === null || activeMenu === void 0 ? void 0 : (_activeMenu$data7 = activeMenu.data) === null || _activeMenu$data7 === void 0 ? void 0 : (_activeMenu$data7$loc = _activeMenu$data7.location) === null || _activeMenu$data7$loc === void 0 ? void 0 : _activeMenu$data7$loc.longitude)\n  } : getDefaultLocation(settings));\n  useEffect(() => {\n    return () => {\n      const data = form.getFieldsValue(true);\n      data.open_time = JSON.stringify(data === null || data === void 0 ? void 0 : data.open_time);\n      data.close_time = JSON.stringify(data === null || data === void 0 ? void 0 : data.close_time);\n      dispatch(setMenuData({\n        activeMenu,\n        data: { ...activeMenu.data,\n          ...data\n        }\n      }));\n    };\n  }, []);\n\n  const onFinish = values => {\n    var _logoImage$, _backImage$, _values$tags;\n\n    setLoadingBtn(true);\n    const body = { ...values,\n      'images[0]': (_logoImage$ = logoImage[0]) === null || _logoImage$ === void 0 ? void 0 : _logoImage$.name,\n      'images[1]': (_backImage$ = backImage[0]) === null || _backImage$ === void 0 ? void 0 : _backImage$.name,\n      delivery_time_type: values.delivery_time_type,\n      delivery_time_to: values.delivery_time_to,\n      delivery_time_from: values.delivery_time_from,\n      categories: values.categories.map(e => e.value),\n      tags: values === null || values === void 0 ? void 0 : (_values$tags = values.tags) === null || _values$tags === void 0 ? void 0 : _values$tags.map(e => e.value),\n      user_id: values.user.value,\n      open: undefined,\n      'location[latitude]': location.lat,\n      'location[longitude]': location.lng,\n      user: undefined,\n      delivery_time: 0,\n      type: 'restaurant'\n    };\n\n    if (action_type === 'edit') {\n      restaurantUpdate(values, body);\n    } else {\n      restaurantCreate(values, body);\n    }\n  };\n\n  function restaurantCreate(values, params) {\n    restaurantService.create(params).then(_ref2 => {\n      let {\n        data\n      } = _ref2;\n      dispatch(replaceMenu({\n        id: `restaurant-${data.uuid}`,\n        url: `restaurant/${data.uuid}`,\n        name: t('add.restaurant'),\n        data: { ...data,\n          background_img: {\n            name: data === null || data === void 0 ? void 0 : data.background_img\n          },\n          logo_img: {\n            name: data === null || data === void 0 ? void 0 : data.logo_img\n          },\n          ...values\n        },\n        refetch: false\n      }));\n      navigate(`/restaurant/${data.uuid}?step=1`);\n    }).catch(err => console.error(err)).finally(() => setLoadingBtn(false));\n  }\n\n  function restaurantUpdate(values, params) {\n    restaurantService.update(uuid, params).then(() => {\n      dispatch(setMenuData({\n        activeMenu,\n        data: values\n      }));\n      next();\n    }).catch(err => console.error(err)).finally(() => setLoadingBtn(false));\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Form, {\n      form: form,\n      name: \"basic\",\n      layout: \"vertical\",\n      onFinish: onFinish,\n      initialValues: {\n        open: false,\n        status: 'new',\n        ...activeMenu.data\n      },\n      children: [/*#__PURE__*/_jsxDEV(RestaurantAddData, {\n        logoImage: logoImage,\n        setLogoImage: setLogoImage,\n        backImage: backImage,\n        setBackImage: setBackImage,\n        form: form,\n        location: location,\n        setLocation: setLocation,\n        user: user\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Space, {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          htmlType: \"submit\",\n          loading: loadingBtn,\n          children: t('next')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n\n_s(RestaurantMain, \"FMUJvKO+/l2Na4bZeWCRfZty8rU=\", false, function () {\n  return [useTranslation, Form.useForm, useNavigate, useDispatch, useParams, useSelector, useSelector];\n});\n\n_c = RestaurantMain;\nexport default RestaurantMain;\n\nvar _c;\n\n$RefreshReg$(_c, \"RestaurantMain\");","map":{"version":3,"names":["React","useEffect","useState","Button","Form","Space","useNavigate","useParams","RestaurantAddData","shallowEqual","useDispatch","useSelector","replaceMenu","setMenuData","restaurantService","useTranslation","getDefaultLocation","RestaurantMain","next","action_type","user","t","form","useForm","navigate","dispatch","uuid","activeMenu","state","menu","loadingBtn","setLoadingBtn","logoImage","setLogoImage","data","logo_img","backImage","setBackImage","background_img","settings","globalSettings","location","setLocation","lat","parseFloat","latitude","lng","longitude","getFieldsValue","open_time","JSON","stringify","close_time","onFinish","values","body","name","delivery_time_type","delivery_time_to","delivery_time_from","categories","map","e","value","tags","user_id","open","undefined","delivery_time","type","restaurantUpdate","restaurantCreate","params","create","then","id","url","refetch","catch","err","console","error","finally","update","status"],"sources":["/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/restaurant/main.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Button, Form, Space } from 'antd';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport RestaurantAddData from './restaurant-add-data';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { replaceMenu, setMenuData } from '../../redux/slices/menu';\nimport restaurantService from '../../services/restaurant';\nimport { useTranslation } from 'react-i18next';\nimport getDefaultLocation from '../../helpers/getDefaultLocation';\n\nconst RestaurantMain = ({ next, action_type = '', user }) => {\n  const { t } = useTranslation();\n  const [form] = Form.useForm();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { uuid } = useParams();\n  const { activeMenu } = useSelector((state) => state.menu, shallowEqual);\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const [logoImage, setLogoImage] = useState(\n    activeMenu.data?.logo_img ? [activeMenu.data?.logo_img] : []\n  );\n  const [backImage, setBackImage] = useState(\n    activeMenu.data?.background_img ? [activeMenu.data?.background_img] : []\n  );\n  const { settings } = useSelector(\n    (state) => state.globalSettings,\n    shallowEqual\n  );\n  const [location, setLocation] = useState(\n    activeMenu?.data?.location\n      ? {\n          lat: parseFloat(activeMenu?.data?.location?.latitude),\n          lng: parseFloat(activeMenu?.data?.location?.longitude),\n        }\n      : getDefaultLocation(settings)\n  );\n\n  useEffect(() => {\n    return () => {\n      const data = form.getFieldsValue(true);\n      data.open_time = JSON.stringify(data?.open_time);\n      data.close_time = JSON.stringify(data?.close_time);\n      dispatch(\n        setMenuData({ activeMenu, data: { ...activeMenu.data, ...data } })\n      );\n    };\n  }, []);\n\n  const onFinish = (values) => {\n    setLoadingBtn(true);\n    const body = {\n      ...values,\n      'images[0]': logoImage[0]?.name,\n      'images[1]': backImage[0]?.name,\n      delivery_time_type: values.delivery_time_type,\n      delivery_time_to: values.delivery_time_to,\n      delivery_time_from: values.delivery_time_from,\n      categories: values.categories.map((e) => e.value),\n      tags: values?.tags?.map((e) => e.value),\n      user_id: values.user.value,\n      open: undefined,\n      'location[latitude]': location.lat,\n      'location[longitude]': location.lng,\n      user: undefined,\n      delivery_time: 0,\n      type: 'restaurant',\n    };\n    if (action_type === 'edit') {\n      restaurantUpdate(values, body);\n    } else {\n      restaurantCreate(values, body);\n    }\n  };\n\n  function restaurantCreate(values, params) {\n    restaurantService\n      .create(params)\n      .then(({ data }) => {\n        dispatch(\n          replaceMenu({\n            id: `restaurant-${data.uuid}`,\n            url: `restaurant/${data.uuid}`,\n            name: t('add.restaurant'),\n            data: {\n              ...data,\n              background_img: { name: data?.background_img },\n              logo_img: { name: data?.logo_img },\n              ...values,\n            },\n            refetch: false,\n          })\n        );\n        navigate(`/restaurant/${data.uuid}?step=1`);\n      })\n      .catch((err) => console.error(err))\n      .finally(() => setLoadingBtn(false));\n  }\n\n  function restaurantUpdate(values, params) {\n    restaurantService\n      .update(uuid, params)\n      .then(() => {\n        dispatch(\n          setMenuData({\n            activeMenu,\n            data: values,\n          })\n        );\n        next();\n      })\n      .catch((err) => console.error(err))\n      .finally(() => setLoadingBtn(false));\n  }\n\n  return (\n    <>\n      <Form\n        form={form}\n        name='basic'\n        layout='vertical'\n        onFinish={onFinish}\n        initialValues={{\n          open: false,\n          status: 'new',\n          ...activeMenu.data,\n        }}\n      >\n        <RestaurantAddData\n          logoImage={logoImage}\n          setLogoImage={setLogoImage}\n          backImage={backImage}\n          setBackImage={setBackImage}\n          form={form}\n          location={location}\n          setLocation={setLocation}\n          user={user}\n        />\n        <Space>\n          <Button type='primary' htmlType='submit' loading={loadingBtn}>\n            {t('next')}\n          </Button>\n        </Space>\n      </Form>\n    </>\n  );\n};\nexport default RestaurantMain;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}