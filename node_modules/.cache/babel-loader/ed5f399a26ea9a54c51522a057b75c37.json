{"ast":null,"code":"import React,{useState}from'react';import{CheckOutlined,CloseOutlined,EditOutlined,MinusOutlined,PlusOutlined}from'@ant-design/icons';import{Button,Card,Col,Input,Row,Space,Spin}from'antd';import Meta from'antd/lib/card/Meta';import getImage from'helpers/getImage';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{addOrderCoupon,changeOrderedProductQuantity,clearOrderProducts,removeFromOrder,setOrderData,setOrderTotal,verifyOrderCoupon}from'redux/slices/order';import orderService from'services/seller/order';import ExtrasModal from'./extrasModal';import numberToPrice from'helpers/numberToPrice';import useDidUpdate from'helpers/useDidUpdate';import{useNavigate}from'react-router-dom';import{addMenu}from'redux/slices/menu';import{fetchSellerProducts}from'redux/slices/product';import{useTranslation}from'react-i18next';import invokableService from'services/rest/invokable';import{BsFillGiftFill}from'react-icons/bs';import{batch}from'react-redux';import QueryString from'qs';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function OrderItems(){var _activeMenu$data,_activeMenu$data$shop,_activeMenu$data2,_activeMenu$data2$sho,_activeMenu$data2$sho2,_data$currency4,_data$currency5,_total$delivery_fee,_data$currency6,_data$currency7,_total$coupon,_data$currency8,_data$currency9,_data$currency10;const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{orderItems,data,total,coupon}=useSelector(state=>state.order,shallowEqual);const[loading,setLoading]=useState(false);const[extrasModal,setExtrasModal]=useState(null);const[loadingCoupon,setLoadingCoupon]=useState(false);const[couponName,setCouponName]=useState('');const{activeMenu}=useSelector(state=>state.menu,shallowEqual);function formatProducts(list){const result=list.map((item,index)=>{var _item$stock;return{[`products[${index}][stock_id]`]:(item===null||item===void 0?void 0:(_item$stock=item.stock)===null||_item$stock===void 0?void 0:_item$stock.id)||item.id,[`products[${index}][quantity]`]:item.quantity};});return Object.assign({},...result);}useDidUpdate(()=>{dispatch(fetchSellerProducts({perPage:12,currency_id:data.currency.id}));},[data.currency]);useDidUpdate(()=>{if(orderItems.length){productCalculate();}else{dispatch(clearOrderProducts());}},[orderItems,data.currency]);function productCalculate(){var _data$currency;const products=formatProducts(orderItems);const params=QueryString.stringify({currency_id:data===null||data===void 0?void 0:(_data$currency=data.currency)===null||_data$currency===void 0?void 0:_data$currency.id,...products},{addQueryPrefix:true});setLoading(true);orderService.calculate(params).then(_ref=>{let{data}=_ref;const orderData={product_total:data===null||data===void 0?void 0:data.price,order_tax:data===null||data===void 0?void 0:data.total_tax,order_total:data===null||data===void 0?void 0:data.total_price,service_fee:data===null||data===void 0?void 0:data.service_fee,coupon_price:data===null||data===void 0?void 0:data.coupon_price,total_discount:data===null||data===void 0?void 0:data.total_discount};dispatch(setOrderTotal(orderData));}).finally(()=>setLoading(false));}const goToProduct=item=>{dispatch(addMenu({id:`product-${item.uuid}`,url:`seller/product/${item.uuid}`,name:'Product edit'}));navigate(`/seller/product/${item.uuid}`);};function handleCheckCoupon(shopId){if(!couponName)return;setLoadingCoupon(true);invokableService.checkCoupon({coupon:couponName}).then(res=>{const coupon=res.data;batch(()=>{dispatch(setOrderData({coupon}));dispatch(verifyOrderCoupon({price:res.data.price,verified:true}));});}).catch(()=>dispatch(verifyOrderCoupon({price:0,verified:false}))).finally(()=>setLoadingCoupon(false));}const handleChangeProductQuantity=(quantity,id)=>{dispatch(changeOrderedProductQuantity({quantity,id}));};return/*#__PURE__*/_jsxs(\"div\",{className:\"order-items\",children:[loading&&/*#__PURE__*/_jsx(\"div\",{className:\"loader\",children:/*#__PURE__*/_jsx(Spin,{})}),/*#__PURE__*/_jsx(Row,{gutter:24,className:\"mt-4\",children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Card,{className:\"shop-card\",children:[orderItems===null||orderItems===void 0?void 0:orderItems.map((item,index)=>{var _item$stock2,_item$stock2$product,_item$stock3,_item$stock3$product,_item$stock3$product$,_item$stock4,_item$stock4$product,_item$stock4$product$,_item$translation,_data$currency2,_item$stock5,_item$stock5$product,_item$unit,_item$unit$translatio,_item$addons,_item$translation2,_item$translation3,_data$currency3;return(item===null||item===void 0?void 0:item.bonus)===undefined||(item===null||item===void 0?void 0:item.bonus)===false?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Card,{className:\"position-relative\",children:[/*#__PURE__*/_jsx(CloseOutlined,{className:\"close-order\",onClick:()=>dispatch(removeFromOrder(item))}),/*#__PURE__*/_jsxs(Space,{className:\"mr-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"order-item-img\",style:{marginRight:'20px'},children:/*#__PURE__*/_jsx(\"img\",{src:getImage((item===null||item===void 0?void 0:(_item$stock2=item.stock)===null||_item$stock2===void 0?void 0:(_item$stock2$product=_item$stock2.product)===null||_item$stock2$product===void 0?void 0:_item$stock2$product.img)||(item===null||item===void 0?void 0:item.img)),alt:item===null||item===void 0?void 0:(_item$stock3=item.stock)===null||_item$stock3===void 0?void 0:(_item$stock3$product=_item$stock3.product)===null||_item$stock3$product===void 0?void 0:(_item$stock3$product$=_item$stock3$product.translation)===null||_item$stock3$product$===void 0?void 0:_item$stock3$product$.title})}),/*#__PURE__*/_jsx(Meta,{title:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"cursor-pointer white-space-wrap\",onClick:()=>goToProduct(item),children:(item===null||item===void 0?void 0:(_item$stock4=item.stock)===null||_item$stock4===void 0?void 0:(_item$stock4$product=_item$stock4.product)===null||_item$stock4$product===void 0?void 0:(_item$stock4$product$=_item$stock4$product.translation)===null||_item$stock4$product$===void 0?void 0:_item$stock4$product$.title)||(item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title)}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(EditOutlined,{}),type:\"text\",size:\"small\",onClick:()=>setExtrasModal(item)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"product-price\",children:numberToPrice((item===null||item===void 0?void 0:item.price)*(item===null||item===void 0?void 0:item.quantity),data===null||data===void 0?void 0:(_data$currency2=data.currency)===null||_data$currency2===void 0?void 0:_data$currency2.symbol)})]}),description:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{disabled:(item===null||item===void 0?void 0:item.quantity)<(item===null||item===void 0?void 0:(_item$stock5=item.stock)===null||_item$stock5===void 0?void 0:(_item$stock5$product=_item$stock5.product)===null||_item$stock5$product===void 0?void 0:_item$stock5$product.min_qty)+1||(item===null||item===void 0?void 0:item.quantity)===1,onClick:()=>handleChangeProductQuantity(item.quantity-1,item.id),type:\"primary\",icon:/*#__PURE__*/_jsx(MinusOutlined,{})}),' ',/*#__PURE__*/_jsxs(\"span\",{children:[(item===null||item===void 0?void 0:item.quantity)*((item===null||item===void 0?void 0:item.interval)||1),item===null||item===void 0?void 0:(_item$unit=item.unit)===null||_item$unit===void 0?void 0:(_item$unit$translatio=_item$unit.translation)===null||_item$unit$translatio===void 0?void 0:_item$unit$translatio.title]}),/*#__PURE__*/_jsx(Button,{onClick:()=>handleChangeProductQuantity(item.quantity+1,item.id),type:\"primary\",disabled:(item===null||item===void 0?void 0:item.quantity)===(item===null||item===void 0?void 0:item.max_qty),icon:/*#__PURE__*/_jsx(PlusOutlined,{})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(Space,{wrap:true,children:item===null||item===void 0?void 0:(_item$addons=item.addons)===null||_item$addons===void 0?void 0:_item$addons.map(addon=>{var _addon$stock,_addon$stock$product,_addon$stock$product$,_addon$product$transl;return/*#__PURE__*/_jsxs(\"span\",{className:\"extras-text rounded\",children:[(addon===null||addon===void 0?void 0:(_addon$stock=addon.stock)===null||_addon$stock===void 0?void 0:(_addon$stock$product=_addon$stock.product)===null||_addon$stock$product===void 0?void 0:(_addon$stock$product$=_addon$stock$product.translation)===null||_addon$stock$product$===void 0?void 0:_addon$stock$product$.title)||(addon===null||addon===void 0?void 0:(_addon$product$transl=addon.product.translation)===null||_addon$product$transl===void 0?void 0:_addon$product$transl.title),' ',\"x \",addon===null||addon===void 0?void 0:addon.quantity]},addon.id);})})})]})})]})]})}):/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Card,{className:\"position-relative\",children:/*#__PURE__*/_jsxs(Space,{className:\"mr-3 w-100 justify-content-between align-items-start\",children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"order-item-img\",children:/*#__PURE__*/_jsx(\"img\",{src:getImage(item===null||item===void 0?void 0:item.img),alt:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title})}),/*#__PURE__*/_jsx(Meta,{title:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"cursor-pointer white-space-wrap\",onClick:()=>goToProduct(item),children:(_item$translation3=item.translation)===null||_item$translation3===void 0?void 0:_item$translation3.title}),/*#__PURE__*/_jsx(\"div\",{className:\"product-price\",children:numberToPrice(item.price,(_data$currency3=data.currency)===null||_data$currency3===void 0?void 0:_data$currency3.symbol)})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bonus\",children:[/*#__PURE__*/_jsx(BsFillGiftFill,{}),\" Bonus\"]})]})})})},index);}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"img\",{src:getImage((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:(_activeMenu$data$shop=_activeMenu$data.shop)===null||_activeMenu$data$shop===void 0?void 0:_activeMenu$data$shop.logo_img),alt:\"logo\",width:40,height:40,className:\"rounded-circle\"}),/*#__PURE__*/_jsx(\"div\",{children:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:(_activeMenu$data2$sho=_activeMenu$data2.shop)===null||_activeMenu$data2$sho===void 0?void 0:(_activeMenu$data2$sho2=_activeMenu$data2$sho.translation)===null||_activeMenu$data2$sho2===void 0?void 0:_activeMenu$data2$sho2.title})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Input,{placeholder:t('coupon'),addonAfter:coupon.verified?/*#__PURE__*/_jsx(CheckOutlined,{style:{color:'#18a695'}}):null,defaultValue:coupon.coupon,onBlur:event=>{var _data$user,_data$shop;return dispatch(addOrderCoupon({coupon:event.target.value,user_id:(_data$user=data.user)===null||_data$user===void 0?void 0:_data$user.value,shop_id:(_data$shop=data.shop)===null||_data$shop===void 0?void 0:_data$shop.value,verified:false}));},onChange:event=>setCouponName(event.target.value)}),/*#__PURE__*/_jsx(Button,{onClick:()=>handleCheckCoupon(),loading:loadingCoupon,disabled:!couponName.length,children:t('check.coupon')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-right shop-total\",children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-weight-bold\",children:[t('products'),\":\"]}),/*#__PURE__*/_jsx(\"p\",{children:numberToPrice(total.product_total,(_data$currency4=data.currency)===null||_data$currency4===void 0?void 0:_data$currency4.symbol)})]}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-weight-bold\",children:[t('shop.tax'),\":\"]}),/*#__PURE__*/_jsx(\"p\",{children:numberToPrice(total.shop_tax,(_data$currency5=data.currency)===null||_data$currency5===void 0?void 0:_data$currency5.symbol)})]}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-weight-bold\",children:[t('delivery.fee'),\":\"]}),/*#__PURE__*/_jsx(\"p\",{children:numberToPrice((_total$delivery_fee=total.delivery_fee)===null||_total$delivery_fee===void 0?void 0:_total$delivery_fee.reduce((acc,curr)=>acc+curr,0),(_data$currency6=data.currency)===null||_data$currency6===void 0?void 0:_data$currency6.symbol)})]}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-weight-bold\",children:[t('discount'),\":\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"-\",numberToPrice(total.discount,(_data$currency7=data.currency)===null||_data$currency7===void 0?void 0:_data$currency7.symbol)]})]}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-weight-bold\",children:[t('coupon'),\":\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"-\",numberToPrice((_total$coupon=total.coupon)===null||_total$coupon===void 0?void 0:_total$coupon.reduce((acc,curr)=>acc+curr,0),(_data$currency8=data.currency)===null||_data$currency8===void 0?void 0:_data$currency8.symbol)]})]}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-weight-bold\",children:[t('service.fee'),\":\"]}),/*#__PURE__*/_jsx(\"p\",{children:numberToPrice(total===null||total===void 0?void 0:total.service_fee,(_data$currency9=data.currency)===null||_data$currency9===void 0?void 0:_data$currency9.symbol)})]}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-weight-bold\",children:[t('total'),\":\"]}),/*#__PURE__*/_jsx(\"p\",{children:numberToPrice(total.order_total,(_data$currency10=data.currency)===null||_data$currency10===void 0?void 0:_data$currency10.symbol)})]})]})]})]})})}),extrasModal&&/*#__PURE__*/_jsx(ExtrasModal,{extrasModal:extrasModal,setExtrasModal:setExtrasModal})]});}","map":null,"metadata":{},"sourceType":"module"}