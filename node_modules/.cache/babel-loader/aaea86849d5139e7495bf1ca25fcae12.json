{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Col,DatePicker,Form,Input,InputNumber,Modal,Row,Select}from'antd';import{useTranslation}from'react-i18next';import userService from'../services/user';import Loading from'./loading';import moment from'moment';import createImage from'../helpers/createImage';import{useDispatch}from'react-redux';import{updateUser}from'../redux/slices/auth';import useDemo from'../helpers/useDemo';import MediaUpload from'./upload';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function UserModal(_ref){let{visible,handleCancel}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const dispatch=useDispatch();const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);const[data,setData]=useState({});const[image,setImage]=useState([]);const[error,setError]=useState(null);const{isDemo,demoDeliveryman,demoSeller}=useDemo();function fetchProfile(){setLoading(true);userService.profileShow().then(res=>{const obj={...res.data,birthday:moment(res.data.birthday)};setImage(res.data.img?[createImage(res.data.img)]:[]);setData(obj);}).finally(()=>setLoading(false));}useEffect(()=>{fetchProfile();},[]);const onFinish=values=>{var _image$;const payload={images:image[0]?[(_image$=image[0])===null||_image$===void 0?void 0:_image$.name]:undefined,firstname:values.firstname,lastname:values.lastname,phone:values.phone,email:values.email,birthday:moment(values.birthday).format('YYYY-MM-DD'),gender:values.gender,password:values.password,password_confirmation:values.password_confirmation};setLoadingBtn(true);userService.profileUpdate(payload).then(res=>{dispatch(updateUser(res.data));handleCancel();}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsx(Modal,{title:t('edit.profile'),visible:visible,onCancel:handleCancel,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),loading:loadingBtn,disabled:isDemo&&(data===null||data===void 0?void 0:data.id)==demoDeliveryman||isDemo&&(data===null||data===void 0?void 0:data.id)==demoSeller||isDemo&&(data===null||data===void 0?void 0:data.role)==='admin',children:t('save')},'ok-button'),/*#__PURE__*/_jsx(Button,{onClick:handleCancel,children:t('cancel')},'cancel-button')],children:!loading?/*#__PURE__*/_jsx(Form,{layout:\"vertical\",name:\"lang-form\",form:form,onFinish:onFinish,initialValues:{...data},children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('avatar'),children:/*#__PURE__*/_jsx(MediaUpload,{type:\"users\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('firstname'),name:\"firstname\",help:error!==null&&error!==void 0&&error.firstname?error.firstname[0]:null,validateStatus:error!==null&&error!==void 0&&error.firstname?'error':'success',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('lastname'),name:\"lastname\",help:error!==null&&error!==void 0&&error.lastname?error.lastname[0]:null,validateStatus:error!==null&&error!==void 0&&error.lastname?'error':'success',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('phone'),name:\"phone\",help:error!==null&&error!==void 0&&error.phone?error.phone[0]:null,validateStatus:error!==null&&error!==void 0&&error.phone?'error':'success',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\",disabled:isDemo})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('email'),name:\"email\",help:error!==null&&error!==void 0&&error.email?error.email[0]:null,validateStatus:error!==null&&error!==void 0&&error.email?'error':'success',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{type:\"email\",disabled:isDemo})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('birthday'),name:\"birthday\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{className:\"w-100\",placeholder:\"\",disabledDate:current=>moment().add(-1,'days')<=current})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('gender'),name:\"gender\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsxs(Select,{picker:\"dayTime\",className:\"w-100\",children:[/*#__PURE__*/_jsx(Select.Option,{value:\"male\",children:t('male')}),/*#__PURE__*/_jsx(Select.Option,{value:\"female\",children:t('female')})]})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('password'),name:\"password\",help:error!==null&&error!==void 0&&error.password?error.password[0]:null,validateStatus:error!==null&&error!==void 0&&error.password?'error':'success',rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{type:\"password\",className:\"w-100\",disabled:isDemo})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('password.confirmation'),help:error!==null&&error!==void 0&&error.password_confirmation?error.password_confirmation[0]:null,validateStatus:error!==null&&error!==void 0&&error.password_confirmation?'error':'success',name:\"password_confirmation\",dependencies:['password'],rules:[{required:false,message:t('required')},_ref2=>{let{getFieldValue}=_ref2;return{validator(rule,value){if(!value||getFieldValue('password')===value){return Promise.resolve();}return Promise.reject(t('two.passwords.dont.match'));}};}],children:/*#__PURE__*/_jsx(Input,{type:\"password\",disabled:isDemo})})})]})}):/*#__PURE__*/_jsx(Loading,{})});}","map":null,"metadata":{},"sourceType":"module"}