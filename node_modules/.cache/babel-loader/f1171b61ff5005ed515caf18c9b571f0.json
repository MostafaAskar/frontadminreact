{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useParams}from'react-router-dom';import{toast}from'react-toastify';import{Button,Card,Col,Form,Input,Row,Spin}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'redux/slices/menu';import{fetchLandingPages}from'redux/slices/landing-page';import{useTranslation}from'react-i18next';import LanguageList from'components/language-list';import getTranslationFields from'helpers/getTranslationFields';import landingPageService from'services/landingPage';import ImageUploadSingle from'components/image-upload-single';import createImage from'helpers/createImage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const TextArea=Input.TextArea;const LandingPageEdit=()=>{var _activeMenu$data;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const navigate=useNavigate();const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);const{id}=useParams();const[image,setImage]=useState(activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.img);const[media,setMedia]=useState(activeMenu!==null&&activeMenu!==void 0&&activeMenu.data?[activeMenu===null||activeMenu===void 0?void 0:activeMenu.data['features[0].img'],activeMenu===null||activeMenu===void 0?void 0:activeMenu.data['features[1].img'],activeMenu===null||activeMenu===void 0?void 0:activeMenu.data['features[2].img']]:['','','']);const updateMedia=(obj,idx)=>{const list=[...media];list[idx]=obj;setMedia(list);};function getLanguageFields(data){if(!data){return{};}const title={};const description={};languages.forEach(element=>{title[`title[${element.locale}]`]=data.title.hasOwnProperty(element.locale)?data.title[element.locale]:undefined;description[`description[${element.locale}]`]=data.description.hasOwnProperty(element.locale)?data.description[element.locale]:undefined;});return{...title,...description};}const getLandingPage=alias=>{setLoading(true);landingPageService.getById(alias).then(_ref=>{var _data$data,_data$data$features,_data$data2,_data$data3,_data$data3$features;let{data}=_ref;const payload={...getLanguageFields(data===null||data===void 0?void 0:data.data),features:data===null||data===void 0?void 0:(_data$data=data.data)===null||_data$data===void 0?void 0:(_data$data$features=_data$data.features)===null||_data$data$features===void 0?void 0:_data$data$features.map(item=>({...getLanguageFields(item)}))};form.setFieldsValue(payload);setImage(createImage(data===null||data===void 0?void 0:(_data$data2=data.data)===null||_data$data2===void 0?void 0:_data$data2.img));setMedia(data===null||data===void 0?void 0:(_data$data3=data.data)===null||_data$data3===void 0?void 0:(_data$data3$features=_data$data3.features)===null||_data$data3$features===void 0?void 0:_data$data3$features.map(item=>createImage(item.img)));}).finally(()=>{dispatch(disableRefetch(activeMenu));setLoading(false);});};useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));};},[]);const onFinish=values=>{setLoadingBtn(true);const body={title:getTranslationFields(languages,values,'title'),description:getTranslationFields(languages,values,'description'),img:image===null||image===void 0?void 0:image.name,features:values.features.map((item,idx)=>{var _media$idx;return{img:(_media$idx=media[idx])===null||_media$idx===void 0?void 0:_media$idx.name,title:getTranslationFields(languages,item,'title'),description:getTranslationFields(languages,item,'description')};})};landingPageService.update(id,{data:body,type:'welcome'}).then(()=>{const nextUrl='settings/landing-page';toast.success(t('successfully.created'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchLandingPages());}).finally(()=>setLoadingBtn(false));};useEffect(()=>{if(activeMenu.refetch){getLandingPage(id);}},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:t('edit.landing.page'),className:\"h-100\",extra:/*#__PURE__*/_jsx(LanguageList,{}),children:!loading?/*#__PURE__*/_jsxs(Form,{name:\"landing-page-edit\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{features:['','',''],...activeMenu.data},className:\"d-flex flex-column h-100\",children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsxs(Col,{span:12,children:[languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:`${t('title')} (${item.locale})`,name:`title[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'title'+item.locale)),languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:`${t('description')} (${item.locale})`,name:`description[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:3})},'description'+item.locale))]}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('background.image'),children:/*#__PURE__*/_jsx(ImageUploadSingle,{type:\"languages\",image:image,setImage:setImage,form:form,name:\"img\"})})})]}),/*#__PURE__*/_jsx(Card,{title:t('features'),children:/*#__PURE__*/_jsx(Form.List,{name:\"features\",children:fields=>{return/*#__PURE__*/_jsx(\"div\",{children:fields.map((field,index)=>/*#__PURE__*/_jsxs(Row,{gutter:12,align:\"middle\",style:{borderBottom:'1px solid var(--grey)',marginBottom:24,borderWidth:index===2?0:1},children:[/*#__PURE__*/_jsxs(Col,{span:20,children:[languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:`${t('title')} (${item.locale})`,name:[index,`title[${item.locale}]`],rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'title'+item.locale)),languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:`${t('description')} (${item.locale})`,name:[index,`description[${item.locale}]`],rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:3})},'description'+item.locale))]}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('media'),children:/*#__PURE__*/_jsx(ImageUploadSingle,{type:\"languages\",isVideo:true,image:media[index],setImage:obj=>updateMedia(obj,index),form:form,name:`features[${index}].img`})})})]},field.key))});}})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex flex-column justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})})});};export default LandingPageEdit;","map":null,"metadata":{},"sourceType":"module"}