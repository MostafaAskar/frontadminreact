{"ast":null,"code":"import{Button,Col,Form,Input,Modal,Row,Select,Space,Switch}from'antd';import React,{useState,useEffect}from'react';import{useTranslation}from'react-i18next';import deliveryService from'services/delivery';import Loading from'components/loading';import{fetchDelivery}from'redux/slices/deliveries';import{shallowEqual,useDispatch,useSelector}from'react-redux';import MediaUpload from'components/upload';import Map from'components/map';import getDefaultLocation from'helpers/getDefaultLocation';import{DebounceSelect}from'components/search';import countryService from'services/deliveryzone/country';import cityService from'services/deliveryzone/city';import regionService from'services/deliveryzone/region';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const type_of_technique=[{label:'Benzine',value:'benzine'},{label:'Diesel',value:'diesel'},{label:'Gas',value:'gas'},{label:'Motorbike',value:'motorbike'},{label:'Bike',value:'bike'},{label:'Foot',value:'foot'},{label:'Electric',value:'electric'}];const DeliverySettingCreate=_ref=>{let{data,handleCancel}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const dispatch=useDispatch();const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);const[image,setImage]=useState([]);const{settings}=useSelector(state=>state.globalSettings,shallowEqual);const[location,setLocation]=useState(getDefaultLocation(settings));const[deliveryZone,setDeliveryZone]=useState({region:null,country:null,city:null});const createImages=items=>items.map(item=>({uid:item.id,name:item.path,url:item.path}));const fetchDeliverySettings=id=>{setLoading(true);deliveryService.getById(id).then(res=>{var _res$data,_res$data$deliveryman,_res$data2,_res$data2$deliveryma,_res$data3,_res$data3$deliveryma,_res$data4,_res$data5,_res$data5$location,_res$data6,_res$data6$location,_res$data7,_res$data8,_res$data8$region,_res$data8$region$tra,_res$data9,_res$data9$region,_res$data10,_res$data10$region,_res$data11,_res$data12,_res$data12$country,_res$data12$country$t,_res$data13,_res$data13$country,_res$data14,_res$data14$country,_res$data15,_res$data16,_res$data16$city,_res$data16$city$tran,_res$data17,_res$data17$city,_res$data18,_res$data18$city,_res$data19,_res$data20,_res$data20$region,_res$data20$region$tr,_res$data21,_res$data21$region,_res$data22,_res$data22$region,_res$data23,_res$data24,_res$data24$country,_res$data24$country$t,_res$data25,_res$data25$country,_res$data26,_res$data26$country,_res$data27,_res$data28,_res$data28$city,_res$data28$city$tran,_res$data29,_res$data29$city,_res$data30,_res$data30$city,_res$data31,_res$data31$location,_res$data32,_res$data32$location;const responseData={...res.data,user_id:{label:((_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$deliveryman=_res$data.deliveryman)===null||_res$data$deliveryman===void 0?void 0:_res$data$deliveryman.firstname)+' '+((_res$data2=res.data)===null||_res$data2===void 0?void 0:(_res$data2$deliveryma=_res$data2.deliveryman)===null||_res$data2$deliveryma===void 0?void 0:_res$data2$deliveryma.firstname),value:(_res$data3=res.data)===null||_res$data3===void 0?void 0:(_res$data3$deliveryma=_res$data3.deliveryman)===null||_res$data3$deliveryma===void 0?void 0:_res$data3$deliveryma.id,images:createImages((_res$data4=res.data)===null||_res$data4===void 0?void 0:_res$data4.galleries),location:{lat:(_res$data5=res.data)===null||_res$data5===void 0?void 0:(_res$data5$location=_res$data5.location)===null||_res$data5$location===void 0?void 0:_res$data5$location.latitude,lng:(_res$data6=res.data)===null||_res$data6===void 0?void 0:(_res$data6$location=_res$data6.location)===null||_res$data6$location===void 0?void 0:_res$data6$location.longitude}},region:!!((_res$data7=res.data)!==null&&_res$data7!==void 0&&_res$data7.region)?{label:(_res$data8=res.data)===null||_res$data8===void 0?void 0:(_res$data8$region=_res$data8.region)===null||_res$data8$region===void 0?void 0:(_res$data8$region$tra=_res$data8$region.translation)===null||_res$data8$region$tra===void 0?void 0:_res$data8$region$tra.title,value:(_res$data9=res.data)===null||_res$data9===void 0?void 0:(_res$data9$region=_res$data9.region)===null||_res$data9$region===void 0?void 0:_res$data9$region.id,key:(_res$data10=res.data)===null||_res$data10===void 0?void 0:(_res$data10$region=_res$data10.region)===null||_res$data10$region===void 0?void 0:_res$data10$region.id}:null,country:!!((_res$data11=res.data)!==null&&_res$data11!==void 0&&_res$data11.country)?{label:(_res$data12=res.data)===null||_res$data12===void 0?void 0:(_res$data12$country=_res$data12.country)===null||_res$data12$country===void 0?void 0:(_res$data12$country$t=_res$data12$country.translation)===null||_res$data12$country$t===void 0?void 0:_res$data12$country$t.title,value:(_res$data13=res.data)===null||_res$data13===void 0?void 0:(_res$data13$country=_res$data13.country)===null||_res$data13$country===void 0?void 0:_res$data13$country.id,key:(_res$data14=res.data)===null||_res$data14===void 0?void 0:(_res$data14$country=_res$data14.country)===null||_res$data14$country===void 0?void 0:_res$data14$country.id}:null,city:!!((_res$data15=res.data)!==null&&_res$data15!==void 0&&_res$data15.city)?{label:(_res$data16=res.data)===null||_res$data16===void 0?void 0:(_res$data16$city=_res$data16.city)===null||_res$data16$city===void 0?void 0:(_res$data16$city$tran=_res$data16$city.translation)===null||_res$data16$city$tran===void 0?void 0:_res$data16$city$tran.title,value:(_res$data17=res.data)===null||_res$data17===void 0?void 0:(_res$data17$city=_res$data17.city)===null||_res$data17$city===void 0?void 0:_res$data17$city.id,key:(_res$data18=res.data)===null||_res$data18===void 0?void 0:(_res$data18$city=_res$data18.city)===null||_res$data18$city===void 0?void 0:_res$data18$city.id}:null};setDeliveryZone({region:!!((_res$data19=res.data)!==null&&_res$data19!==void 0&&_res$data19.region)?{label:(_res$data20=res.data)===null||_res$data20===void 0?void 0:(_res$data20$region=_res$data20.region)===null||_res$data20$region===void 0?void 0:(_res$data20$region$tr=_res$data20$region.translation)===null||_res$data20$region$tr===void 0?void 0:_res$data20$region$tr.title,value:(_res$data21=res.data)===null||_res$data21===void 0?void 0:(_res$data21$region=_res$data21.region)===null||_res$data21$region===void 0?void 0:_res$data21$region.id,key:(_res$data22=res.data)===null||_res$data22===void 0?void 0:(_res$data22$region=_res$data22.region)===null||_res$data22$region===void 0?void 0:_res$data22$region.id}:null,country:!!((_res$data23=res.data)!==null&&_res$data23!==void 0&&_res$data23.country)?{label:(_res$data24=res.data)===null||_res$data24===void 0?void 0:(_res$data24$country=_res$data24.country)===null||_res$data24$country===void 0?void 0:(_res$data24$country$t=_res$data24$country.translation)===null||_res$data24$country$t===void 0?void 0:_res$data24$country$t.title,value:(_res$data25=res.data)===null||_res$data25===void 0?void 0:(_res$data25$country=_res$data25.country)===null||_res$data25$country===void 0?void 0:_res$data25$country.id,key:(_res$data26=res.data)===null||_res$data26===void 0?void 0:(_res$data26$country=_res$data26.country)===null||_res$data26$country===void 0?void 0:_res$data26$country.id}:null,city:!!((_res$data27=res.data)!==null&&_res$data27!==void 0&&_res$data27.city)?{label:(_res$data28=res.data)===null||_res$data28===void 0?void 0:(_res$data28$city=_res$data28.city)===null||_res$data28$city===void 0?void 0:(_res$data28$city$tran=_res$data28$city.translation)===null||_res$data28$city$tran===void 0?void 0:_res$data28$city$tran.title,value:(_res$data29=res.data)===null||_res$data29===void 0?void 0:(_res$data29$city=_res$data29.city)===null||_res$data29$city===void 0?void 0:_res$data29$city.id,key:(_res$data30=res.data)===null||_res$data30===void 0?void 0:(_res$data30$city=_res$data30.city)===null||_res$data30$city===void 0?void 0:_res$data30$city.id}:null});setLocation({lat:(_res$data31=res.data)===null||_res$data31===void 0?void 0:(_res$data31$location=_res$data31.location)===null||_res$data31$location===void 0?void 0:_res$data31$location.latitude,lng:(_res$data32=res.data)===null||_res$data32===void 0?void 0:(_res$data32$location=_res$data32.location)===null||_res$data32$location===void 0?void 0:_res$data32$location.longitude});setImage(createImages(res.data.galleries));form.setFieldsValue(responseData);}).finally(()=>setLoading(false));};const fetchRegions=search=>{const params={search,perPage:10,page:1// has_price: 1,\n};return regionService.get(params).then(_ref2=>{let{data}=_ref2;return data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});};const fetchCountries=search=>{var _deliveryZone$region;const params={search,perPage:10,page:1,region_id:deliveryZone===null||deliveryZone===void 0?void 0:(_deliveryZone$region=deliveryZone.region)===null||_deliveryZone$region===void 0?void 0:_deliveryZone$region.value// has_price: 1,\n};return countryService.get(params).then(_ref3=>{let{data}=_ref3;return data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation2;return{label:item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.region_id};});});};const fetchCities=search=>{var _deliveryZone$country;const params={search,perPage:10,page:1,country_id:deliveryZone===null||deliveryZone===void 0?void 0:(_deliveryZone$country=deliveryZone.country)===null||_deliveryZone$country===void 0?void 0:_deliveryZone$country.value// has_price: 1,\n};return cityService.get(params).then(_ref4=>{let{data}=_ref4;return data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation3;return{label:item===null||item===void 0?void 0:(_item$translation3=item.translation)===null||_item$translation3===void 0?void 0:_item$translation3.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});};const onFinish=values=>{setLoadingBtn(true);const params={...values,user_id:data.id,images:image.map(img=>img.name),location:{latitude:location.lat,longitude:location.lng},region_id:values.region.value,country_id:values.country.value,city_id:values.city.value};if(data.settingsId){deliveryService.update(data.settingsId,params).then(()=>{handleCancel();dispatch(fetchDelivery({}));}).finally(()=>setLoadingBtn(false));}else{deliveryService.create(params).then(()=>{handleCancel();dispatch(fetchDelivery({}));}).finally(()=>setLoadingBtn(false));}};useEffect(()=>{if(data.settingsId){fetchDeliverySettings(data.settingsId);}},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Modal,{visible:!!data,title:data.id?t('edit.delivery.setting'):t('add.delivery.setting'),closable:false,onCancel:handleCancel,style:{minWidth:'80vw'},footer:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",onClick:()=>form.submit(),loading:loadingBtn,children:t('submit')},'submit'),/*#__PURE__*/_jsx(Button,{type:\"default\",onClick:handleCancel,children:t('cancel')},'cancelBtn')]})],children:/*#__PURE__*/_jsx(Form,{name:\"basic\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{online:true},children:loading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('brand'),name:\"brand\",rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('model'),name:\"model\",rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('type.of.technique'),name:\"type_of_technique\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{options:type_of_technique})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('car.number'),name:\"number\",rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('car.color'),name:\"color\",rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"region\",label:t('region'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchRegions,placeholder:t('select.region'),onChange:value=>{form.setFieldsValue({country:null,city:null});setDeliveryZone({region:value,country:null,city:null});},onClear:()=>{form.setFieldsValue({region:[],country:[],city:[]});setDeliveryZone({region:null,country:null,city:null});},autoComplete:\"none\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"country\",label:t('country'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchCountries,placeholder:t('select.country'),refetchOptions:true,onChange:value=>{form.setFieldsValue({city:null});setDeliveryZone({...deliveryZone,country:value,city:null});},onClear:()=>{form.setFieldsValue({country:[],city:[]});setDeliveryZone({...deliveryZone,country:null,city:null});},disabled:!deliveryZone.region,autoComplete:\"none\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"city\",label:t('city'),children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchCities,placeholder:t('select.city'),refetchOptions:true,disabled:!deliveryZone.region||!deliveryZone.country,autoComplete:\"none\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),name:\"images\",rules:[{validator(){if((image===null||image===void 0?void 0:image.length)===0){return Promise.reject(new Error(t('required')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"deliveryman/settings\",imageList:image,setImageList:setImage,form:form,length:\"1\",multiple:true})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('online'),name:\"online\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('map'),name:\"location\",children:/*#__PURE__*/_jsx(Map,{location:location,setLocation:setLocation})})})]})})})});};export default DeliverySettingCreate;","map":null,"metadata":{},"sourceType":"module"}