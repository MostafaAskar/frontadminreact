{"ast":null,"code":"var _jsxFileName = \"/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/seller-views/my-shop/main.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { Button, Form, Space } from 'antd';\nimport ShopAddData from './shop-add-data';\nimport { batch, shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { setMenuData } from 'redux/slices/menu';\nimport shopService from 'services/seller/shop';\nimport { useTranslation } from 'react-i18next';\nimport getDefaultLocation from 'helpers/getDefaultLocation';\nimport { fetchMyShop } from 'redux/slices/myShop';\nimport { ShopTypes } from 'constants/shop-types';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst ShopMain = _ref => {\n  _s();\n\n  var _activeMenu$data, _activeMenu$data2, _activeMenu$data2$loc, _activeMenu$data3, _activeMenu$data3$loc, _activeMenu$data4, _activeMenu$data5, _activeMenu$data6, _activeMenu$data7, _activeMenu$data$deli, _activeMenu$data8;\n\n  let {\n    next\n  } = _ref;\n  const {\n    t\n  } = useTranslation();\n  const [form] = Form.useForm();\n  const dispatch = useDispatch();\n  const {\n    activeMenu\n  } = useSelector(state => state.menu, shallowEqual);\n  const {\n    settings\n  } = useSelector(state => state.globalSettings, shallowEqual);\n  const [location, setLocation] = useState(activeMenu !== null && activeMenu !== void 0 && (_activeMenu$data = activeMenu.data) !== null && _activeMenu$data !== void 0 && _activeMenu$data.location ? {\n    lat: parseFloat(activeMenu === null || activeMenu === void 0 ? void 0 : (_activeMenu$data2 = activeMenu.data) === null || _activeMenu$data2 === void 0 ? void 0 : (_activeMenu$data2$loc = _activeMenu$data2.location) === null || _activeMenu$data2$loc === void 0 ? void 0 : _activeMenu$data2$loc.latitude),\n    lng: parseFloat(activeMenu === null || activeMenu === void 0 ? void 0 : (_activeMenu$data3 = activeMenu.data) === null || _activeMenu$data3 === void 0 ? void 0 : (_activeMenu$data3$loc = _activeMenu$data3.location) === null || _activeMenu$data3$loc === void 0 ? void 0 : _activeMenu$data3$loc.longitude)\n  } : getDefaultLocation(settings));\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const {\n    myShop\n  } = useSelector(state => state.myShop, shallowEqual);\n  const [logoImage, setLogoImage] = useState((_activeMenu$data4 = activeMenu.data) !== null && _activeMenu$data4 !== void 0 && _activeMenu$data4.logo_img ? [(_activeMenu$data5 = activeMenu.data) === null || _activeMenu$data5 === void 0 ? void 0 : _activeMenu$data5.logo_img] : []);\n  const [backImage, setBackImage] = useState((_activeMenu$data6 = activeMenu.data) !== null && _activeMenu$data6 !== void 0 && _activeMenu$data6.background_img ? [(_activeMenu$data7 = activeMenu.data) === null || _activeMenu$data7 === void 0 ? void 0 : _activeMenu$data7.background_img] : []);\n  useEffect(() => {\n    return () => {\n      const data = form.getFieldsValue(true);\n      data.open_time = JSON.stringify(data === null || data === void 0 ? void 0 : data.open_time);\n      data.close_time = JSON.stringify(data === null || data === void 0 ? void 0 : data.close_time);\n      dispatch(setMenuData({\n        activeMenu,\n        data: { ...activeMenu.data,\n          ...data\n        }\n      }));\n    };\n  }, []);\n\n  const onFinish = values => {\n    var _values$delivery_type, _logoImage$, _backImage$;\n\n    setLoadingBtn(true);\n    const body = { ...values,\n      delivery_type: (values === null || values === void 0 ? void 0 : (_values$delivery_type = values.delivery_type) === null || _values$delivery_type === void 0 ? void 0 : _values$delivery_type.value) || (values === null || values === void 0 ? void 0 : values.delivery_type),\n      'images[0]': (_logoImage$ = logoImage[0]) === null || _logoImage$ === void 0 ? void 0 : _logoImage$.name,\n      'images[1]': (_backImage$ = backImage[0]) === null || _backImage$ === void 0 ? void 0 : _backImage$.name,\n      delivery_time_type: values.delivery_time_type,\n      delivery_time_to: values.delivery_time_to || 0,\n      delivery_time_from: values.delivery_time_from || 0,\n      user_id: values.user.value,\n      visibility: Number(values.visibility),\n      'location[latitude]': location.lat,\n      'location[longitude]': location.lng,\n      user: undefined,\n      delivery_time: 0,\n      type: myShop.type === 'shop' ? 'shop' : 'restaurant',\n      tags: values.tags.map(e => e.value)\n    };\n    body === null || body === void 0 ? true : delete body.background_img;\n    body === null || body === void 0 ? true : delete body.logo_img;\n    shopUpdate(values, body);\n  };\n\n  function shopUpdate(values, params) {\n    shopService.update(params).then(() => {\n      batch(() => {\n        dispatch(setMenuData({\n          activeMenu,\n          data: values\n        }));\n        dispatch(fetchMyShop({}));\n      });\n      next();\n    }).finally(() => setLoadingBtn(false));\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Form, {\n      form: form,\n      name: \"basic\",\n      layout: \"vertical\",\n      onFinish: onFinish,\n      initialValues: {\n        visibility: true,\n        status: 'new',\n        ...activeMenu.data,\n        delivery_type: (_activeMenu$data$deli = (_activeMenu$data8 = activeMenu.data) === null || _activeMenu$data8 === void 0 ? void 0 : _activeMenu$data8.delivery_type) !== null && _activeMenu$data$deli !== void 0 ? _activeMenu$data$deli : ShopTypes[0]\n      },\n      children: [/*#__PURE__*/_jsxDEV(ShopAddData, {\n        logoImage: logoImage,\n        setLogoImage: setLogoImage,\n        backImage: backImage,\n        setBackImage: setBackImage,\n        form: form,\n        location: location,\n        setLocation: setLocation\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Space, {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          htmlType: \"submit\",\n          loading: loadingBtn,\n          children: t('next')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n\n_s(ShopMain, \"iKddF+tylG0cOKR+WqysYNGYEBg=\", false, function () {\n  return [useTranslation, Form.useForm, useDispatch, useSelector, useSelector, useSelector];\n});\n\n_c = ShopMain;\nexport default ShopMain;\n\nvar _c;\n\n$RefreshReg$(_c, \"ShopMain\");","map":{"version":3,"names":["React","useEffect","useState","Button","Form","Space","ShopAddData","batch","shallowEqual","useDispatch","useSelector","setMenuData","shopService","useTranslation","getDefaultLocation","fetchMyShop","ShopTypes","ShopMain","next","t","form","useForm","dispatch","activeMenu","state","menu","settings","globalSettings","location","setLocation","data","lat","parseFloat","latitude","lng","longitude","loadingBtn","setLoadingBtn","myShop","logoImage","setLogoImage","logo_img","backImage","setBackImage","background_img","getFieldsValue","open_time","JSON","stringify","close_time","onFinish","values","body","delivery_type","value","name","delivery_time_type","delivery_time_to","delivery_time_from","user_id","user","visibility","Number","undefined","delivery_time","type","tags","map","e","shopUpdate","params","update","then","finally","status"],"sources":["/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/seller-views/my-shop/main.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Button, Form, Space } from 'antd';\nimport ShopAddData from './shop-add-data';\nimport { batch, shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { setMenuData } from 'redux/slices/menu';\nimport shopService from 'services/seller/shop';\nimport { useTranslation } from 'react-i18next';\nimport getDefaultLocation from 'helpers/getDefaultLocation';\nimport { fetchMyShop } from 'redux/slices/myShop';\nimport { ShopTypes } from 'constants/shop-types';\n\nconst ShopMain = ({ next }) => {\n  const { t } = useTranslation();\n  const [form] = Form.useForm();\n  const dispatch = useDispatch();\n\n  const { activeMenu } = useSelector((state) => state.menu, shallowEqual);\n  const { settings } = useSelector(\n    (state) => state.globalSettings,\n    shallowEqual,\n  );\n\n  const [location, setLocation] = useState(\n    activeMenu?.data?.location\n      ? {\n          lat: parseFloat(activeMenu?.data?.location?.latitude),\n          lng: parseFloat(activeMenu?.data?.location?.longitude),\n        }\n      : getDefaultLocation(settings),\n  );\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const { myShop } = useSelector((state) => state.myShop, shallowEqual);\n  const [logoImage, setLogoImage] = useState(\n    activeMenu.data?.logo_img ? [activeMenu.data?.logo_img] : [],\n  );\n  const [backImage, setBackImage] = useState(\n    activeMenu.data?.background_img ? [activeMenu.data?.background_img] : [],\n  );\n\n  useEffect(() => {\n    return () => {\n      const data = form.getFieldsValue(true);\n      data.open_time = JSON.stringify(data?.open_time);\n      data.close_time = JSON.stringify(data?.close_time);\n      dispatch(\n        setMenuData({ activeMenu, data: { ...activeMenu.data, ...data } }),\n      );\n    };\n  }, []);\n\n  const onFinish = (values) => {\n    setLoadingBtn(true);\n    const body = {\n      ...values,\n      delivery_type: values?.delivery_type?.value || values?.delivery_type,\n      'images[0]': logoImage[0]?.name,\n      'images[1]': backImage[0]?.name,\n      delivery_time_type: values.delivery_time_type,\n      delivery_time_to: values.delivery_time_to || 0,\n      delivery_time_from: values.delivery_time_from || 0,\n      user_id: values.user.value,\n      visibility: Number(values.visibility),\n      'location[latitude]': location.lat,\n      'location[longitude]': location.lng,\n      user: undefined,\n      delivery_time: 0,\n      type: myShop.type === 'shop' ? 'shop' : 'restaurant',\n      tags: values.tags.map((e) => e.value),\n    };\n    delete body?.background_img;\n    delete body?.logo_img;\n    shopUpdate(values, body);\n  };\n\n  function shopUpdate(values, params) {\n    shopService\n      .update(params)\n      .then(() => {\n        batch(() => {\n          dispatch(\n            setMenuData({\n              activeMenu,\n              data: values,\n            }),\n          );\n          dispatch(fetchMyShop({}));\n        });\n        next();\n      })\n      .finally(() => setLoadingBtn(false));\n  }\n\n  return (\n    <>\n      <Form\n        form={form}\n        name='basic'\n        layout='vertical'\n        onFinish={onFinish}\n        initialValues={{\n          visibility: true,\n          status: 'new',\n          ...activeMenu.data,\n          delivery_type: activeMenu.data?.delivery_type ?? ShopTypes[0],\n        }}\n      >\n        <ShopAddData\n          logoImage={logoImage}\n          setLogoImage={setLogoImage}\n          backImage={backImage}\n          setBackImage={setBackImage}\n          form={form}\n          location={location}\n          setLocation={setLocation}\n        />\n        <Space>\n          <Button type='primary' htmlType='submit' loading={loadingBtn}>\n            {t('next')}\n          </Button>\n        </Space>\n      </Form>\n    </>\n  );\n};\nexport default ShopMain;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}