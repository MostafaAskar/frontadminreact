{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Col,DatePicker,Form,Input,Row,Space,TimePicker}from'antd';import{useTranslation}from'react-i18next';import MediaUpload from'components/upload';import{DebounceSelect}from'components/search';import parcelTypeService from'services/parcelType';import parcelOrderService from'services/parcelOrder';import numberToPrice from'helpers/numberToPrice';import{shallowEqual,useSelector}from'react-redux';import moment from'moment';import paymentService from'services/payment';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function ParcelDetails(_ref){var _activeMenu$data;let{form,loading,prev,locationFrom,locationTo,image,setImage}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[type,setType]=useState(activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.type);const[price,setPrice]=useState(0);useEffect(()=>{if(type&&locationFrom&&locationTo){const payload={'address_from[latitude]':locationFrom.lat,'address_from[longitude]':locationFrom.lng,'address_to[latitude]':locationTo.lat,'address_to[longitude]':locationTo.lng,type_id:type===null||type===void 0?void 0:type.value};parcelOrderService.calculate(payload).then(_ref2=>{let{data}=_ref2;setPrice(data.price);}).catch(err=>console.error(err));}},[type,locationFrom,locationTo]);async function fetchParcelTypeList(search){const params={search};return parcelTypeService.getAll(params).then(res=>res.data.map(item=>({label:item.type,value:item.id,key:item.id})));}async function fetchPaymentTypeList(search){const params={search};return paymentService.getAll(params).then(res=>{var _res$data,_res$data$filter;return(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$filter=_res$data.filter(el=>el.tag==='cash'||el.tag==='wallet'))===null||_res$data$filter===void 0?void 0:_res$data$filter.map(item=>({label:t(item.tag),value:item.id,key:item.id}));});}const onChangeType=event=>{setType(event);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('type'),name:\"type\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchParcelTypeList,onChange:onChangeType})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),name:\"images\",rules:[{validator(){if((image===null||image===void 0?void 0:image.length)===0){return Promise.reject(new Error(t('required')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"languages\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('payment.type'),name:\"payment_type\",rules:[{required:true,message:t('missing.payment.type')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchPaymentTypeList})})}),/*#__PURE__*/_jsx(Col,{span:12}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('delivery.date'),name:\"delivery_date\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{className:\"w-100\",placeholder:\"\",disabledDate:current=>moment().add(-1,'days')>=current})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('delivery.time'),name:\"delivery_time\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(TimePicker,{className:\"w-100\",format:\"HH:mm\",placeholder:\"\"})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('note'),name:\"note\",rules:[{required:true,message:t('required')},{validator:(_,value)=>{if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input.TextArea,{row:1,maxLength:100})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between\",children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"default\",htmlType:\"button\",onClick:prev,children:t('prev')}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loading,disabled:!price,children:t('submit')})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"span\",{children:[t('total.price'),\":\"]}),/*#__PURE__*/_jsx(\"span\",{children:numberToPrice(price)})]})]})]});}","map":null,"metadata":{},"sourceType":"module"}