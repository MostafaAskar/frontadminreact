{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Card,Col,DatePicker,Form,Input,InputNumber,Row,Select}from'antd';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{batch,useDispatch,useSelector}from'react-redux';import{removeFromMenu,setMenuData}from'../../redux/slices/menu';import userService from'../../services/user';import{fetchClients}from'../../redux/slices/client';import{useTranslation}from'react-i18next';import moment from'moment';import MediaUpload from'../../components/upload';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function UserAdd(){var _activeMenu$data,_activeMenu$data2;const{t}=useTranslation();const[form]=Form.useForm();const[error,setError]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const navigate=useNavigate();const activeMenu=useSelector(list=>list.menu.activeMenu);const dispatch=useDispatch();const[image,setImage]=useState(activeMenu!==null&&activeMenu!==void 0&&(_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.image?[activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.image]:[]);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);data.birthday=JSON.stringify(data===null||data===void 0?void 0:data.birthday);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,...data}}));};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const onFinish=values=>{var _image$;setLoadingBtn(true);const body={firstname:values.firstname,lastname:values.lastname,email:values.user_email,phone:values.phone,birthday:moment(values.birthday).format('YYYY-MM-DD'),gender:values.gender,password_confirmation:values.password_confirmation,password:values.password,images:image[0]?[(_image$=image[0])===null||_image$===void 0?void 0:_image$.name]:undefined};const nextUrl='users/user';userService.create(body).then(()=>{toast.success(t('successfully.created'));batch(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchClients({}));});navigate(`/${nextUrl}`);}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));};const getInitialTimes=()=>{var _activeMenu$data3,_activeMenu$data4;if(!((_activeMenu$data3=activeMenu.data)!==null&&_activeMenu$data3!==void 0&&_activeMenu$data3.birthday)){return{};}const birthday=JSON.parse((_activeMenu$data4=activeMenu.data)===null||_activeMenu$data4===void 0?void 0:_activeMenu$data4.birthday);return{birthday:moment(birthday)};};return/*#__PURE__*/_jsx(Card,{title:t('add.user'),children:/*#__PURE__*/_jsx(Form,{form:form,layout:\"vertical\",initialValues:{gender:'male',...activeMenu.data,...getInitialTimes()},onFinish:onFinish,children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{rules:[{validator(){if((image===null||image===void 0?void 0:image.length)===0){return Promise.reject(new Error(t('required')));}return Promise.resolve();}}],label:t('avatar'),name:\"images\",children:/*#__PURE__*/_jsx(MediaUpload,{type:\"users\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('firstname'),name:\"firstname\",help:error!==null&&error!==void 0&&error.firstname?error.firstname[0]:null,validateStatus:error!==null&&error!==void 0&&error.firstname?'error':'success',rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:'lastname',name:\"lastname\",help:error!==null&&error!==void 0&&error.lastname?error.lastname[0]:null,validateStatus:error!==null&&error!==void 0&&error.lastname?'error':'success',rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('phone'),name:\"phone\",help:error!==null&&error!==void 0&&error.phone?error.phone[0]:null,validateStatus:error!==null&&error!==void 0&&error.phone?'error':'success',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('birthday'),name:\"birthday\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{className:\"w-100\",disabledDate:current=>moment().add(-18,'years')<=current,defaultPickerValue:moment().add(-18,'years')})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('gender'),name:\"gender\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsxs(Select,{picker:\"dayTime\",className:\"w-100\",children:[/*#__PURE__*/_jsx(Select.Option,{value:\"male\",children:t('male')}),/*#__PURE__*/_jsx(Select.Option,{value:\"female\",children:t('female')})]})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('email'),name:\"user_email\",help:error!==null&&error!==void 0&&error.email?error.email[0]:null,validateStatus:error!==null&&error!==void 0&&error.email?'error':'success',rules:[{required:true,message:t('required')},{type:'email',message:t('invalid.email')}],children:/*#__PURE__*/_jsx(Input,{type:\"email\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('password'),name:\"password\",help:error!==null&&error!==void 0&&error.password?error.password[0]:null,validateStatus:error!==null&&error!==void 0&&error.password?'error':'success',rules:[{required:true,message:t('required')},{validator(_,value){if(value&&(value===null||value===void 0?void 0:value.toString().length)<6){return Promise.reject(new Error(t('min.6.letters')));}return Promise.resolve();}}],normalize:value=>(value===null||value===void 0?void 0:value.trim())===''?value===null||value===void 0?void 0:value.trim():value,children:/*#__PURE__*/_jsx(Input.Password,{type:\"password\",className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('password.confirmation'),help:error!==null&&error!==void 0&&error.password_confirmation?error.password_confirmation[0]:null,validateStatus:error!==null&&error!==void 0&&error.password_confirmation?'error':'success',name:\"password_confirmation\",dependencies:['password'],hasFeedback:true,rules:[{required:true,message:t('required')},_ref=>{let{getFieldValue}=_ref;return{validator(rule,value){if(!value||getFieldValue('password')===value){return Promise.resolve();}return Promise.reject(t('two.passwords.dont.match'));}};}],normalize:value=>(value===null||value===void 0?void 0:value.trim())===''?value===null||value===void 0?void 0:value.trim():value,children:/*#__PURE__*/_jsx(Input.Password,{type:\"password\"})})}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('save')})]})})});}","map":null,"metadata":{},"sourceType":"module"}