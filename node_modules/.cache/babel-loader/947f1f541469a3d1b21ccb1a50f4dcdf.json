{"ast":null,"code":"import React,{useState,useEffect}from'react';import{shallowEqual,useDispatch,useSelector}from'react-redux';import LanguageList from'components/language-list';import{useTranslation}from'react-i18next';import{steps}from'./steps';import{Card,Steps}from'antd';import ShopMain from'./main';import UserEdit from'./user';import{useQueryParams}from'helpers/useQueryParams';import{disableRefetch,setMenuData}from'redux/slices/menu';import shopService from'services/shop';import{useParams}from'react-router-dom';import ShopDelivery from'./shopDelivery';import Loading from'components/loading';import ShopLocations from'components/shop/shop-locations';import ShopSocial from'./social';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{Step}=Steps;const ShopsEdit=()=>{var _queryParams$values,_activeMenu$data;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const queryParams=useQueryParams();const current=Number(((_queryParams$values=queryParams.values)===null||_queryParams$values===void 0?void 0:_queryParams$values.step)||0);const[loading,setLoading]=useState(activeMenu.refetch);const dispatch=useDispatch();const{uuid}=useParams();const{languages}=useSelector(state=>state.formLang,shallowEqual);const next=()=>{const step=current+1;queryParams.set('step',step);};const prev=()=>{const step=current-1;queryParams.set('step',step);};const onChange=step=>{dispatch(setMenuData({activeMenu,data:{...activeMenu.data,step}}));queryParams.set('step',step);};const fetchShop=uuid=>{setLoading(true);shopService.getById(uuid).then(res=>{var _res$data,_res$data$seller,_res$data2,_res$data2$seller,_res$data3,_res$data3$seller,_res$data4,_res$data5,_res$data6,_res$data7,_res$data7$categories,_res$data8,_res$data8$tags,_res$data9,_res$data10,_res$data11,_res$data12,_res$data13;const data={...res.data,...getLanguageFields(res.data),logo_img:createImages(res.data.logo_img),background_img:createImages(res.data.background_img),user:{label:((_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$seller=_res$data.seller)===null||_res$data$seller===void 0?void 0:_res$data$seller.firstname)+' '+((_res$data2=res.data)===null||_res$data2===void 0?void 0:(_res$data2$seller=_res$data2.seller)===null||_res$data2$seller===void 0?void 0:_res$data2$seller.lastname),value:(_res$data3=res.data)===null||_res$data3===void 0?void 0:(_res$data3$seller=_res$data3.seller)===null||_res$data3$seller===void 0?void 0:_res$data3$seller.id},delivery_time_from:((_res$data4=res.data)===null||_res$data4===void 0?void 0:_res$data4.delivery_time.from)||0,delivery_time_to:((_res$data5=res.data)===null||_res$data5===void 0?void 0:_res$data5.delivery_time.to)||0,delivery_time_type:(_res$data6=res.data)===null||_res$data6===void 0?void 0:_res$data6.delivery_time.type,recommended:res.data.mark==='recommended',categories:(_res$data7=res.data)===null||_res$data7===void 0?void 0:(_res$data7$categories=_res$data7.categories)===null||_res$data7$categories===void 0?void 0:_res$data7$categories.map(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id,key:item.id};}),tags:(_res$data8=res.data)===null||_res$data8===void 0?void 0:(_res$data8$tags=_res$data8.tags)===null||_res$data8$tags===void 0?void 0:_res$data8$tags.map(item=>{var _item$translation2;return{label:item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title,value:item.id,key:item.id};}),price:((_res$data9=res.data)===null||_res$data9===void 0?void 0:_res$data9.price)||0,price_per_km:((_res$data10=res.data)===null||_res$data10===void 0?void 0:_res$data10.price_per_km)||0,min_amount:((_res$data11=res.data)===null||_res$data11===void 0?void 0:_res$data11.min_amount)||0,tax:((_res$data12=res.data)===null||_res$data12===void 0?void 0:_res$data12.tax)||0,percentage:((_res$data13=res.data)===null||_res$data13===void 0?void 0:_res$data13.percentage)||0};dispatch(setMenuData({activeMenu,data}));}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const createImages=items=>{return{items,uid:items,url:items,name:items};};function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2,_translations$find3;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description,[`address[${item.locale}]`]:(_translations$find3=translations.find(el=>el.locale===item.locale))===null||_translations$find3===void 0?void 0:_translations$find3.address};});return Object.assign({},...result);}useEffect(()=>{if(activeMenu.refetch&&uuid){fetchShop(uuid);}},[activeMenu.refetch,current,uuid]);return/*#__PURE__*/_jsxs(Card,{title:t('shop.edit'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:[/*#__PURE__*/_jsx(Steps,{current:current,onChange:onChange,children:steps.map(item=>/*#__PURE__*/_jsx(Step,{title:t(item.title)},item.title))}),!loading?/*#__PURE__*/_jsxs(\"div\",{className:\"steps-content\",children:[steps[current].content==='First-content'&&/*#__PURE__*/_jsx(ShopMain,{next:next,loading:loading,action_type:'edit',user:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.seller}),steps[current].content==='Second-content'&&/*#__PURE__*/_jsx(ShopLocations,{next:next,prev:prev}),steps[current].content==='Third-content'&&/*#__PURE__*/_jsx(ShopSocial,{next:next,prev:prev}),steps[current].content==='Fourth-content'&&/*#__PURE__*/_jsx(ShopDelivery,{next:next,prev:prev}),steps[current].content==='Fifth-content'&&/*#__PURE__*/_jsx(UserEdit,{next:next,prev:prev})]}):/*#__PURE__*/_jsx(Loading,{})]});};export default ShopsEdit;","map":null,"metadata":{},"sourceType":"module"}