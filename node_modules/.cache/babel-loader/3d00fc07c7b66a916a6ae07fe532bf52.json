{"ast":null,"code":"import React,{useContext,useEffect,useMemo,useRef,useState}from'react';import{Button,Card,Form,Input,Select,Space,Table}from'antd';import translationService from'services/translation';import{toast}from'react-toastify';import{EditOutlined,PlusCircleOutlined,DeleteOutlined}from'@ant-design/icons';import TranslationCreateModal from'./translationCreateModal';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import SearchInput from'components/search-input';import{CgImport}from'react-icons/cg';import{addMenu}from'redux/slices/menu';import{useNavigate}from'react-router-dom';import{export_url}from'configs/app-global';import CustomModal from'components/modal';import{Context}from'context/context';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const EditableContext=/*#__PURE__*/React.createContext(null);const EditableRow=_ref=>{let{index,...props}=_ref;const[form]=Form.useForm();return/*#__PURE__*/_jsx(Form,{form:form,component:false,children:/*#__PURE__*/_jsx(EditableContext.Provider,{value:form,children:/*#__PURE__*/_jsx(\"tr\",{...props})})});};const EditableCell=_ref2=>{let{title,editable,children,dataIndex,record,handleSave,...restProps}=_ref2;const{t}=useTranslation();const[editing,setEditing]=useState(false);const inputRef=useRef(null);const form=useContext(EditableContext);useEffect(()=>{if(editing){inputRef.current.focus();}},[editing]);const toggleEdit=()=>{setEditing(!editing);form.setFieldsValue({[dataIndex]:record[dataIndex]});};const save=async()=>{try{const values=await form.validateFields();toggleEdit();handleSave({...record,...values,dataIndex});}catch(errInfo){console.log('Save failed:',errInfo);}};let childNode=children;if(editable){childNode=editing?/*#__PURE__*/_jsx(Form.Item,{style:{margin:0},name:dataIndex,rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{ref:inputRef,onPressEnter:save,onBlur:save})}):/*#__PURE__*/_jsxs(\"div\",{className:\"editable-cell-value-wrap cursor-pointer d-flex justify-content-between align-items-center\",style:{paddingRight:24},onClick:toggleEdit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-100\",children:children}),/*#__PURE__*/_jsx(EditOutlined,{})]});}return/*#__PURE__*/_jsx(\"td\",{...restProps,children:childNode});};export default function Translations(){const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{setIsModalVisible}=useContext(Context);const[list,setList]=useState([]);const[pageSize,setPageSize]=useState(10);const[page,setPage]=useState(1);const[total,setTotal]=useState(0);const[loading,setLoading]=useState(false);const[group,setGroup]=useState(null);const[sort,setSort]=useState(null);const[column,setColumn]=useState(null);const[visible,setVisible]=useState(false);const[skipPage,setSkipPage]=useState(0);const{languages}=useSelector(state=>state.formLang,shallowEqual);const[locale,setLocale]=useState('');const[search,setSearch]=useState('');const[downloading,setDownloading]=useState(false);const[deleteKey,setDeleteKey]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const defaultColumns=useMemo(()=>[{title:t('name'),dataIndex:'key',sorter:(a,b,sortOrder)=>sortTable(sortOrder,'key'),width:250,fixed:'left'},{title:t('group'),dataIndex:'group',sorter:(a,b,sortOrder)=>sortTable(sortOrder,'group'),width:150,fixed:'left'},{title:t('options'),dataIndex:'key',width:100,fixed:'center',render:key=>{return/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),onClick:()=>{setDeleteKey([key]);setIsModalVisible(true);}});}},...languages.filter(item=>locale?item.locale===locale:true).map(item=>({title:item.title,dataIndex:`value[${item.locale}]`,editable:true,width:300}))],[languages,locale]);function sortTable(type,column){let sortType;switch(type){case'ascend':sortType='asc';break;case'descend':sortType='desc';break;default:break;}setSort(sortType);setColumn(column);}function fetchTranslations(){setLoading(true);const params={perPage:pageSize,skip:skipPage,group,sort,column,search};translationService.getAll(params).then(_ref3=>{let{data}=_ref3;const translations=Object.entries(data.translations).map(item=>({key:item[0],group:item[1][0].group,...Object.assign({},...languages.map(lang=>{var _item$1$find;return{[`value[${lang.locale}]`]:(_item$1$find=item[1].find(el=>el.locale===lang.locale))===null||_item$1$find===void 0?void 0:_item$1$find.value};}))}));setList(translations);setTotal(data.total);}).finally(()=>setLoading(false));}useEffect(()=>{fetchTranslations();},[pageSize,group,sort,column,skipPage,search]);const onChangePagination=pageNumber=>{const{pageSize,current}=pageNumber;const skip=(current-1)*pageSize;setPageSize(pageSize);setPage(current);setSkipPage(skip);};const handleSave=row=>{const{dataIndex,key}=row;const newData=[...list];const index=newData.findIndex(item=>row.key===item.key);const item=newData[index];if(item[dataIndex]===row[dataIndex]){return;}newData.splice(index,1,{...item,...row});setList(newData);const savedItem={...row,value:undefined,dataIndex:undefined,key:undefined};updateTranslation(key,savedItem);};function updateTranslation(key,data){translationService.update(key,data).then(res=>toast.success(res.message));}const components={body:{row:EditableRow,cell:EditableCell}};const columns=defaultColumns.map(col=>{if(!col.editable){return col;}return{...col,onCell:record=>({record,editable:col.editable,dataIndex:col.dataIndex,title:col.title,fixed:col.fixed,handleSave})};});const excelExport=()=>{setDownloading(true);translationService.export().then(res=>{window.location.href=export_url+res.data.file_name;}).finally(()=>setDownloading(false));};const goToImport=()=>{dispatch(addMenu({id:'translation-import',url:`settings/translations/import`,name:t('translation.import')}));navigate(`import`);};const handleDelete=()=>{setLoadingBtn(true);const params={...Object.assign({},...deleteKey.map((item,index)=>({[`ids[${index}]`]:item})))};translationService.delete(params).then(()=>{fetchTranslations();toast.success(t('successfully.deleted'));setIsModalVisible(false);setDeleteKey(null);}).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsxs(Card,{extra:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[/*#__PURE__*/_jsx(SearchInput,{placeholder:t('search'),handleChange:search=>setSearch(search)}),/*#__PURE__*/_jsxs(Select,{style:{minWidth:150},value:locale,onChange:value=>setLocale(value),placeholder:t('select.language'),children:[/*#__PURE__*/_jsx(Select.Option,{value:\"\",children:t('all')}),languages.map(item=>/*#__PURE__*/_jsx(Select.Option,{value:item.locale,children:item.title},item.locale))]}),/*#__PURE__*/_jsxs(Select,{style:{minWidth:150},value:group,onChange:value=>setGroup(value),placeholder:t('select.group'),children:[/*#__PURE__*/_jsx(Select.Option,{value:\"\",children:t('all')}),/*#__PURE__*/_jsx(Select.Option,{value:\"web\",children:t('web')}),/*#__PURE__*/_jsx(Select.Option,{value:\"mobile\",children:t('mobile')}),/*#__PURE__*/_jsx(Select.Option,{value:\"errors\",children:t('errors')})]}),/*#__PURE__*/_jsxs(Button,{onClick:excelExport,loading:downloading,children:[/*#__PURE__*/_jsx(CgImport,{className:\"mr-2\"}),t('export')]}),/*#__PURE__*/_jsxs(Button,{onClick:goToImport,children:[/*#__PURE__*/_jsx(CgImport,{className:\"mr-2\"}),t('import')]}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),type:\"primary\",onClick:()=>setVisible(true),children:t('add.translation')})]}),children:[/*#__PURE__*/_jsx(Table,{components:components,columns:columns,dataSource:list,pagination:{pageSize,page,total},rowKey:record=>record.id,onChange:onChangePagination,loading:loading,scroll:{x:1500}}),visible&&/*#__PURE__*/_jsx(TranslationCreateModal,{visible:visible,setVisible:setVisible,languages:languages,refetch:fetchTranslations}),/*#__PURE__*/_jsx(CustomModal,{click:handleDelete,text:t('are.you.sure.you.want.to.delete.the.selected.translation'),loading:loadingBtn})]});}","map":null,"metadata":{},"sourceType":"module"}