{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useParams}from'react-router-dom';import{toast}from'react-toastify';import{Button,Card,Col,Form,Input,Row,Space,Spin,Switch}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'../../redux/slices/menu';import{fetchBlogs}from'../../redux/slices/blog';import blogService from'../../services/blog';import LanguageList from'../../components/language-list';import getTranslationFields from'../../helpers/getTranslationFields';import createImage from'../../helpers/createImage';import{useTranslation}from'react-i18next';import CkeEditorEdit from'../../components/ckeEditorEdit';import MediaUpload from'../../components/upload';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function BlogEdit(){var _activeMenu$data,_activeMenu$data2;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const navigate=useNavigate();const{uuid}=useParams();const[image,setImage]=useState((_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.image?[(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.image]:[]);const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));};},[]);const onFinish=values=>{const body={type:'blog',active:values.active?1:0,images:image.length?image.map(item=>item.name):undefined,title:getTranslationFields(languages,values),description:getTranslationFields(languages,values,'description'),short_desc:getTranslationFields(languages,values,'short_desc')};setLoadingBtn(true);const nextUrl='blogs';blogService.update(uuid,body).then(()=>{toast.success(t('successfully.created'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchBlogs({}));}).finally(()=>setLoadingBtn(false));};function getLanguageFields(data){if(!data){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2,_translations$find3;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description,[`short_desc[${item.locale}]`]:(_translations$find3=translations.find(el=>el.locale===item.locale))===null||_translations$find3===void 0?void 0:_translations$find3.short_desc};});return Object.assign({},...result);}const fetchBlog=uuid=>{setLoading(true);blogService.getById(uuid).then(res=>{let blog=res.data;form.setFieldsValue({...blog,...getLanguageFields(blog),image:[createImage(blog.img)]});setImage([createImage(blog.img)]);}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};useEffect(()=>{if(activeMenu.refetch){fetchBlog(uuid);}},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:t('edit.blog'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:!loading?/*#__PURE__*/_jsxs(Form,{name:\"blog-edit\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{active:true,...activeMenu.data},children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('requried')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'title'+item.locale))}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),rules:[{required:!image.length,message:t('required')}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"blogs\",imageList:image,setImageList:setImage,form:form,length:\"1\",multiple:false})})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-12 col-sm-6\",children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})}),/*#__PURE__*/_jsx(Col,{span:24,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('short.description'),name:`short_desc[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'short_desc'+item.locale))}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(CkeEditorEdit,{languages:languages,form:form,lang:defaultLang,getLanguageFields:getLanguageFields})})]}),/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('save')})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})})});}","map":null,"metadata":{},"sourceType":"module"}