{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Card,Col,Descriptions,Row,Space,Spin}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useNavigate,useParams}from'react-router-dom';import{removeFromMenu}from'../../redux/slices/menu';import{fetchProducts}from'../../redux/slices/product';import{useTranslation}from'react-i18next';import productService from'../../services/product';import{IMG_URL}from'../../configs/app-global';import{toast}from'react-toastify';import requestAdminModelsService from'services/request-models';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const ProductFinish=_ref=>{var _changedInfo$shop,_changedInfo$category,_changedInfo$brand,_changedInfo$unit,_changedInfo$images,_originalInfo$transla,_originalInfo$transla2,_originalInfo$shop,_originalInfo$categor,_originalInfo$brand,_originalInfo$unit,_originalInfo$galleri,_originalInfo$stocks;let{prev,isRequest}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const navigate=useNavigate();const dispatch=useDispatch();const[data,setData]=useState({});const[loading,setLoading]=useState(null);const{uuid}=useParams();const[isButtonLoading,setButtonLoading]=useState(false);function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description};});return Object.assign({},...result);}function fetchProduct(uuid){setLoading(true);productService.getById(uuid).then(res=>{const data={...res.data,...getLanguageFields(res.data),properties:res.data.properties.map((item,index)=>({id:index,[`key[${item.locale}]`]:item.key,[`value[${item.locale}]`]:item.value})),translation:undefined,translations:undefined};setData(data);}).finally(()=>setLoading(false));}function finish(){const body={status:undefined};const nextUrl='catalog/products';if(isRequest&&activeMenu.data){setButtonLoading(true);const requestBody={id:activeMenu.data.model_id,type:'product',data:activeMenu.data};requestAdminModelsService.requestChangeUpdate(activeMenu.data.request_id,requestBody).then(()=>{navigate(`/${nextUrl}`,{state:{tab:'request'}});toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));}).finally(()=>{setButtonLoading(false);});return;}dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchProducts(body));navigate(`/${nextUrl}`);}useEffect(()=>{if(!isRequest){fetchProduct(uuid);}},[isRequest]);const changedInfo=activeMenu.data;const originalInfo=isRequest?activeMenu.data.model:data;return!loading?/*#__PURE__*/_jsxs(Card,{children:[isRequest&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Descriptions,{bordered:true,title:t('changed.info'),children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('title')} (${defaultLang})`,span:3,children:changedInfo[`title[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('description')} (${defaultLang})`,span:3,children:changedInfo[`description[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('shop'),span:1.5,children:changedInfo===null||changedInfo===void 0?void 0:(_changedInfo$shop=changedInfo.shop)===null||_changedInfo$shop===void 0?void 0:_changedInfo$shop.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('category'),span:1.5,children:changedInfo===null||changedInfo===void 0?void 0:(_changedInfo$category=changedInfo.category)===null||_changedInfo$category===void 0?void 0:_changedInfo$category.label}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('brand'),span:1.5,children:changedInfo===null||changedInfo===void 0?void 0:(_changedInfo$brand=changedInfo.brand)===null||_changedInfo$brand===void 0?void 0:_changedInfo$brand.label}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('unit'),span:1.5,children:changedInfo===null||changedInfo===void 0?void 0:(_changedInfo$unit=changedInfo.unit)===null||_changedInfo$unit===void 0?void 0:_changedInfo$unit.label}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('images'),span:3,children:/*#__PURE__*/_jsx(Row,{gutter:12,children:changedInfo===null||changedInfo===void 0?void 0:(_changedInfo$images=changedInfo.images)===null||_changedInfo$images===void 0?void 0:_changedInfo$images.filter(item=>!item.isVideo).map((item,idx)=>/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"img\",{width:80,alt:\"product\",src:item.url})},'image'+idx))})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('tax'),children:(changedInfo===null||changedInfo===void 0?void 0:changedInfo.tax)||0}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('min.quantity'),children:changedInfo===null||changedInfo===void 0?void 0:changedInfo.min_qty}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('max.quantity'),children:changedInfo===null||changedInfo===void 0?void 0:changedInfo.max_qty})]}),changedInfo===null||changedInfo===void 0?void 0:changedInfo.stocks.map((item,idx)=>{var _item$ids;if(!item){return'';}return/*#__PURE__*/_jsxs(Descriptions,{bordered:true,className:\"mt-4\",children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:t('price'),span:2,children:item.price}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('quantity'),span:2,children:item.quantity}),item===null||item===void 0?void 0:(_item$ids=item.ids)===null||_item$ids===void 0?void 0:_item$ids.map((extra,idx)=>/*#__PURE__*/_jsx(Descriptions.Item,{label:changedInfo===null||changedInfo===void 0?void 0:changedInfo.extras[idx].label,children:extra===null||extra===void 0?void 0:extra.label},'extra'+idx))]},'desc'+idx);})]}),/*#__PURE__*/_jsxs(Descriptions,{bordered:true,className:\"mt-4\",title:t('original.info'),children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('title')} (${defaultLang})`,span:3,column:3,children:((_originalInfo$transla=originalInfo.translation)===null||_originalInfo$transla===void 0?void 0:_originalInfo$transla.title)||originalInfo[`title[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('description')} (${defaultLang})`,span:3,column:3,children:(originalInfo===null||originalInfo===void 0?void 0:(_originalInfo$transla2=originalInfo.translation)===null||_originalInfo$transla2===void 0?void 0:_originalInfo$transla2.description)||originalInfo[`description[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('shop'),span:1.5,column:1.5,children:(_originalInfo$shop=originalInfo.shop)===null||_originalInfo$shop===void 0?void 0:_originalInfo$shop.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('category'),span:1.5,column:1.5,children:(_originalInfo$categor=originalInfo.category)===null||_originalInfo$categor===void 0?void 0:_originalInfo$categor.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('brand'),span:1.5,column:1.5,children:(_originalInfo$brand=originalInfo.brand)===null||_originalInfo$brand===void 0?void 0:_originalInfo$brand.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('unit'),span:1.5,column:1.5,children:(_originalInfo$unit=originalInfo.unit)===null||_originalInfo$unit===void 0?void 0:_originalInfo$unit.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('images'),span:3,column:3,children:/*#__PURE__*/_jsx(Row,{gutter:12,children:originalInfo===null||originalInfo===void 0?void 0:(_originalInfo$galleri=originalInfo.galleries)===null||_originalInfo$galleri===void 0?void 0:_originalInfo$galleri.filter(item=>!item.preview).map((item,idx)=>/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"img\",{width:80,alt:\"product\",src:IMG_URL+item.path})},'image'+idx))})}),/*#__PURE__*/_jsx(Descriptions.Item,{span:3,column:3,label:t('tax'),children:originalInfo.tax||0}),/*#__PURE__*/_jsx(Descriptions.Item,{span:3,column:3,label:t('min.quantity'),children:originalInfo.min_qty}),/*#__PURE__*/_jsx(Descriptions.Item,{span:3,column:3,label:t('max.quantity'),children:originalInfo.max_qty})]}),(_originalInfo$stocks=originalInfo.stocks)===null||_originalInfo$stocks===void 0?void 0:_originalInfo$stocks.map((item,idx)=>{if(!item){return'';}return/*#__PURE__*/_jsxs(Descriptions,{bordered:true,className:\"mt-4\",children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:t('price'),span:2,column:2,children:item.price}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('quantity'),span:2,column:2,children:item.quantity}),item.extras.map((extra,idx)=>{var _extra$group,_extra$group$translat,_extra$value;return/*#__PURE__*/_jsx(Descriptions.Item,{label:extra===null||extra===void 0?void 0:(_extra$group=extra.group)===null||_extra$group===void 0?void 0:(_extra$group$translat=_extra$group.translation)===null||_extra$group$translat===void 0?void 0:_extra$group$translat.title,span:2,column:2,children:extra===null||extra===void 0?void 0:(_extra$value=extra.value)===null||_extra$value===void 0?void 0:_extra$value.value},'extra'+idx);})]},'desc'+idx);}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-end mt-4\",children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{onClick:prev,children:t('prev')}),/*#__PURE__*/_jsx(Button,{loading:isButtonLoading,type:\"primary\",onClick:finish,children:t('finish')})]})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})});};export default ProductFinish;","map":null,"metadata":{},"sourceType":"module"}