{"ast":null,"code":"import React,{useEffect,useState}from'react';import{shallowEqual,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import{Button,Card,Col,Form,Row,Select,Spin,Switch}from'antd';import{useDispatch}from'react-redux';import{useNavigate}from'react-router-dom';import shopAdsService from'services/shop-ads';import{toast}from'react-toastify';import LanguageList from'components/language-list';import{DebounceSelect}from'components/search';import{setMenuData,removeFromMenu,disableRefetch}from'redux/slices/menu';import advertService from'services/advert';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ShopAdsForm=_ref=>{let{id}=_ref;const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const[form]=Form.useForm();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[loading,setLoading]=useState(false);const[isFetching,setFetching]=useState(false);const[ads_package_id,setAdsPackageId]=useState(null);const allStatuses=['new','approved','canceled'];const onFinish=values=>{var _values$banner_id;const params={...values,banner_id:values===null||values===void 0?void 0:(_values$banner_id=values.banner_id)===null||_values$banner_id===void 0?void 0:_values$banner_id.value,active:Number(values===null||values===void 0?void 0:values.active),ads_package_id:ads_package_id};shopAdsUpdate(params);};const shopAdsUpdate=params=>{setLoading(true);const nextUrl='catalog/shop-ads';shopAdsService.update(id,params).then(()=>{navigate(`/${nextUrl}`);toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));}).finally(()=>setLoading(false));};async function fetchAdsPackage(search){const params={search,perPage:10,active:1};return advertService.getAll(params).then(res=>formatDataSelect(res.data));}function formatDataSelect(data){return data.map(item=>({label:item===null||item===void 0?void 0:item.translation.title,value:item.id,self:item,key:item.id}));}const getShopAds=alias=>{setFetching(true);shopAdsService.getById(alias).then(res=>{var _ads_package$translat;setFetching(false);const shopAd=res.data;const ads_package=shopAd===null||shopAd===void 0?void 0:shopAd.ads_package;setAdsPackageId(shopAd.ads_package_id);const data={...shopAd,ads_package_id:{label:ads_package===null||ads_package===void 0?void 0:(_ads_package$translat=ads_package.translation)===null||_ads_package$translat===void 0?void 0:_ads_package$translat.title,value:ads_package===null||ads_package===void 0?void 0:ads_package.id,key:ads_package===null||ads_package===void 0?void 0:ads_package.id},status:shopAd===null||shopAd===void 0?void 0:shopAd.status,active:shopAd===null||shopAd===void 0?void 0:shopAd.active};form.setFieldsValue(data);dispatch(setMenuData({activeMenu,data}));}).finally(()=>{});};useEffect(()=>{if(!!id){getShopAds(id);}},[id]);useEffect(()=>{if(activeMenu.refetch){getShopAds(id);dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);if(isFetching){return/*#__PURE__*/_jsx(Card,{title:t('edit.ad'),children:/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})})});}return/*#__PURE__*/_jsxs(Form,{layout:\"vertical\",form:form,initialValues:{active:true,...(activeMenu===null||activeMenu===void 0?void 0:activeMenu.data)},onFinish:onFinish,children:[/*#__PURE__*/_jsx(Card,{title:!!id?t('edit.shop.ads'):t('add.shop.ads'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('ads.package'),name:'ads_package_id',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchAdsPackage,debounceTimeout:200})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('status'),name:'status',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{children:allStatuses.map(item=>/*#__PURE__*/_jsx(Select.Option,{children:t(item)},item))})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})]})}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loading,children:t('submit')})]});};export default ShopAdsForm;","map":null,"metadata":{},"sourceType":"module"}