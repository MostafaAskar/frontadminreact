{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useLocation,useNavigate,useParams}from'react-router-dom';import{toast}from'react-toastify';import{Button,Card,Col,Form,Input,Row,Spin,Switch}from'antd';import{IMG_URL}from'../../configs/app-global';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'../../redux/slices/menu';import brandService from'../../services/brand';import{fetchBrands}from'../../redux/slices/brand';import{useTranslation}from'react-i18next';import MediaUpload from'../../components/upload';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const BrandClone=()=>{var _activeMenu$data,_activeMenu$data2;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{id}=useParams();const dispatch=useDispatch();const[image,setImage]=useState((_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.image?[(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.image]:[]);const[form]=Form.useForm();const navigate=useNavigate();const locations=useLocation();const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));};},[]);const createImage=name=>{return{name,url:IMG_URL+name};};const fetchBrand=id=>{setLoading(true);brandService.getById(id).then(res=>{let brand=res.data;form.setFieldsValue({...brand,image:[createImage(brand.img)]});setImage([createImage(brand.img)]);}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const onFinish=values=>{var _image$;const body={...values,active:values.active?1:0,'images[0]':(_image$=image[0])===null||_image$===void 0?void 0:_image$.name};setLoadingBtn(true);const nextUrl='catalog/brands';brandService.create(body).then(()=>{toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchBrands({}));}).finally(()=>setLoadingBtn(false));};useEffect(()=>{if(activeMenu.refetch){fetchBrand(id);}},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:t('clone.brand'),children:!loading?/*#__PURE__*/_jsxs(Form,{name:\"basic\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{...activeMenu.data},children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:'title',rules:[{required:true,message:t('required')},{validator(_,value){if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{maxLength:50})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),name:\"images\",rules:[{required:!(image!==null&&image!==void 0&&image.length),message:t('required')}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"brands\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-12 col-sm-6\",children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})})});};export default BrandClone;","map":null,"metadata":{},"sourceType":"module"}