{"ast":null,"code":"import React,{useState}from'react';import{Button,Card,Col,Form,Input,InputNumber,Row,Switch,message}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{setMenuData}from'redux/slices/menu';import{useTranslation}from'react-i18next';import getTranslationFields from'helpers/getTranslationFields';import LanguageList from'components/language-list';import MediaUpload from'components/upload';import deliveryPointService from'services/delivery-point';import{RefetchSearch}from'components/refetch-search';import regionService from'services/deliveryzone/region';import countryService from'services/deliveryzone/country';import cityService from'services/deliveryzone/city';import Map from'components/map';import areaService from'services/deliveryzone/area';import getDefaultLocation from'helpers/getDefaultLocation';import AddressForm from'components/forms/address-form';import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const AddDeliveryPoint=_ref=>{let{next}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{settings}=useSelector(state=>state.globalSettings,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const[image,setImage]=useState([]);const[location,setLocation]=useState(getDefaultLocation(settings));const[loadingBtn,setLoadingBtn]=useState(false);const[formData,setFormData]=useState({});const[value,setValue]=useState('');const{country,region,city}=formData;const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);const onFinish=values=>{var _activeMenu$data;const{area,city,country,region,price,fitting_rooms,active}=values;const body={price,fitting_rooms,location:{latitude:location===null||location===void 0?void 0:location.lat,longitude:location===null||location===void 0?void 0:location.lng},active:active?1:0,area_id:area===null||area===void 0?void 0:area.value,city_id:city===null||city===void 0?void 0:city.value,country_id:country===null||country===void 0?void 0:country.value,region_id:region===null||region===void 0?void 0:region.value,images:image.map(image=>image.name),title:getTranslationFields(languages,values,'title'),address:getTranslationFields(languages,values,'address')};if(activeMenu!==null&&activeMenu!==void 0&&(_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.id){next();return;}setLoadingBtn(true);deliveryPointService.create(body).then(_ref2=>{let{data}=_ref2;message.success(t('successfully.created'));const formFieldsValue=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data:{...formFieldsValue,id:data.id}}));next();}).finally(()=>setLoadingBtn(false));};async function fetchRegion(search){const params={search,status:1,perPage:10};return regionService.get(params).then(_ref3=>{let{data}=_ref3;return data.map(item=>({label:item.translation.title||'no name',value:item.id}));});}async function fetchCountry(search){const params={search,status:1,perPage:10,region_id:region===null||region===void 0?void 0:region.value};return countryService.get(params).then(_ref4=>{let{data}=_ref4;return data.map(item=>({label:item.translation.title||'no name',value:item.id}));});}async function fetchCity(search){const params={search,status:1,perPage:10,country_id:country===null||country===void 0?void 0:country.value};return cityService.get(params).then(_ref5=>{let{data}=_ref5;return data.map(item=>({label:item.translation.title||'no name',value:item.id}));});}async function fetchArea(search){const params={search,status:1,perPage:10,city_id:city===null||city===void 0?void 0:city.value};return areaService.get(params).then(_ref6=>{let{data}=_ref6;return data.map(item=>({label:item.translation.title||'no name',value:item.id}));});}return/*#__PURE__*/_jsxs(Form,{name:\"add.delivery.point\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{clickable:true,...activeMenu.data},children:[/*#__PURE__*/_jsxs(Row,{gutter:[24,24],children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(Card,{title:t('deliveryzone'),className:\"h-100\",children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('region'),name:\"region\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchRegion,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,onChange:value=>{setFormData(prev=>({...prev,region:value}));form.resetFields(['city','area','country']);}})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('country'),name:\"country\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchCountry,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,onChange:value=>{setFormData(prev=>({...prev,country:value}));form.resetFields(['city','area']);},disabled:!Boolean(region===null||region===void 0?void 0:region.value)})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('city'),name:\"city\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchCity,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,disabled:!Boolean(country===null||country===void 0?void 0:country.value),onChange:value=>{setFormData(prev=>({...prev,city:value}));form.resetFields(['area']);}})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('area'),name:\"area\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchArea,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,disabled:!Boolean(city===null||city===void 0?void 0:city.value)})})})]})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(Card,{title:t('pricing'),className:\"h-100\",children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('price'),name:\"price\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('fitting_rooms'),name:\"fitting_rooms\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{rules:[{required:false,message:t('required')}],label:t('image'),name:\"images\",children:/*#__PURE__*/_jsx(MediaUpload,{type:\"products\",imageList:image,setImageList:setImage,form:form,length:\"1\",multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})]})})]})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:t('address'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(AddressForm,{setLocation:setLocation,value:value,setValue:setValue})}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'title'+idx))}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Map,{location:location,setLocation:setLocation,setAddress:value=>form.setFieldsValue({[`address[${defaultLang}]`]:value})})})]})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex justify-content-end mt-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})})})]});};export default AddDeliveryPoint;","map":null,"metadata":{},"sourceType":"module"}