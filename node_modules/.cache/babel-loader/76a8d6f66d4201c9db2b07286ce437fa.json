{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Form,Card}from'antd';import LanguageList from'components/language-list';import{useNavigate,useParams}from'react-router-dom';import couponService from'services/coupon';import moment from'moment';import{batch,shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'redux/slices/menu';import{useTranslation}from'react-i18next';import{fetchCoupon}from'redux/slices/coupon';import CouponForm from'./coupon-form';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";const CouponEdit=()=>{const{t}=useTranslation();const[form]=Form.useForm();const[loading,setLoading]=useState(false);const{languages}=useSelector(state=>state.formLang,shallowEqual);const dispatch=useDispatch();const navigate=useNavigate();const{id}=useParams();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title};});return Object.assign({},...result);}function getCoupon(id){setLoading(true);couponService.getById(id).then(_ref=>{var _data$shop,_data$shop$translatio,_data$shop2,_data$shop3;let{data}=_ref;const body={...data,shop_id:{label:data===null||data===void 0?void 0:(_data$shop=data.shop)===null||_data$shop===void 0?void 0:(_data$shop$translatio=_data$shop.translation)===null||_data$shop$translatio===void 0?void 0:_data$shop$translatio.title,value:data===null||data===void 0?void 0:(_data$shop2=data.shop)===null||_data$shop2===void 0?void 0:_data$shop2.id,key:data===null||data===void 0?void 0:(_data$shop3=data.shop)===null||_data$shop3===void 0?void 0:_data$shop3.id},...getLanguageFields(data),expired_at:moment(data.expired_at,'YYYY-MM-DD')};form.setFieldsValue({...body});dispatch(setMenuData({activeMenu,data:{...body,expired_at:JSON.stringify(body===null||body===void 0?void 0:body.expired_at)}}));}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});}const onFinish=values=>{const params={...values,expired_at:moment(values.expired_at).format('YYYY-MM-DD'),qty:Number(values.qty),price:Number(values.price)};const nextUrl='coupons';couponService.update(id,params).then(()=>{toast.success(t('toast.updated'));batch(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchCoupon({}));});navigate(`/${nextUrl}`);});};useEffect(()=>{if(activeMenu.refetch){getCoupon(id);}},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:t('edit.coupon'),extra:/*#__PURE__*/_jsx(LanguageList,{}),loading:loading,children:/*#__PURE__*/_jsx(CouponForm,{form:form,handleSubmit:onFinish})});};export default CouponEdit;","map":null,"metadata":{},"sourceType":"module"}