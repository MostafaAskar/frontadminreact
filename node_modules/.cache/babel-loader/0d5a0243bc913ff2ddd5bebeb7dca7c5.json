{"ast":null,"code":"import{Button,Form,Input,Modal}from'antd';import React,{useEffect,useState}from'react';import{SketchPicker}from'react-color';import{useTranslation}from'react-i18next';import{useDispatch}from'react-redux';import{toast}from'react-toastify';import ImageUploadSingle from'components/image-upload-single';import createImage from'helpers/createImage';import{fetchExtraValues}from'redux/slices/extraValue';import extraService from'services/extra';import{DebounceSelect}from'components/search';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ExtraValueModal(_ref){var _modal$group,_modal$group$translat,_modal$group2,_modal$group3;let{modal,handleCancel,isVisible,paramsData}=_ref;const[form]=Form.useForm();const{t}=useTranslation();const dispatch=useDispatch();const[loadingBtn,setLoadingBtn]=useState(false);const[type,setType]=useState('text');const[image,setImage]=useState(null);const[color,setColor]=useState('');const fetchExtraGroups=search=>{const paramsData={perPage:10,page:1,search:search};return extraService.getAllGroups(paramsData).then(res=>res.data.map(group=>{var _group$translation;return{label:group===null||group===void 0?void 0:(_group$translation=group.translation)===null||_group$translation===void 0?void 0:_group$translation.title,value:group===null||group===void 0?void 0:group.id,key:`${group===null||group===void 0?void 0:group.type},${group===null||group===void 0?void 0:group.id}`};}));};useEffect(()=>{if(modal!==null&&modal!==void 0&&modal.id){setType(modal.group.type);switch(modal.group.type){case'color':setColor(modal.value);break;case'image':setImage(createImage(modal.value));break;default:break;}form.setFieldsValue(modal);}},[modal]);const updateExtra=(id,body)=>{setLoadingBtn(true);extraService.updateValue(id,body).then(()=>{toast.success(t('successfully.updated'));handleCancel();dispatch(fetchExtraValues(paramsData));}).finally(()=>{setLoadingBtn(false);form.resetFields();});};const createExtra=body=>{setLoadingBtn(true);extraService.createValue(body).then(()=>{toast.success(t('successfully.created'));handleCancel();dispatch(fetchExtraValues(paramsData));}).finally(()=>{setLoadingBtn(false);form.resetFields();});};const onFinish=values=>{var _values$extra_group_i,_getValue;const body={extra_group_id:(_values$extra_group_i=values.extra_group_id.value)!==null&&_values$extra_group_i!==void 0?_values$extra_group_i:values.extra_group_id,value:(_getValue=getValue(type,values.value))!==null&&_getValue!==void 0?_getValue:values.value};if(modal!==null&&modal!==void 0&&modal.id){updateExtra(modal===null||modal===void 0?void 0:modal.id,body);}else{createExtra(body);}};function getValue(type,value){switch(type){case'color':return value.hex;case'text':return value;case'image':return value.name;default:return'';}}const renderExtraValue=type=>{switch(type){case'color':return/*#__PURE__*/_jsx(SketchPicker,{onChangeComplete:color=>setColor(color.hex),color:color,disableAlpha:true});case'text':return/*#__PURE__*/_jsx(Input,{placeholder:t('enter.extra.value')});case'image':return/*#__PURE__*/_jsx(ImageUploadSingle,{type:\"extras\",image:image,setImage:setImage,form:form,name:\"value\"});default:return'';}};return/*#__PURE__*/_jsx(Modal,{title:modal!==null&&modal!==void 0&&modal.id?t('edit.extra'):t('add.extra'),visible:isVisible,onCancel:handleCancel,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),loading:loadingBtn,children:t('save')}),/*#__PURE__*/_jsx(Button,{type:\"default\",onClick:handleCancel,children:t('cancel')})],children:/*#__PURE__*/_jsxs(Form,{name:\"extra-form\",layout:\"vertical\",form:form,onFinish:onFinish,initialValues:{extra_group_id:modal!==null&&modal!==void 0&&modal.group?{label:modal===null||modal===void 0?void 0:(_modal$group=modal.group)===null||_modal$group===void 0?void 0:(_modal$group$translat=_modal$group.translation)===null||_modal$group$translat===void 0?void 0:_modal$group$translat.title,value:modal===null||modal===void 0?void 0:(_modal$group2=modal.group)===null||_modal$group2===void 0?void 0:_modal$group2.id,key:modal===null||modal===void 0?void 0:(_modal$group3=modal.group)===null||_modal$group3===void 0?void 0:_modal$group3.id}:[]},children:[/*#__PURE__*/_jsx(Form.Item,{name:\"extra_group_id\",label:t('extra.group'),rules:[{required:true,message:'required'}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchExtraGroups,placeholder:t('select.extra.group'),allowClear:true,onChange:e=>{var _e$key;setType(e===null||e===void 0?void 0:(_e$key=e.key)===null||_e$key===void 0?void 0:_e$key.split(',')[0]);form.setFieldsValue({value:''});}})}),/*#__PURE__*/_jsx(Form.Item,{name:\"value\",label:t('value'),rules:[{required:true,message:'required'}],children:renderExtraValue(type)})]})});}","map":null,"metadata":{},"sourceType":"module"}