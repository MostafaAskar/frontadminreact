{"ast":null,"code":"import{Card,Col,Row,Space,Table,Tag,Button,Select}from'antd';import React from'react';import{CloudDownloadOutlined}from'@ant-design/icons';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useState}from'react';import{useEffect}from'react';import ReportService from'services/reports';import{addMenu,disableRefetch}from'redux/slices/menu';import FilterColumns from'components/filter-column';import{fetchStockProduct}from'redux/slices/report/stock';import useDidUpdate from'helpers/useDidUpdate';import{useTranslation}from'react-i18next';import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const ReportStock=()=>{var _activeMenu$data;const dispatch=useDispatch();const{t}=useTranslation();const navigate=useNavigate();const options=[{value:null,label:'All products',key:'all_products'},{value:'in_stock',label:'In stock',key:'in_stock'},{value:'low_stock',label:'Low stock',key:'low_stock'},{value:'out_of_stock',label:'Out of stock',key:'out_of_stock'}];const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{loading,productList:reportProducts}=useSelector(state=>state.stockReport,shallowEqual);const[selectedRowKeys,setSelectedRowKeys]=useState([]);const[downloading,setDownloading]=useState(false);const[status,setStatus]=useState((activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.value)||null);const goToProductReport=row=>{dispatch(addMenu({url:`report/products`,id:'report.products',name:t('report.products')}));navigate(`/report/products?product_id=${row.id}`);};const[columns,setColumns]=useState([{title:'Product title',dataIndex:'product_translation_title',key:'product_translation_title',render:(_,data)=>{var _data$translation;return/*#__PURE__*/_jsx(\"a\",{onClick:()=>goToProductReport(data),children:data===null||data===void 0?void 0:(_data$translation=data.translation)===null||_data$translation===void 0?void 0:_data$translation.title});},is_show:true,sorter:(a,b)=>{var _a$translation,_b$translation;return a===null||a===void 0?void 0:(_a$translation=a.translation)===null||_a$translation===void 0?void 0:_a$translation.title.localeCompare(b===null||b===void 0?void 0:(_b$translation=b.translation)===null||_b$translation===void 0?void 0:_b$translation.title);}},{title:'Status',key:'status',dataIndex:'status',render:(_,data)=>/*#__PURE__*/_jsx(Tag,{children:data.status},data.id),is_show:true},{title:'Stock',key:'stock',dataIndex:'quantity',render:(_,data)=>data===null||data===void 0?void 0:data.stocks_sum_quantity,is_show:true,sorter:(a,b)=>(a===null||a===void 0?void 0:a.stocks_sum_quantity)-(b===null||b===void 0?void 0:b.stocks_sum_quantity)}]);const params={page:activeMenu.page,perPage:activeMenu.perPage,actual:status};const fetchProduct=params=>{dispatch(fetchStockProduct(params));};useDidUpdate(()=>{fetchProduct(params);},[status]);useEffect(()=>{if(activeMenu.refetch){fetchProduct(params);dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);const onSelectChange=newSelectedRowKeys=>setSelectedRowKeys(newSelectedRowKeys);const rowSelection={selectedRowKeys,onChange:onSelectChange};const onChangePagination=pagination=>{const{pageSize:perPage,current:page}=pagination;fetchProduct({page,perPage,actual:status});};const excelExport=()=>{setDownloading(true);ReportService.getStocks({export:'excel',actual:status}).then(res=>{const body=res.data.link;if(body){window.location.href=body;}}).finally(()=>setDownloading(false));};const handleSelector=e=>setStatus(e);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Row,{gutter:24,children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Card,{title:t('stock'),children:[/*#__PURE__*/_jsxs(Space,{className:\"d-flex justify-content-end\",children:[/*#__PURE__*/_jsx(Select,{style:{width:'200px'},onChange:handleSelector,options:options,defaultValue:(activeMenu===null||activeMenu===void 0?void 0:activeMenu.data)||null}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(CloudDownloadOutlined,{}),loading:downloading,onClick:excelExport,children:t('download')}),/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})]}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},rowSelection:rowSelection,columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:reportProducts.data||[],rowKey:row=>row.id,loading:loading,pagination:{pageSize:reportProducts===null||reportProducts===void 0?void 0:reportProducts.per_page,page:(reportProducts===null||reportProducts===void 0?void 0:reportProducts.current_page)||1,total:reportProducts===null||reportProducts===void 0?void 0:reportProducts.total,defaultCurrent:1},onChange:onChangePagination})]})})})});};export default ReportStock;","map":null,"metadata":{},"sourceType":"module"}