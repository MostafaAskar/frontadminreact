{"ast":null,"code":"import React,{useState}from'react';import{Button,Col,DatePicker,Form,Input,InputNumber,Row,Select}from'antd';import{useLocation,useNavigate,useParams}from'react-router-dom';import{shallowEqual,useDispatch,useSelector}from'react-redux';import userService from'services/user';import{toast}from'react-toastify';import{removeFromMenu}from'redux/slices/menu';import{fetchUsers}from'redux/slices/user';import moment from'moment';import{useTranslation}from'react-i18next';import{fetchClients}from'redux/slices/client';import MediaUpload from'components/upload';import{DebounceSelect}from'components/search';import shopService from'services/restaurant';import useDemo from'helpers/useDemo';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function UserEditForm(_ref){var _activeMenu$data;let{form,data,image,setImage,action_type=''}=_ref;const{t}=useTranslation();const activeMenu=useSelector(list=>list.menu.activeMenu,shallowEqual);const dispatch=useDispatch();const navigate=useNavigate();const{uuid}=useParams();const locations=useLocation();const[error,setError]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const role=activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.role;const user=useSelector(state=>state.user,shallowEqual);const client=useSelector(state=>state.client,shallowEqual);const{isDemo}=useDemo();const onFinish=values=>{var _image$,_values$shop_id,_values$shop_id2,_values$shop_id3;setLoadingBtn(true);const body={firstname:values.firstname,lastname:values.lastname,email:values===null||values===void 0?void 0:values.email,phone:values===null||values===void 0?void 0:values.phone,birthday:moment(values.birthday).format('YYYY-MM-DD'),gender:values.gender,images:image[0]?[(_image$=image[0])===null||_image$===void 0?void 0:_image$.name]:undefined,shop_id:values!==null&&values!==void 0&&values.shop_id?(values===null||values===void 0?void 0:(_values$shop_id=values.shop_id)===null||_values$shop_id===void 0?void 0:_values$shop_id.length)!==undefined?values===null||values===void 0?void 0:(_values$shop_id2=values.shop_id)===null||_values$shop_id2===void 0?void 0:_values$shop_id2.map(item=>item.value):[values===null||values===void 0?void 0:(_values$shop_id3=values.shop_id)===null||_values$shop_id3===void 0?void 0:_values$shop_id3.value]:undefined,role:role};const nextUrl=locations.pathname.search('/user/delivery/')===0?'deliveries/list':data.role!=='user'?'users/admin':'users/user';const userParamsData={...user.params,role:data.role};const clientParamsData={...client.params};if(action_type==='edit'){userService.update(uuid,body).then(()=>{toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);if(data.role==='user'){dispatch(fetchClients(clientParamsData));}else{dispatch(fetchUsers(userParamsData));}}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));}else{userService.create(body).then(()=>{toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);if(data.role==='user'){dispatch(fetchClients(clientParamsData));}else{dispatch(fetchUsers(userParamsData));}}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));}};async function fetchUserShop(search){const params={search,status:'approved'};return shopService.search(params).then(res=>res.data.map(item=>({label:item.translation!==null?item.translation.title:t('no.name'),value:item.id,key:item.id})));}return/*#__PURE__*/_jsx(Form,{form:form,layout:\"vertical\",initialValues:{gender:'male',role:'admin',...data},onFinish:onFinish,className:\"px-2\",children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{name:'images',label:t('avatar'),rules:[{validator(){if((image===null||image===void 0?void 0:image.length)===0){return Promise.reject(new Error(t('required')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(MediaUpload,{type:'users',imageList:image,setImageList:setImage,form:form,multiple:false,name:\"logo_img\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('firstname'),name:\"firstname\",help:error!==null&&error!==void 0&&error.firstname?error.firstname[0]:null,validateStatus:error!==null&&error!==void 0&&error.firstname?'error':'success',rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('lastname'),name:\"lastname\",help:error!==null&&error!==void 0&&error.lastname?error.lastname[0]:null,validateStatus:error!==null&&error!==void 0&&error.lastname?'error':'success',rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('phone'),name:\"phone\",help:error!==null&&error!==void 0&&error.phone?error.phone[0]:null,validateStatus:error!==null&&error!==void 0&&error.phone?'error':'success',rules:[{required:!isDemo,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('birthday'),name:\"birthday\",rules:[{required:true,message:t('required')}],valuePropName:'birthday',children:/*#__PURE__*/_jsx(DatePicker,{className:\"w-100\",disabledDate:current=>moment().add(-18,'years')<=current,defaultPickerValue:moment().add(-18,'years'),defaultValue:moment(data===null||data===void 0?void 0:data.birthday)})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('gender'),name:\"gender\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsxs(Select,{picker:\"dayTime\",className:\"w-100\",children:[/*#__PURE__*/_jsx(Select.Option,{value:\"male\",children:t('male')}),/*#__PURE__*/_jsx(Select.Option,{value:\"female\",children:t('female')})]})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('email'),name:\"email\",help:error!==null&&error!==void 0&&error.email?error.email[0]:null,validateStatus:error!==null&&error!==void 0&&error.email?'error':'success',rules:[{required:!isDemo,message:t('required')},{type:'email',message:t('invalid.email')}],children:/*#__PURE__*/_jsx(Input,{type:\"email\",className:\"w-100\",disabled:isDemo})})}),role==='cook'&&/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('shop'),name:\"shop_id\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchUserShop,className:\"w-100\",placeholder:t('select.shop'),allowClear:false})})}),role==='moderator'&&/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('branches'),name:\"shop_id\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchUserShop,className:\"w-100\",placeholder:t('select.shop'),allowClear:false})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('save')})})]})});}","map":null,"metadata":{},"sourceType":"module"}