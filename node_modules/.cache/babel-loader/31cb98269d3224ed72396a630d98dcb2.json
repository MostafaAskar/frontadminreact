{"ast":null,"code":"import{Card,Col,Row,Space,Typography,Table,Tag,Divider,DatePicker,Select,Spin}from'antd';import React,{useContext}from'react';import ChartWidget from'components/chart-widget';import{BarChartOutlined,LineChartOutlined}from'@ant-design/icons';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{Link,useLocation}from'react-router-dom';import QueryString from'qs';import{ReportContext}from'context/report';import{useEffect}from'react';import{fetchReportOverviewCart,fetchReportOverviewCategories,fetchReportOverviewProducts}from'redux/slices/report/overview';import{disableRefetch}from'redux/slices/menu';import useDidUpdate from'helpers/useDidUpdate';import moment from'moment';import numberToPrice from'helpers/numberToPrice';import{useTranslation}from'react-i18next';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{Text,Title}=Typography;const{RangePicker}=DatePicker;const ReportOverview=()=>{var _carts$chart_price,_carts$chart_price2,_carts$chart_count,_carts$chart_price3,_categories$meta,_categories$meta2,_categories$meta3,_products$meta,_products$meta2,_products$meta3;const{t}=useTranslation();const location=useLocation();const category_id=QueryString.parse(location.search,[])['?category_id'];const product_id=QueryString.parse(location.search,[])['?product_id'];const{date_from,date_to,by_time,chart,handleDateRange,options,handleByTime,chart_type,setChartType}=useContext(ReportContext);const{loading,carts,products,categories}=useSelector(state=>state.overviewReport,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const topProductsTitle=data=>{const titleArray=data===null||data===void 0?void 0:data.split(', ');return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',rowGap:'10px',flexDirection:'column'},children:titleArray===null||titleArray===void 0?void 0:titleArray.map((item,index)=>(item===null||item===void 0?void 0:item[0])==='#'?/*#__PURE__*/_jsx(\"span\",{style:{display:'block',width:'15px',height:'15px',borderRadius:'50%',backgroundColor:item===null||item===void 0?void 0:item.trim()}}):item)});};const columns=[{title:t('title'),dataIndex:'title',key:'title',render:title=>topProductsTitle(title)},{title:t('item.sold'),dataIndex:'quantity',key:'quantity'},{title:t('net.sales'),dataIndex:'total_price',key:'total_price',render:price=>numberToPrice(price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)},{title:t('orders'),dataIndex:'count',key:'count'}];const performance=[{title:'Total sales',qty:'delivered_sum',percent:'5',price:true},{title:'Orders',qty:'count',percent:'5',price:false},{title:'Canceled orders price',qty:'canceled_sum',percent:'5',price:true},{title:'Total tax',qty:'tax',percent:'5',price:true},{title:'Delivered avg',qty:'delivered_avg',percent:'5',price:true},{title:'Delivery fee',qty:'delivery_fee',percent:'5',price:true}];const fetchProducts=(page,perPage)=>{const params={date_from,date_to,type:by_time,page,perPage};dispatch(fetchReportOverviewProducts(params));};const fetchCategories=(page,perPage)=>{const params={date_from,date_to,type:by_time,page,perPage};dispatch(fetchReportOverviewCategories(params));};const fetchOverview=(page,perPage)=>{const params={date_from,date_to,type:by_time,page,perPage};if(category_id)params.categories=[category_id];if(product_id)params.products=[product_id];dispatch(fetchReportOverviewCart(params));};const onProductPaginationChange=pagination=>{const{pageSize:perPage,current:page}=pagination;fetchProducts(page,perPage);};const onCategoryPaginationChange=pagination=>{const{pageSize:perPage,current:page}=pagination;fetchProducts(page,perPage);};useEffect(()=>{if(activeMenu.refetch){fetchOverview();fetchProducts();fetchCategories();dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);useDidUpdate(()=>{fetchOverview();},[date_to,by_time,chart,category_id,product_id,date_from]);useDidUpdate(()=>{fetchProducts();},[date_to,by_time,date_from]);useDidUpdate(()=>{fetchCategories();},[date_to,by_time,date_from]);return/*#__PURE__*/_jsxs(Spin,{size:\"large\",spinning:loading,children:[/*#__PURE__*/_jsx(Row,{gutter:24,className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Space,{size:\"large\",children:/*#__PURE__*/_jsx(RangePicker,{defaultValue:[moment(date_from),moment(date_to)],onChange:handleDateRange})})})}),/*#__PURE__*/_jsx(Divider,{orientation:\"left\",children:\"Performance\"}),/*#__PURE__*/_jsx(Row,{gutter:24,children:performance===null||performance===void 0?void 0:performance.map((item,key)=>{return/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Link,{to:\"/report/revenue\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Row,{className:\"mb-5\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Text,{children:item.title})})}),/*#__PURE__*/_jsx(Row,{gutter:24,children:/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Title,{level:2,children:item.price?numberToPrice(carts[item.qty],defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol):carts[item.qty]})})})]})},item.title)});})}),/*#__PURE__*/_jsxs(Row,{gutter:24,className:\"mb-2\",children:[/*#__PURE__*/_jsx(Col,{span:20,children:/*#__PURE__*/_jsx(Divider,{orientation:\"left\",children:\"Charts\"})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",children:[/*#__PURE__*/_jsx(Select,{style:{width:100},onChange:handleByTime,options:options,defaultValue:by_time}),/*#__PURE__*/_jsx(Divider,{type:\"vertical\",style:{height:'100%'}}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(LineChartOutlined,{style:{fontSize:'22px',cursor:'pointer',color:chart_type==='line'?'green':''},onClick:()=>setChartType('line')}),/*#__PURE__*/_jsx(BarChartOutlined,{style:{fontSize:'22px',cursor:'pointer',color:chart_type==='bar'?'green':''},onClick:()=>setChartType('bar')})]})]})})]}),/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Card,{title:\"Net Sales\",children:/*#__PURE__*/_jsx(ChartWidget,{type:chart_type,series:[{name:'Orders',data:carts===null||carts===void 0?void 0:(_carts$chart_price=carts.chart_price)===null||_carts$chart_price===void 0?void 0:_carts$chart_price.map(item=>item.delivered_sum)}],xAxis:carts===null||carts===void 0?void 0:(_carts$chart_price2=carts.chart_price)===null||_carts$chart_price2===void 0?void 0:_carts$chart_price2.map(item=>item.time)})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Card,{title:\"Orders\",children:/*#__PURE__*/_jsx(ChartWidget,{type:chart_type,series:[{name:'Orders',data:carts===null||carts===void 0?void 0:(_carts$chart_count=carts.chart_count)===null||_carts$chart_count===void 0?void 0:_carts$chart_count.map(item=>item.count)}],xAxis:carts===null||carts===void 0?void 0:(_carts$chart_price3=carts.chart_price)===null||_carts$chart_price3===void 0?void 0:_carts$chart_price3.map(item=>item.time)})})})]}),/*#__PURE__*/_jsx(Divider,{orientation:\"left\",children:\"Leaderboards\"}),/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Card,{title:\"Top categories\",children:/*#__PURE__*/_jsx(Table,{scroll:{x:true},onChange:onCategoryPaginationChange,pagination:{pageSize:categories===null||categories===void 0?void 0:(_categories$meta=categories.meta)===null||_categories$meta===void 0?void 0:_categories$meta.per_page,page:(categories===null||categories===void 0?void 0:(_categories$meta2=categories.meta)===null||_categories$meta2===void 0?void 0:_categories$meta2.current_page)||1,total:categories===null||categories===void 0?void 0:(_categories$meta3=categories.meta)===null||_categories$meta3===void 0?void 0:_categories$meta3.total,defaultCurrent:1},columns:columns,dataSource:categories===null||categories===void 0?void 0:categories.data})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Card,{title:\"Top products\",children:/*#__PURE__*/_jsx(Table,{scroll:{x:true},onChange:onProductPaginationChange,pagination:{pageSize:products===null||products===void 0?void 0:(_products$meta=products.meta)===null||_products$meta===void 0?void 0:_products$meta.per_page,page:(products===null||products===void 0?void 0:(_products$meta2=products.meta)===null||_products$meta2===void 0?void 0:_products$meta2.current_page)||1,total:products===null||products===void 0?void 0:(_products$meta3=products.meta)===null||_products$meta3===void 0?void 0:_products$meta3.total,defaultCurrent:1},columns:columns,dataSource:products===null||products===void 0?void 0:products.data})})})]})]});};export default ReportOverview;","map":null,"metadata":{},"sourceType":"module"}