{"ast":null,"code":"import React,{Fragment,useState}from'react';import{Form,Card,Row,Col,Input,Button,Switch}from'antd';import{useTranslation}from'react-i18next';import LanguageList from'components/language-list';import{shallowEqual,useSelector,useDispatch,batch}from'react-redux';import{useNavigate}from'react-router-dom';import TextArea from'antd/es/input/TextArea';import{DebounceSelect}from'components/search';import productService from'services/product';import MediaUpload from'components/upload';import{removeFromMenu}from'redux/slices/menu';import{toast}from'react-toastify';import{fetchLooks}from'redux/slices/looks';import shopService from'services/shop';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function LooksForm(_ref){var _activeMenu$data$imag,_activeMenu$data,_activeMenu$data$shop,_activeMenu$data2;let{form,handleSubmit}=_ref;const dispatch=useDispatch();const navigate=useNavigate();const{t}=useTranslation();const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[loadingBtn,setLoadingBtn]=useState(false);const[image,setImage]=useState((_activeMenu$data$imag=activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.image)!==null&&_activeMenu$data$imag!==void 0?_activeMenu$data$imag:[]);const[shop,setShop]=useState((_activeMenu$data$shop=activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.shop)!==null&&_activeMenu$data$shop!==void 0?_activeMenu$data$shop:{});const[isShopChanged,setIsShopChanged]=useState(false);function handleValidation(value){let item=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;const condition=!!item?!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang:!value;if(condition){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<length){return Promise.reject(new Error(t(`must.be.at.least.${length}`)));}return Promise.resolve();}const fetchShops=search=>{const paramsData={page:1,perPage:10,status:'approved',search:!!search?search:null};return shopService.getAll(paramsData).then(res=>res.data.map(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};}));};const fetchProducts=search=>{const paramsData={page:1,perPage:10,active:1,status:'published',shop_id:shop===null||shop===void 0?void 0:shop.value,search:!!search?search:null};return productService.getAll(paramsData).then(res=>res.data.map(item=>{var _item$translation2;return{label:item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};})).finally(()=>setIsShopChanged(false));};const onFinish=values=>{setLoadingBtn(true);const nextUrl='catalog/looks';handleSubmit(values,image).then(()=>{toast.success(t('successfully.added'));batch(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchLooks({}));});navigate(`/${nextUrl}`);}).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsx(Card,{title:t('add.look'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:/*#__PURE__*/_jsxs(Form,{form:form,onFinish:onFinish,layout:\"vertical\",initialValues:{active:true,...(activeMenu===null||activeMenu===void 0?void 0:activeMenu.data)},children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,hidden:item.locale!==defaultLang,rules:[{validator:(_,value)=>handleValidation(value,item)}],children:/*#__PURE__*/_jsx(Input,{})},'title'+item.id))}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:`description[${item.locale}]`,hidden:item.locale!==defaultLang,rules:[{validator:(_,value)=>handleValidation(value,item,5)}],children:/*#__PURE__*/_jsx(TextArea,{rows:3})},'description'+item.id))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('shop'),name:'shop',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{allowClear:false,fetchOptions:fetchShops,onSelect:selectedShop=>{setIsShopChanged(true);setShop(selectedShop);form.setFieldsValue({products:[]});}})},'shop')}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('products'),name:'products',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{mode:\"multiple\",fetchOptions:fetchProducts,disabled:!(shop!==null&&shop!==void 0&&shop.value),refetchOptions:isShopChanged})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{name:\"images\",label:t('image'),rules:[{validator(){if(image.length===0){return Promise.reject(new Error(t('required')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"products\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{defaultChecked:true})})})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})]})})});}","map":null,"metadata":{},"sourceType":"module"}