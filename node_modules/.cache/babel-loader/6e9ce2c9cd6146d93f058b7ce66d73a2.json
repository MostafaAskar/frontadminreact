{"ast":null,"code":"import React,{useState}from'react';import{toast}from'react-toastify';import{Button,Col,Divider,Form,Input,InputNumber,Modal,Row}from'antd';import{shallowEqual,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import sellerBookingTable from'../../../services/seller/booking-table';import sellerBookingZone from'../../../services/seller/booking-zone';import{RefetchSearch}from'components/refetch-search';import{AppstoreOutlined}from'@ant-design/icons';import BookingZoneAddModal from'./booking-zone-add-modal';import{useDispatch}from'react-redux';import{setBookingData}from'redux/slices/booking';import{fetchBookingTable}from'redux/slices/booking-tables';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const BookingTableAddModal=_ref=>{var _data$free_from;let{visible,handleCancel}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[form]=Form.useForm();const[loadingBtn,setLoadingBtn]=useState(false);const[zoneRefetch,setZoneRefetch]=useState(null);const[zone,setZone]=useState(null);const dispatch=useDispatch();const{data}=useSelector(state=>state.booking,shallowEqual);const{current_zone}=useSelector(state=>state.bookingZone,shallowEqual);const params={shop_section_id:current_zone===null||current_zone===void 0?void 0:current_zone.id,status:data.current_tab==='all'?undefined:data.current_tab,free_from:(data===null||data===void 0?void 0:(_data$free_from=data.free_from)===null||_data$free_from===void 0?void 0:_data$free_from.length)>2?JSON.parse(data===null||data===void 0?void 0:data.free_from):undefined};const onFinish=values=>{const body={...values,chair_count:String(values.chair_count),shop_section_id:values.shop_section_id.value};setLoadingBtn(true);sellerBookingTable.create(body).then(()=>{toast.success(t('successfully.created'));handleCancel();dispatch(setBookingData({reload:true}));}).finally(()=>{setLoadingBtn(false);// dispatch(setBookingData({ reload: true }));\ndispatch(fetchBookingTable(params));});};function fetchZone(){setZoneRefetch(false);return sellerBookingZone.getAll().then(res=>{return res.data.map(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id};});});}const goToAddZone=()=>{setZone(true);setZoneRefetch(true);};const handleClose=()=>setZone(false);return/*#__PURE__*/_jsxs(Modal,{title:t('add.booking.table'),visible:visible,onCancel:handleCancel,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),loading:loadingBtn,className:\"table_booking\",children:t('confirm')},'ok-button')],children:[/*#__PURE__*/_jsx(Form,{name:\"basic\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{active:true,...activeMenu.data},children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('zona'),name:'shop_section_id',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchZone,refetch:zoneRefetch,dropdownRender:menu=>/*#__PURE__*/_jsxs(_Fragment,{children:[menu,/*#__PURE__*/_jsx(Divider,{style:{margin:'8px 0'}}),/*#__PURE__*/_jsx(Button,{className:\"w-100\",size:\"small\",icon:/*#__PURE__*/_jsx(AppstoreOutlined,{}),onClick:goToAddZone,children:t('add.booking.zone')})]})})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:\"name\",name:`name`,rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('chair.count'),name:\"chair_count\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",min:0})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('tax'),name:\"tax\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",min:0,max:100})})})]})}),zone&&/*#__PURE__*/_jsx(BookingZoneAddModal,{visible:zone,handleCancel:handleClose})]});};export default BookingTableAddModal;","map":null,"metadata":{},"sourceType":"module"}