{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{Button,Table,Card,Space,Tag,Image}from'antd';import{DeleteOutlined,EditOutlined}from'@ant-design/icons';import{useDispatch,useSelector,shallowEqual}from'react-redux';import{fetchShopAds}from'redux/slices/shop-ads';import{Context}from'../../context/context';import{useTranslation}from'react-i18next';import{toast}from'react-toastify';import FilterColumns from'components/filter-column';import{addMenu,disableRefetch,setMenuData}from'redux/slices/menu';import useDidUpdate from'helpers/useDidUpdate';import DeleteButton from'../../components/delete-button';import{useNavigate}from'react-router-dom';import CustomModal from'components/modal';import ShopAdsStatusModal from'./shop-ads-status-modal';import shopAdsService from'services/shop-ads';import formatSortType from'../../helpers/formatSortType';import moment from'moment';import{IMG_URL}from'configs/app-global';import TransactionStatusModal from'./transactionStatusModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ShopAds(){const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{shopAdsList,loading:listLoading,meta}=useSelector(state=>state.shopAds,shallowEqual);const{setIsModalVisible}=useContext(Context);const[id,setId]=useState(null);const[text,setText]=useState(null);const[active,setActive]=useState(null);const[loading,setLoading]=useState(false);const[shopAdsDetails,setShopAdsDetails]=useState(null);const[singleAds,setSingleAds]=useState([]);const[loadingSingleAds,setLoadingSingleAds]=useState(false);const[expandId,setExpandId]=useState(null);const[transactionDetail,setTransactionDetail]=useState(null);const data=activeMenu.data;const paramsData={search:data===null||data===void 0?void 0:data.serach,perPage:data===null||data===void 0?void 0:data.perPage,page:data===null||data===void 0?void 0:data.page,sort:data===null||data===void 0?void 0:data.sort};useEffect(()=>{if(activeMenu.refetch){dispatch(fetchShopAds(paramsData));dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);useDidUpdate(()=>{dispatch(fetchShopAds(paramsData));},[activeMenu.data]);const onChangePagination=(pagination,filter,sorter)=>{const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,perPage,page,column,sort}}));};const shopAdsDelete=()=>{setLoading(true);const params={...Object.assign({},...id.map((item,index)=>({[`ids[${index}]`]:item})))};shopAdsService.delete(params).then(()=>{setIsModalVisible(false);toast.success(t('successfully.deleted'));dispatch(fetchShopAds(paramsData));setText(null);setActive(false);}).finally(()=>{setLoading(false);setId(null);});};const goToEdit=row=>{dispatch(addMenu({id:'shop-ads',url:`shop-ads/${row.id}`,name:t('edit.shop.ads')}));navigate(`/shop-ads/${row.id}`);};const goToTransactions=()=>{dispatch(addMenu({id:'transactions',url:`transactions`,name:t('transactions')}));navigate(`/transactions`);};const handleActive=()=>{setLoading(true);shopAdsService.setActive(id).then(()=>{setIsModalVisible(false);dispatch(fetchShopAds(paramsData));toast.success(t('successfully.updated'));setActive(false);}).finally(()=>setLoading(false));};const allDelete=()=>{if(id===null||id.length===0){toast.warning(t('select.the.product'));}else{setIsModalVisible(true);setText(false);}};const rowSelection={selectedRowKeys:id,onChange:key=>{setId(key);}};const showAds=_ref=>{let{expanded,record}=_ref;setSingleAds([]);if(expanded){setLoadingSingleAds(true);setExpandId(record===null||record===void 0?void 0:record.id);shopAdsService.getById(record===null||record===void 0?void 0:record.id).then(res=>{var _res$data;setSingleAds((_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.shop_ads_products);}).finally(()=>setLoadingSingleAds(false));}else{setExpandId(null);}};const expandedRowRender=()=>{const columns=[{title:t('id'),dataIndex:'id',is_show:true,sorter:(a,b)=>a.id-b.id},{title:t('image'),dataIndex:'img',is_show:true,render:(img,row)=>{var _row$product;return/*#__PURE__*/_jsx(Image,{width:100,height:100,src:IMG_URL+((_row$product=row.product)===null||_row$product===void 0?void 0:_row$product.img),placeholder:true,style:{borderRadius:4,objectFit:'cover'}});}},{title:t('name'),dataIndex:'name',is_show:true,render:(img,row)=>{var _row$product2,_row$product2$transla;return(_row$product2=row.product)===null||_row$product2===void 0?void 0:(_row$product2$transla=_row$product2.translation)===null||_row$product2$transla===void 0?void 0:_row$product2$transla.title;}},{title:t('active'),dataIndex:'active',is_show:true,render:(img,row)=>{var _row$product3;return(_row$product3=row.product)!==null&&_row$product3!==void 0&&_row$product3.active?t('active'):t('inactive');}},{title:t('status'),is_show:true,dataIndex:'status',key:'status',render:(status,row)=>{var _row$product4,_row$product5,_row$product6,_row$product7,_row$product8;return/*#__PURE__*/_jsx(\"div\",{children:((_row$product4=row.product)===null||_row$product4===void 0?void 0:_row$product4.status)==='pending'?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:t((_row$product5=row.product)===null||_row$product5===void 0?void 0:_row$product5.status)}):((_row$product6=row.product)===null||_row$product6===void 0?void 0:_row$product6.status)==='unpublished'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t((_row$product7=row.product)===null||_row$product7===void 0?void 0:_row$product7.status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t((_row$product8=row.product)===null||_row$product8===void 0?void 0:_row$product8.status)})});}}];return/*#__PURE__*/_jsx(Table,{columns:columns,dataSource:singleAds,pagination:false,loading:loadingSingleAds});};const[columns,setColumns]=useState([{title:t('id'),dataIndex:'id',is_show:true,sorter:(a,b)=>a.id-b.id},{title:t('shop'),dataIndex:'title',is_show:true,render:(_,row)=>{var _row$shop,_row$shop$translation;return/*#__PURE__*/_jsx(\"span\",{children:row===null||row===void 0?void 0:(_row$shop=row.shop)===null||_row$shop===void 0?void 0:(_row$shop$translation=_row$shop.translation)===null||_row$shop$translation===void 0?void 0:_row$shop$translation.title});}},{title:t('expire.at'),dataIndex:'expire_at',is_show:true,render:(_,row)=>/*#__PURE__*/_jsx(_Fragment,{children:row!==null&&row!==void 0&&row.expired_at?moment(row===null||row===void 0?void 0:row.expired_at).format('YYYY-MM-DD hh:mm'):/*#__PURE__*/_jsx(\"span\",{children:t('not.expired')})})},{title:t('status'),is_show:true,dataIndex:'status',key:'status',render:(status,row)=>/*#__PURE__*/_jsxs(\"div\",{children:[status==='new'?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:t(status)}):status==='canceled'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(status)}),/*#__PURE__*/_jsx(EditOutlined,{onClick:()=>setShopAdsDetails(row)})]})},{title:t('transaction'),dataIndex:'transaction',is_show:true,render:(transaction,row)=>{var _row$transaction;return/*#__PURE__*/_jsx(_Fragment,{children:!!transaction?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{onClick:goToTransactions,color:\"cyan\",children:row===null||row===void 0?void 0:(_row$transaction=row.transaction)===null||_row$transaction===void 0?void 0:_row$transaction.status}),\"\\xA0 \\xA0 \\xA0\",/*#__PURE__*/_jsx(EditOutlined,{onClick:()=>setTransactionDetail(row===null||row===void 0?void 0:row.transaction)})]}):/*#__PURE__*/_jsx(Button,{color:\"error\",children:t('not.paid')})});}},{title:t('options'),dataIndex:'options',is_show:true,render:(_,row)=>{return/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(DeleteButton,{icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),onClick:()=>{setIsModalVisible(true);setId([row.id]);setText(true);setActive(false);}})});}}]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Card,{className:\"p-0\",children:/*#__PURE__*/_jsxs(Space,{wrap:true,size:[14,20],children:[/*#__PURE__*/_jsx(DeleteButton,{size:\"\",onClick:allDelete,children:t('delete.selected')}),/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})]})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Table,{onExpand:(expanded,record)=>showAds({expanded,record}),expandable:{expandedRowRender,defaultExpandedRowKeys:['0'],expandedRowKeys:[expandId]},scroll:{x:true},dataSource:shopAdsList,columns:columns===null||columns===void 0?void 0:columns.filter(item=>item===null||item===void 0?void 0:item.is_show),rowSelection:rowSelection,rowKey:record=>record.id,loading:loading||listLoading,pagination:{pageSize:meta.per_page,page:meta.current_page,total:meta.total},onChange:onChangePagination})}),shopAdsDetails&&/*#__PURE__*/_jsx(ShopAdsStatusModal,{data:shopAdsDetails,handleCancel:()=>setShopAdsDetails(null),paramsData:paramsData}),/*#__PURE__*/_jsx(CustomModal,{click:active?handleActive:shopAdsDelete,text:active?t('set.active.advert'):text?t('delete'):t('all.delete'),setText:setId,setActive:setActive}),transactionDetail&&/*#__PURE__*/_jsx(TransactionStatusModal,{data:transactionDetail,handleCancel:()=>setTransactionDetail(false),paramsData:paramsData})]});}","map":null,"metadata":{},"sourceType":"module"}