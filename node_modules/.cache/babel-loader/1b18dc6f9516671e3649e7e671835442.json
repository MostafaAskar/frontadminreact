{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Card,Col,Collapse,Form,InputNumber,Row,Space}from'antd';import{useTranslation}from'react-i18next';import{useSelector,shallowEqual}from'react-redux';import{DeleteOutlined,PlusOutlined}from'@ant-design/icons';import{GetColorName}from'hex-color-to-color-name';import productService from'services/product';import{useParams}from'react-router-dom';import RiveResult from'components/rive-result';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const{Panel}=Collapse;const panelHeaderHTML=stock=>{var _stock$extras,_stock$extras2;return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{hidden:!(stock!==null&&stock!==void 0&&(_stock$extras=stock.extras)!==null&&_stock$extras!==void 0&&_stock$extras.length),children:stock===null||stock===void 0?void 0:(_stock$extras2=stock.extras)===null||_stock$extras2===void 0?void 0:_stock$extras2.map(extra=>{var _extra$group,_extra$group2,_extra$group2$transla,_extra$value,_extra$value2,_extra$group3,_extra$group3$transla,_extra$value3;return(extra===null||extra===void 0?void 0:(_extra$group=extra.group)===null||_extra$group===void 0?void 0:_extra$group.type)==='color'?/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',columnGap:'5px'},children:[(_extra$group2=extra.group)===null||_extra$group2===void 0?void 0:(_extra$group2$transla=_extra$group2.translation)===null||_extra$group2$transla===void 0?void 0:_extra$group2$transla.title,\":\",' ',GetColorName(extra===null||extra===void 0?void 0:(_extra$value=extra.value)===null||_extra$value===void 0?void 0:_extra$value.value),\" (\",/*#__PURE__*/_jsx(\"span\",{style:{display:'block',width:'15px',height:'15px',backgroundColor:`${extra===null||extra===void 0?void 0:(_extra$value2=extra.value)===null||_extra$value2===void 0?void 0:_extra$value2.value}`,borderRadius:'50%',border:'1px solid #ccc'}}),\")\"]},extra===null||extra===void 0?void 0:extra.id):/*#__PURE__*/_jsxs(\"div\",{children:[(_extra$group3=extra.group)===null||_extra$group3===void 0?void 0:(_extra$group3$transla=_extra$group3.translation)===null||_extra$group3$transla===void 0?void 0:_extra$group3$transla.title,\": \",(_extra$value3=extra.value)===null||_extra$value3===void 0?void 0:_extra$value3.value]},extra===null||extra===void 0?void 0:extra.id);})})});};function Wholesale(_ref){var _activeMenu$data,_activeMenu$data$stoc,_activeMenu$data2,_activeMenu$data3,_activeMenu$data4,_activeMenu$data5,_activeMenu$data6;let{prev,next}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const{uuid}=useParams();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const hasAnyExtras=activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:(_activeMenu$data$stoc=_activeMenu$data.stocksData)===null||_activeMenu$data$stoc===void 0?void 0:_activeMenu$data$stoc.some(stock=>{var _stock$extras3;return!!(stock!==null&&stock!==void 0&&(_stock$extras3=stock.extras)!==null&&_stock$extras3!==void 0&&_stock$extras3.length);});const stocks=((_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.stocksData)||[];const minQuantity=!!((_activeMenu$data3=activeMenu.data)!==null&&_activeMenu$data3!==void 0&&_activeMenu$data3.min_qty)?(_activeMenu$data4=activeMenu.data)===null||_activeMenu$data4===void 0?void 0:_activeMenu$data4.min_qty:1;const maxQuantity=!!((_activeMenu$data5=activeMenu.data)!==null&&_activeMenu$data5!==void 0&&_activeMenu$data5.max_qty)?(_activeMenu$data6=activeMenu.data)===null||_activeMenu$data6===void 0?void 0:_activeMenu$data6.max_qty:1;const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);const fetchProduct=()=>{setLoading(true);productService.getById(uuid).then(res=>{var _res$data,_res$data$stocks;const extras=res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$stocks=_res$data.stocks)===null||_res$data$stocks===void 0?void 0:_res$data$stocks.map(item=>({[item===null||item===void 0?void 0:item.id]:item===null||item===void 0?void 0:item.whole_sale_prices}));form.setFieldsValue(Object.assign({},...extras));}).finally(()=>setLoading(false));};useEffect(()=>{fetchProduct();},[]);const onFinish=values=>{if(!hasAnyExtras)return next();setLoadingBtn(true);const extras=stocks===null||stocks===void 0?void 0:stocks.map(stock=>{var _stock$extras4;const whole_sales=(values===null||values===void 0?void 0:values[stock===null||stock===void 0?void 0:stock.id])||[];return{ids:stock===null||stock===void 0?void 0:(_stock$extras4=stock.extras)===null||_stock$extras4===void 0?void 0:_stock$extras4.map(extra=>extra===null||extra===void 0?void 0:extra.extra_value_id),galleries:stock===null||stock===void 0?void 0:stock.galleries,price:stock===null||stock===void 0?void 0:stock.price,quantity:stock===null||stock===void 0?void 0:stock.quantity,stock_id:stock===null||stock===void 0?void 0:stock.id,whole_sales};});productService.stocks(uuid,{extras}).then(()=>next()).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsx(Card,{loading:loading,children:/*#__PURE__*/_jsxs(Form,{form:form,layout:\"vertical\",onFinish:onFinish,children:[hasAnyExtras?/*#__PURE__*/_jsx(Collapse,{children:stocks.map(stock=>{const formListName=stock===null||stock===void 0?void 0:stock.id;return/*#__PURE__*/_jsx(Panel,{header:panelHeaderHTML(stock),children:/*#__PURE__*/_jsx(Form.List,{name:formListName,children:(fields,_ref2)=>{let{add,remove}=_ref2;return/*#__PURE__*/_jsxs(_Fragment,{children:[fields.map((_ref3,index)=>{var _fields,_activeMenu$data7,_activeMenu$data8;let{key,name,...restField}=_ref3;const prevMaxQuantity=form.getFieldValue([formListName,(_fields=fields[index-1])===null||_fields===void 0?void 0:_fields.name,'max_quantity']);return/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:7,children:/*#__PURE__*/_jsx(Form.Item,{...restField,label:t('min.quantity'),name:[name,'min_quantity'],rules:[{required:true,message:t('required')},{validator(_,value){if(!!value&&(value<=prevMaxQuantity||value>maxQuantity||value<=0)){return Promise.reject(new Error(`${t('must.be.between')} ${prevMaxQuantity||minQuantity} ${t('and')} ${maxQuantity}`));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",step:((_activeMenu$data7=activeMenu.data)===null||_activeMenu$data7===void 0?void 0:_activeMenu$data7.interval)||1// min={minQuantity}\n})})}),/*#__PURE__*/_jsx(Col,{span:7,children:/*#__PURE__*/_jsx(Form.Item,{...restField,label:t('max.quantity'),name:[name,'max_quantity'],rules:[{required:true,message:t('required')},{validator(_,value){const minQuantityInput=form.getFieldValue([formListName,name,'min_quantity']);if(!!value&&(value<=minQuantityInput||value>maxQuantity||value<=0)){return Promise.reject(new Error(`${t('must.be.between')} ${minQuantityInput||minQuantity} ${t('and')} ${maxQuantity}`));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",step:((_activeMenu$data8=activeMenu.data)===null||_activeMenu$data8===void 0?void 0:_activeMenu$data8.interval)||1})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Form.Item,{...restField,label:t('price'),name:[name,'price'],rules:[{required:true,message:t('required')},{type:'number',min:0,message:t('must.be.positive.number')},{type:'number',max:999999999999999,message:t('max.15.digits')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",parser:value=>parseInt(value,10)})})}),/*#__PURE__*/_jsx(Col,{span:2,style:{display:'flex',alignItems:'center',justifyContent:'end'},children:/*#__PURE__*/_jsx(Button,{onClick:()=>{remove(name);},danger:true,type:\"primary\",icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),disabled:(fields===null||fields===void 0?void 0:fields.length)!==index+1})})]},index);}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{onClick:()=>{add();},type:\"dashed\",icon:/*#__PURE__*/_jsx(PlusOutlined,{}),block:true,children:t('add')})})]});}},stock===null||stock===void 0?void 0:stock.id)},stock===null||stock===void 0?void 0:stock.id);})}):/*#__PURE__*/_jsx(RiveResult,{}),/*#__PURE__*/_jsxs(Space,{className:\"mt-4\",children:[/*#__PURE__*/_jsx(Button,{onClick:prev,children:t('prev')}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('next')})]})]})});}export default Wholesale;","map":null,"metadata":{},"sourceType":"module"}