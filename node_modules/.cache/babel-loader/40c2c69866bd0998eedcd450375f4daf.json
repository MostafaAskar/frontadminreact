{"ast":null,"code":"var _jsxFileName = \"/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/coupons/coupon-edit.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { Form, Card } from 'antd';\nimport LanguageList from 'components/language-list';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport couponService from 'services/coupon';\nimport moment from 'moment';\nimport { batch, shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { disableRefetch, removeFromMenu, setMenuData } from 'redux/slices/menu';\nimport { useTranslation } from 'react-i18next';\nimport { fetchCoupon } from 'redux/slices/coupon';\nimport CouponForm from './coupon-form';\nimport { toast } from 'react-toastify';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst CouponEdit = () => {\n  _s();\n\n  const {\n    t\n  } = useTranslation();\n  const [form] = Form.useForm();\n  const [loading, setLoading] = useState(false);\n  const {\n    languages\n  } = useSelector(state => state.formLang, shallowEqual);\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const {\n    id\n  } = useParams();\n  const {\n    activeMenu\n  } = useSelector(state => state.menu, shallowEqual);\n\n  function getLanguageFields(data) {\n    if (!(data !== null && data !== void 0 && data.translations)) {\n      return {};\n    }\n\n    const {\n      translations\n    } = data;\n    const result = languages.map(item => {\n      var _translations$find;\n\n      return {\n        [`title[${item.locale}]`]: (_translations$find = translations.find(el => el.locale === item.locale)) === null || _translations$find === void 0 ? void 0 : _translations$find.title\n      };\n    });\n    return Object.assign({}, ...result);\n  }\n\n  function getCoupon(id) {\n    setLoading(true);\n    couponService.getById(id).then(_ref => {\n      var _data$shop, _data$shop$translatio, _data$shop2, _data$shop3;\n\n      let {\n        data\n      } = _ref;\n      const body = { ...data,\n        shop_id: {\n          label: data === null || data === void 0 ? void 0 : (_data$shop = data.shop) === null || _data$shop === void 0 ? void 0 : (_data$shop$translatio = _data$shop.translation) === null || _data$shop$translatio === void 0 ? void 0 : _data$shop$translatio.title,\n          value: data === null || data === void 0 ? void 0 : (_data$shop2 = data.shop) === null || _data$shop2 === void 0 ? void 0 : _data$shop2.id,\n          key: data === null || data === void 0 ? void 0 : (_data$shop3 = data.shop) === null || _data$shop3 === void 0 ? void 0 : _data$shop3.id\n        },\n        ...getLanguageFields(data),\n        expired_at: moment(data.expired_at, 'YYYY-MM-DD')\n      };\n      form.setFieldsValue({ ...body\n      });\n      dispatch(setMenuData({\n        activeMenu,\n        data: { ...body,\n          expired_at: JSON.stringify(body === null || body === void 0 ? void 0 : body.expired_at)\n        }\n      }));\n    }).finally(() => {\n      setLoading(false);\n      dispatch(disableRefetch(activeMenu));\n    });\n  }\n\n  const onFinish = values => {\n    const params = { ...values,\n      expired_at: moment(values.expired_at).format('YYYY-MM-DD'),\n      qty: Number(values.qty),\n      price: Number(values.price)\n    };\n    const nextUrl = 'coupons';\n    couponService.update(id, params).then(() => {\n      toast.success(t('toast.updated'));\n      batch(() => {\n        dispatch(removeFromMenu({ ...activeMenu,\n          nextUrl\n        }));\n        dispatch(fetchCoupon({}));\n      });\n      navigate(`/${nextUrl}`);\n    });\n  };\n\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      getCoupon(id);\n    }\n  }, [activeMenu.refetch]);\n  return /*#__PURE__*/_jsxDEV(Card, {\n    title: t('edit.coupon'),\n    extra: /*#__PURE__*/_jsxDEV(LanguageList, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 43\n    }, this),\n    loading: loading,\n    children: /*#__PURE__*/_jsxDEV(CouponForm, {\n      form: form,\n      handleSubmit: onFinish\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n};\n\n_s(CouponEdit, \"I6ye7AsLokDzwxgHuKy6vMaXIiQ=\", false, function () {\n  return [useTranslation, Form.useForm, useSelector, useDispatch, useNavigate, useParams, useSelector];\n});\n\n_c = CouponEdit;\nexport default CouponEdit;\n\nvar _c;\n\n$RefreshReg$(_c, \"CouponEdit\");","map":{"version":3,"names":["React","useEffect","useState","Form","Card","LanguageList","useNavigate","useParams","couponService","moment","batch","shallowEqual","useDispatch","useSelector","disableRefetch","removeFromMenu","setMenuData","useTranslation","fetchCoupon","CouponForm","toast","CouponEdit","t","form","useForm","loading","setLoading","languages","state","formLang","dispatch","navigate","id","activeMenu","menu","getLanguageFields","data","translations","result","map","item","locale","find","el","title","Object","assign","getCoupon","getById","then","body","shop_id","label","shop","translation","value","key","expired_at","setFieldsValue","JSON","stringify","finally","onFinish","values","params","format","qty","Number","price","nextUrl","update","success","refetch"],"sources":["/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/coupons/coupon-edit.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Form, Card } from 'antd';\nimport LanguageList from 'components/language-list';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport couponService from 'services/coupon';\nimport moment from 'moment';\nimport { batch, shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { disableRefetch, removeFromMenu, setMenuData } from 'redux/slices/menu';\nimport { useTranslation } from 'react-i18next';\nimport { fetchCoupon } from 'redux/slices/coupon';\nimport CouponForm from './coupon-form';\nimport { toast } from 'react-toastify';\n\nconst CouponEdit = () => {\n  const { t } = useTranslation();\n  const [form] = Form.useForm();\n  const [loading, setLoading] = useState(false);\n  const { languages } = useSelector((state) => state.formLang, shallowEqual);\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const { id } = useParams();\n  const { activeMenu } = useSelector((state) => state.menu, shallowEqual);\n\n  function getLanguageFields(data) {\n    if (!data?.translations) {\n      return {};\n    }\n    const { translations } = data;\n    const result = languages.map((item) => ({\n      [`title[${item.locale}]`]: translations.find(\n        (el) => el.locale === item.locale,\n      )?.title,\n    }));\n    return Object.assign({}, ...result);\n  }\n\n  function getCoupon(id) {\n    setLoading(true);\n    couponService\n      .getById(id)\n      .then(({ data }) => {\n        const body = {\n          ...data,\n          shop_id: {\n            label: data?.shop?.translation?.title,\n            value: data?.shop?.id,\n            key: data?.shop?.id,\n          },\n          ...getLanguageFields(data),\n          expired_at: moment(data.expired_at, 'YYYY-MM-DD'),\n        };\n\n        form.setFieldsValue({\n          ...body,\n        });\n\n        dispatch(\n          setMenuData({\n            activeMenu,\n            data: { ...body, expired_at: JSON.stringify(body?.expired_at) },\n          }),\n        );\n      })\n      .finally(() => {\n        setLoading(false);\n        dispatch(disableRefetch(activeMenu));\n      });\n  }\n\n  const onFinish = (values) => {\n    const params = {\n      ...values,\n      expired_at: moment(values.expired_at).format('YYYY-MM-DD'),\n      qty: Number(values.qty),\n      price: Number(values.price),\n    };\n    const nextUrl = 'coupons';\n\n    couponService.update(id, params).then(() => {\n      toast.success(t('toast.updated'));\n      batch(() => {\n        dispatch(removeFromMenu({ ...activeMenu, nextUrl }));\n        dispatch(fetchCoupon({}));\n      });\n      navigate(`/${nextUrl}`);\n    });\n  };\n\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      getCoupon(id);\n    }\n  }, [activeMenu.refetch]);\n\n  return (\n    <Card title={t('edit.coupon')} extra={<LanguageList />} loading={loading}>\n      <CouponForm form={form} handleSubmit={onFinish} />\n    </Card>\n  );\n};\n\nexport default CouponEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}