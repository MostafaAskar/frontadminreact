{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useParams}from'react-router-dom';import{toast}from'react-toastify';import{Button,Card,Col,DatePicker,Form,Input,Row,Select}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'../../redux/slices/menu';import{useTranslation}from'react-i18next';import TextEditor from'./textEditor';import moment from'moment';import messageSubscriberService from'../../services/messageSubscriber';import Loading from'../../components/loading';import{fetchMessageSubscriber}from'../../redux/slices/messegeSubscriber';import emailService from'../../services/emailSettings';import{DebounceSelect}from'../../components/search';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const options=[{title:'order',value:'order'},{title:'subscribe',value:'subscribe'},{title:'verify',value:'verify'}];const MessageSubciribedAdd=()=>{const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const navigate=useNavigate();const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);const{id}=useParams();const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);useEffect(()=>{return()=>{const values=form.getFieldsValue(true);const send_to=JSON.stringify(values.send_to);const data={...values,send_to};dispatch(setMenuData({activeMenu,data}));};},[]);const fetchSubscriber=id=>{setLoading(true);messageSubscriberService.getById(id).then(res=>{const data={...res.data,send_to:moment(res.data.send_to,'YYYY-MM-DD HH:mm:ss'),has_date:true,email_setting_id:{label:res.data.email_setting.host,value:res.data.email_setting.id}};form.setFieldsValue(data);}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const onFinish=values=>{console.log('data',values);const body={...values,send_to:moment(values.send_to).format('YYYY-MM-DD HH:mm:ss'),email_setting_id:values.email_setting_id.value};setLoadingBtn(true);const nextUrl='message/subscriber';messageSubscriberService.update(id,body).then(()=>{toast.success(t('successfully.created'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchMessageSubscriber());}).finally(()=>setLoadingBtn(false));};useEffect(()=>{if(activeMenu.refetch){fetchSubscriber(id);}},[activeMenu.refetch]);const getInitialValues=()=>{const data=activeMenu.data;if(!(data!==null&&data!==void 0&&data.send_to)){return data;}const start=data.send_to;return{...data,send_to:moment(start,'YYYY-MM-DD')};};const fetchEmailProvider=()=>{return emailService.get().then(_ref=>{let{data}=_ref;return data.map(item=>({label:item.host,value:item.id}));});};return/*#__PURE__*/_jsx(_Fragment,{children:!loading?/*#__PURE__*/_jsx(Card,{title:t('edit.subscriber'),className:\"h-100\",children:/*#__PURE__*/_jsxs(Form,{name:\"subscriber-add\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{...activeMenu.data,...getInitialValues()},className:\"d-flex flex-column h-100\",children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('subject'),name:\"subject\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('type'),name:\"type\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{disabled:true,options:options,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('email.setting.id'),name:\"email_setting_id\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchEmailProvider,className:\"w-100\",placeholder:t('email.setting.id')})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(TextEditor,{languages:languages,form:form,lang:defaultLang})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('alt.body'),name:\"alt_body\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:t('send.to'),name:\"send_to\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{showTime:true,className:\"w-100\",disabledDate:current=>moment().add(-1,'days')>=current})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex flex-column justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('send')})})})]})}):/*#__PURE__*/_jsx(Loading,{})});};export default MessageSubciribedAdd;","map":null,"metadata":{},"sourceType":"module"}