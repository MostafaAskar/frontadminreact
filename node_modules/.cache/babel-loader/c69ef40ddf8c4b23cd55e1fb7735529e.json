{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Card,Col,Form,Input,Row,Select}from'antd';import{isArray}from'lodash';import userService from'services/user';import{DebounceSelect}from'components/search';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{setOrderCurrency,setOrderData}from'redux/slices/order';import{useTranslation}from'react-i18next';import{PlusCircleOutlined}from'@ant-design/icons';import{addMenu}from'redux/slices/menu';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{AsyncSelect}from'components/async-select';import restPaymentService from'services/rest/payment';import UserAddress from'./user-address';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const UserInfo=_ref=>{var _activeMenu$data,_activeMenu$data$addr;let{form}=_ref;const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{data}=useSelector(state=>state.order,shallowEqual);const{currencies}=useSelector(state=>state.currency,shallowEqual);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[addressModal,setAddressModal]=useState(null);const[users,setUsers]=useState([]);const[refetchPayment,setRefetchPayment]=useState(false);const{payment_type}=useSelector(state=>state.globalSettings.settings,shallowEqual);useEffect(()=>{setRefetchPayment(true);},[data.shop]);async function getUsers(search){const params={search,perPage:10};return userService.search(params).then(_ref2=>{let{data}=_ref2;setUsers(data);return formatUser(data);});}async function fetchPaymentList(){return restPaymentService.getAll().then(_ref3=>{let{data}=_ref3;return data.filter(el=>el.tag==='cash'||el.tag==='wallet').map(item=>({label:item.tag||'no name',value:item.id,key:item.id}));});}async function fetchSellerPaymentList(){return restPaymentService.getById(data.shop.value).then(_ref4=>{let{data}=_ref4;return data.filter(el=>el.tag==='cash'||el.tag==='wallet').map(item=>({label:item.payment.tag||'no name',value:item.payment.id,key:item.payment.id}));});}function formatUser(data){if(!data)return;if(isArray(data)){return data.map(item=>({label:`${item.firstname} ${item.lastname||''}`,value:item.id,key:item.id}));}else{return{label:`${data.firstname} ${data.lastname||''}`,value:data.id,key:data.id};}}function selectUser(userObj){const user=users.find(item=>item.id===userObj.value);dispatch(setOrderData({user:userObj,userUuid:user.uuid,userOBJ:user}));form.setFieldsValue({address:null});}function selectCurrency(item){const currency=currencies.find(el=>el.id===item);dispatch(setOrderCurrency(currency));}const goToAddClient=()=>{dispatch(addMenu({url:`user/add`,id:'user_add',name:t('add.user')}));navigate(`/user/add`);};const goToAddClientAddress=()=>{if(!data.userUuid){toast.warning(t('please.select.client'));return;}setAddressModal(data.userUuid);};return/*#__PURE__*/_jsxs(Card,{title:t('customer.details'),children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:16,children:/*#__PURE__*/_jsx(Form.Item,{label:t('client'),name:\"user\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{placeholder:t('select.client'),fetchOptions:getUsers,onSelect:selectUser})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Form.Item,{label:t('add'),className:\"label-hidden\",children:/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),onClick:goToAddClient,children:t('add')})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('address'),name:\"address\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(\"div\",{className:\"address w-100\",onClick:goToAddClientAddress,children:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:(_activeMenu$data$addr=_activeMenu$data.addressData)===null||_activeMenu$data$addr===void 0?void 0:_activeMenu$data$addr.address})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('currency'),name:\"currency_id\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{placeholder:t('select.currency'),onSelect:selectCurrency,children:currencies.map((item,index)=>/*#__PURE__*/_jsxs(Select.Option,{value:item.id,children:[item.title,\" (\",item.symbol,\")\"]},index))})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('payment.type'),name:\"payment_type\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(AsyncSelect,{refetch:refetchPayment,fetchOptions:payment_type==='admin'?fetchPaymentList:fetchSellerPaymentList,className:\"w-100\",placeholder:t('select.payment.type'),onSelect:paymentType=>dispatch(setOrderData({paymentType})),disabled:true})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('note'),name:\"note\",children:/*#__PURE__*/_jsx(Input,{})})})]}),addressModal&&/*#__PURE__*/_jsx(UserAddress,{uuid:addressModal,handleCancel:()=>setAddressModal(null)})]});};export default UserInfo;","map":null,"metadata":{},"sourceType":"module"}