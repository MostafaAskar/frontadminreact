{"ast":null,"code":"import React,{useEffect,useState,useRef}from'react';import{Card,Table,Image,Tag,Button,Space,Row,Col,Spin}from'antd';import{useParams}from'react-router-dom';import orderService from'../../../services/waiter/order';import getImage from'../../../helpers/getImage';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,setMenuData}from'../../../redux/slices/menu';import OrderStatusModal from'./orderStatusModal';import OrderDeliveryman from'./orderDeliveryman';import{useTranslation}from'react-i18next';import numberToPrice from'../../../helpers/numberToPrice';import ShowLocationsMap from'./show-locations.map';import{BsCalendarDay}from'react-icons/bs';import{FiShoppingCart}from'react-icons/fi';import moment from'moment';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function WaiterOrderDetails(){var _activeMenu$data,_data$table,_data$table2,_activeMenu$data2,_data$delivery_price;const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const{statusList}=useSelector(state=>state.orderStatus,shallowEqual);const data=activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.data;const{t}=useTranslation();const{id}=useParams();const dispatch=useDispatch();const totalPriceRef=useRef();const productListRef=useRef();const[totalPrice,setTotalPrice]=useState(null);const[loading,setLoading]=useState(false);const[orderDetails,setOrderDetails]=useState(null);const[orderDeliveryDetails,setOrderDeliveryDetails]=useState(null);const[locationsMap,setLocationsMap]=useState(null);const expandedRowRender=record=>{const columns=[{title:t('id'),dataIndex:'id',key:'id',render:(_,row)=>{var _row$stock;return(_row$stock=row.stock)===null||_row$stock===void 0?void 0:_row$stock.id;}},{title:t('product.name'),dataIndex:'product',key:'product',render:(_,row)=>{var _row$stock2,_row$stock2$product,_row$stock2$product$t,_row$stock3,_row$stock3$extras;return/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",className:\"relative\",children:[(_row$stock2=row.stock)===null||_row$stock2===void 0?void 0:(_row$stock2$product=_row$stock2.product)===null||_row$stock2$product===void 0?void 0:(_row$stock2$product$t=_row$stock2$product.translation)===null||_row$stock2$product$t===void 0?void 0:_row$stock2$product$t.title,(_row$stock3=row.stock)===null||_row$stock3===void 0?void 0:(_row$stock3$extras=_row$stock3.extras)===null||_row$stock3$extras===void 0?void 0:_row$stock3$extras.map(extra=>{var _extra$group,_extra$group$translat,_extra$value;return/*#__PURE__*/_jsxs(Tag,{children:[(_extra$group=extra.group)===null||_extra$group===void 0?void 0:(_extra$group$translat=_extra$group.translation)===null||_extra$group$translat===void 0?void 0:_extra$group$translat.title,\": \",(_extra$value=extra.value)===null||_extra$value===void 0?void 0:_extra$value.value]},extra===null||extra===void 0?void 0:extra.id);})]});}},{title:t('image'),dataIndex:'img',key:'img',render:(_,row)=>{var _row$stock4,_row$stock4$product;return/*#__PURE__*/_jsx(Image,{src:getImage((_row$stock4=row.stock)===null||_row$stock4===void 0?void 0:(_row$stock4$product=_row$stock4.product)===null||_row$stock4$product===void 0?void 0:_row$stock4$product.img),alt:\"product\",width:100,height:\"auto\",className:\"rounded\",preview:true,placeholder:true});}},{title:t('price'),dataIndex:'origin_price',key:'origin_price',render:origin_price=>numberToPrice(origin_price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)},{title:t('quantity'),dataIndex:'quantity',key:'quantity',render:text=>/*#__PURE__*/_jsx(\"span\",{children:text})},{title:t('discount'),dataIndex:'discount',key:'discount',render:function(){let discount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return numberToPrice(discount,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol);}},{title:t('tax'),dataIndex:'tax',key:'tax',render:tax=>numberToPrice(tax,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)},{title:t('total.price'),dataIndex:'total_price',key:'total_price',render:(total_price,row)=>{return numberToPrice(total_price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol);}}];const data=(record===null||record===void 0?void 0:record.products)||[];return/*#__PURE__*/_jsx(Table,{columns:columns,dataSource:data,pagination:false});};const columns=[{title:t('id'),dataIndex:'id',key:'id',render:(_,row)=>{var _row$shop;return row===null||row===void 0?void 0:(_row$shop=row.shop)===null||_row$shop===void 0?void 0:_row$shop.id;}},{title:t('shop.name'),dataIndex:'shop.name',key:'shop.name',render:(_,row)=>{var _row$shop$translation;return/*#__PURE__*/_jsx(Space,{direction:\"vertical\",className:\"relative\",children:row===null||row===void 0?void 0:(_row$shop$translation=row.shop.translation)===null||_row$shop$translation===void 0?void 0:_row$shop$translation.title});}},{title:t('image'),dataIndex:'shop.img',key:'shop.img',render:(_,row)=>{var _row$shop2;return/*#__PURE__*/_jsx(Image,{src:getImage(row===null||row===void 0?void 0:(_row$shop2=row.shop)===null||_row$shop2===void 0?void 0:_row$shop2.logo_img),alt:\"product\",width:100,height:\"auto\",className:\"rounded\",preview:true,placeholder:true});}},{title:t('Phone'),dataIndex:'origin_price',key:'shop.phone',render:(_,row)=>{var _row$shop3,_row$shop4;return/*#__PURE__*/_jsx(\"a\",{href:`tel:${row===null||row===void 0?void 0:(_row$shop3=row.shop)===null||_row$shop3===void 0?void 0:_row$shop3.phone}`,children:row===null||row===void 0?void 0:(_row$shop4=row.shop)===null||_row$shop4===void 0?void 0:_row$shop4.phone});}},{title:t('tax'),dataIndex:'tax',key:'tax',render:(_,row)=>{var _row$shop5;return row===null||row===void 0?void 0:(_row$shop5=row.shop)===null||_row$shop5===void 0?void 0:_row$shop5.tax;}},{title:t('total.price'),dataIndex:'total_price',key:'total_price',render:total_price=>{return numberToPrice(total_price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol);}}];const handleCloseModal=()=>{setOrderDetails(null);setOrderDeliveryDetails(null);setLocationsMap(null);};function fetchOrder(){setLoading(true);orderService.getById(id).then(_ref=>{let{data}=_ref;const currency=data.currency;const user=data.user;const id=data.id;const price=data.price;const createdAt=data.created_at;const details=data.details.map(item=>{var _item$shop,_item$shop$translatio;return{...item,title:(_item$shop=item.shop)===null||_item$shop===void 0?void 0:(_item$shop$translatio=_item$shop.translation)===null||_item$shop$translatio===void 0?void 0:_item$shop$translatio.title};});dispatch(setMenuData({activeMenu,data:{details,currency,user,id,createdAt,price,data}}));}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});}useEffect(()=>{if(activeMenu.refetch){fetchOrder();}},[activeMenu.refetch]);return/*#__PURE__*/_jsxs(\"div\",{className:\"order_details\",children:[/*#__PURE__*/_jsx(Card,{className:\"order-details-info\",title:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FiShoppingCart,{className:\"mr-2 icon\"}),`${t('order')} ${data!==null&&data!==void 0&&data.id?`#${data===null||data===void 0?void 0:data.id} `:''}`,' ',t('from.order'),\" \",data===null||data===void 0?void 0:(_data$table=data.table)===null||_data$table===void 0?void 0:_data$table.name]}),extra:(data===null||data===void 0?void 0:data.status)!=='delivered'&&(data===null||data===void 0?void 0:data.status)!=='canceled'&&(data===null||data===void 0?void 0:data.status)!=='accepted'&&(data===null||data===void 0?void 0:data.status)!=='cooking'?/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>setOrderDetails(data),children:t('change.status')}):null}),/*#__PURE__*/_jsx(Spin,{spinning:loading,children:/*#__PURE__*/_jsx(Card,{style:{minHeight:'200px'},children:/*#__PURE__*/_jsxs(Row,{hidden:loading,className:\"mb-3 order_detail\",children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(\"div\",{children:[t('created.date.&.time'),\":\",/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2\",children:[/*#__PURE__*/_jsx(BsCalendarDay,{className:\"mr-1\"}),' ',moment(data===null||data===void 0?void 0:data.created_at).format('YYYY-MM-DD HH:mm'),' ']})]})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(\"div\",{children:[t('status'),\":\",/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:(data===null||data===void 0?void 0:data.status)==='new'?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:t(data===null||data===void 0?void 0:data.status)}):(data===null||data===void 0?void 0:data.status)==='canceled'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(data===null||data===void 0?void 0:data.status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(data===null||data===void 0?void 0:data.status)})})]})}),' ',/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(\"div\",{children:[t('table'),\":\",/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:(data===null||data===void 0?void 0:(_data$table2=data.table)===null||_data$table2===void 0?void 0:_data$table2.name)||t('unspecified')})]})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(\"div\",{children:[t('delivery_type'),\":\",/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:(data===null||data===void 0?void 0:data.delivery_type)||t('unspecified')})]})})]})})}),/*#__PURE__*/_jsxs(Card,{className:\"w-100 order-table\",children:[/*#__PURE__*/_jsx(Table,{ref:productListRef,scroll:{x:true},columns:columns,dataSource:((_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.details)||[],loading:loading,rowKey:record=>record.id,pagination:false,expandable:{expandedRowRender,defaultExpandedRowKeys:['0']}}),/*#__PURE__*/_jsxs(Space,{size:100,className:\"d-flex justify-content-end w-100 order-table__summary\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"span\",{children:[t('delivery.fee'),\":\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{children:[t('order.tax'),\":\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{children:[t('product'),\":\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{children:[t('discount'),\":\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"h3\",{children:[t('total.price'),\":\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:numberToPrice((_data$delivery_price=data===null||data===void 0?void 0:data.delivery_price)!==null&&_data$delivery_price!==void 0?_data$delivery_price:0,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{children:numberToPrice(data===null||data===void 0?void 0:data.total_tax,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{children:numberToPrice(data===null||data===void 0?void 0:data.origin_price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{children:numberToPrice(data===null||data===void 0?void 0:data.total_discount,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h3\",{ref:totalPriceRef,children:numberToPrice(data===null||data===void 0?void 0:data.total_price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)})]})]})]}),orderDetails&&/*#__PURE__*/_jsx(OrderStatusModal,{orderDetails:orderDetails,handleCancel:handleCloseModal,status:statusList}),orderDeliveryDetails&&/*#__PURE__*/_jsx(OrderDeliveryman,{orderDetails:orderDeliveryDetails,handleCancel:handleCloseModal}),locationsMap&&/*#__PURE__*/_jsx(ShowLocationsMap,{id:locationsMap,handleCancel:handleCloseModal})]});}","map":null,"metadata":{},"sourceType":"module"}