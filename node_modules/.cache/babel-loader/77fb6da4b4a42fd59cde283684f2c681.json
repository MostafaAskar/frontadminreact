{"ast":null,"code":"import{Button,Form,Input,Modal}from'antd';import React,{useEffect,useState}from'react';import{SketchPicker}from'react-color';import{useTranslation}from'react-i18next';import{useDispatch}from'react-redux';import{toast}from'react-toastify';import ImageUploadSingle from'components/image-upload-single';import createImage from'helpers/createImage';import{fetchPropertyValues}from'redux/slices/propertyValue';import propertyService from'services/property';import{DebounceSelect}from'components/search';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function PropertyValueModal(_ref){let{modal,handleCancel,onSuccess,groupId}=_ref;const[form]=Form.useForm();const{t}=useTranslation();const dispatch=useDispatch();const[loadingBtn,setLoadingBtn]=useState(false);const[type,setType]=useState('text');const[image,setImage]=useState(null);const[color,setColor]=useState('');useEffect(()=>{if(modal!==null&&modal!==void 0&&modal.id){var _modal$group,_modal$group$translat,_modal$group2;setType(modal.group.type);const body={...modal,property_group_id:{label:modal===null||modal===void 0?void 0:(_modal$group=modal.group)===null||_modal$group===void 0?void 0:(_modal$group$translat=_modal$group.translation)===null||_modal$group$translat===void 0?void 0:_modal$group$translat.title,value:modal===null||modal===void 0?void 0:(_modal$group2=modal.group)===null||_modal$group2===void 0?void 0:_modal$group2.id},value:modal.value};switch(modal.group.type){case'color':setColor(modal.value);break;case'image':setImage(createImage(modal.value));break;default:break;}form.setFieldsValue(body);}if(groupId){form.setFieldsValue({property_group_id:{value:groupId}});}},[modal,groupId]);const updateExtra=(id,body)=>{setLoadingBtn(true);propertyService.updateValue(id,body).then(()=>{toast.success(t('successfully.updated'));handleCancel();dispatch(fetchPropertyValues());}).finally(()=>setLoadingBtn(false));};const createExtra=body=>{setLoadingBtn(true);propertyService.createValue(body).then(()=>{toast.success(t('successfully.created'));handleCancel();dispatch(fetchPropertyValues());!!onSuccess&&onSuccess();}).finally(()=>setLoadingBtn(false));};const onFinish=values=>{var _values$property_grou;const body={property_group_id:values===null||values===void 0?void 0:(_values$property_grou=values.property_group_id)===null||_values$property_grou===void 0?void 0:_values$property_grou.value,value:getValue(type,values.value)};if(modal!==null&&modal!==void 0&&modal.id){updateExtra(modal.id,body);}else{createExtra(body);}};function getValue(type,value){switch(type){case'color':return value.hex;case'text':return value;case'image':return value.name;default:return'';}}const renderPropertyValue=type=>{switch(type){case'color':return/*#__PURE__*/_jsx(SketchPicker,{onChangeComplete:color=>setColor(color.hex),color:color,disableAlpha:true});case'text':return/*#__PURE__*/_jsx(Input,{placeholder:t('enter.extra.value')});case'image':return/*#__PURE__*/_jsx(ImageUploadSingle,{type:\"property\",image:image,setImage:setImage,form:form,name:\"value\"});default:return'';}};async function fetchPropertyGroupList(search){const params={perPage:10,active:1,search};return propertyService.getAllGroups(params).then(res=>{var _res$data;return res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.map(item=>{var _item$translation;return{value:item===null||item===void 0?void 0:item.id,label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,key:item===null||item===void 0?void 0:item.id};});});}return/*#__PURE__*/_jsx(Modal,{title:modal!==null&&modal!==void 0&&modal.id?t('edit.property'):t('add.property'),visible:!!modal,onCancel:handleCancel,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),loading:loadingBtn,children:t('save')}),/*#__PURE__*/_jsx(Button,{type:\"default\",onClick:handleCancel,children:t('cancel')})],children:/*#__PURE__*/_jsxs(Form,{name:\"property-form\",layout:\"vertical\",form:form,onFinish:onFinish,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"property_group_id\",label:t('property.group'),hidden:!!groupId,rules:[{required:true,message:''}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchPropertyGroupList})}),/*#__PURE__*/_jsx(Form.Item,{name:\"value\",label:t('value'),rules:[{required:true,message:''}],children:renderPropertyValue(type)})]})});}","map":null,"metadata":{},"sourceType":"module"}