{"ast":null,"code":"import{Card,Col,Row,Space,Typography,Table,Tag,DatePicker,Spin,Menu,Dropdown,Button}from'antd';import React,{useContext,useEffect,useState}from'react';import{disableRefetch,setMenu}from'../../../redux/slices/menu';import{shallowEqual,useDispatch,useSelector}from'react-redux';import ReportChart from'../../../components/report/chart';import moment from'moment';import{ReportContext}from'../../../context/report';import FilterColumns from'../../../components/filter-column';import{useNavigate}from'react-router-dom';import{useTranslation}from'react-i18next';import{fetchSellerOrderProduct,fetchSellerOrderProductChart}from'../../../redux/slices/report/order';import useDidUpdate from'../../../helpers/useDidUpdate';import numberToPrice from'../../../helpers/numberToPrice';import{DebounceSelect}from'components/search';import shopService from'services/restaurant';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const{Text,Title}=Typography;const{RangePicker}=DatePicker;const ReportOrder=()=>{const dispatch=useDispatch();const navigate=useNavigate();const{t}=useTranslation();const{date_from,date_to,by_time,chart,handleChart,handleDateRange}=useContext(ReportContext);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{loading,chartData:reportData,productList:reportProducts}=useSelector(state=>state.orderReport,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const[selectedShop,setSelectedShop]=useState();const[columns,setColumns]=useState([{title:'Order #',dataIndex:'id',key:'id',is_show:true,render:(_,data)=>/*#__PURE__*/_jsxs(Button,{type:\"primary\",onClick:()=>goToShow(data),children:[\"#\",data.id]})},{title:'Status',dataIndex:'items_sold',key:'items_sold',is_show:true,render:(_,row)=>/*#__PURE__*/_jsx(Tag,{children:row.status})},{title:'Customer',dataIndex:'user_firstname',key:'user_firstname',is_show:true,render:(_,data)=>/*#__PURE__*/_jsx(_Fragment,{children:`${data.firstname} ${data.lastname}`})},{title:'Customer type',key:'user_active',dataIndex:'user_active',is_show:true,render:(_,data)=>{const status=Boolean(data.active);return/*#__PURE__*/_jsx(Tag,{color:status?'green':'red',children:status?'Active':'Inactive'},data.id);}},{title:'Product(s)',key:'category',dataIndex:'category',is_show:true,render:(_,data)=>{var _data$products;if(((_data$products=data.products)===null||_data$products===void 0?void 0:_data$products.length)>1){var _data$products2,_data$products3;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{children:data.products[0]}),/*#__PURE__*/_jsx(Dropdown,{overlay:/*#__PURE__*/_jsx(Menu,{children:(_data$products2=data.products)===null||_data$products2===void 0?void 0:_data$products2.slice(1,data.products.length).map((item,key)=>/*#__PURE__*/_jsx(Menu.Item,{children:item},key))}),children:/*#__PURE__*/_jsx(Tag,{style:{cursor:'pointer'},children:`+ ${((_data$products3=data.products)===null||_data$products3===void 0?void 0:_data$products3.length)-1} more`})})]});}else{return/*#__PURE__*/_jsx(_Fragment,{children:data.products[0]});}}},{title:'Item sold',key:'item_sold',dataIndex:'item_sold',sorter:(a,b)=>Number(a.quantity)-Number(b.quantity),is_show:true,render:(_,data)=>{return Number(data.quantity);}},{title:'Net sales',key:'price',dataIndex:'price',is_show:true,sorter:(a,b)=>a.price-b.price,render:(_,data)=>{return/*#__PURE__*/_jsx(_Fragment,{children:numberToPrice(data.price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)});}}]);const performance=[{label:'Item sold',value:'quantity',price:false,qty:'quantity'},{label:'Net sales',value:'price',price:true,qty:'price'},{label:'Avg Order price',value:'avg_price',price:true,qty:'avg_price'},{label:'Orders',value:'count',price:false,qty:'count'}];const goToShow=row=>{const url=`seller/order/details/${row.id}`;dispatch(setMenu({url,id:'order_details',name:t('order.details'),refetch:true,data:{}}));navigate(`/${url}`);};const fetchOrderChart=()=>{if(performance.find(item=>item.value===chart)){const data={date_from,date_to,type:by_time,chart,shop_id:selectedShop===null||selectedShop===void 0?void 0:selectedShop.value};dispatch(fetchSellerOrderProductChart(data));}};const fetchOrderList=(page,perPage)=>{dispatch(fetchSellerOrderProduct({date_from,date_to,by_time,chart,page:1,perPage:10,shop_id:selectedShop===null||selectedShop===void 0?void 0:selectedShop.value}));};useEffect(()=>{handleChart(performance[0].value);},[]);useEffect(()=>{if(activeMenu.refetch){fetchOrderList();fetchOrderChart();dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);useDidUpdate(()=>{fetchOrderList();},[date_to,by_time,chart,date_from,selectedShop===null||selectedShop===void 0?void 0:selectedShop.value]);useDidUpdate(()=>{fetchOrderChart();},[date_to,by_time,chart,date_from,selectedShop===null||selectedShop===void 0?void 0:selectedShop.value]);const onChangePagination=pagination=>{const{pageSize:perPage,current:page}=pagination;fetchOrderList(page,perPage);};async function fetchUserShopList(search){const params={search,active:1};return shopService.get(params).then(res=>res.data.map(item=>({label:item.translation?item.translation.title:'no name',value:item.id})));}return/*#__PURE__*/_jsxs(Spin,{size:\"large\",spinning:loading,children:[/*#__PURE__*/_jsx(Row,{gutter:24,className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Space,{size:\"large\",children:/*#__PURE__*/_jsx(RangePicker,{defaultValue:[moment(date_from),moment(date_to)],onChange:handleDateRange})})})}),/*#__PURE__*/_jsx(Row,{gutter:24,className:\"report-products\",children:performance===null||performance===void 0?void 0:performance.map((item,key)=>/*#__PURE__*/_jsx(Col,{span:6,onClick:()=>handleChart(item.value),children:/*#__PURE__*/_jsxs(Card,{className:chart===item.value&&'active',children:[/*#__PURE__*/_jsx(Row,{className:\"mb-5\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Text,{children:item.label})})}),/*#__PURE__*/_jsx(Row,{gutter:24,children:/*#__PURE__*/_jsx(Col,{span:18,children:/*#__PURE__*/_jsx(Title,{level:2,children:!item.price?reportData[item.qty]:numberToPrice(reportData[item.qty],defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)})})})]})},item.label))}),/*#__PURE__*/_jsx(ReportChart,{reportData:reportData,chart_data:\"price_avg\"}),/*#__PURE__*/_jsx(Row,{gutter:24,children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(Space,{className:\"d-flex justify-content-between\",children:[/*#__PURE__*/_jsx(Text,{level:3,children:\"Orders\"}),/*#__PURE__*/_jsx(Space,{className:\"d-flex justify-content-end\",children:/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})})]}),/*#__PURE__*/_jsx(Table,{columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:reportProducts===null||reportProducts===void 0?void 0:reportProducts.data,rowKey:row=>row.id,loading:loading,pagination:{pageSize:reportProducts===null||reportProducts===void 0?void 0:reportProducts.per_page,page:(reportProducts===null||reportProducts===void 0?void 0:reportProducts.current_page)||1,total:reportProducts===null||reportProducts===void 0?void 0:reportProducts.total,defaultCurrent:1},onChange:onChangePagination,scroll:{x:1200}})]})})})]});};export default ReportOrder;","map":null,"metadata":{},"sourceType":"module"}