{"ast":null,"code":"import React,{useState}from'react';import{Form,Button,Space,Card}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{setMenuData}from'redux/slices/menu';import{useTranslation}from'react-i18next';import{useLocation,useNavigate,useParams}from'react-router-dom';import ExtraValueSelectModal from'./extra-value-select-modal';import{IoCloseOutline}from'react-icons/io5';import ExtraSelectModal from'./extra-select-modal';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ProductExtras=_ref=>{var _activeMenu$data;let{next,prev,isRequest,mode}=_ref;const{t}=useTranslation();const dispatch=useDispatch();const{uuid,id}=useParams();const navigate=useNavigate();const location=useLocation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[loadingBtn,setLoadingBtn]=useState(false);const[extraSelectModalOpen,setExtraSelectModalOpen]=useState(false);const[selectedExtras,setSelectedExtras]=useState(((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.extras)||[]);const[currentExtra,setCurrentExtra]=useState(null);const[isChanged,setIsChanged]=useState(false);const{settings}=useSelector(state=>state.globalSettings);const onFinish=()=>{var _location$state,_location$state2;if(selectedExtras.some(selectedExtra=>{var _selectedExtra$values;return((_selectedExtra$values=selectedExtra.values)===null||_selectedExtra$values===void 0?void 0:_selectedExtra$values.length)===0||!selectedExtra.values;})){toast.error(t('please.select.at.least.1.extra.value.for.each.extra'));return;}const extras=selectedExtras.map(selectedExtra=>selectedExtra.value);extras.sort((a,b)=>a-b);let tempState=location.state;if(isRequest){dispatch(setMenuData({activeMenu,data:{...activeMenu.data,extras:selectedExtras}}));navigate(`/seller/product-request/${id}?step=2`,{state:{generate:isChanged}});return;}if((isChanged||location.state)&&mode==='edit'&&!((_location$state=location.state)!==null&&_location$state!==void 0&&_location$state.create)&&(settings===null||settings===void 0?void 0:settings.product_auto_approve)==='0'){if(location.state){tempState.extras=selectedExtras;}else{tempState={...activeMenu.data,extras:selectedExtras};}dispatch(setMenuData({activeMenu,data:{...activeMenu.data,extras:selectedExtras}}));navigate(`/seller/product/${uuid}?step=2`,{state:tempState});return;}setLoadingBtn(true);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,extras:selectedExtras}}));navigate(`/seller/product/${uuid}?step=2`,{state:{create:(_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.create}});};const handleDeleteSelectedExtra=extra=>{setIsChanged(true);setSelectedExtras(oldExtras=>oldExtras.filter(oldExtra=>oldExtra.id!==extra.id));};const handleSelectExtraValue=(extraId,values)=>{setIsChanged(true);setSelectedExtras(oldExtras=>oldExtras.map(oldExtra=>{if(oldExtra.value===extraId){const tempValues=values.map(value=>{var _activeMenu$data2,_activeMenu$data2$ext;const prevExtras=(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:(_activeMenu$data2$ext=_activeMenu$data2.extras)===null||_activeMenu$data2$ext===void 0?void 0:_activeMenu$data2$ext.flatMap(extra=>extra.values).find(extra=>extra.value===value.value);return{...value,stock_id:prevExtras===null||prevExtras===void 0?void 0:prevExtras.stock_id};});return{...oldExtra,values:tempValues};}return oldExtra;}));};const handleDeleteSelectedExtraValue=(extraId,value)=>{setIsChanged(true);setSelectedExtras(oldExtras=>{return oldExtras.map(oldExtra=>{if(oldExtra.value===extraId){return{...oldExtra,values:(oldExtra===null||oldExtra===void 0?void 0:oldExtra.values.filter(oldValue=>oldValue.value!==value))||[]};}return oldExtra;});});};return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Form,{layout:\"vertical\",initialValues:{...activeMenu.data},onFinish:onFinish,children:[/*#__PURE__*/_jsx(ExtraSelectModal,{open:extraSelectModalOpen,onClose:()=>setExtraSelectModalOpen(false),selectedExtras:selectedExtras,onSelect:item=>{setIsChanged(true);setSelectedExtras(oldExtras=>[...oldExtras,item]);setExtraSelectModalOpen(false);}}),/*#__PURE__*/_jsx(ExtraValueSelectModal,{extra:currentExtra,onClose:()=>setCurrentExtra(null),onSelect:handleSelectExtraValue}),/*#__PURE__*/_jsx(Space,{className:\"w-100\",size:\"middle\",direction:\"vertical\",children:selectedExtras.map(selectedExtra=>{var _selectedExtra$values2;return/*#__PURE__*/_jsxs(Space,{className:\"w-100\",direction:\"vertical\",children:[/*#__PURE__*/_jsxs(Space,{className:\"w-100\",wrap:true,children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setCurrentExtra(selectedExtra),ghost:true,type:\"primary\",children:selectedExtra===null||selectedExtra===void 0?void 0:selectedExtra.label}),selectedExtra===null||selectedExtra===void 0?void 0:(_selectedExtra$values2=selectedExtra.values)===null||_selectedExtra$values2===void 0?void 0:_selectedExtra$values2.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"extra-value\",children:[item===null||item===void 0?void 0:item.label,' ',/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteSelectedExtraValue(selectedExtra.value,item.value),type:\"button\",className:\"extra-clear\",children:/*#__PURE__*/_jsx(IoCloseOutline,{})})]},item.value))]}),/*#__PURE__*/_jsx(Space,{className:\"w-100\",style:{justifyContent:'flex-end'},children:/*#__PURE__*/_jsx(Button,{danger:true,onClick:()=>handleDeleteSelectedExtra(selectedExtra),type:\"text\",children:t('delete')})})]},selectedExtra.id);})}),/*#__PURE__*/_jsx(Button,{onClick:()=>setExtraSelectModalOpen(true),className:\"w-100 my-3\",type:\"dashed\",children:t('add.extra')}),/*#__PURE__*/_jsxs(Space,{className:\"mt-3\",children:[/*#__PURE__*/_jsx(Button,{onClick:prev,children:t('prev')}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('next')})]})]})});};export default ProductExtras;","map":null,"metadata":{},"sourceType":"module"}