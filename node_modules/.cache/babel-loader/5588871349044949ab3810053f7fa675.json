{"ast":null,"code":"import{Badge,Button,Card,Col,Descriptions,Image,PageHeader,Row,Space,Spin,Table,Tag,Typography}from'antd';import moment from'moment';import{useEffect,useState}from'react';import{useTranslation}from'react-i18next';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useNavigate,useParams}from'react-router-dom';import numberToPrice from'../../helpers/numberToPrice';import{addMenu,disableRefetch,setMenuData}from'redux/slices/menu';import userService from'../../services/user';import getImage from'../../helpers/getImage';import{fetchUserOrders}from'../../redux/slices/orders';import formatSortType from'../../helpers/formatSortType';import useDemo from'../../helpers/useDemo';import useDidUpdate from'../../helpers/useDidUpdate';import UserTopProducts from'./user-top-products';import UserRefunds from'./user-refunds';import hideEmail from'components/hideEmail';import hideNumber from'components/hideNumber';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const ReactAppIsDemo=process.env.REACT_APP_IS_DEMO;const UserDetail=()=>{var _data$wallet;const{id}=useParams();const navigate=useNavigate();const[data,setData]=useState({});const dispatch=useDispatch();const[loading,setLoading]=useState(false);const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const{defaultLang}=useSelector(state=>state.formLang,shallowEqual);const{orders,meta,loading:orderListLoading,params}=useSelector(state=>state.orders,shallowEqual);const{isDemo,demoDeliveryman,demoSeller,demoAdmin,demoModerator,demoMeneger}=useDemo();function fetchUser(uuid){setLoading(true);userService.getById(uuid).then(res=>setData(res.data)).finally(()=>setLoading(false));}const expandedRowRender=row=>{const columns=[{title:t('product'),dataIndex:'product',render:(_,data)=>{var _data$stock2,_data$stock2$product,_data$stock2$product$,_data$addons;return/*#__PURE__*/_jsx(\"div\",{className:\"text-hover\",onClick:()=>{var _data$stock,_data$stock$product;return goToProduct((_data$stock=data.stock)===null||_data$stock===void 0?void 0:(_data$stock$product=_data$stock.product)===null||_data$stock$product===void 0?void 0:_data$stock$product.uuid);},children:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[(_data$stock2=data.stock)===null||_data$stock2===void 0?void 0:(_data$stock2$product=_data$stock2.product)===null||_data$stock2$product===void 0?void 0:(_data$stock2$product$=_data$stock2$product.translation)===null||_data$stock2$product$===void 0?void 0:_data$stock2$product$.title,(_data$addons=data.addons)===null||_data$addons===void 0?void 0:_data$addons.map(addon=>{var _addon$stock,_addon$stock$product,_addon$stock$product$;return/*#__PURE__*/_jsxs(Tag,{children:[addon===null||addon===void 0?void 0:(_addon$stock=addon.stock)===null||_addon$stock===void 0?void 0:(_addon$stock$product=_addon$stock.product)===null||_addon$stock$product===void 0?void 0:(_addon$stock$product$=_addon$stock$product.translation)===null||_addon$stock$product$===void 0?void 0:_addon$stock$product$.title,\" x \",addon.quantity]},addon.id);})]})});},key:'product'},{title:t('quantity'),dataIndex:'quantity',key:'quantity'},{title:t('total.price'),dataIndex:'total_price',render:price=>numberToPrice(price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol),key:'total_price'},{title:t('discount'),dataIndex:'discount',key:'discount'}];return/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",className:\"w-100\",children:[/*#__PURE__*/_jsx(Typography.Text,{children:t('ordered.products')}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},columns:columns,dataSource:row.details,pagination:false})]});};const goToOrder=id=>{dispatch(addMenu({url:`/order/details/${id}`,id:'order.details',name:t('order.details')}));navigate(`/order/details/${id}`);};const goToShop=uuid=>{dispatch(addMenu({url:`/shop/${uuid}`,id:'edit.shop',name:t('edit.shop')}));navigate(`/shop/${uuid}`);};const goToProduct=uuid=>{dispatch(addMenu({id:`product-edit`,url:`product/${uuid}`,name:t('edit.product')}));navigate(`/product/${uuid}`);};const goToEdit=()=>{dispatch(addMenu({url:`user/${id}`,id:'user_edit',name:t('edit.user')}));navigate(`/user/${id}`,{state:'user'});};function onChangePagination(pagination,filter,sorter){const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,perPage,page,column,sort}}));}useEffect(()=>{fetchUser(id);},[id]);useEffect(()=>{const params={user_id:id,page:1,perPage:10};dispatch(fetchUserOrders(params));// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useDidUpdate(()=>{var _activeMenu$data,_activeMenu$data2;const params={user_id:id,page:(activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.page)||1,perPage:(activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.perPage)||10};dispatch(fetchUserOrders(params));},[activeMenu.data]);useEffect(()=>{if(activeMenu.refetch){var _activeMenu$data3,_activeMenu$data4;const params={user_id:id,page:(activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data3=activeMenu.data)===null||_activeMenu$data3===void 0?void 0:_activeMenu$data3.page)||1,perPage:(activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data4=activeMenu.data)===null||_activeMenu$data4===void 0?void 0:_activeMenu$data4.perPage)||10};fetchUser(id);dispatch(fetchUserOrders(params));dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center h-100\",children:/*#__PURE__*/_jsx(Spin,{})});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageHeader,{title:t('user.info'),extra:/*#__PURE__*/_jsx(Button,{type:\"primary\",disabled:/*eslint eqeqeq: \"off\"*/isDemo&&(data===null||data===void 0?void 0:data.id)==demoDeliveryman||isDemo&&(data===null||data===void 0?void 0:data.id)==demoModerator||isDemo&&(data===null||data===void 0?void 0:data.id)==demoMeneger||isDemo&&(data===null||data===void 0?void 0:data.id)==demoSeller||isDemo&&(data===null||data===void 0?void 0:data.id)===demoAdmin,onClick:goToEdit,children:t('edit')})}),/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:16,children:/*#__PURE__*/_jsxs(Card,{title:`${data===null||data===void 0?void 0:data.firstname} ${(data===null||data===void 0?void 0:data.lastname)||''} #${data===null||data===void 0?void 0:data.id}`,children:[/*#__PURE__*/_jsx(Image,{src:getImage(data===null||data===void 0?void 0:data.img),alt:data===null||data===void 0?void 0:data.firstname,width:100,height:100,style:{borderRadius:'10px',objectFit:'cover'}}),/*#__PURE__*/_jsxs(Descriptions,{column:2,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:t('registration.date'),children:moment(data===null||data===void 0?void 0:data.registered_at).format('YYYY-MM-DD HH:mm')}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('status'),children:/*#__PURE__*/_jsx(Tag,{color:data!==null&&data!==void 0&&data.active?'cyan':'red',children:data!==null&&data!==void 0&&data.active?t('active'):t('inactive')})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('birthday'),children:moment(data===null||data===void 0?void 0:data.birthday).format('YYYY-MM-DD')}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('email'),children:ReactAppIsDemo?hideEmail(data===null||data===void 0?void 0:data.email):data===null||data===void 0?void 0:data.email}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('gender'),children:data===null||data===void 0?void 0:data.gender}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('role'),children:data===null||data===void 0?void 0:data.role}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('wallet'),children:numberToPrice(data===null||data===void 0?void 0:(_data$wallet=data.wallet)===null||_data$wallet===void 0?void 0:_data$wallet.price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('phone'),children:data!==null&&data!==void 0&&data.phone?ReactAppIsDemo?hideNumber(data===null||data===void 0?void 0:data.phone):data===null||data===void 0?void 0:data.phone:t('no.phone.number')})]})]})}),/*#__PURE__*/_jsxs(Col,{span:8,children:[/*#__PURE__*/_jsx(Card,{title:t('successfull.orders'),children:/*#__PURE__*/_jsxs(Descriptions,{column:1,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:t('delivered.orders.count'),children:/*#__PURE__*/_jsx(Badge,{showZero:true,style:{backgroundColor:'#3d7de3'},count:(data===null||data===void 0?void 0:data.o_count)||0})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('spent.since.registration'),children:/*#__PURE__*/_jsx(Badge,{showZero:true,style:{backgroundColor:'#48e33d'},count:numberToPrice(data===null||data===void 0?void 0:data.o_sum,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)||0})})]})}),(data===null||data===void 0?void 0:data.shop)&&/*#__PURE__*/_jsx(Card,{title:`${t('shop.info')} #${data===null||data===void 0?void 0:data.shop.id}`,children:/*#__PURE__*/_jsxs(Descriptions,{column:1,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:t('name'),children:data===null||data===void 0?void 0:data.shop.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('phone'),children:data===null||data===void 0?void 0:data.shop.phone})]})})]}),/*#__PURE__*/_jsxs(Col,{span:24,children:[/*#__PURE__*/_jsx(Card,{title:t('orders'),children:/*#__PURE__*/_jsx(Table,{expandable:{expandedRowRender,defaultExpandedRowKeys:['0']},dataSource:orders,columns:[{title:'ID',dataIndex:'id',key:'id',render:id=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>goToOrder(id),className:\"text-hover\",children:[\"#\",id]})},{title:t('number.of.products'),dataIndex:'order_details_count',key:'order_details_count',render:count=>`${count||0} ${count&&count<2?t('products'):t('product')}`},{title:t('total.price'),dataIndex:'total_price',key:'total_price',render:total_price=>numberToPrice(total_price,defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol)},{title:t('delivery.date.&.time'),dataIndex:'delivery_date',key:'delivery_date',render:(_,row)=>`${row===null||row===void 0?void 0:row.delivery_date} ${(row===null||row===void 0?void 0:row.delivery_time)||''}`},{title:t('status'),dataIndex:'status',key:'status',render:status=>/*#__PURE__*/_jsx(Tag,{children:status})},{title:t('delivery.address'),dataIndex:'address',key:'address',render:(_,row)=>{var _row$my_address$stree,_row$my_address,_row$delivery_point$a,_row$delivery_point,_row$delivery_point$a2;let address;switch(row===null||row===void 0?void 0:row.delivery_type){case'delivery':address=(_row$my_address$stree=row===null||row===void 0?void 0:(_row$my_address=row.my_address)===null||_row$my_address===void 0?void 0:_row$my_address.street_house_number)!==null&&_row$my_address$stree!==void 0?_row$my_address$stree:t('no.address');break;case'point':address=(_row$delivery_point$a=row===null||row===void 0?void 0:(_row$delivery_point=row.delivery_point)===null||_row$delivery_point===void 0?void 0:(_row$delivery_point$a2=_row$delivery_point.address)===null||_row$delivery_point$a2===void 0?void 0:_row$delivery_point$a2[defaultLang])!==null&&_row$delivery_point$a!==void 0?_row$delivery_point$a:t('no.address');break;case'digital':address=t('digital.delivery');break;default:address=t('no.address');}return address;}}],loading:orderListLoading,pagination:{pageSize:params.perPage,page:params.page,total:meta.total,defaultCurrent:params.page},rowKey:record=>record.id,onChange:onChangePagination})}),/*#__PURE__*/_jsx(UserRefunds,{id:id}),/*#__PURE__*/_jsx(UserTopProducts,{id:id})]})]})]});};export default UserDetail;","map":null,"metadata":{},"sourceType":"module"}