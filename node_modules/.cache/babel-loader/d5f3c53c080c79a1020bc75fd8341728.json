{"ast":null,"code":"import{useRef,useState}from'react';import{useTranslation}from'react-i18next';import{Button,Col,Form,Input,InputNumber,Modal,Row}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{getCartData}from'../../../../redux/selectors/cartSelector';import countryService from'../../../../services/deliveryzone/country';import cityService from'../../../../services/deliveryzone/city';import{toast}from'react-toastify';import addressService from'../../../../services/seller/address';import{DebounceSelect}from'../../../../components/search';import{setCartData}from'../../../../redux/slices/cart';import PosUserAddress from'./pos-user-address';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function DeliveryUserModal(_ref){let{visible,handleCancel}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const[loadingBtn,setLoadingBtn]=useState(false);const[error,setError]=useState(null);const[addressModal,setAddressModal]=useState(null);const dispatch=useDispatch();const cartData=useSelector(state=>getCartData(state.cart));const{currentBag}=useSelector(state=>state.cart,shallowEqual);const countryOptions=useRef([]);const fetchCountries=search=>{var _cartData$region;const params={search,perPage:10,page:1,has_price:1,region_id:cartData===null||cartData===void 0?void 0:(_cartData$region=cartData.region)===null||_cartData$region===void 0?void 0:_cartData$region.value};return countryService.get(params).then(_ref2=>{let{data}=_ref2;const options=data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id,region_id:item===null||item===void 0?void 0:item.region_id};});countryOptions.current=options;return options;});};const fetchCities=search=>{var _cartData$country;const params={search,perPage:10,page:1,country_id:cartData===null||cartData===void 0?void 0:(_cartData$country=cartData.country)===null||_cartData$country===void 0?void 0:_cartData$country.value,has_price:1};return cityService.get(params).then(_ref3=>{let{data}=_ref3;return data===null||data===void 0?void 0:data.flatMap(item=>{var _item$translation2;return{label:item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});};const goToAddClientAddress=()=>{if(!cartData.userUuid){toast.warning(t('please.select.client'));return;}setAddressModal(cartData.userUuid);};const onFinish=values=>{var _cartData$user,_values$country,_values$city,_values$phone,_values$street_house_;const payload={...values,user_id:(_cartData$user=cartData.user)===null||_cartData$user===void 0?void 0:_cartData$user.value,country_id:(_values$country=values.country)===null||_values$country===void 0?void 0:_values$country.value,city_id:(_values$city=values.city)===null||_values$city===void 0?void 0:_values$city.value,active:1,phone:(_values$phone=values.phone)===null||_values$phone===void 0?void 0:_values$phone.toString(),street_house_number:(_values$street_house_=values.street_house_number)===null||_values$street_house_===void 0?void 0:_values$street_house_.toString(),city:undefined,country:undefined};setLoadingBtn(true);addressService.create(payload).then(()=>{toast.success(t('successfully.added'));handleCancel();}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsxs(Modal,{title:t('add.delivery.address'),visible:visible,onCancel:handleCancel,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),loading:loadingBtn,children:t('save')},'ok-button'),/*#__PURE__*/_jsx(Button,{onClick:handleCancel,children:t('cancel')},'cancel-button')],children:[/*#__PURE__*/_jsx(Form,{layout:\"vertical\",form:form,onFinish:onFinish,children:/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"firstname\",label:t('firstname'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"lastname\",label:t('lastname'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"title\",label:t('title'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsxs(Col,{span:12,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"country\",label:t('country'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchCountries,placeholder:t('select.country'),onChange:country=>{const selectedCountry=countryOptions.current.find(item=>item.value===country.value);form.setFieldsValue({region_id:selectedCountry===null||selectedCountry===void 0?void 0:selectedCountry.region_id});dispatch(setCartData({country,region_id:selectedCountry===null||selectedCountry===void 0?void 0:selectedCountry.region_id,bag_id:currentBag}));},refetchOptions:true,onClear:()=>{form.setFieldsValue({city:[]});dispatch(setCartData({country:null,city:null,bag_id:currentBag}));},autoComplete:\"none\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"region_id\",hidden:true})]}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"city\",label:t('city'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchCities,placeholder:t('select.city'),refetchOptions:true,disabled:!(cartData!==null&&cartData!==void 0&&cartData.country),onChange:city=>dispatch(setCartData({city,bag_id:currentBag})),autoComplete:\"none\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('phone.number'),name:\"phone\",rules:[{validator(_,value){if(value<0){return Promise.reject(new Error(t('must.be.positive')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",addonBefore:'+',parser:value=>parseInt(value,10)})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"street_house_number\",label:t('home.number'),rules:[{required:true,message:t('required')},{type:'number',max:99999999,message:t('max.length.8')}],children:/*#__PURE__*/_jsx(InputNumber,{placeholder:t('home.number'),className:\"w-100\",min:0,onChange:value=>dispatch(setCartData({street_house_number:value,bag_id:currentBag}))})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"zipcode\",label:t('zip.code'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{placeholder:t('zip.code'),className:\"w-100\",onChange:value=>dispatch(setCartData({zip_code:value.target.value,bag_id:currentBag})),maxLength:15})})}),/*#__PURE__*/_jsxs(Col,{span:24,children:[/*#__PURE__*/_jsx(Form.Item,{name:['address','address'],label:t('address'),rules:[{required:true,message:''}],onClick:goToAddClientAddress,children:/*#__PURE__*/_jsx(Input,{autoComplete:\"off\",placeholder:t('address')})}),/*#__PURE__*/_jsx(Form.Item,{name:['location','latitude'],hidden:true}),/*#__PURE__*/_jsx(Form.Item,{name:['location','longitude'],hidden:true})]}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{name:\"additional_details\",label:t('details'),children:/*#__PURE__*/_jsx(Input,{})})})]})}),addressModal&&/*#__PURE__*/_jsx(PosUserAddress,{uuid:addressModal,handleCancel:()=>setAddressModal(null),parentForm:form})]});}","map":null,"metadata":{},"sourceType":"module"}