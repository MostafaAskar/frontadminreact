{"ast":null,"code":"import React,{useEffect,useMemo,useState}from'react';import{steps}from'./steps';import{Card,Spin,Steps}from'antd';import ProductProperty from'./product-property';import ProductFinish from'./product-finish';import ProductStock from'./product-stock';import ProductExtras from'./product-extras';import ProductsIndex from'./products-index';import LanguageList from'components/language-list';import{useParams}from'react-router-dom';import productService from'services/product';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,setMenuData}from'redux/slices/menu';import{useTranslation}from'react-i18next';import{useQueryParams}from'helpers/useQueryParams';import ProductGallery from'./product-gallery';import ProductDigital from'./product-digital';import Wholesale from'./wholesale';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const{Step}=Steps;const ProductsEdit=()=>{var _queryParams$values,_activeMenu$data,_filteredExtras$value,_activeMenu$data2,_activeMenu$data3;const{t}=useTranslation();const{uuid}=useParams();const queryParams=useQueryParams();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{languages}=useSelector(state=>state.formLang,shallowEqual);const dispatch=useDispatch();const current=Number(((_queryParams$values=queryParams.values)===null||_queryParams$values===void 0?void 0:_queryParams$values.step)||0);const[loading,setLoading]=useState(activeMenu.refetch);const[newSteps,setNewSteps]=useState(steps);const{extras}=(activeMenu===null||activeMenu===void 0?void 0:activeMenu.data)||{};const isDigital=activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.digital;const isTypeColorExists=extras===null||extras===void 0?void 0:extras.some(extra=>{var _extra$group;return(extra===null||extra===void 0?void 0:(_extra$group=extra.group)===null||_extra$group===void 0?void 0:_extra$group.type)==='color';});const filteredExtras=useMemo(()=>extras===null||extras===void 0?void 0:extras.find(item=>{var _item$group;return(item===null||item===void 0?void 0:(_item$group=item.group)===null||_item$group===void 0?void 0:_item$group.type)==='color';}),[extras]);const uniqueData=Array.from(new Set(filteredExtras===null||filteredExtras===void 0?void 0:(_filteredExtras$value=filteredExtras.values)===null||_filteredExtras$value===void 0?void 0:_filteredExtras$value.map(item=>item.value))).map(value=>{var _filteredExtras$value2;return filteredExtras===null||filteredExtras===void 0?void 0:(_filteredExtras$value2=filteredExtras.values)===null||_filteredExtras$value2===void 0?void 0:_filteredExtras$value2.find(item=>item.value===value);});const colorItems=uniqueData.filter(item=>item.group_type==='color');useEffect(()=>{if(isDigital){setNewSteps(steps.filter(item=>item.title!=='product.extras'));}else if(isDigital===false){setNewSteps(steps.filter(item=>item.title!=='product.digital'));}if(isTypeColorExists){setNewSteps(prev=>prev);}else{setNewSteps(prev=>prev.filter(item=>item.title!=='Gallery'));}},[isTypeColorExists,isDigital]);const next=()=>{const step=current+1;queryParams.set('step',step);};const prev=()=>{const step=current-1;queryParams.set('step',step);};const createImages=items=>items.map(item=>({uid:item.id,name:item.path,url:item.path,isVideo:Boolean(item.preview)}));const createMediaFile=items=>{const mediaObject={images:[],previews:[]};const previews=items.filter(item=>item.preview).map(item=>({uid:item.id,name:item.preview,url:item.preview}));const videos=items.filter(item=>item.preview).map(item=>({uid:item.id,name:item.path,url:item.path,isVideo:true}));mediaObject.previews=previews;mediaObject.images=videos;return mediaObject;};const createSelectObject=item=>{if(!item)return null;return{label:item!==null&&item!==void 0&&item.translation?item.translation.title:item.title,value:item.id,key:item.id};};function fetchProduct(uuid){setLoading(true);productService.getById(uuid).then(res=>{var _res$data,_res$data2,_res$data3,_res$data4,_res$data5,_res$data6;const extras={};res.data.stocks.forEach(stock=>{stock.extras.forEach(extra=>{if(extra.extra_group_id in extras){var _extras$extra$extra_g;if(!((_extras$extra$extra_g=extras[extra.extra_group_id].values)!==null&&_extras$extra$extra_g!==void 0&&_extras$extra$extra_g.some(item=>{var _extra$value;return item.value===((_extra$value=extra.value)===null||_extra$value===void 0?void 0:_extra$value.id);}))){var _extras$extra$extra_g2,_extra$value2;(_extras$extra$extra_g2=extras[extra.extra_group_id].values)===null||_extras$extra$extra_g2===void 0?void 0:_extras$extra$extra_g2.push({value:extra.value.id,label:(_extra$value2=extra.value)===null||_extra$value2===void 0?void 0:_extra$value2.value,stock_id:stock.id});}}else{var _extra$group$translat,_extra$value3;extras[extra.extra_group_id]={group:extra.group,label:(_extra$group$translat=extra.group.translation)===null||_extra$group$translat===void 0?void 0:_extra$group$translat.title,value:extra.extra_group_id,id:extra.extra_group_id,stock_id:stock.id,values:[{value:extra.value.id,label:(_extra$value3=extra.value)===null||_extra$value3===void 0?void 0:_extra$value3.value,stock_id:stock.id}]};}});});const data={...res.data,...getLanguageFields(res.data),shop:createSelectObject(res.data.shop),category:createSelectObject(res.data.category),brand:createSelectObject(res.data.brand),unit:createSelectObject(res.data.unit),images:createImages(res.data.galleries),initialMediaFile:createMediaFile(res.data.galleries),extras:Object.values(extras),stocks:res.data.stocks.map(stock=>({...stock,...Object.assign({},...stock.extras.map((extra,idx)=>({[`extras[${idx}]`]:extra.id}))),quantity:stock.quantity||0,price:stock.price||0,extras:undefined})),stocksData:res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.stocks,properties:res.data.properties.map((item,index)=>({id:index,[`key[${item.locale}]`]:item.key,[`value[${item.locale}]`]:item.value})),translation:undefined,translations:undefined,min_qty:(_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.min_qty,max_qty:(_res$data3=res.data)===null||_res$data3===void 0?void 0:_res$data3.max_qty,tax:(_res$data4=res.data)===null||_res$data4===void 0?void 0:_res$data4.tax,interval:(_res$data5=res.data)===null||_res$data5===void 0?void 0:_res$data5.interval,age_limit:(_res$data6=res.data)===null||_res$data6===void 0?void 0:_res$data6.age_limit};dispatch(setMenuData({activeMenu,data}));}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});}function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description};});return Object.assign({},...result);}useEffect(()=>{if(activeMenu.refetch){fetchProduct(uuid);}},[activeMenu.refetch]);const onChange=step=>{dispatch(setMenuData({activeMenu,data:{...activeMenu.data,step}}));queryParams.set('step',step);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Card,{title:t('edit.product'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:/*#__PURE__*/_jsx(Steps,{current:current,onChange:onChange,children:newSteps.map(item=>/*#__PURE__*/_jsx(Step,{title:t(item.title)},item.title))})}),!loading?/*#__PURE__*/_jsxs(\"div\",{className:\"\",children:[newSteps[current].content==='First-content'&&/*#__PURE__*/_jsx(ProductsIndex,{next:next,action_type:'edit'}),((_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.digital)&&newSteps[current].content==='Product-digital'&&/*#__PURE__*/_jsx(ProductDigital,{next:next,prev:prev}),!((_activeMenu$data3=activeMenu.data)!==null&&_activeMenu$data3!==void 0&&_activeMenu$data3.digital)&&newSteps[current].content==='Second-content'&&/*#__PURE__*/_jsx(ProductExtras,{next:next,prev:prev}),newSteps[current].content==='Third-content'&&/*#__PURE__*/_jsx(ProductStock,{next:next,prev:prev}),newSteps[current].content==='wholesale-content'&&/*#__PURE__*/_jsx(Wholesale,{next:next,prev:prev}),isTypeColorExists>0&&newSteps[current].content==='Gallery-content'&&/*#__PURE__*/_jsx(ProductGallery,{next:next,prev:prev}),newSteps[current].content==='Fourth-content'&&/*#__PURE__*/_jsx(ProductProperty,{next:next,prev:prev}),newSteps[current].content==='Finish-content'&&/*#__PURE__*/_jsx(ProductFinish,{prev:prev})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})})]});};export default ProductsEdit;","map":null,"metadata":{},"sourceType":"module"}