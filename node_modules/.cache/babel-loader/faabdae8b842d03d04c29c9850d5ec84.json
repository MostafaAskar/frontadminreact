{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{Button,Card,Col,Form,Input,Row,Select,Switch}from'antd';import{batch,shallowEqual,useDispatch,useSelector}from'react-redux';import{removeFromMenu,setMenuData}from'redux/slices/menu';import{fetchPages}from'redux/slices/pages';import{useTranslation}from'react-i18next';import LanguageList from'components/language-list';import MediaUpload from'components/upload';import{IMG_URL,api_url}from'configs/app-global';import{typeList}from'./type-list';import CkeEditor from'components/ckeEditor';import axios from'axios';import getTranslationFields from'helpers/getTranslationFields';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const PageAdd=()=>{var _activeMenu$data,_activeMenu$data$gall,_activeMenu$data$gall2;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const navigate=useNavigate();const[loadingBtn,setLoadingBtn]=useState(false);const[type,setType]=useState(null);const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);const{pages}=useSelector(state=>state.pages,shallowEqual);const createImage=name=>{return{name,url:IMG_URL+name};};const[image,setImage]=useState((_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&(_activeMenu$data$gall=_activeMenu$data.galleries)!==null&&_activeMenu$data$gall!==void 0&&_activeMenu$data$gall[0]?[createImage((_activeMenu$data$gall2=activeMenu.data.galleries)===null||_activeMenu$data$gall2===void 0?void 0:_activeMenu$data$gall2[0].path)]:[]);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));};},[]);const onFinish=values=>{setLoadingBtn(true);const body={images:image.map(img=>img.name),active:Number(values.active),type:values.type,title:getTranslationFields(languages,values,'title'),description:getTranslationFields(languages,values,'description'),buttons:{google_play_button_link:values===null||values===void 0?void 0:values.google_play_button_link,app_store_button_link:values===null||values===void 0?void 0:values.app_store_button_link}};const trimAndCheckLength=value=>{var _value$trim;return value===null||value===void 0?void 0:(_value$trim=value.trim())===null||_value$trim===void 0?void 0:_value$trim.length;};if(!trimAndCheckLength(values===null||values===void 0?void 0:values.google_play_button_link)){var _body$buttons;(_body$buttons=body.buttons)===null||_body$buttons===void 0?true:delete _body$buttons.google_play_button_link;}if(!trimAndCheckLength(values===null||values===void 0?void 0:values.app_store_button_link)){var _body$buttons2;(_body$buttons2=body.buttons)===null||_body$buttons2===void 0?true:delete _body$buttons2.app_store_button_link;}if(!trimAndCheckLength(values===null||values===void 0?void 0:values.app_store_button_link)&&!trimAndCheckLength(values===null||values===void 0?void 0:values.google_play_button_link)){delete body.buttons;}axios({method:'post',url:`${api_url}dashboard/admin/pages`,headers:{Authorization:`Bearer ${localStorage.getItem('token')}`},data:body,params:{}}).then(()=>{const nextUrl='pages';toast.success(t('successfully.created'));batch(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchPages({}));});navigate(`/${nextUrl}`);}).catch(err=>{var _err$response,_err$response$data;return toast.error((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message);}).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsx(Card,{title:t('add.pages'),className:\"h-100\",extra:/*#__PURE__*/_jsx(LanguageList,{}),children:/*#__PURE__*/_jsxs(Form,{name:\"page-add\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{active:true,...activeMenu.data},className:\"d-flex flex-column h-100\",children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('name'),name:`title[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'title'+item.locale))}),/*#__PURE__*/_jsx(Col,{span:12}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(CkeEditor,{form:form,languages:languages,lang:defaultLang})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('type'),name:\"type\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{onChange:e=>setType(e),options:typeList.filter(i=>!pages.some(e=>e.type===i.value)),className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})}),type!=='delivery'&&type!=='about'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('google_play_button_link'),name:\"google_play_button_link\",children:/*#__PURE__*/_jsx(Input,{className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('app_store_button_link'),name:\"app_store_button_link\",children:/*#__PURE__*/_jsx(Input,{className:\"w-100\"})})})]}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),children:/*#__PURE__*/_jsx(MediaUpload,{type:\"other\",imageList:image,setImageList:setImage,form:form,multiple:false})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex flex-column justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})})})]})});};export default PageAdd;","map":null,"metadata":{},"sourceType":"module"}