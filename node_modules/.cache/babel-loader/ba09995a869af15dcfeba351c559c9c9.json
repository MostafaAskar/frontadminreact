{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Input,Form,Row,Col,Button,Card,Switch,Select}from'antd';import{toast}from'react-toastify';import{useNavigate,useParams}from'react-router-dom';import languagesService from'../../services/languages';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'../../redux/slices/menu';import{useTranslation}from'react-i18next';import createImage from'../../helpers/createImage';import Loading from'../../components/loading';import MediaUpload from'../../components/upload';import{fetchLang}from'../../redux/slices/languages';import lang from'../../helpers/lang.json';import useDemo from'../../helpers/useDemo';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function LanguageAdd(){var _activeMenu$data,_activeMenu$data2;const{t}=useTranslation();const navigate=useNavigate();const{id}=useParams();const dispatch=useDispatch();const[form]=Form.useForm();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);const{isDemo}=useDemo();const[image,setImage]=useState(activeMenu!==null&&activeMenu!==void 0&&(_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.image?[activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.image]:[]);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,...data}}));};},[]);const fetchLanguage=id=>{setLoading(true);languagesService.getById(id).then(res=>{let language=res.data;setImage([createImage(language.img)]);form.setFieldsValue({...language,image:[createImage(language.img)]});}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const onFinish=values=>{var _image$;setLoadingBtn(true);const body={title:values===null||values===void 0?void 0:values.title,locale:values===null||values===void 0?void 0:values.locale,images:image.length?[(_image$=image[0])===null||_image$===void 0?void 0:_image$.name]:undefined,active:Number(values===null||values===void 0?void 0:values.active),backward:values===null||values===void 0?void 0:values.backward,default:values===null||values===void 0?void 0:values.default};const nextUrl='settings/languages';if(!id){languagesService.create(body).then(()=>{dispatch(fetchLang());toast.success(t('successfully.created'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);}).finally(()=>setLoadingBtn(false));}else{languagesService.update(id,body).then(()=>{dispatch(fetchLang());toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);}).finally(()=>setLoadingBtn(false));}};useEffect(()=>{if(activeMenu.refetch&&id){fetchLanguage(id);}},[activeMenu.refetch]);const options=lang.map(item=>({label:(item===null||item===void 0?void 0:item.Native_name.toUpperCase())+' '+item.Language_name,value:item.short_code,key:item.Native_name}));return/*#__PURE__*/_jsx(Card,{title:id?t('edit.language'):t('add.language'),children:!loading?/*#__PURE__*/_jsxs(Form,{form:form,name:\"form\",layout:\"vertical\",initialValues:{...activeMenu.data,active:false,backward:false,default:false},onFinish:onFinish,children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:\"title\",rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('short.code'),name:\"locale\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{filterOption:(input,option)=>{var _option$label;return((_option$label=option===null||option===void 0?void 0:option.label)!==null&&_option$label!==void 0?_option$label:'').includes(input);},filterSort:(optionA,optionB)=>{var _optionA$label,_optionB$label;return((_optionA$label=optionA===null||optionA===void 0?void 0:optionA.label)!==null&&_optionA$label!==void 0?_optionA$label:'').toLowerCase().localeCompare(((_optionB$label=optionB===null||optionB===void 0?void 0:optionB.label)!==null&&_optionB$label!==void 0?_optionB$label:'').toLowerCase());},showSearch:true,allowClear:true,options:options})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),name:\"images\",rules:[{validator(){if((image===null||image===void 0?void 0:image.length)===0){return Promise.reject(new Error(t('required')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"languages\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:\"RTL\",name:\"backward\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{label:t('default'),name:\"default\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{disabled:isDemo})})})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('save')})]}):/*#__PURE__*/_jsx(Loading,{})});}","map":null,"metadata":{},"sourceType":"module"}