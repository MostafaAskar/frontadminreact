{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Table,Card,Space,Tag}from'antd';import{fetchShopAdverts}from'redux/slices/advert';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import SearchInput from'components/search-input';import FilterColumns from'components/filter-column';import{disableRefetch}from'redux/slices/menu';import useDidUpdate from'helpers/useDidUpdate';import numberToPrice from'helpers/numberToPrice';import advertService from'services/seller/advert';import{toast}from'react-toastify';import paymentService from'services/rest/payment';import{EyeFilled}from'@ant-design/icons';import AdDetail from'./ad-detail';import moment from'moment';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Advert(){const{t}=useTranslation();const dispatch=useDispatch();const[id,setId]=useState(null);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{shopAdList,loading:listLoading,meta}=useSelector(state=>state.advert,shallowEqual);const[search,setSearch]=useState('');const[loading,setLoading]=useState(false);const handlePurchase=id=>{setLoading(true);paymentService.getAll().then(res=>{const wallet=res.data.find(payment=>payment.tag==='wallet');if(!wallet){toast.error(t('request.admin.to.enable.payment.from.wallet'));setLoading(false);return;}advertService.purchase(id,{payment_sys_id:wallet===null||wallet===void 0?void 0:wallet.id}).then(()=>{toast.success(t('purchased.successfully'));}).finally(()=>{setLoading(false);dispatch(fetchShopAdverts(paramsData));});}).catch(()=>{setLoading(false);});};const[columns,setColumns]=useState([{title:t('id'),dataIndex:'id',is_show:true,sorter:(a,b)=>a.id-b.id},{title:t('ad.package'),dataIndex:'ads_package',is_show:true,render:ad=>{var _ad$translation;return/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"span\",{children:ad===null||ad===void 0?void 0:(_ad$translation=ad.translation)===null||_ad$translation===void 0?void 0:_ad$translation.title}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(EyeFilled,{}),onClick:()=>setId(ad.id)})]});}},{title:t('price'),dataIndex:'price',is_show:true,render:(_,row)=>{var _row$ads_package;return numberToPrice(row===null||row===void 0?void 0:(_row$ads_package=row.ads_package)===null||_row$ads_package===void 0?void 0:_row$ads_package.price);}},{title:t('expire_at'),dataIndex:'expire_at',is_show:true,render:(_,row)=>moment(row===null||row===void 0?void 0:row.expired_at).format('YYYY-MM-DD HH:mm')},{title:t('status'),dataIndex:'status',is_show:true,render:status=>/*#__PURE__*/_jsx(\"div\",{children:status==='new'?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:t(status)}):status==='canceled'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(status)})})},{title:t('transaction'),dataIndex:'transaction',is_show:true,render:transaction=>{return/*#__PURE__*/_jsx(\"div\",{children:(transaction===null||transaction===void 0?void 0:transaction.status)==='paid'?/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(transaction===null||transaction===void 0?void 0:transaction.status)}):(transaction===null||transaction===void 0?void 0:transaction.status)==='canceled'||(transaction===null||transaction===void 0?void 0:transaction.status)==='rejected'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(transaction===null||transaction===void 0?void 0:transaction.status)}):/*#__PURE__*/_jsx(Tag,{color:\"orange\",children:t('not.paid')})});}},{title:t('options'),dataIndex:'options',is_show:true,render:(_,row)=>{var _row$transaction;return/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(Button,{onClick:()=>handlePurchase(row.id),disabled:((_row$transaction=row.transaction)===null||_row$transaction===void 0?void 0:_row$transaction.status)==='paid',loading:loading,children:t('purchase')})});}}]);const paramsData={perPage:10,page:1,sort:'desc',column:'created_at'};useEffect(()=>{if(activeMenu.refetch){dispatch(fetchShopAdverts(paramsData));dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);useDidUpdate(()=>{const paramsData={search};dispatch(fetchShopAdverts(paramsData));},[activeMenu.data,search]);const onChangePagination=pageNumber=>{const{pageSize,current}=pageNumber;dispatch(fetchShopAdverts({perPage:pageSize,page:current}));};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Card,{className:\"p-o\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-content-between\",children:[/*#__PURE__*/_jsx(SearchInput,{style:{maxWidth:'200px'},handleChange:value=>setSearch(value),placeholder:t('search')}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-3\",children:/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})})]})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Table,{scroll:{x:true},dataSource:shopAdList,columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),rowKey:record=>record.id,loading:listLoading||loading,pagination:{pageSize:meta.per_page,page:meta.current_page,total:meta.total},onChange:onChangePagination})}),/*#__PURE__*/_jsx(AdDetail,{id:id,onClose:()=>setId(null)})]});}","map":null,"metadata":{},"sourceType":"module"}