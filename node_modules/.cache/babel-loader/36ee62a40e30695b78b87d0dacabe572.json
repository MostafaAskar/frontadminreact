{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Card,Col,Form,Input,InputNumber,Row,Select,Spin,Switch}from'antd';import{toast}from'react-toastify';import{useLocation,useNavigate,useParams}from'react-router-dom';import LanguageList from'components/language-list';import TextArea from'antd/es/input/TextArea';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData,setRefetch}from'redux/slices/menu';import sellerCategory from'services/seller/category';import{IMG_URL}from'configs/app-global';import{useTranslation}from'react-i18next';import MediaUpload from'components/upload';import requestModelsService from'services/seller/request-models';import{fetchSellerCategory}from'redux/slices/category';import{AsyncTreeSelect}from'components/async-tree-select';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const SellerCategoryEdit=()=>{var _activeMenu$data,_activeMenu$data2;const{t}=useTranslation();const navigate=useNavigate();const dispatch=useDispatch();const[type,setType]=useState('main');const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{params}=useSelector(state=>state.requestModels,shallowEqual);const{user}=useSelector(state=>state.auth,shallowEqual);const{state}=useLocation();const[loading,setLoading]=useState(false);const[image,setImage]=useState((_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.image?[(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.image]:[]);const[form]=Form.useForm();const[loadingBtn,setLoadingBtn]=useState(false);const[error,setError]=useState(null);const{uuid}=useParams();const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));dispatch(fetchSellerCategory({...params,type,parent_id:state===null||state===void 0?void 0:state.parentId,shop_id:user===null||user===void 0?void 0:user.shop_id}));};},[]);const createImage=name=>{return{name,url:IMG_URL+name};};const getLanguageField=list=>Object.assign({},...list);const getCategory=alias=>{setLoading(true);sellerCategory.getById(alias).then(res=>{var _category$parent,_category$parent$tran;let category=res.data;const body={...category,title:getLanguageField(category.translations.map(translation=>({[translation.locale]:translation.title}))),description:getLanguageField(category.translations.map(translation=>({[translation.locale]:translation.description}))),image:[createImage(category.img)],keywords:category.keywords.split(','),id:category.id,parent_id:{label:(_category$parent=category.parent)===null||_category$parent===void 0?void 0:(_category$parent$tran=_category$parent.translation)===null||_category$parent$tran===void 0?void 0:_category$parent$tran.title,value:category.parent_id,key:category.parent_id},input:(category===null||category===void 0?void 0:category.input)||0};form.setFieldsValue(body);setImage([createImage(category.img)]);}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const onFinish=values=>{var _values$parent_id,_values$parent_id2;setLoadingBtn(true);const body={id:values.id,type:'category',data:{...values,type:(_values$parent_id=values.parent_id)!==null&&_values$parent_id!==void 0&&_values$parent_id.value?type:'main',active:values.active?1:0,keywords:values.keywords.join(','),parent_id:(_values$parent_id2=values.parent_id)===null||_values$parent_id2===void 0?void 0:_values$parent_id2.value,images:image===null||image===void 0?void 0:image.map(img=>img.name)}};const nextUrl='seller/categories';requestModelsService.requestChange(body).then(()=>{toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(setRefetch(activeMenu));navigate(`/${nextUrl}`,{state:{tab:'request'}});}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));};useEffect(()=>{getCategory(uuid);},[activeMenu.refetch,uuid,state===null||state===void 0?void 0:state.parentId]);async function fetchUserCategoryList(){const{id}=form.getFieldValue({});const params={perPage:100,type:'main'};return sellerCategory.selectPaginate(params).then(res=>res.data.filter(item=>item.id!==id).map(item=>{var _item$translation,_item$children;return{label:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id,key:item.id,type:'main',children:(_item$children=item.children)===null||_item$children===void 0?void 0:_item$children.map(el=>{var _el$translation,_el$children;return{label:(_el$translation=el.translation)===null||_el$translation===void 0?void 0:_el$translation.title,value:el.id,key:el.id,type:'sub_main',children:(_el$children=el.children)===null||_el$children===void 0?void 0:_el$children.map(three=>{var _three$translation;return{label:(_three$translation=three.translation)===null||_three$translation===void 0?void 0:_three$translation.title,value:three.id,key:three.id,disabled:true,type:'child'};})};})};}));}const handleCatrgory=(value,node)=>{const{type}=node||{};const nextType=type==='main'?'sub_main':type==='sub_main'?'child':'main';setType(nextType);};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Card,{title:state!==null&&state!==void 0&&state.parentId?t('edit.sub.category'):t('edit.category'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:!loading?/*#__PURE__*/_jsxs(Form,{name:\"basic\",layout:\"vertical\",onFinish:onFinish,initialValues:{active:true,...activeMenu.data},form:form,children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"id\",hidden:true,children:/*#__PURE__*/_jsx(InputNumber,{})}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,index)=>/*#__PURE__*/_jsx(Form.Item,{label:t('name'),name:['title',item.locale],help:error?error['title'][defaultLang]?error['title'][defaultLang][0]:null:null,validateStatus:error?'error':'success',rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},item.title+index))}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,index)=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:['description',item.locale],rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:4})},item.locale+index))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('keywords'),name:\"keywords\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{mode:\"tags\",style:{width:'100%'}})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('parent.category'),name:\"parent_id\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(AsyncTreeSelect,{fetchOptions:fetchUserCategoryList,onSelect:handleCatrgory,allowClear:true})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"input\",label:t('input'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,parser:value=>parseInt(value,10),max:32767,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),children:/*#__PURE__*/_jsx(MediaUpload,{type:\"categories\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:2,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center py-5\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"mt-5 pt-5\"})})})});};export default SellerCategoryEdit;","map":null,"metadata":{},"sourceType":"module"}