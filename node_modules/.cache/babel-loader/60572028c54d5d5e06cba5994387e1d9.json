{"ast":null,"code":"import React,{useCallback,useEffect,useState}from'react';import{Button,Card,Col,Descriptions,Row,Space,Spin}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useLocation,useNavigate,useParams}from'react-router-dom';import{removeFromMenu}from'../../../redux/slices/menu';import{fetchSellerProducts}from'../../../redux/slices/product';import{useTranslation}from'react-i18next';import productService from'../../../services/seller/product';import{IMG_URL}from'../../../configs/app-global';import requestModelsService from'services/seller/request-models';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const ProductFinish=_ref=>{var _productInfo$shop,_productInfo$category,_productInfo$brand,_productInfo$unit,_productInfo$images,_data$shop,_data$category,_data$brand,_data$unit,_data$galleries,_data$stocks;let{prev,isRequest,mode}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const navigate=useNavigate();const{state}=useLocation();const dispatch=useDispatch();const[data,setData]=useState({});const[loading,setLoading]=useState(null);const{uuid}=useParams();const{params}=useSelector(state=>state.product,shallowEqual);const[buttonLoadding,setButtonLoading]=useState(false);const{settings}=useSelector(state=>state.globalSettings);function finish(){const nextUrl='seller/products';const body={...params};if(isRequest&&activeMenu.data){setButtonLoading(true);const requestBody={id:activeMenu.data.model_id,type:'product',data:activeMenu.data};requestModelsService.requestChangeUpdate(activeMenu.data.request_id,requestBody).then(()=>{navigate(`/${nextUrl}`,{state:{tab:'request'}});toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchSellerProducts(body));}).finally(()=>{setButtonLoading(false);});return;}if(state&&mode==='edit'&&(settings===null||settings===void 0?void 0:settings.product_auto_approve)==='0'){setButtonLoading(true);const requestBody={type:'product',id:activeMenu.data.product_id,data:state};requestModelsService.requestChange(requestBody).then(()=>{toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchSellerProducts(body));navigate(`/${nextUrl}`,{state:{tab:'request'}});}).finally(()=>{setButtonLoading(false);});return;}dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchSellerProducts(body));navigate(`/${nextUrl}`);}function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description};});return Object.assign({},...result);}const fetchProduct=useCallback(uuid=>{setLoading(true);productService.getById(uuid).then(res=>{const data={...res.data,...getLanguageFields(res.data),properties:res.data.properties.map((item,index)=>({id:index,[`key[${item.locale}]`]:item.key,[`value[${item.locale}]`]:item.value})),translation:undefined,translations:undefined};setData(data);}).finally(()=>setLoading(false));},[uuid]);useEffect(()=>{if(!isRequest){fetchProduct(uuid);}},[isRequest,uuid]);const productInfo=isRequest?activeMenu.data:state;return!loading?/*#__PURE__*/_jsxs(Card,{children:[state||isRequest?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Descriptions,{title:t('product.info'),bordered:true,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('title')} (${defaultLang})`,span:3,children:productInfo[`title[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('description')} (${defaultLang})`,span:3,children:productInfo[`description[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('shop'),span:1.5,children:productInfo===null||productInfo===void 0?void 0:(_productInfo$shop=productInfo.shop)===null||_productInfo$shop===void 0?void 0:_productInfo$shop.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('category'),span:1.5,children:productInfo===null||productInfo===void 0?void 0:(_productInfo$category=productInfo.category)===null||_productInfo$category===void 0?void 0:_productInfo$category.label}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('brand'),span:1.5,children:productInfo===null||productInfo===void 0?void 0:(_productInfo$brand=productInfo.brand)===null||_productInfo$brand===void 0?void 0:_productInfo$brand.label}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('unit'),span:1.5,children:productInfo===null||productInfo===void 0?void 0:(_productInfo$unit=productInfo.unit)===null||_productInfo$unit===void 0?void 0:_productInfo$unit.label}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('images'),span:3,children:/*#__PURE__*/_jsx(Row,{gutter:12,children:productInfo===null||productInfo===void 0?void 0:(_productInfo$images=productInfo.images)===null||_productInfo$images===void 0?void 0:_productInfo$images.filter(item=>!item.isVideo).map((item,idx)=>/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"img\",{width:80,alt:\"product\",src:item.url})},'image'+idx))})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('tax'),children:productInfo===null||productInfo===void 0?void 0:productInfo.tax}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('min.quantity'),children:productInfo===null||productInfo===void 0?void 0:productInfo.min_qty}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('max.quantity'),children:productInfo===null||productInfo===void 0?void 0:productInfo.max_qty})]}),productInfo===null||productInfo===void 0?void 0:productInfo.stocks.map((item,idx)=>{var _item$ids;if(!item){return'';}return/*#__PURE__*/_jsxs(Descriptions,{bordered:true,className:\"mt-4\",children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:t('price'),span:2,children:item.price}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('quantity'),span:2,children:item.quantity}),item===null||item===void 0?void 0:(_item$ids=item.ids)===null||_item$ids===void 0?void 0:_item$ids.map((extra,idx)=>/*#__PURE__*/_jsx(Descriptions.Item,{label:productInfo===null||productInfo===void 0?void 0:productInfo.extras[idx].label,children:extra===null||extra===void 0?void 0:extra.label},'extra'+idx))]},'desc'+idx);})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Descriptions,{title:t('product.info'),bordered:true,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('title')} (${defaultLang})`,span:3,children:data[`title[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:`${t('description')} (${defaultLang})`,span:3,children:data[`description[${defaultLang}]`]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('shop'),span:1.5,children:(_data$shop=data.shop)===null||_data$shop===void 0?void 0:_data$shop.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('category'),span:1.5,children:(_data$category=data.category)===null||_data$category===void 0?void 0:_data$category.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('brand'),span:1.5,children:(_data$brand=data.brand)===null||_data$brand===void 0?void 0:_data$brand.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('unit'),span:1.5,children:(_data$unit=data.unit)===null||_data$unit===void 0?void 0:_data$unit.translation.title}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('images'),span:3,children:/*#__PURE__*/_jsx(Row,{gutter:12,children:data===null||data===void 0?void 0:(_data$galleries=data.galleries)===null||_data$galleries===void 0?void 0:_data$galleries.filter(item=>!item.preview).map((item,idx)=>/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"img\",{width:80,alt:\"product\",src:IMG_URL+item.path})},'image'+idx))})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('tax'),children:data.tax}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('min.quantity'),children:data.min_qty}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('max.quantity'),children:data.max_qty})]}),(_data$stocks=data.stocks)===null||_data$stocks===void 0?void 0:_data$stocks.map((item,idx)=>{if(!item){return'';}return/*#__PURE__*/_jsxs(Descriptions,{bordered:true,className:\"mt-4\",children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:t('price'),span:2,children:item.price}),/*#__PURE__*/_jsx(Descriptions.Item,{label:t('quantity'),span:2,children:item.quantity}),item.extras.map((extra,idx)=>{var _extra$group,_extra$group$translat,_extra$value;return/*#__PURE__*/_jsx(Descriptions.Item,{label:extra===null||extra===void 0?void 0:(_extra$group=extra.group)===null||_extra$group===void 0?void 0:(_extra$group$translat=_extra$group.translation)===null||_extra$group$translat===void 0?void 0:_extra$group$translat.title,children:extra===null||extra===void 0?void 0:(_extra$value=extra.value)===null||_extra$value===void 0?void 0:_extra$value.value},'extra'+idx);})]},'desc'+idx);})]}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex mt-4\",children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{onClick:prev,children:t('prev')}),/*#__PURE__*/_jsx(Button,{loading:buttonLoadding,type:\"primary\",onClick:finish,children:t('finish')})]})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})});};export default ProductFinish;","map":null,"metadata":{},"sourceType":"module"}