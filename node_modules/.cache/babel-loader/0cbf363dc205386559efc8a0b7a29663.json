{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useParams}from'react-router-dom';import{toast}from'react-toastify';import{Button,Card,Col,Form,Input,Row}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'../../../redux/slices/menu';import{useTranslation}from'react-i18next';import LanguageList from'../../../components/language-list';import getTranslationFields from'../../../helpers/getTranslationFields';import Map from'../../../components/map';import branchService from'../../../services/seller/branch';import{fetchBranch}from'../../../redux/slices/branch';import getDefaultLocation from'../../../helpers/getDefaultLocation';import{usePlacesWidget}from'react-google-autocomplete';import{MAP_API_KEY}from'../../../configs/app-global';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const SellerBranchEdit=()=>{const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const navigate=useNavigate();const{id}=useParams();const{settings}=useSelector(state=>state.globalSettings,shallowEqual);const{google_map_key}=useSelector(state=>state.globalSettings.settings,shallowEqual);const[location,setLocation]=useState(getDefaultLocation(settings));const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);data.open_time=JSON.stringify(data===null||data===void 0?void 0:data.open_time);data.close_time=JSON.stringify(data===null||data===void 0?void 0:data.close_time);dispatch(setMenuData({activeMenu,data}));};},[]);function getLanguageFields(data){if(!data){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title};});return Object.assign({},...result);}const getBranch=id=>{setLoading(true);branchService.getById(id).then(res=>{var _branch$address;let branch=res.data;setLocation({lat:Number(branch===null||branch===void 0?void 0:branch.location.latitude),lng:Number(branch===null||branch===void 0?void 0:branch.location.longitude)});form.setFieldsValue({...branch,...getLanguageFields(branch),address:(_branch$address=branch.address)===null||_branch$address===void 0?void 0:_branch$address.address});}).finally(()=>{dispatch(disableRefetch(activeMenu));setLoading(false);});};const onFinish=values=>{const body={title:getTranslationFields(languages,values,'title'),address:{address:values.address,office:null,house:null,floor:null},location:{longitude:location.lng,latitude:location.lat}};setLoadingBtn(true);const nextUrl='seller/branch';branchService.update(id,body).then(()=>{toast.success(t('successfully.created'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchBranch());}).finally(()=>setLoadingBtn(false));};useEffect(()=>{if(activeMenu.refetch){getBranch(id);}},[activeMenu.refetch]);const{ref}=usePlacesWidget({apiKey:google_map_key||MAP_API_KEY,onPlaceSelected:place=>{const location={lat:place===null||place===void 0?void 0:place.geometry.location.lat(),lng:place===null||place===void 0?void 0:place.geometry.location.lng()};setLocation(location);form.setFieldsValue({[`address[${defaultLang}]`]:place===null||place===void 0?void 0:place.formatted_address});}});return/*#__PURE__*/_jsx(Card,{loading:loading,title:t('edit.branch'),className:\"h-100\",extra:/*#__PURE__*/_jsx(LanguageList,{}),children:/*#__PURE__*/_jsxs(Form,{name:\"branch-add\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{...activeMenu.data},className:\"d-flex flex-column h-100\",children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'title'+idx))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('address'),name:`address`,rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(\"input\",{className:\"address-input\",ref:ref,placeholder:''})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Map,{location:location,setLocation:setLocation,setAddress:value=>form.setFieldsValue({address:value})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex flex-column justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})})})]})});};export default SellerBranchEdit;","map":null,"metadata":{},"sourceType":"module"}