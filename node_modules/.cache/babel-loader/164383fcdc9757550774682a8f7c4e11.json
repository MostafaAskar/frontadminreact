{"ast":null,"code":"import React,{useState,useEffect}from'react';import{shallowEqual,useDispatch,useSelector}from'react-redux';import LanguageList from'../../components/language-list';import{useTranslation}from'react-i18next';import{steps}from'./steps';import{Card,Steps}from'antd';import UserEdit from'./user';import{useQueryParams}from'../../helpers/useQueryParams';import{disableRefetch,setMenuData}from'../../redux/slices/menu';import restaurantService from'../../services/restaurant';import{useParams}from'react-router-dom';import Loading from'../../components/loading';import RestaurantMain from'./main';import RestaurantDelivery from'./restaurantDelivery';import Map from'../../components/shop/map';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{Step}=Steps;const RestaurantEdit=()=>{var _queryParams$values;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const queryParams=useQueryParams();const current=Number(((_queryParams$values=queryParams.values)===null||_queryParams$values===void 0?void 0:_queryParams$values.step)||0);const[loading,setLoading]=useState(activeMenu.refetch);const dispatch=useDispatch();const{uuid}=useParams();const{languages}=useSelector(state=>state.formLang,shallowEqual);const next=()=>{const step=current+1;queryParams.set('step',step);};const prev=()=>{const step=current-1;queryParams.set('step',step);};const onChange=step=>{dispatch(setMenuData({activeMenu,data:{...activeMenu.data,step}}));queryParams.set('step',step);};const fetchRestaurant=uuid=>{setLoading(true);restaurantService.getById(uuid).then(res=>{var _res$data,_res$data2,_res$data3,_res$data4,_res$data4$categories,_res$data5;const data={...res.data,...getLanguageFields(res.data),logo_img:createImages(res.data.logo_img),background_img:createImages(res.data.background_img),user:{label:res.data.seller.firstname+' '+res.data.seller.lastname,value:res.data.seller.id},delivery_time_from:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.delivery_time.from,delivery_time_to:(_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.delivery_time.to,delivery_time_type:(_res$data3=res.data)===null||_res$data3===void 0?void 0:_res$data3.delivery_time.type,recommended:res.data.mark==='recommended',categories:(_res$data4=res.data)===null||_res$data4===void 0?void 0:(_res$data4$categories=_res$data4.categories)===null||_res$data4$categories===void 0?void 0:_res$data4$categories.map(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id,key:item.id};}),tags:(_res$data5=res.data)===null||_res$data5===void 0?void 0:_res$data5.tags.map(item=>{var _item$translation2;return{label:item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title,value:item.id,key:item.id};})};dispatch(setMenuData({activeMenu,data}));}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const createImages=items=>{return{items,uid:items,url:items,name:items};};function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2,_translations$find3;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description,[`address[${item.locale}]`]:(_translations$find3=translations.find(el=>el.locale===item.locale))===null||_translations$find3===void 0?void 0:_translations$find3.address};});return Object.assign({},...result);}useEffect(()=>{if(activeMenu.refetch&&uuid){fetchRestaurant(uuid);}},[activeMenu.refetch]);return/*#__PURE__*/_jsxs(Card,{title:t('restaurant.edit'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:[/*#__PURE__*/_jsx(Steps,{current:current,onChange:onChange,children:steps.map(item=>/*#__PURE__*/_jsx(Step,{title:t(item.title)},item.title))}),!loading?/*#__PURE__*/_jsxs(\"div\",{className:\"steps-content\",children:[steps[current].content==='First-content'&&/*#__PURE__*/_jsx(RestaurantMain,{next:next,loading:loading,action_type:'edit',user:true}),steps[current].content==='Second-content'&&/*#__PURE__*/_jsx(Map,{next:next,prev:prev}),steps[current].content==='Third-content'&&/*#__PURE__*/_jsx(RestaurantDelivery,{next:next,prev:prev}),steps[current].content==='Four-content'&&/*#__PURE__*/_jsx(UserEdit,{next:next,prev:prev})]}):/*#__PURE__*/_jsx(Loading,{})]});};export default RestaurantEdit;","map":null,"metadata":{},"sourceType":"module"}