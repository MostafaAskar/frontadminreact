{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{Button,Space,Card}from'antd';import{useNavigate}from'react-router-dom';import{ClearOutlined}from'@ant-design/icons';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{addMenu,disableRefetch,setMenuData}from'../../../redux/slices/menu';import{useTranslation}from'react-i18next';import useDidUpdate from'../../../helpers/useDidUpdate';import{fetchOrders,handleSearch}from'../../../redux/slices/waiterOrder';import SearchInput from'../../../components/search-input';import userService from'../../../services/seller/user';import{fetchRestOrderStatus}from'../../../redux/slices/orderStatus';import DeleteButton from'../../../components/delete-button';import{Context}from'../../../context/context';import{toast}from'react-toastify';import orderService from'../../../services/waiter/order';import Incorporate from'./dnd/Incorporate';import{clearItems,fetchAcceptedOrders,fetchCanceledOrders,fetchDeliveredOrders,fetchNewOrders,fetchOnAWayOrders,fetchReadyOrders}from'../../../redux/slices/waiterOrder';import{batch}from'react-redux';import OrderDeliveryman from'./orderDeliveryman';import{clearOrder}from'../../../redux/slices/order';import ShowLocationsMap from'./show-locations.map';import DownloadModal from'./downloadModal';import CustomModal from'../../../components/modal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function SellerOrdersBoard(){const dispatch=useDispatch();const navigate=useNavigate();const{t}=useTranslation();const[id,setId]=useState(null);const{setIsModalVisible}=useContext(Context);const[text,setText]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const[locationsMap,setLocationsMap]=useState(null);const[dowloadModal,setDowloadModal]=useState(null);const[orderDeliveryDetails,setOrderDeliveryDetails]=useState(null);const[type,setType]=useState(null);const goToShow=row=>{dispatch(addMenu({url:`waiter/order/details/${row.id}`,id:'order_details',name:t('order.details')}));navigate(`/waiter/order/details/${row.id}`);};const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const data=activeMenu===null||activeMenu===void 0?void 0:activeMenu.data;const paramsData={search:data===null||data===void 0?void 0:data.search,// sort: data?.sort,\n// column: data?.column,\nperPage:(data===null||data===void 0?void 0:data.perPage)||5,page:(data===null||data===void 0?void 0:data.page)||1,user_id:data===null||data===void 0?void 0:data.userId,status:data===null||data===void 0?void 0:data.status};const orderDelete=()=>{setLoadingBtn(true);const params={...Object.assign({},...id.map((item,index)=>({[`ids[${index}]`]:item})))};orderService.delete(params).then(()=>{dispatch(clearItems());toast.success(t('successfully.deleted'));setIsModalVisible(false);fetchOrderAllItem({status:type});setText(null);}).finally(()=>setLoadingBtn(false));};useDidUpdate(()=>{// dispatch(handleSearch(paramsData));\ndispatch(clearItems());fetchOrderAllItem();},[data]);useEffect(()=>{if(activeMenu!==null&&activeMenu!==void 0&&activeMenu.refetch){dispatch(fetchOrders(paramsData));dispatch(fetchRestOrderStatus());dispatch(disableRefetch(activeMenu));}},[activeMenu===null||activeMenu===void 0?void 0:activeMenu.refetch]);const handleFilter=(item,name)=>{dispatch(clearItems());dispatch(setMenuData({activeMenu,data:{...data,[name]:item}}));};async function getUsers(search){const params={search,perPage:10};return userService.getAll(params).then(_ref=>{let{data}=_ref;return data.map(item=>({label:`${item.firstname} ${item.lastname||''}`,value:item.id}));});}const allDelete=()=>{if(id===null||id.length===0){toast.warning(t('select.the.product'));}else{setIsModalVisible(true);setText(false);}};const fetchOrdersCase=params=>{const paramsWithType={...paramsData,...params};switch(params.status){case'new':dispatch(fetchNewOrders(paramsWithType));break;case'accepted':dispatch(fetchAcceptedOrders(paramsWithType));break;case'ready':dispatch(fetchReadyOrders(paramsWithType));break;case'on_a_way':dispatch(fetchOnAWayOrders(paramsWithType));break;case'delivered':dispatch(fetchDeliveredOrders(paramsWithType));break;case'canceled':dispatch(fetchCanceledOrders(paramsWithType));break;default:console.log(`Sorry, we are out of`);}};const fetchOrderAllItem=()=>{fetchOrdersCase({status:'new'});fetchOrdersCase({status:'accepted'});fetchOrdersCase({status:'ready'});fetchOrdersCase({status:'on_a_way'});fetchOrdersCase({status:'delivered'});fetchOrdersCase({status:'canceled'});};const handleClear=()=>{batch(()=>{dispatch(clearItems());dispatch(setMenuData({activeMenu,data:null}));});fetchOrderAllItem();};const handleCloseModal=()=>{setOrderDeliveryDetails(null);setLocationsMap(null);setDowloadModal(null);};const goToAddOrder=()=>{dispatch(clearOrder());dispatch(addMenu({id:'pos.system',url:'seller/pos-system',name:t('add.order')}));navigate('/seller/pos-system');};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[/*#__PURE__*/_jsx(SearchInput,{placeholder:t('search'),resetSearch:!(data!==null&&data!==void 0&&data.search),handleChange:search=>handleFilter(search,'search'),defaultValue:data===null||data===void 0?void 0:data.search}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(ClearOutlined,{}),onClick:handleClear,children:t('clear')})]})}),/*#__PURE__*/_jsx(Incorporate,{goToShow:goToShow,fetchOrderAllItem:fetchOrderAllItem,fetchOrders:fetchOrdersCase,setLocationsMap:setLocationsMap,setId:setId,setIsModalVisible:setIsModalVisible,setText:setText,setDowloadModal:setDowloadModal,type:type,setType:setType}),/*#__PURE__*/_jsx(CustomModal,{click:orderDelete,text:text?t('delete'):t('all.delete'),loading:loadingBtn,setText:setId,setActive:setId}),orderDeliveryDetails&&/*#__PURE__*/_jsx(OrderDeliveryman,{orderDetails:orderDeliveryDetails,handleCancel:handleCloseModal}),locationsMap&&/*#__PURE__*/_jsx(ShowLocationsMap,{id:locationsMap,handleCancel:handleCloseModal}),dowloadModal&&/*#__PURE__*/_jsx(DownloadModal,{id:dowloadModal,handleCancel:handleCloseModal})]});}","map":null,"metadata":{},"sourceType":"module"}