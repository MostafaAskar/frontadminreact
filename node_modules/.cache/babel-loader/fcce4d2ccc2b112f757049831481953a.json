{"ast":null,"code":"import{Button,Card,Col,DatePicker,Form,Row,Space,Switch,Tag}from'antd';import React,{useState,useEffect}from'react';import{useTranslation}from'react-i18next';import Loading from'components/loading';import moment from'moment';import workingDays from'services/seller/workingDays';import closeDates from'services/seller/closedDays';import{useNavigate}from'react-router-dom';import{weeks}from'components/shop/weeks';import{DayPicker}from'react-day-picker';import{CheckOutlined,CloseOutlined}from'@ant-design/icons';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{removeFromMenu}from'redux/slices/menu';import{fetchMyShop}from'redux/slices/myShop';import{BsChevronCompactDown,BsChevronCompactUp}from'react-icons/bs';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const Delivery=_ref=>{let{next,prev}=_ref;const[form]=Form.useForm();const{t}=useTranslation();const[days,setDays]=useState([]);const[lines,setLines]=useState(new Array(7).fill(false));const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);const{myShop:shop}=useSelector(state=>state.myShop,shallowEqual);const navigate=useNavigate();const dispatch=useDispatch();const disabledDays=[{from:new Date(1900,4,18),to:new Date(moment().subtract(1,'days'))}];const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[list,setList]=useState(true);const onFinish=values=>{setLoadingBtn(true);const closeDatesBody={dates:days?days.map(item=>moment(item).format('YYYY-MM-DD')):undefined};const workingDaysBody={dates:values.working_days.map(item=>({day:item.title,from:moment(item.from?item.from:'00').format('HH:mm'),to:moment(item.to?item.to:'00').format('HH:mm'),disabled:item.disabled}))};const nextUrl='my-shop';closeDates.update(shop.uuid,closeDatesBody).then(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchMyShop());}).finally(()=>setLoadingBtn(false));if(values.working_days.length!==0){workingDays.update(shop.uuid,workingDaysBody).then(()=>{dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchMyShop());}).finally(()=>setLoadingBtn(false));}};const getDays=()=>{setLoading(true);closeDates.getById(shop.uuid).then(res=>{setDays(res.data.closed_dates.filter(date=>date.day>moment(new Date()).format('YYYY-MM-DD')).map(itm=>new Date(itm.day)));});workingDays.getById(shop.uuid).then(res=>{setLines(res.data.dates.length!==0?res.data.dates.map(item=>item.disabled):[]);res.data.dates.length!==0&&form.setFieldsValue({working_days:res.data.dates.map(item=>({title:item.day,from:moment(item.from,'HH:mm:ss'),to:moment(item.to,'HH:mm:ss'),disabled:Boolean(item.disabled)}))});}).finally(()=>setLoading(false));};useEffect(()=>{form.setFieldsValue({working_days:weeks});if(shop.uuid){getDays();}},[]);const deleteDay=e=>setDays(days.filter(item=>item!==e));const footer=days&&days.length>0?/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Tag,{style:{fontSize:14,padding:'4px 10px',width:'100%',marginTop:'10px'},children:t('Your.existing.vacations')}),/*#__PURE__*/_jsxs(Col,{span:24,className:\"mt-2\",children:[days.slice(0,list?1:days.length).map((item,index)=>/*#__PURE__*/_jsxs(Space,{className:\"d-flex justify-content-between\",style:{borderBottom:'1px solid #4D5B75'},children:[/*#__PURE__*/_jsx(Col,{span:24,style:{fontSize:14,marginTop:'8px'},children:moment(item).format('YYYY-MM-DD')}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Tag,{color:\"red\",className:\"cursor-pointer mt-3 mb-2\",style:{fontSize:14},onClick:()=>deleteDay(item),children:t('remove')})})]},index)),/*#__PURE__*/_jsx(Button,{className:\"mt-3 w-100\",onClick:()=>{setList(!list);},children:list?/*#__PURE__*/_jsx(BsChevronCompactDown,{}):/*#__PURE__*/_jsx(BsChevronCompactUp,{})})]})]}):/*#__PURE__*/_jsx(Tag,{style:{fontSize:14,padding:'4px 10px',width:'100%'},children:\"Please pick one or more days.\"});const handleChange=idx=>{const newLines=[...lines];newLines[idx]=!lines[idx];setLines(newLines);};const middle=(start,end)=>{const result=[];for(let i=start;i<end;i++){result.push(i);}return result;};const disabledDateTime=()=>({disabledHours:()=>middle(0,1),disabledMinutes:()=>middle(0,0),disabledSeconds:()=>middle(0,60)});return/*#__PURE__*/_jsx(_Fragment,{children:!loading?/*#__PURE__*/_jsx(Form,{form:form,layout:\"vertical\",onFinish:onFinish,children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{span:13,children:/*#__PURE__*/_jsx(Card,{title:t('restaurant.working.days'),children:/*#__PURE__*/_jsx(Row,{gutter:8,children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.List,{name:\"working_days\",children:fields=>{return/*#__PURE__*/_jsx(\"div\",{children:fields.map((field,index)=>/*#__PURE__*/_jsxs(Row,{gutter:12,align:\"center\",children:[/*#__PURE__*/_jsx(Col,{span:7,children:/*#__PURE__*/_jsx(Form.Item,{name:[index,'day'],children:/*#__PURE__*/_jsx(\"span\",{children:t(weeks[index].title)})})}),lines[field.key]?/*#__PURE__*/_jsx(Col,{span:13,className:\"mt-2\",children:/*#__PURE__*/_jsx(\"span\",{children:t('shop.closed')})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Col,{span:7,children:/*#__PURE__*/_jsx(Form.Item,{rules:[{required:lines[field.key]===false}],name:[index,'from'],children:/*#__PURE__*/_jsx(DatePicker,{disabledTime:disabledDateTime,picker:\"time\",placeholder:t('start.time')})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Form.Item,{rules:[{required:lines[field.key]===false}],name:[index,'to'],children:/*#__PURE__*/_jsx(DatePicker,{disabledTime:disabledDateTime,picker:\"time\",placeholder:t('end.time')})})})]}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{name:[index,'disabled'],valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{checkedChildren:/*#__PURE__*/_jsx(CheckOutlined,{}),unCheckedChildren:/*#__PURE__*/_jsx(CloseOutlined,{}),checked:lines[field.key],onChange:()=>handleChange(field.key)})})})]},field.key))});}})})})})}),/*#__PURE__*/_jsx(Col,{span:11,children:/*#__PURE__*/_jsxs(Card,{title:t('restaurant.closed.days'),children:[/*#__PURE__*/_jsx(\"p\",{children:\"If you can't answer the buyer's questions in time and want to share this information with your buyers, you can add the dates here.\"}),/*#__PURE__*/_jsx(Form.Item,{rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(DayPicker,{className:\"datepicker\",mode:\"multiple\",disabled:disabledDays,min:1,selected:days,onSelect:setDays,footer:footer,showOutsideDays:true})})]})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')}),/*#__PURE__*/_jsx(Button,{htmlType:\"submit\",onClick:()=>prev(),children:t('prev')})]})})]})}):/*#__PURE__*/_jsx(Loading,{})});};export default Delivery;","map":null,"metadata":{},"sourceType":"module"}