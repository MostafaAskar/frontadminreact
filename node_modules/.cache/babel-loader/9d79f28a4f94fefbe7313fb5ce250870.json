{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Space,Table,Image,Card}from'antd';import{DeleteOutlined,EditOutlined,PlusCircleOutlined}from'@ant-design/icons';import{toast}from'react-toastify';import{useTranslation}from'react-i18next';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{fetchPropertyValues}from'redux/slices/propertyValue';import propertyService from'services/property';import PropertyValueModal from'./property-value-modal';import PropertyDeleteModal from'./property-delete-modal';import DeleteButton from'components/delete-button';import{IMG_URL}from'configs/app-global';import{disableRefetch,setMenuData}from'redux/slices/menu';import FilterColumns from'components/filter-column';import{InfiniteSelect}from'components/infinite-select';import useDidUpdate from'helpers/useDidUpdate';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function PropertyValue(){var _activeMenu$data2;const{t}=useTranslation();const dispatch=useDispatch();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{propertyGroups}=useSelector(state=>state.propertyGroup,shallowEqual);const{propertyValues,loading}=useSelector(state=>state.propertyValue,shallowEqual);const[id,setId]=useState(null);const[modal,setModal]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const[columns,setColumns]=useState([{title:t('id'),dataIndex:'id',key:'id',is_show:true},{title:t('title'),dataIndex:'group',key:'group',is_show:true,render:group=>{var _group$translation;return group===null||group===void 0?void 0:(_group$translation=group.translation)===null||_group$translation===void 0?void 0:_group$translation.title;}},{title:t('value'),dataIndex:'value',key:'value',is_show:true,render:(value,row)=>/*#__PURE__*/_jsxs(Space,{className:\"extras\",children:[row.group.type==='color'?/*#__PURE__*/_jsx(\"div\",{className:\"extra-color-wrapper-contain\",style:{backgroundColor:row.value}}):null,row.group.type==='image'?/*#__PURE__*/_jsx(Image,{width:100,src:IMG_URL+row.value,className:\"borderRadius\"}):null,row.group.type==='image'?null:/*#__PURE__*/_jsx(\"span\",{children:row.value})]})},{title:t('options'),is_show:true,render:record=>/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(EditOutlined,{}),onClick:()=>setModal(record)}),/*#__PURE__*/_jsx(DeleteButton,{type:\"primary\",danger:true,icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),onClick:()=>setId([record.id])})]})}]);const handleCancel=()=>setModal(null);const deleteProperty=()=>{setLoadingBtn(true);const params={...Object.assign({},...id.map((item,index)=>({[`ids[${index}]`]:item})))};propertyService.deleteValue(params).then(()=>{toast.success(t('successfully.deleted'));setId(null);dispatch(fetchPropertyValues());}).finally(()=>setLoadingBtn(false));};useDidUpdate(()=>{var _activeMenu$data;dispatch(fetchPropertyValues({group_id:activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.group_id}));},[activeMenu.data]);useEffect(()=>{if(activeMenu.refetch){dispatch(fetchPropertyValues());dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);async function fetchPropertyGroups(_ref){let{search,page}=_ref;const params={search:(search===null||search===void 0?void 0:search.length)===0?undefined:search,page:page};return propertyService.getAllGroups(params).then(res=>{return res.data.map(item=>{var _item$translation;return{label:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id};});});}const handleFilter=items=>{const data=activeMenu.data;dispatch(setMenuData({activeMenu,data:{...data,...items}}));};return/*#__PURE__*/_jsxs(Card,{title:t('property.value'),extra:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[/*#__PURE__*/_jsx(InfiniteSelect,{placeholder:t('select.group'),fetchOptions:fetchPropertyGroups,loading:loading,style:{minWidth:180},onChange:e=>handleFilter({group_id:e===null||e===void 0?void 0:e.value}),value:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.group_id}),/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),onClick:()=>setModal({}),children:t('add.property')}),/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})]}),children:[/*#__PURE__*/_jsx(Table,{scroll:{x:true},loading:loading,columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:propertyValues,rowKey:record=>record.id,pagination:false}),modal&&/*#__PURE__*/_jsx(PropertyValueModal,{modal:modal,handleCancel:handleCancel}),id&&/*#__PURE__*/_jsx(PropertyDeleteModal,{id:id,click:deleteProperty,text:t('delete.property'),loading:loadingBtn,handleClose:()=>setId(null)})]});}","map":null,"metadata":{},"sourceType":"module"}