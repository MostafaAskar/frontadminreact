{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{Button,Card,Col,DatePicker,Form,Input,Row,Select}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{removeFromMenu,setMenuData}from'../../redux/slices/menu';import{useTranslation}from'react-i18next';import TextEditor from'./textEditor';import moment from'moment';import messageSubscriberService from'../../services/messageSubscriber';import{fetchMessageSubscriber}from'../../redux/slices/messegeSubscriber';import emailService from'../../services/emailSettings';import{DebounceSelect}from'../../components/search';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const options=[{title:'order',value:'order'},{title:'subscribe',value:'subscribe'},{title:'verify',value:'verify'}];const MessageSubciribedAdd=()=>{const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[form]=Form.useForm();const navigate=useNavigate();const[loadingBtn,setLoadingBtn]=useState(false);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const{subscribers}=useSelector(state=>state.messageSubscriber,shallowEqual);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));};},[]);const fetchEmailProvider=()=>{return emailService.get().then(_ref=>{let{data}=_ref;return data.map(item=>({label:item.host,value:item.id}));});};const onFinish=values=>{const body={...values,type:values.type,email_setting_id:values.email_setting_id.value,send_to:moment(values.send_to).format('YYYY-MM-DD HH:mm:ss')};setLoadingBtn(true);const nextUrl='message/subscriber';messageSubscriberService.create(body).then(()=>{toast.success(t('successfully.created'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);dispatch(fetchMessageSubscriber());}).finally(()=>setLoadingBtn(false));};const getInitialValues=()=>{const data=activeMenu.data;if(!(data!==null&&data!==void 0&&data.send_to)){return data;}const start=data.send_to;return{...data,send_to:moment(start,'YYYY-MM-DD')};};return/*#__PURE__*/_jsx(Card,{title:t('add.subscriber'),className:\"h-100\",children:/*#__PURE__*/_jsxs(Form,{name:\"subscriber-add\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{...activeMenu.data,...getInitialValues()},className:\"d-flex flex-column h-100\",children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('subject'),name:\"subject\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('type'),name:\"type\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{options:options.filter(i=>!subscribers.some(e=>e.type===i.value)),className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('email.setting.id'),name:\"email_setting_id\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchEmailProvider,className:\"w-100\",placeholder:t('email.setting.id')})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(TextEditor,{languages:languages,form:form,lang:defaultLang})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('alt.body'),name:\"alt_body\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('send.to'),name:\"send_to\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{showTime:true,className:\"w-100\",disabledDate:current=>moment().add(-1,'days')>=current})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex flex-column justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('send')})})})]})});};export default MessageSubciribedAdd;","map":null,"metadata":{},"sourceType":"module"}