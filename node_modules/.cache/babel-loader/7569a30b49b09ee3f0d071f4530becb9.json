{"ast":null,"code":"import React,{useState}from'react';import{Button,Card,Col,Form,Input,Row}from'antd';import{DebounceSelect}from'../../components/search';import MediaUpload from'../../components/upload';import{useTranslation}from'react-i18next';import{shallowEqual,useSelector}from'react-redux';import productService from'services/product';import VideoUploaderWithModal from'components/video-uploader';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function BannerForm(_ref){var _activeMenu$data,_activeMenu$data2;let{form,handleSubmit}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);//states\nconst[image,setImage]=useState(((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.img.filter(item=>!item.isVideo))||[]);const[loadingBtn,setLoadingBtn]=useState(false);const[mediaList,setMediaList]=useState((activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.initialMediaFile)||{images:[],previews:[]});//functions\nfunction fetchProductsOptions(search){const params={search,perPage:10,status:'published'};return productService.getAll(params).then(res=>formatProduct(res.data));}//helper functions\nfunction formatProduct(data){return data.map(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id,key:item.id};});}//submit form\nconst onFinish=values=>{setLoadingBtn(true);handleSubmit(values,image,mediaList).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsx(Form,{name:\"banner-form\",layout:\"vertical\",onFinish:onFinish,form:form,initialValues:{clickable:true,...activeMenu.data},className:\"d-flex flex-column h-100\",children:/*#__PURE__*/_jsxs(Row,{gutter:[24,24],children:[/*#__PURE__*/_jsx(Col,{span:16,children:/*#__PURE__*/_jsxs(Row,{gutter:[24,24],children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:t('images'),className:\"h-100\",children:/*#__PURE__*/_jsx(Form.Item,{rules:[{required:!image.length,message:t('required')}],label:t('image'),name:\"images\",children:/*#__PURE__*/_jsx(MediaUpload,{type:\"banners\",imageList:image,setImageList:setImage,form:form,length:\"1\",multiple:false})})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:t('video'),className:\"h-100\",children:/*#__PURE__*/_jsx(VideoUploaderWithModal,{name:\"banners\",form:form,mediaList:mediaList,setMediaList:setMediaList})})})]})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsxs(Card,{title:t('basic.info'),className:\"h-100\",children:[languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')},{validator(_,value){if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{maxLength:50})},'title'+item.locale)),languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:`description[${item.locale}]`,rules:[{required:item.locale===defaultLang,message:t('required')},{validator(_,value){if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<5){return Promise.reject(new Error(t('must.be.at.least.5')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input.TextArea,{maxLength:150})},'description'+item.locale)),/*#__PURE__*/_jsx(Form.Item,{label:t('products'),name:'products',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{mode:\"multiple\",fetchOptions:fetchProductsOptions,debounceTimeout:200})})]})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})})})})]})});}","map":null,"metadata":{},"sourceType":"module"}