{"ast":null,"code":"import{Button,Card,Col,DatePicker,Form,Input,InputNumber,Row,Space}from'antd';import TextArea from'antd/lib/input/TextArea';import moment from'moment';import React,{useState,useEffect}from'react';import{useTranslation}from'react-i18next';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{toast}from'react-toastify';import{disableRefetch,setMenuData}from'../../redux/slices/menu';import referralService from'../../services/referral';import{fetchSettings as getSettings}from'../../redux/slices/globalSettings';import LanguageList from'../../components/language-list';import MediaUpload from'../../components/upload';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ReferalSetting=()=>{var _activeMenu$data,_activeMenu$data2;const{t}=useTranslation();const[form]=Form.useForm();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const{settings}=useSelector(state=>state.globalSettings);const referral=Number(settings.referral_active);const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const[image,setImage]=useState((_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.logo_img?[(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.logo_img]:[]);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);data.expired_at=JSON.stringify(data===null||data===void 0?void 0:data.expired_at);dispatch(setMenuData({activeMenu,data:data}));};},[]);function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2,_translations$find3;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description,[`faq[${item.locale}]`]:(_translations$find3=translations.find(el=>el.locale===item.locale))===null||_translations$find3===void 0?void 0:_translations$find3.faq};});return Object.assign({},...result);}function fetchSettings(){setLoading(true);referralService.get().then(res=>{const data=res.data[0];const result={...getLanguageFields(data),price_from:data.price_from,price_to:data.price_to,expired_at:data.expired_at?moment(data.expired_at):undefined,active:data.active,image:[createImages(data.img)]};form.setFieldsValue(result);setImage([createImages(data.img)]);}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});}const createImages=items=>{return{items,uid:items,url:items,name:items};};const onFinish=values=>{const data={...values,expired_at:moment(values.expired_at).format('YYYY-MM-DD'),img:image[0].name};setLoadingBtn(true);referralService.update(data).then(()=>{toast.success(t('successfully.updated'));dispatch(getSettings());}).finally(()=>setLoadingBtn(false));};const getInitialTimes=()=>{var _activeMenu$data3,_activeMenu$data4;if(!((_activeMenu$data3=activeMenu.data)!==null&&_activeMenu$data3!==void 0&&_activeMenu$data3.expired_at)){return{};}const data=JSON.parse((_activeMenu$data4=activeMenu.data)===null||_activeMenu$data4===void 0?void 0:_activeMenu$data4.expired_at);return{expired_at:moment(data,'HH:mm:ss')};};useEffect(()=>{if(activeMenu.refetch){fetchSettings();}},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:t('referral.settings'),loading:loading,extra:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(LanguageList,{}),/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),loading:loadingBtn,disabled:referral!==1,children:t('save')})]}),children:/*#__PURE__*/_jsx(Form,{layout:\"vertical\",initialValues:{...activeMenu.data,active:true,...getInitialTimes()},form:form,onFinish:onFinish,name:\"referral-settings\",children:/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:24,children:referral!==1?/*#__PURE__*/_jsx(\"h3\",{className:\"text-center mt-2 mb-4\",children:t('no.active.referral')}):null}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{disabled:referral!==1})},'title'+idx))}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:`description[${item.locale}]`,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<5){return Promise.reject(new Error(t('must.be.at.least.5')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:3,disabled:referral!==1})},'description'+idx))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"price_from\",label:t('sender.price'),rules:[{required:true,message:t('required')},{type:'number',min:0,message:t('must.be.positive')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",disabled:referral!==1})})}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,idx)=>/*#__PURE__*/_jsx(Form.Item,{label:t('terms'),name:`faq[${item.locale}]`,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:3,disabled:referral!==1})},'terms'+idx))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"price_to\",label:t('distribution.price'),rules:[{required:true,message:t('required')},{type:'number',min:0,message:t('must.be.positive')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",disabled:referral!==1})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{name:\"expired_at\",label:t('expired.at'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{className:\"w-100\",disabledDate:current=>moment().add(-1,'days')>=current,disabled:referral!==1})})}),/*#__PURE__*/_jsx(Col,{span:12,disabled:referral!==1,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),disabled:referral!==1,name:\"images\",rules:[{required:image.length===0,message:t('required')}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"referral\",imageList:image,setImageList:setImage,form:form,multiple:false,name:\"referral\",disabled:referral!==1})})})]})})});};export default ReferalSetting;","map":null,"metadata":{},"sourceType":"module"}