{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Card,Col,Row,Space,Spin}from'antd';import brandService from'services/brand';import categoryService from'services/category';import Meta from'antd/lib/card/Meta';import getImage from'helpers/getImage';import{PlusOutlined}from'@ant-design/icons';import OrderItems from'./orderItems';import{DebounceSelect}from'components/search';import SearchInput from'components/search-input';import ExtrasModal from'./extrasModal';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{toast}from'react-toastify';import{fetchRestProducts}from'../../redux/slices/product';import{useTranslation}from'react-i18next';import shopService from'services/shop';import{clearOrderItems,setCurrentShop}from'redux/slices/order';import{useParams}from'react-router-dom';import{BsFillGiftFill}from'react-icons/bs';import RiveResult from'components/rive-result';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ProductInfo=_ref=>{let{form}=_ref;const{t}=useTranslation();const[brand,setBrand]=useState(null);const[category,setCategory]=useState(null);const[search,setSearch]=useState(null);const[extrasModal,setExtrasModal]=useState(null);const{id}=useParams();const dispatch=useDispatch();const{data}=useSelector(state=>state.order,shallowEqual);const{products,loading}=useSelector(state=>state.product,shallowEqual);useEffect(()=>{var _data$shop;const params={perPage:10,page:1,brand_id:brand===null||brand===void 0?void 0:brand.value,category_id:category===null||category===void 0?void 0:category.value,search,shop_id:(_data$shop=data.shop)===null||_data$shop===void 0?void 0:_data$shop.value,active:1};dispatch(fetchRestProducts(params));},[brand,category,search,data.shop]);async function fetchBrands(search){return brandService.search(search).then(_ref2=>{let{data}=_ref2;return data.map(item=>({label:item.title,value:item.id}));});}async function fetchCategories(search){const params={search,type:'main'};return categoryService.search(params).then(_ref3=>{let{data}=_ref3;return data.map(item=>{var _item$translation;return{label:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id};});});}const addProductToCart=item=>{if(!data.currency){toast.warning(t('please.select.currency'));return;}if(!data.address){toast.warning(t('please.select.address'));return;}if(!data.deliveries){toast.warning(t('please.select.delivery'));return;}setExtrasModal(item);};async function fetchShops(search){const params={search,status:'approved'};return shopService.getAll(params).then(_ref4=>{let{data}=_ref4;return data.map(item=>{var _item$translation2;return{label:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title,value:item.id};});});}const selectShop=value=>{dispatch(setCurrentShop(value));dispatch(clearOrderItems());form.setFieldsValue({delivery:null,delivery_date:null,delivery_time:null});};return/*#__PURE__*/_jsxs(Card,{title:t('order.details'),extra:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[/*#__PURE__*/_jsx(DebounceSelect,{placeholder:t('select.shop'),fetchOptions:fetchShops,style:{minWidth:150},onChange:selectShop,allowClear:false,value:data===null||data===void 0?void 0:data.shop,disabled:id}),/*#__PURE__*/_jsx(DebounceSelect,{placeholder:t('select.category'),fetchOptions:fetchCategories,style:{minWidth:150},onChange:value=>setCategory(value),value:category}),/*#__PURE__*/_jsx(DebounceSelect,{placeholder:t('select.brand'),fetchOptions:fetchBrands,style:{minWidth:150},onChange:value=>setBrand(value),value:brand})]}),children:[/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-end mb-4\",children:/*#__PURE__*/_jsx(SearchInput,{placeholder:t('search'),handleChange:setSearch,defaultValue:search===null||search===void 0?void 0:search.search})}),/*#__PURE__*/_jsxs(\"div\",{className:\"products-row order-items\",children:[products.length?products.map(item=>{var _item$product,_item$product$transla,_item$product2,_item$product2$transl;return/*#__PURE__*/_jsxs(Card,{className:\"products-col\",cover:/*#__PURE__*/_jsx(\"img\",{alt:(_item$product=item.product)===null||_item$product===void 0?void 0:(_item$product$transla=_item$product.translation)===null||_item$product$transla===void 0?void 0:_item$product$transla.title,src:getImage(item===null||item===void 0?void 0:item.img)}),onClick:()=>addProductToCart(item),children:[/*#__PURE__*/_jsx(Meta,{title:item===null||item===void 0?void 0:(_item$product2=item.product)===null||_item$product2===void 0?void 0:(_item$product2$transl=_item$product2.translation)===null||_item$product2$transl===void 0?void 0:_item$product2$transl.title}),/*#__PURE__*/_jsx(\"div\",{className:\"preview\",children:/*#__PURE__*/_jsx(PlusOutlined,{})}),item.stocks.map((it,idx)=>{var _it$bonus,_it$bonus2;return/*#__PURE__*/_jsxs(\"span\",{className:it.bonus?'show-bonus':'d-none',children:[/*#__PURE__*/_jsx(BsFillGiftFill,{}),\" \",(_it$bonus=it.bonus)===null||_it$bonus===void 0?void 0:_it$bonus.value,'+',(_it$bonus2=it.bonus)===null||_it$bonus2===void 0?void 0:_it$bonus2.bonus_quantity]},idx);})]},item.id);}):/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(RiveResult,{id:\"nosell\"})})}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"loader\",children:/*#__PURE__*/_jsx(Spin,{})})]}),extrasModal&&/*#__PURE__*/_jsx(ExtrasModal,{extrasModal:extrasModal,setExtrasModal:setExtrasModal}),/*#__PURE__*/_jsx(OrderItems,{form:form})]});};export default ProductInfo;","map":null,"metadata":{},"sourceType":"module"}