{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Form,Input,Modal}from'antd';import{useTranslation}from'react-i18next';import LanguageList from'components/language-list';import{shallowEqual,useDispatch,useSelector}from'react-redux';import propertyService from'services/property';import{toast}from'react-toastify';import{fetchPropertyGroups}from'redux/slices/propertyGroup';import getTranslationFields from'helpers/getTranslationFields';import Loading from'components/loading';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function PropertyGroupModal(_ref){let{modal,handleCancel,onSuccess}=_ref;const[form]=Form.useForm();const{t}=useTranslation();const dispatch=useDispatch();const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);function fetchGroup(id){setLoading(true);propertyService.getGroupById(id).then(res=>{const data=res.data;form.setFieldsValue({...data,...getLanguageFields(data)});}).finally(()=>setLoading(false));}useEffect(()=>{if(modal!==null&&modal!==void 0&&modal.id){fetchGroup(modal.id);}},[modal]);function createPropertyGroup(body){setLoadingBtn(true);propertyService.createGroup(body).then(()=>{toast.success(t('successfully.created'));handleCancel();dispatch(fetchPropertyGroups());!!onSuccess&&onSuccess();}).finally(()=>setLoadingBtn(false));}const onFinish=values=>{const body={title:getTranslationFields(languages,values),type:'text'};if(modal!==null&&modal!==void 0&&modal.id){updatePropertyGroup(modal===null||modal===void 0?void 0:modal.id,body);}else{createPropertyGroup(body);}};function updatePropertyGroup(id,body){setLoadingBtn(true);propertyService.updateGroup(id,body).then(()=>{toast.success(t('successfully.updated'));dispatch(fetchPropertyGroups());handleCancel();}).finally(()=>setLoadingBtn(false));}function getLanguageFields(data){if(!data){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title};});return Object.assign({},...result);}return/*#__PURE__*/_jsx(Modal,{title:modal!==null&&modal!==void 0&&modal.id?t('edit.property.group'):t('add.property.group'),visible:!!modal,onCancel:handleCancel,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),loading:loadingBtn,children:t('save')},'save-button-group'),/*#__PURE__*/_jsx(Button,{type:\"default\",onClick:handleCancel,children:t('cancel')},'cancel-button-group')],children:!loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-end\",children:/*#__PURE__*/_jsx(LanguageList,{})}),/*#__PURE__*/_jsx(Form,{layout:\"vertical\",name:\"property-group\",form:form,onFinish:onFinish,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{rules:[{required:item.locale===defaultLang,message:t('required')}],name:`title[${item.locale}]`,label:t('title'),hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{placeholder:t('title')})},'title'+item.locale))})]}):/*#__PURE__*/_jsx(Loading,{})});}","map":null,"metadata":{},"sourceType":"module"}