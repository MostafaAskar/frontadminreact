{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Card,Col,Form,Input,InputNumber,Row,Select,Switch}from'antd';import{DebounceSelect}from'../../components/search';import shopService from'../../services/restaurant';import{shallowEqual,useDispatch,useSelector}from'react-redux';import productService from'../../services/product';import{replaceMenu,setMenuData}from'../../redux/slices/menu';import unitService from'../../services/unit';import{useNavigate,useParams}from'react-router-dom';import{useTranslation}from'react-i18next';import TextArea from'antd/lib/input/TextArea';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ProductsIndex=_ref=>{let{next,action_type=''}=_ref;const{t}=useTranslation();const[form]=Form.useForm();const dispatch=useDispatch();const{uuid}=useParams();const navigate=useNavigate();const[error,setError]=useState(null);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const[loadingBtn,setLoadingBtn]=useState(false);const[units,setUnits]=useState([]);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,...data}}));};},[]);async function fetchUserShopList(search){const params={search};return shopService.get(params).then(res=>res.data.map(item=>({label:item.translation?item.translation.title:'no name',value:item.id})));}const onFinish=values=>{var _values$shop,_values$unit;setLoadingBtn(true);const params={...values,min_qty:1,max_qty:1000,active:Number(values.active),shop_id:(_values$shop=values.shop)===null||_values$shop===void 0?void 0:_values$shop.value,unit_id:(_values$unit=values.unit)===null||_values$unit===void 0?void 0:_values$unit.value,unit:undefined,addon:Number(1),shop:undefined};if(action_type==='edit'){productUpdate(values,params);}else{productCreate(values,params);}};function productCreate(values,params){productService.create(params).then(_ref2=>{let{data}=_ref2;dispatch(replaceMenu({id:`product-${data.uuid}`,url:`product/${data.uuid}`,name:t('add.product'),data:values,refetch:false}));navigate(`/addon/${data.uuid}?step=1`);}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));}function productUpdate(values,params){productService.update(uuid,params).then(()=>{dispatch(setMenuData({activeMenu,data:values}));next();}).catch(err=>setError(err.response.data.params)).finally(()=>setLoadingBtn(false));}function fetchUnits(){const params={perPage:100,page:1,active:1};unitService.getAll(params).then(_ref3=>{let{data}=_ref3;return setUnits(formatUnits(data));});}useEffect(()=>{fetchUnits();},[]);function formatUnits(data){return data.map(item=>{var _item$translation;return{label:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item.id};});}return/*#__PURE__*/_jsxs(Form,{layout:\"vertical\",form:form,initialValues:{active:true,...activeMenu.data},onFinish:onFinish,className:'addon-menu',children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{xs:24,sm:24,md:16,children:/*#__PURE__*/_jsx(Card,{title:t('basic.info'),children:/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:24,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('name'),name:`title[${item.locale}]`,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{})},'name'+item.id))}),/*#__PURE__*/_jsx(Col,{span:24,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('description'),name:`description[${item.locale}]`,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<5){return Promise.reject(new Error(t('must.be.at.least.5')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(TextArea,{rows:4,span:4})},'description'+item.id))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('tax'),name:\"tax\",rules:[{validator(_,value){if(!value&&value!==0){return Promise.reject(new Error(t('required')));}else if(value&&(value<0||value>100)){return Promise.reject(new Error(t('must.be.between.0.and.100')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",addonAfter:\"%\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})]})})}),/*#__PURE__*/_jsxs(Col,{xs:24,sm:24,md:8,children:[/*#__PURE__*/_jsx(Card,{title:t('shop/restaurant'),children:/*#__PURE__*/_jsx(Form.Item,{name:\"shop\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchUserShopList,disabled:action_type==='edit'})})}),/*#__PURE__*/_jsx(Card,{title:t('addition'),children:/*#__PURE__*/_jsx(Form.Item,{label:t('unit'),name:\"unit\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(Select,{labelInValue:true,filterOption:false,options:units})})})]})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('next')})]});};export default ProductsIndex;","map":null,"metadata":{},"sourceType":"module"}