{"ast":null,"code":"import React,{useEffect,useState}from'react';import{steps}from'./steps';import{Card,Spin,Steps}from'antd';import AddonFinish from'./addons-finish';import AddonStock from'./addons-stock';import AddonIndex from'./addons-index';import LanguageList from'../../components/language-list';import{useParams}from'react-router-dom';import productService from'../../services/product';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,setMenuData}from'../../redux/slices/menu';import{useTranslation}from'react-i18next';import{useQueryParams}from'../../helpers/useQueryParams';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{Step}=Steps;const AddonEdit=()=>{var _queryParams$values;const{t}=useTranslation();const{uuid}=useParams();const queryParams=useQueryParams();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{languages}=useSelector(state=>state.formLang,shallowEqual);const dispatch=useDispatch();const current=Number(((_queryParams$values=queryParams.values)===null||_queryParams$values===void 0?void 0:_queryParams$values.step)||0);const[loading,setLoading]=useState(activeMenu.refetch);const next=()=>{const step=current+1;queryParams.set('step',step);};const prev=()=>{const step=current-1;queryParams.set('step',step);};const createImages=items=>items.map(item=>({uid:item.id,name:item.path,url:item.path}));const createSelectObject=item=>{if(!item)return null;return{label:item.translation?item.translation.title:item.title,value:item.id};};function fetchProduct(uuid){setLoading(true);productService.getById(uuid).then(res=>{var _res$data$stocks$;const data={...res.data,...getLanguageFields(res.data),shop:createSelectObject(res.data.shop),category:createSelectObject(res.data.category),brand:createSelectObject(res.data.brand),unit:createSelectObject(res.data.unit),images:createImages(res.data.galleries),extras:(_res$data$stocks$=res.data.stocks[0])===null||_res$data$stocks$===void 0?void 0:_res$data$stocks$.extras.map(el=>el.extra_group_id),stocks:res.data.stocks.map(stock=>({...stock,...Object.assign({},...stock.extras.map((extra,idx)=>({[`extras[${idx}]`]:extra.id}))),quantity:stock.quantity||0,extras:undefined})),properties:res.data.properties.map((item,index)=>({id:index,[`key[${item.locale}]`]:item.key,[`value[${item.locale}]`]:item.value})),translation:undefined,translations:undefined};dispatch(setMenuData({activeMenu,data}));}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});}function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description};});return Object.assign({},...result);}useEffect(()=>{if(activeMenu.refetch){fetchProduct(uuid);}},[activeMenu.refetch]);const onChange=step=>{dispatch(setMenuData({activeMenu,data:{...activeMenu.data,step}}));queryParams.set('step',step);};return/*#__PURE__*/_jsxs(Card,{title:t('addon.edit'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:[/*#__PURE__*/_jsx(Steps,{current:current,onChange:onChange,children:steps.map(item=>/*#__PURE__*/_jsx(Step,{title:t(item.title)},item.title))}),!loading?/*#__PURE__*/_jsxs(\"div\",{className:\"steps-content\",children:[steps[current].content==='First-content'&&/*#__PURE__*/_jsx(AddonIndex,{next:next,action_type:'edit'}),steps[current].content==='Third-content'&&/*#__PURE__*/_jsx(AddonStock,{next:next,prev:prev,current:current}),steps[current].content==='Finish-content'&&/*#__PURE__*/_jsx(AddonFinish,{prev:prev})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"py-5\"})})]});};export default AddonEdit;","map":null,"metadata":{},"sourceType":"module"}