{"ast":null,"code":"import React,{useEffect,useState}from'react';import{data}from'configs/menu-config';import{LockOutlined,MailOutlined}from'@ant-design/icons';import{Button,Card,Col,Descriptions,Form,Input,notification,Row,Typography}from'antd';import authService from'../../services/auth';import{useDispatch,useSelector}from'react-redux';import{setUserData}from'../../redux/slices/auth';import{fetchRestSettings,fetchSettings}from'../../redux/slices/globalSettings';import{useTranslation}from'react-i18next';import{PROJECT_NAME}from'../../configs/app-global';import Recaptcha from'components/recaptcha';import{setMenu}from'redux/slices/menu';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{Title}=Typography;const credentials=[{login:'owner@githubit.com',password:'githubit'},{login:'manager@githubit.com',password:'manager'},{login:'sellers@githubit.com',password:'seller'},{login:'moderator@githubit.com',password:'moderator'},{login:'delivery@githubit.com',password:'delivery'}// {\n//   login: 'temp@gmail.com',\n//   password: '12345678',\n// },\n];const Login=()=>{const{t}=useTranslation();const dispatch=useDispatch();const[form]=Form.useForm();const[loading,setLoading]=useState(false);const{settings}=useSelector(state=>state.globalSettings);const[recaptcha,setRecaptcha]=useState(null);const handleRecaptchaChange=value=>{setRecaptcha(value);};const isDemo=Boolean(Number(settings===null||settings===void 0?void 0:settings.is_demo));const handleLogin=values=>{const body={password:values.password};if(values.email.includes('@')){body.email=values.email;}else{body.phone=values.email.replace(/[^0-9]/g,'');}setLoading(true);authService.login(body).then(res=>{var _res$data$user,_res$data$user$shop,_res$data,_res$data$user2,_res$data$user2$walle;const user={fullName:res.data.user.firstname+' '+res.data.user.lastname,role:res.data.user.role,urls:data[res.data.user.role],img:res.data.user.img,token:res.data.access_token,email:res.data.user.email,id:res.data.user.id,shop_id:(_res$data$user=res.data.user)===null||_res$data$user===void 0?void 0:(_res$data$user$shop=_res$data$user.shop)===null||_res$data$user$shop===void 0?void 0:_res$data$user$shop.id,walletId:(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$user2=_res$data.user)===null||_res$data$user2===void 0?void 0:(_res$data$user2$walle=_res$data$user2.wallet)===null||_res$data$user2$walle===void 0?void 0:_res$data$user2$walle.id};if(user.role==='waiter'){dispatch(setMenu({icon:'user',id:'orders-board',name:'my.orders',url:'waiter/orders-board'}));}if(user.role==='user'){notification.error({message:t('ERROR_101')});return;}localStorage.setItem('token',res.data.access_token);dispatch(setUserData(user));if(user.role==='admin'){dispatch(fetchSettings());}else{dispatch(fetchRestSettings());}}).finally(()=>setLoading(false));};const copyCredentials=(event,item)=>{event.preventDefault();form.setFieldsValue({email:item.login,password:item.password});};useEffect(()=>{dispatch(fetchRestSettings());},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"login-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container d-flex flex-column justify-content-center h-100 align-items-end\",children:/*#__PURE__*/_jsx(Row,{justify:\"center\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"my-4 pl-4 pr-4 w-100\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"app-brand text-center\",children:/*#__PURE__*/_jsx(Title,{className:\"brand-logo\",children:settings.title||PROJECT_NAME})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Form,{name:\"login-form\",layout:\"vertical\",form:form,onFinish:handleLogin,style:{width:'420px'},children:[/*#__PURE__*/_jsx(Form.Item,{name:\"email\",label:\"Email\",rules:[{required:true,message:'Please input your Email!'}],children:/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(MailOutlined,{className:\"site-form-item-icon\"}),placeholder:\"Email or phone\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"password\",label:\"Password\",rules:[{required:true,message:'Please input your password!'}],children:/*#__PURE__*/_jsx(Input.Password,{prefix:/*#__PURE__*/_jsx(LockOutlined,{className:\"site-form-item-icon\"}),placeholder:\"Password\"})}),/*#__PURE__*/_jsx(Recaptcha,{onChange:handleRecaptchaChange}),/*#__PURE__*/_jsx(Form.Item,{className:\"login-input mt-4\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",className:\"login-form-button\",loading:loading,disabled:!Boolean(recaptcha),children:t('Login')})}),isDemo&&/*#__PURE__*/_jsx(Descriptions,{bordered:true,size:\"small\",children:credentials.map((item,idx)=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Descriptions.Item,{span:2,label:item.login,children:item.password}),/*#__PURE__*/_jsx(Descriptions.Item,{span:1,children:/*#__PURE__*/_jsx(\"a\",{href:\"/\",className:\"copy-link\",onClick:event=>copyCredentials(event,item),children:t('Copy')})})]},idx))}),' ',!isDemo&&process.env.REACT_APP_IS_DEMO==='true'&&/*#__PURE__*/_jsxs(Descriptions,{size:\"small\",children:[/*#__PURE__*/_jsx(Descriptions.Item,{span:4,label:\"Login\",children:credentials[0].login}),/*#__PURE__*/_jsx(Descriptions.Item,{span:4,label:\"Password\",children:credentials[0].password})]})]})})})]})})})})})});};export default Login;","map":null,"metadata":{},"sourceType":"module"}