{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Card,Button,Table,Tooltip,Result}from'antd';import{BASE_URL,api_url}from'../../configs/app-global';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{useTranslation}from'react-i18next';import{CloudDownloadOutlined}from'@ant-design/icons';import formatSortType from'../../helpers/formatSortType';import{disableRefetch,setMenuData}from'../../redux/slices/menu';import useDidUpdate from'../../helpers/useDidUpdate';import{fetchBackups}from'../../redux/slices/backup';import{toast}from'react-toastify';import axios from'axios';import useDemo from'../../helpers/useDemo';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function Backup(){const[loadingBtn,setLoadingBtn]=useState(false);const dispatch=useDispatch();const{t}=useTranslation();const access_token=localStorage.getItem('token');const columns=[{title:t('id'),dataIndex:'id',key:'id',sorter:true},{title:t('client'),dataIndex:'user',key:'user',render:user=>/*#__PURE__*/_jsxs(\"div\",{children:[user.firstname,\" \",user.lastname]})},{title:t('title'),dataIndex:'title',key:'title'},{title:t('created.at'),dataIndex:'created_at',key:'created_at'},{title:t('options'),dataIndex:'title',key:'title',render:title=>/*#__PURE__*/_jsx(Tooltip,{title:t('download.backup'),children:/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(CloudDownloadOutlined,{}),onClick:()=>downloadBackup('/storage/laravel-backup/'+title)})})}];const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{history,meta,loading,params}=useSelector(state=>state.backup,shallowEqual);const data=activeMenu.data;const{isDemo}=useDemo();function onChangePagination(pagination,filters,sorter){const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{perPage,page,column,sort}}));}useDidUpdate(()=>{if(isDemo){return;}const paramsData={sort:data===null||data===void 0?void 0:data.sort,column:data===null||data===void 0?void 0:data.column,perPage:data===null||data===void 0?void 0:data.perPage,page:data===null||data===void 0?void 0:data.page};dispatch(fetchBackups(paramsData));},[activeMenu.data]);useEffect(()=>{if(activeMenu.refetch){if(isDemo){return;}dispatch(fetchBackups());dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);const getBackup=()=>{toast.warning(!isDemo?t('backup.loading'):null);if(isDemo){toast.warning(t('cannot.work.demo'));return;}setLoadingBtn(true);axios.post(`${api_url}dashboard/admin/backup/history`,{},{headers:{Authorization:`Bearer ${access_token}`,'content-type':'text/json'}}).then(res=>downloadBackup(res.data.data.path)).finally(()=>setLoadingBtn(false));};function downloadBackup(path){const link=document.createElement('a');link.href=BASE_URL+path;document.body.appendChild(link);link.click();document.body.removeChild(link);}return/*#__PURE__*/_jsxs(Card,{title:t('backup'),children:[/*#__PURE__*/_jsx(Result,{status:\"warning\",title:t('do.you.care.about.your.data'),subTitle:t('here.you.can.take.backup.from.database'),extra:/*#__PURE__*/_jsx(Button,{type:\"primary\",loading:loadingBtn,onClick:getBackup,children:t('download.backup')})}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},columns:columns,dataSource:history,loading:loading,pagination:{pageSize:params.perPage,page:params.page,total:meta.total,defaultCurrent:params.page},rowKey:record=>record.id,onChange:onChangePagination})]});}","map":null,"metadata":{},"sourceType":"module"}