{"ast":null,"code":"import React,{useMemo,useState}from'react';import{Link,useLocation,useNavigate}from'react-router-dom';import{LogoutOutlined,MenuFoldOutlined,MenuUnfoldOutlined,SearchOutlined}from'@ant-design/icons';import{Divider,Menu,Space,Layout,Modal,Input}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{addMenu,clearMenu,setMenu}from'redux/slices/menu';import{useTranslation}from'react-i18next';import LangModal from'./lang-modal';import getSystemIcons from'helpers/getSystemIcons';import NotificationBar from'./notificationBar';import{navCollapseTrigger}from'redux/slices/theme';import ThemeConfigurator from'./theme-configurator';import i18n from'configs/i18next';import{RiArrowDownSFill}from'react-icons/ri';import Scrollbars from'react-custom-scrollbars';import SubMenu from'antd/lib/menu/SubMenu';import NavProfile from'./nav-profile';import{batch}from'react-redux';import{clearUser}from'redux/slices/auth';import{setCurrentChat}from'redux/slices/chat';import{data as allRoutes}from'configs/menu-config';import useDidUpdate from'helpers/useDidUpdate';import{clearBags}from'redux/slices/cart';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const{Sider}=Layout;const Sidebar=()=>{var _languages$find;const{t}=useTranslation();const navigate=useNavigate();const{pathname}=useLocation();const{user}=useSelector(state=>state.auth,shallowEqual);const[isModalVisible,setIsModalVisible]=useState(false);const{system_refund,payment_type}=useSelector(state=>state.globalSettings.settings,shallowEqual);const{navCollapsed}=useSelector(state=>state.theme.theme,shallowEqual);const{languages}=useSelector(state=>state.formLang,shallowEqual);const dispatch=useDispatch();const[langModal,setLangModal]=useState(false);const{myShop}=useSelector(state=>state.myShop,shallowEqual);const{theme}=useSelector(state=>state.theme,shallowEqual);const parcelMode=useMemo(()=>!!theme.parcelMode&&(user===null||user===void 0?void 0:user.role)==='admin',[theme,user]);const routes=useMemo(()=>filterUserRoutes(user.urls),[user]);const active=routes===null||routes===void 0?void 0:routes.find(item=>pathname.includes(item.url));const[searchTerm,setSearchTerm]=useState('');const[data,setData]=useState(parcelMode?allRoutes.parcel:routes);useDidUpdate(()=>{if(parcelMode){setData(allRoutes.parcel);}else{setData(routes);}},[theme,user]);const addNewItem=item=>{if(typeof item.url==='undefined')return;if(item.name==='logout'){setIsModalVisible(true);return;}const data={...item,icon:undefined,children:undefined,refetch:true};dispatch(setMenu(data));navigate(`/${item.url}`);};function filterUserRoutes(routes){let list=routes;if(myShop.type==='shop'){list=routes===null||routes===void 0?void 0:routes.filter(item=>(item===null||item===void 0?void 0:item.name)!=='brands');}if(payment_type==='admin'){list=routes===null||routes===void 0?void 0:routes.filter(item=>(item===null||item===void 0?void 0:item.name)!=='payments');}if(system_refund==='0'){list=routes===null||routes===void 0?void 0:routes.filter(item=>(item===null||item===void 0?void 0:item.name)!=='refunds');}return list;}const menuTrigger=event=>{event.stopPropagation();dispatch(navCollapseTrigger());};const addMenuItem=payload=>{const data={...payload,icon:undefined};dispatch(addMenu(data));};const handleOk=()=>{batch(()=>{dispatch(clearUser());dispatch(clearMenu());dispatch(setCurrentChat(null));dispatch(clearBags());});setIsModalVisible(false);localStorage.removeItem('token');navigate('/login');};const handleCancel=()=>setIsModalVisible(false);function getOptionList(routes){const optionTree=[];routes===null||routes===void 0?void 0:routes.map(item=>{var _item$submenu;optionTree.push(item);item===null||item===void 0?void 0:(_item$submenu=item.submenu)===null||_item$submenu===void 0?void 0:_item$submenu.map(sub=>{var _sub$children;optionTree.push(sub);sub===null||sub===void 0?void 0:(_sub$children=sub.children)===null||_sub$children===void 0?void 0:_sub$children.map(child=>{optionTree.push(child);});});});return optionTree;}const optionList=getOptionList(data);const menuList=searchTerm.length>0?optionList.filter(input=>{var _input$name;return t((_input$name=input===null||input===void 0?void 0:input.name)!==null&&_input$name!==void 0?_input$name:'').toUpperCase().includes(searchTerm.toUpperCase());}):data;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Sider,{className:\"navbar-nav side-nav\",width:250,collapsed:navCollapsed,style:{height:'100vh',top:0},children:[/*#__PURE__*/_jsx(NavProfile,{user:user}),/*#__PURE__*/_jsx(\"div\",{className:\"menu-collapse\",onClick:menuTrigger,children:/*#__PURE__*/_jsx(MenuFoldOutlined,{})}),navCollapsed&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-content-center\",children:/*#__PURE__*/_jsx(ThemeConfigurator,{})}),!navCollapsed?/*#__PURE__*/_jsxs(Space,{className:\"mx-4 mt-2 d-flex justify-content-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"icon-button\",onClick:()=>setLangModal(true),children:[/*#__PURE__*/_jsx(\"img\",{className:\"globalOutlined\",src:(_languages$find=languages.find(item=>item.locale===i18n.language))===null||_languages$find===void 0?void 0:_languages$find.img,alt:user.fullName}),/*#__PURE__*/_jsx(\"span\",{className:\"default-lang\",children:i18n.language}),/*#__PURE__*/_jsx(RiArrowDownSFill,{size:15})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"d-flex\",children:[/*#__PURE__*/_jsx(ThemeConfigurator,{}),/*#__PURE__*/_jsx(NotificationBar,{})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"menu-unfold\",onClick:menuTrigger,children:/*#__PURE__*/_jsx(MenuUnfoldOutlined,{})}),/*#__PURE__*/_jsx(Divider,{style:{margin:'10px 0'}}),!navCollapsed&&/*#__PURE__*/_jsx(\"span\",{className:\"mt-2 mb-2 d-flex justify-content-center\",children:/*#__PURE__*/_jsx(Input,{placeholder:\"search\",style:{width:'90%'},value:searchTerm,onChange:event=>{setSearchTerm(event.target.value);},prefix:/*#__PURE__*/_jsx(SearchOutlined,{})})}),/*#__PURE__*/_jsx(Scrollbars,{autoHeight:true,autoHeightMin:window.innerHeight>969?'80vh':'77vh',autoHeightMax:window.innerHeight>969?'80vh':'77vh',autoHide:true,children:/*#__PURE__*/_jsx(Menu,{theme:\"light\",mode:\"inline\",defaultSelectedKeys:[String(active===null||active===void 0?void 0:active.id)],defaultOpenKeys:!navCollapsed?data===null||data===void 0?void 0:data.map((i,idx)=>i.id+'_'+idx):[],children:menuList===null||menuList===void 0?void 0:menuList.map((item,idx)=>{var _item$submenu2;return((_item$submenu2=item.submenu)===null||_item$submenu2===void 0?void 0:_item$submenu2.length)>0?/*#__PURE__*/_jsx(SubMenu,{title:t(item.name),icon:getSystemIcons(item.icon),children:item.submenu.map((submenu,idy)=>{var _submenu$children,_submenu$children2;return((_submenu$children=submenu.children)===null||_submenu$children===void 0?void 0:_submenu$children.length)>0?/*#__PURE__*/_jsx(SubMenu,{defaultOpen:true,title:t(submenu.name),icon:getSystemIcons(submenu.icon),onTitleClick:()=>addNewItem(submenu),children:(_submenu$children2=submenu.children)===null||_submenu$children2===void 0?void 0:_submenu$children2.map((sub,idk)=>/*#__PURE__*/_jsx(Menu.Item,{icon:getSystemIcons(sub.icon),children:/*#__PURE__*/_jsx(Link,{to:'/'+sub.url,onClick:()=>addMenuItem(sub),children:/*#__PURE__*/_jsx(\"span\",{children:t(sub.name)})})},'child'+idk+sub.id))},submenu.id+'_'+idy):/*#__PURE__*/_jsx(Menu.Item,{icon:getSystemIcons(submenu.icon),children:/*#__PURE__*/_jsx(Link,{to:'/'+submenu.url,onClick:()=>addNewItem(submenu),children:/*#__PURE__*/_jsx(\"span\",{children:t(submenu.name)})})},submenu.id);})},item.id+'_'+idx):/*#__PURE__*/_jsx(Menu.Item,{icon:getSystemIcons(item.icon),children:/*#__PURE__*/_jsx(Link,{to:'/'+item.url,onClick:()=>addNewItem(item),children:/*#__PURE__*/_jsx(\"span\",{children:t(item.name)})})},item.id);})})})]}),langModal&&/*#__PURE__*/_jsx(LangModal,{visible:langModal,handleCancel:()=>setLangModal(false)}),/*#__PURE__*/_jsxs(Modal,{visible:isModalVisible,onOk:handleOk,onCancel:handleCancel,centered:true,children:[/*#__PURE__*/_jsx(LogoutOutlined,{style:{fontSize:'25px',color:'#08c'},theme:\"primary\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:t('leave.site')})]})]});};export default Sidebar;","map":null,"metadata":{},"sourceType":"module"}