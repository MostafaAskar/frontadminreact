{"ast":null,"code":"var _jsxFileName = \"/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/backup/index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { Card, Button, Table, Tooltip, Result } from 'antd';\nimport { BASE_URL, api_url } from '../../configs/app-global';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport { CloudDownloadOutlined } from '@ant-design/icons';\nimport formatSortType from '../../helpers/formatSortType';\nimport { disableRefetch, setMenuData } from '../../redux/slices/menu';\nimport useDidUpdate from '../../helpers/useDidUpdate';\nimport { fetchBackups } from '../../redux/slices/backup';\nimport { toast } from 'react-toastify';\nimport axios from 'axios';\nimport useDemo from '../../helpers/useDemo';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Backup() {\n  _s();\n\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const dispatch = useDispatch();\n  const {\n    t\n  } = useTranslation();\n  const access_token = localStorage.getItem('token');\n  const columns = [{\n    title: t('id'),\n    dataIndex: 'id',\n    key: 'id',\n    sorter: true\n  }, {\n    title: t('client'),\n    dataIndex: 'user',\n    key: 'user',\n    render: user => /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [user.firstname, \" \", user.lastname]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 9\n    }, this)\n  }, {\n    title: t('title'),\n    dataIndex: 'title',\n    key: 'title'\n  }, {\n    title: t('created.at'),\n    dataIndex: 'created_at',\n    key: 'created_at'\n  }, {\n    title: t('options'),\n    dataIndex: 'title',\n    key: 'title',\n    render: title => /*#__PURE__*/_jsxDEV(Tooltip, {\n      title: t('download.backup'),\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        type: \"primary\",\n        icon: /*#__PURE__*/_jsxDEV(CloudDownloadOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 56,\n          columnNumber: 19\n        }, this),\n        onClick: () => downloadBackup('/storage/laravel-backup/' + title)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 54,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 9\n    }, this)\n  }];\n  const {\n    activeMenu\n  } = useSelector(state => state.menu, shallowEqual);\n  const {\n    history,\n    meta,\n    loading,\n    params\n  } = useSelector(state => state.backup, shallowEqual);\n  const data = activeMenu.data;\n  const {\n    isDemo\n  } = useDemo();\n\n  function onChangePagination(pagination, filters, sorter) {\n    const {\n      pageSize: perPage,\n      current: page\n    } = pagination;\n    const {\n      field: column,\n      order\n    } = sorter;\n    const sort = formatSortType(order);\n    dispatch(setMenuData({\n      activeMenu,\n      data: {\n        perPage,\n        page,\n        column,\n        sort\n      }\n    }));\n  }\n\n  useDidUpdate(() => {\n    if (isDemo) {\n      return;\n    }\n\n    const paramsData = {\n      sort: data === null || data === void 0 ? void 0 : data.sort,\n      column: data === null || data === void 0 ? void 0 : data.column,\n      perPage: data === null || data === void 0 ? void 0 : data.perPage,\n      page: data === null || data === void 0 ? void 0 : data.page\n    };\n    dispatch(fetchBackups(paramsData));\n  }, [activeMenu.data]);\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      if (isDemo) {\n        return;\n      }\n\n      dispatch(fetchBackups());\n      dispatch(disableRefetch(activeMenu));\n    }\n  }, [activeMenu.refetch]);\n\n  const getBackup = () => {\n    toast.warning(!isDemo ? t('backup.loading') : null);\n\n    if (isDemo) {\n      toast.warning(t('cannot.work.demo'));\n      return;\n    }\n\n    setLoadingBtn(true);\n    axios.post(`${api_url}dashboard/admin/backup/history`, {}, {\n      headers: {\n        Authorization: `Bearer ${access_token}`,\n        'content-type': 'text/json'\n      }\n    }).then(res => downloadBackup(res.data.data.path)).finally(() => setLoadingBtn(false));\n  };\n\n  function downloadBackup(path) {\n    const link = document.createElement('a');\n    link.href = BASE_URL + path;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Card, {\n    title: t('backup'),\n    children: [/*#__PURE__*/_jsxDEV(Result, {\n      status: \"warning\",\n      title: t('do.you.care.about.your.data'),\n      subTitle: t('here.you.can.take.backup.from.database'),\n      extra: /*#__PURE__*/_jsxDEV(Button, {\n        type: \"primary\",\n        loading: loadingBtn,\n        onClick: getBackup,\n        children: t('download.backup')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Table, {\n      scroll: {\n        x: true\n      },\n      columns: columns,\n      dataSource: history,\n      loading: loading,\n      pagination: {\n        pageSize: params.perPage,\n        page: params.page,\n        total: meta.total,\n        defaultCurrent: params.page\n      },\n      rowKey: record => record.id,\n      onChange: onChangePagination\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Backup, \"HHzg9WIEM4unPAyqjMHeHo7z5XQ=\", false, function () {\n  return [useDispatch, useTranslation, useSelector, useSelector, useDemo, useDidUpdate];\n});\n\n_c = Backup;\n\nvar _c;\n\n$RefreshReg$(_c, \"Backup\");","map":{"version":3,"names":["React","useEffect","useState","Card","Button","Table","Tooltip","Result","BASE_URL","api_url","shallowEqual","useDispatch","useSelector","useTranslation","CloudDownloadOutlined","formatSortType","disableRefetch","setMenuData","useDidUpdate","fetchBackups","toast","axios","useDemo","Backup","loadingBtn","setLoadingBtn","dispatch","t","access_token","localStorage","getItem","columns","title","dataIndex","key","sorter","render","user","firstname","lastname","downloadBackup","activeMenu","state","menu","history","meta","loading","params","backup","data","isDemo","onChangePagination","pagination","filters","pageSize","perPage","current","page","field","column","order","sort","paramsData","refetch","getBackup","warning","post","headers","Authorization","then","res","path","finally","link","document","createElement","href","body","appendChild","click","removeChild","x","total","defaultCurrent","record","id"],"sources":["/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/backup/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Card, Button, Table, Tooltip, Result } from 'antd';\nimport { BASE_URL, api_url } from '../../configs/app-global';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport { CloudDownloadOutlined } from '@ant-design/icons';\nimport formatSortType from '../../helpers/formatSortType';\nimport { disableRefetch, setMenuData } from '../../redux/slices/menu';\nimport useDidUpdate from '../../helpers/useDidUpdate';\nimport { fetchBackups } from '../../redux/slices/backup';\nimport { toast } from 'react-toastify';\nimport axios from 'axios';\nimport useDemo from '../../helpers/useDemo';\n\nexport default function Backup() {\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const dispatch = useDispatch();\n  const { t } = useTranslation();\n  const access_token = localStorage.getItem('token');\n\n  const columns = [\n    {\n      title: t('id'),\n      dataIndex: 'id',\n      key: 'id',\n      sorter: true,\n    },\n    {\n      title: t('client'),\n      dataIndex: 'user',\n      key: 'user',\n      render: (user) => (\n        <div>\n          {user.firstname} {user.lastname}\n        </div>\n      ),\n    },\n    {\n      title: t('title'),\n      dataIndex: 'title',\n      key: 'title',\n    },\n    {\n      title: t('created.at'),\n      dataIndex: 'created_at',\n      key: 'created_at',\n    },\n    {\n      title: t('options'),\n      dataIndex: 'title',\n      key: 'title',\n      render: (title) => (\n        <Tooltip title={t('download.backup')}>\n          <Button\n            type='primary'\n            icon={<CloudDownloadOutlined />}\n            onClick={() => downloadBackup('/storage/laravel-backup/' + title)}\n          />\n        </Tooltip>\n      ),\n    },\n  ];\n\n  const { activeMenu } = useSelector((state) => state.menu, shallowEqual);\n  const { history, meta, loading, params } = useSelector(\n    (state) => state.backup,\n    shallowEqual\n  );\n  const data = activeMenu.data;\n  const { isDemo } = useDemo();\n\n  function onChangePagination(pagination, filters, sorter) {\n    const { pageSize: perPage, current: page } = pagination;\n    const { field: column, order } = sorter;\n    const sort = formatSortType(order);\n    dispatch(\n      setMenuData({\n        activeMenu,\n        data: { perPage, page, column, sort },\n      })\n    );\n  }\n\n  useDidUpdate(() => {\n    if (isDemo) {\n      return;\n    }\n    const paramsData = {\n      sort: data?.sort,\n      column: data?.column,\n      perPage: data?.perPage,\n      page: data?.page,\n    };\n    dispatch(fetchBackups(paramsData));\n  }, [activeMenu.data]);\n\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      if (isDemo) {\n        return;\n      }\n      dispatch(fetchBackups());\n      dispatch(disableRefetch(activeMenu));\n    }\n  }, [activeMenu.refetch]);\n\n  const getBackup = () => {\n    toast.warning(!isDemo ? t('backup.loading') : null);\n    if (isDemo) {\n      toast.warning(t('cannot.work.demo'));\n      return;\n    }\n    setLoadingBtn(true);\n    axios\n      .post(\n        `${api_url}dashboard/admin/backup/history`,\n        {},\n        {\n          headers: {\n            Authorization: `Bearer ${access_token}`,\n            'content-type': 'text/json',\n          },\n        }\n      )\n      .then((res) => downloadBackup(res.data.data.path))\n      .finally(() => setLoadingBtn(false));\n  };\n\n  function downloadBackup(path) {\n    const link = document.createElement('a');\n    link.href = BASE_URL + path;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  return (\n    <Card title={t('backup')}>\n      <Result\n        status='warning'\n        title={t('do.you.care.about.your.data')}\n        subTitle={t('here.you.can.take.backup.from.database')}\n        extra={\n          <Button type='primary' loading={loadingBtn} onClick={getBackup}>\n            {t('download.backup')}\n          </Button>\n        }\n      />\n      <Table\n        scroll={{ x: true }}\n        columns={columns}\n        dataSource={history}\n        loading={loading}\n        pagination={{\n          pageSize: params.perPage,\n          page: params.page,\n          total: meta.total,\n          defaultCurrent: params.page,\n        }}\n        rowKey={(record) => record.id}\n        onChange={onChangePagination}\n      />\n    </Card>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}