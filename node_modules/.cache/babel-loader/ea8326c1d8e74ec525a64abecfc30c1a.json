{"ast":null,"code":"import React,{useState}from'react';import{Form,Row,Col,Input,Button,Switch,Modal,Spin}from'antd';import{useTranslation}from'react-i18next';import LanguageList from'components/language-list';import{shallowEqual,useSelector,useDispatch,batch}from'react-redux';import{toast}from'react-toastify';import countryService from'services/deliveryzone/country';import{useEffect}from'react';import{InfiniteSelect}from'components/infinite-select';import cityService from'services/deliveryzone/city';import regionService from'services/deliveryzone/region';import{fetchCity}from'redux/slices/deliveryzone/city';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CityForm(_ref){let{visible,setVisible,id,setId}=_ref;const[form]=Form.useForm();const dispatch=useDispatch();const{t}=useTranslation();const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);const[loadingBtn,setLoadingBtn]=useState(false);const[loading,setLoading]=useState(false);const[data,setData]=useState(null);const handleClose=()=>{setData(null);setVisible(false);form.resetFields();setId(null);};const addCountry=values=>{cityService.create(values).then(()=>{toast.success(t('successfully.added'));batch(()=>{dispatch(fetchCity({}));});handleClose();}).finally(()=>setLoadingBtn(false));};const updateCountry=values=>{cityService.update(data.id,values).then(()=>{toast.success(t('successfully.updated'));batch(()=>{dispatch(fetchCity({}));});handleClose();}).finally(()=>setLoadingBtn(false));};const onFinish=values=>{var _values$country_id,_values$region_id;setLoadingBtn(true);const paramsData={country_id:values===null||values===void 0?void 0:(_values$country_id=values.country_id)===null||_values$country_id===void 0?void 0:_values$country_id.value,region_id:values===null||values===void 0?void 0:(_values$region_id=values.region_id)===null||_values$region_id===void 0?void 0:_values$region_id.value,active:values.active,title:{...Object.assign({},...languages.map(lang=>({[lang.locale]:values[`title[${lang.locale}]`]})))}};if(data!==null&&data!==void 0&&data.id)updateCountry(paramsData);else addCountry(paramsData);};function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title};});return Object.assign({},...result);}const fetchCountry=_ref2=>{let{search,page}=_ref2;return countryService.get({search,page,has_price:true}).then(res=>{return res.data.map(country=>{var _country$translation;return{label:country===null||country===void 0?void 0:(_country$translation=country.translation)===null||_country$translation===void 0?void 0:_country$translation.title,value:country.id};});});};const fetchRegion=_ref3=>{let{search,page}=_ref3;return regionService.get({search,page,has_price:true}).then(res=>{return res.data.map(region=>{var _region$translation;return{label:region===null||region===void 0?void 0:(_region$translation=region.translation)===null||_region$translation===void 0?void 0:_region$translation.title,value:region.id};});});};useEffect(()=>{if(id){setLoading(true);cityService.show(id).then(_ref4=>{let{data}=_ref4;setData(data);form.setFieldsValue({active:data===null||data===void 0?void 0:data.active,country_id:{label:data.country.translation.title,value:data.country.id},region_id:{label:data.region.translation.title,value:data.region.id},...getLanguageFields(data)});}).finally(()=>setLoading(false));}},[id]);return/*#__PURE__*/_jsx(Modal,{visible:visible,onCancel:handleClose,onOk:handleClose,footer:null,loading:loading,title:t('add.country'),children:/*#__PURE__*/_jsxs(Form,{form:form,onFinish:onFinish,layout:\"vertical\",initialValues:{active:true},children:[/*#__PURE__*/_jsx(Spin,{spinning:loading,children:/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(LanguageList,{})}),/*#__PURE__*/_jsx(Col,{span:24,children:languages.map(item=>/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:`title[${item.locale}]`,hidden:item.locale!==defaultLang,rules:[{validator(_,value){if(!value&&(item===null||item===void 0?void 0:item.locale)===defaultLang){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})},'title'+item.id))}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{name:\"region_id\",label:t('region_id'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InfiniteSelect,{fetchOptions:fetchRegion})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{name:\"country_id\",label:t('country_id'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InfiniteSelect,{fetchOptions:fetchCountry})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{defaultChecked:true})})})]})}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})]})});}","map":null,"metadata":{},"sourceType":"module"}