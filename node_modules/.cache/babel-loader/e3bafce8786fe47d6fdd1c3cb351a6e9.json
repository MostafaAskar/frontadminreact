{"ast":null,"code":"var _jsxFileName = \"/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/seller-views/booking-time/time-edit.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport Loading from 'components/loading';\nimport moment from 'moment';\nimport { weeks } from 'components/shop/weeks';\nimport BookingTimeForm from 'components/forms/booking-time-form';\nimport { Form } from 'antd';\nimport sellerBookingTime from 'services/seller/booking-time';\nimport bookingClosedDays from 'services/seller/bookingClosedDays';\nimport { shallowEqual, useSelector } from 'react-redux';\nimport bookingWorkingDays from 'services/seller/bookingWorkingDays';\nimport { useDispatch } from 'react-redux';\nimport { disableRefetch, removeFromMenu } from 'redux/slices/menu';\nimport { toast } from 'react-toastify';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { fetchBookingTime } from 'redux/slices/booking-time';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst BookingTimeEdit = () => {\n  _s();\n\n  const {\n    t\n  } = useTranslation();\n  const [form] = Form.useForm();\n  const [days, setDays] = useState([]);\n  const [lines, setLines] = useState(new Array(7).fill(false));\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const {\n    myShop\n  } = useSelector(state => state.myShop, shallowEqual);\n  const {\n    activeMenu\n  } = useSelector(state => state.menu, shallowEqual);\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n\n  const onFinish = values => {\n    setLoadingBtn(true);\n    const closeDatesBody = {\n      dates: days ? days.map(item => moment(item).format('YYYY-MM-DD')) : undefined\n    };\n    const workingDaysBody = {\n      dates: values.working_days.map(item => ({\n        day: item.title,\n        from: moment(item.from ? item.from : '00').format('HH-mm'),\n        to: moment(item.to ? item.to : '00').format('HH-mm'),\n        disabled: item.disabled\n      }))\n    };\n    const workingMaxTime = {\n      max_time: values.max_time\n    };\n    const nextUrl = 'seller/booking/time';\n    Promise.all([sellerBookingTime.create(workingMaxTime), bookingClosedDays.update(myShop.uuid, closeDatesBody), values.working_days.length !== 0 ? bookingWorkingDays.update(myShop.uuid, workingDaysBody) : undefined]).then(() => {\n      toast.success(t('successfully.updated'));\n      dispatch(fetchBookingTime());\n      dispatch(removeFromMenu({ ...activeMenu,\n        nextUrl\n      }));\n      navigate(`/${nextUrl}`);\n    });\n  };\n\n  const getDays = () => {\n    setLoading(true);\n    sellerBookingTime.getAll().then(res => {\n      form.setFieldsValue({\n        max_time: res.data.max_time\n      });\n    }).finally(() => {\n      dispatch(disableRefetch(activeMenu));\n      setLoading(false);\n    });\n    bookingClosedDays.getById(myShop.uuid).then(res => {\n      setDays(res.data.closed_dates.filter(date => date.day > moment(new Date()).format('YYYY-MM-DD')).map(itm => new Date(itm.day)));\n    }).finally(() => {\n      dispatch(disableRefetch(activeMenu));\n      setLoading(false);\n    });\n    bookingWorkingDays.getById(myShop.uuid).then(res => {\n      setLines(res.data.dates.length !== 0 ? res.data.dates.map(item => item.disabled) : []);\n      res.data.dates.length !== 0 && form.setFieldsValue({\n        working_days: res.data.dates.map(item => ({\n          title: item.day,\n          from: moment(item.from, 'HH:mm:ss'),\n          to: moment(item.to, 'HH:mm:ss'),\n          disabled: Boolean(item.disabled)\n        }))\n      });\n    }).finally(() => {\n      dispatch(disableRefetch(activeMenu));\n      setLoading(false);\n    });\n  };\n\n  useEffect(() => {\n    form.setFieldsValue({\n      working_days: weeks\n    });\n  }, []);\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      getDays();\n    }\n  }, [activeMenu.refetch]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: !loading ? /*#__PURE__*/_jsxDEV(BookingTimeForm, {\n      onFinish: onFinish,\n      form: form,\n      lines: lines,\n      loadingBtn: loadingBtn,\n      days: days,\n      setDays: setDays,\n      setLines: setLines,\n      weeks: weeks\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(BookingTimeEdit, \"FVHX/1mXiyti4XaYw6fscQFunjY=\", false, function () {\n  return [useTranslation, Form.useForm, useSelector, useSelector, useDispatch, useNavigate];\n});\n\n_c = BookingTimeEdit;\nexport default BookingTimeEdit;\n\nvar _c;\n\n$RefreshReg$(_c, \"BookingTimeEdit\");","map":{"version":3,"names":["React","useState","useEffect","Loading","moment","weeks","BookingTimeForm","Form","sellerBookingTime","bookingClosedDays","shallowEqual","useSelector","bookingWorkingDays","useDispatch","disableRefetch","removeFromMenu","toast","useNavigate","useTranslation","fetchBookingTime","BookingTimeEdit","t","form","useForm","days","setDays","lines","setLines","Array","fill","loadingBtn","setLoadingBtn","loading","setLoading","myShop","state","activeMenu","menu","dispatch","navigate","onFinish","values","closeDatesBody","dates","map","item","format","undefined","workingDaysBody","working_days","day","title","from","to","disabled","workingMaxTime","max_time","nextUrl","Promise","all","create","update","uuid","length","then","success","getDays","getAll","res","setFieldsValue","data","finally","getById","closed_dates","filter","date","Date","itm","Boolean","refetch"],"sources":["/home/mostafa/Magde/new uzmart/admin/uzmart-admin-main/src/views/seller-views/booking-time/time-edit.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Loading from 'components/loading';\nimport moment from 'moment';\nimport { weeks } from 'components/shop/weeks';\nimport BookingTimeForm from 'components/forms/booking-time-form';\nimport { Form } from 'antd';\nimport sellerBookingTime from 'services/seller/booking-time';\nimport bookingClosedDays from 'services/seller/bookingClosedDays';\nimport { shallowEqual, useSelector } from 'react-redux';\nimport bookingWorkingDays from 'services/seller/bookingWorkingDays';\nimport { useDispatch } from 'react-redux';\nimport { disableRefetch, removeFromMenu } from 'redux/slices/menu';\nimport { toast } from 'react-toastify';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { fetchBookingTime } from 'redux/slices/booking-time';\n\nconst BookingTimeEdit = () => {\n  const { t } = useTranslation();\n  const [form] = Form.useForm();\n  const [days, setDays] = useState([]);\n  const [lines, setLines] = useState(new Array(7).fill(false));\n  const [loadingBtn, setLoadingBtn] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const { myShop } = useSelector((state) => state.myShop, shallowEqual);\n  const { activeMenu } = useSelector((state) => state.menu, shallowEqual);\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n\n  const onFinish = (values) => {\n    setLoadingBtn(true);\n    const closeDatesBody = {\n      dates: days\n        ? days.map((item) => moment(item).format('YYYY-MM-DD'))\n        : undefined,\n    };\n\n    const workingDaysBody = {\n      dates: values.working_days.map((item) => ({\n        day: item.title,\n        from: moment(item.from ? item.from : '00').format('HH-mm'),\n        to: moment(item.to ? item.to : '00').format('HH-mm'),\n        disabled: item.disabled,\n      })),\n    };\n\n    const workingMaxTime = {\n      max_time: values.max_time,\n    };\n    const nextUrl = 'seller/booking/time';\n\n    Promise.all([\n      sellerBookingTime.create(workingMaxTime),\n      bookingClosedDays.update(myShop.uuid, closeDatesBody),\n      values.working_days.length !== 0\n        ? bookingWorkingDays.update(myShop.uuid, workingDaysBody)\n        : undefined,\n    ]).then(() => {\n      toast.success(t('successfully.updated'));\n      dispatch(fetchBookingTime());\n      dispatch(removeFromMenu({ ...activeMenu, nextUrl }));\n      navigate(`/${nextUrl}`);\n    });\n  };\n\n  const getDays = () => {\n    setLoading(true);\n    sellerBookingTime\n      .getAll()\n      .then((res) => {\n        form.setFieldsValue({\n          max_time: res.data.max_time,\n        });\n      })\n      .finally(() => {\n        dispatch(disableRefetch(activeMenu));\n        setLoading(false);\n      });\n\n    bookingClosedDays\n      .getById(myShop.uuid)\n      .then((res) => {\n        setDays(\n          res.data.closed_dates\n            .filter(\n              (date) => date.day > moment(new Date()).format('YYYY-MM-DD')\n            )\n            .map((itm) => new Date(itm.day))\n        );\n      })\n      .finally(() => {\n        dispatch(disableRefetch(activeMenu));\n        setLoading(false);\n      });\n\n    bookingWorkingDays\n      .getById(myShop.uuid)\n      .then((res) => {\n        setLines(\n          res.data.dates.length !== 0\n            ? res.data.dates.map((item) => item.disabled)\n            : []\n        );\n\n        res.data.dates.length !== 0 &&\n          form.setFieldsValue({\n            working_days: res.data.dates.map((item) => ({\n              title: item.day,\n              from: moment(item.from, 'HH:mm:ss'),\n              to: moment(item.to, 'HH:mm:ss'),\n              disabled: Boolean(item.disabled),\n            })),\n          });\n      })\n      .finally(() => {\n        dispatch(disableRefetch(activeMenu));\n        setLoading(false);\n      });\n  };\n\n  useEffect(() => {\n    form.setFieldsValue({\n      working_days: weeks,\n    });\n  }, []);\n\n  useEffect(() => {\n    if (activeMenu.refetch) {\n      getDays();\n    }\n  }, [activeMenu.refetch]);\n\n  return (\n    <>\n      {!loading ? (\n        <BookingTimeForm\n          onFinish={onFinish}\n          form={form}\n          lines={lines}\n          loadingBtn={loadingBtn}\n          days={days}\n          setDays={setDays}\n          setLines={setLines}\n          weeks={weeks}\n        />\n      ) : (\n        <Loading />\n      )}\n    </>\n  );\n};\n\nexport default BookingTimeEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}