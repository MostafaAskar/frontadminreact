{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Card,Space,Table,Tabs,Tag,Tooltip}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{addMenu,disableRefetch,setMenuData}from'../../redux/slices/menu';import useDidUpdate from'../../helpers/useDidUpdate';import formatSortType from'../../helpers/formatSortType';import{useTranslation}from'react-i18next';import numberToPrice from'../../helpers/numberToPrice';import{EditOutlined,SettingOutlined}from'@ant-design/icons';import PayoutRequestModal from'./payoutActionModal';import FilterColumns from'../../components/filter-column';import{useNavigate}from'react-router-dom';import{fetchAdminPayouts}from'../../redux/slices/adminPayouts';import PayoutStatusChangeModal from'./payoutStatusChangeModal';import moment from'moment';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{TabPane}=Tabs;const roles=['all','accepted','pending','canceled'];export default function AdminPayouts(){var _activeMenu$data;const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[role,setRole]=useState('all');const immutable=((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.role)||role;const data=activeMenu.data;const paramsData={sort:data===null||data===void 0?void 0:data.sort,column:data===null||data===void 0?void 0:data.column,perPage:data===null||data===void 0?void 0:data.perPage,page:data===null||data===void 0?void 0:data.page,status:role==='all'?undefined:immutable};const{payoutRequests,meta,loading,params}=useSelector(state=>state.adminPayouts,shallowEqual);const[modal,setModal]=useState(null);const[selectedRow,setSelectedRow]=useState(null);const goToUser=row=>{dispatch(addMenu({url:`/users/user/${row.uuid}`,id:'user_info',name:t('user.info')}));navigate(`/users/user/${row.uuid}`,{state:{user_id:row.id}});};const[columns,setColumns]=useState([{title:t('user'),dataIndex:'createdBy',key:'createdBy',is_show:true,render:user=>/*#__PURE__*/_jsx(\"div\",{className:\"text-hover\",onClick:()=>goToUser(user),children:(user===null||user===void 0?void 0:user.firstname)+' '+(user===null||user===void 0?void 0:user.lastname)})},{title:t('price'),dataIndex:'price',key:'price',is_show:true,render:(price,row)=>{var _row$currency;return numberToPrice(price,(_row$currency=row.currency)===null||_row$currency===void 0?void 0:_row$currency.symbol);}},{title:t('status'),dataIndex:'status',key:'status',is_show:true,render:status=>/*#__PURE__*/_jsx(\"div\",{children:status==='pending'?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:t(status)}):status==='canceled'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(status)})})},{title:t('cause'),dataIndex:'cause',key:'cause',is_show:true},{title:t('created.at'),dataIndex:'created_at',key:'created_at',is_show:true,render:created_at=>moment(created_at).format('YYYY-MM-DD HH:mm')},{title:t('answer'),dataIndex:'answer',key:'answer',is_show:true},{title:t('options'),dataIndex:'uuid',key:'uuid',is_show:true,render:(uuid,row)=>/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(EditOutlined,{}),onClick:()=>setModal(row)}),row.status!=='accepted'&&/*#__PURE__*/_jsx(Tooltip,{title:t('change.status'),children:/*#__PURE__*/_jsx(Button,{onClick:()=>setSelectedRow(row),icon:/*#__PURE__*/_jsx(SettingOutlined,{})})})]})}]);useEffect(()=>{if(activeMenu.refetch){dispatch(fetchAdminPayouts(paramsData));dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);useDidUpdate(()=>{dispatch(fetchAdminPayouts(paramsData));},[activeMenu.data]);function onChangePagination(pagination,filters,sorter){const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{perPage,page,column,sort}}));}const handleFilter=items=>{const data=activeMenu.data;dispatch(setMenuData({activeMenu,data:{...data,...items}}));};return/*#__PURE__*/_jsxs(Card,{title:t('payout.requests'),extra:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setModal(true),type:\"primary\",children:t('create.payout')}),/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})]}),children:[/*#__PURE__*/_jsx(Tabs,{className:\"mt-3\",activeKey:immutable,onChange:key=>{handleFilter({role:key,page:1});setRole(key);},type:\"card\",children:roles.map(item=>/*#__PURE__*/_jsx(TabPane,{tab:t(item)},item))}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:payoutRequests,pagination:{pageSize:params.perPage,page:params.page,total:meta.total,defaultCurrent:params.page},rowKey:record=>record.id,onChange:onChangePagination,loading:loading}),modal&&/*#__PURE__*/_jsx(PayoutRequestModal,{data:modal,handleCancel:()=>setModal(null)}),selectedRow&&/*#__PURE__*/_jsx(PayoutStatusChangeModal,{data:selectedRow,statuses:roles,handleCancel:()=>setSelectedRow(null)})]});}","map":null,"metadata":{},"sourceType":"module"}