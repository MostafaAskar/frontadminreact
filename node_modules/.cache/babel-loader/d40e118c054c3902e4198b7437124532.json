{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useTranslation}from'react-i18next';import{shallowEqual,useSelector,useDispatch}from'react-redux';import{Button,Col,DatePicker,Form,InputNumber,Row,Switch}from'antd';import{DebounceSelect}from'components/search';import productService from'services/seller/product';import{setMenuData}from'redux/slices/menu';import moment from'moment/moment';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ProductBonusForm(_ref){let{form,handleSubmit}=_ref;const{t}=useTranslation();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const dispatch=useDispatch();const[loadingBtn,setLoadingBtn]=useState(false);const fetchProductsStock=search=>{const params={search,page:1,perPage:20};return productService.getStock(params).then(_ref2=>{let{data}=_ref2;return data===null||data===void 0?void 0:data.map(item=>{var _item$product,_item$product$transla,_item$extras,_item$extras2;return{label:(item===null||item===void 0?void 0:(_item$product=item.product)===null||_item$product===void 0?void 0:(_item$product$transla=_item$product.translation)===null||_item$product$transla===void 0?void 0:_item$product$transla.title)+`${(item===null||item===void 0?void 0:(_item$extras=item.extras)===null||_item$extras===void 0?void 0:_item$extras.length)>0?`: ${item===null||item===void 0?void 0:(_item$extras2=item.extras)===null||_item$extras2===void 0?void 0:_item$extras2.map(ext=>{var _ext$value;return ext===null||ext===void 0?void 0:(_ext$value=ext.value)===null||_ext$value===void 0?void 0:_ext$value.value;}).join(', ')}`:''}`,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});};const getInitialTimes=()=>{var _activeMenu$data,_activeMenu$data2;if(!((_activeMenu$data=activeMenu.data)!==null&&_activeMenu$data!==void 0&&_activeMenu$data.expired_at)){return{};}const data=JSON.parse((_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.expired_at);return{expired_at:moment(data,'YYYY-MM-DD')};};useEffect(()=>{return()=>{const data=form.getFieldsValue(true);const dataString={...data,expired_at:data===null||data===void 0?void 0:data.expired_at};dispatch(setMenuData({activeMenu,data:dataString}));};},[]);const onFinish=values=>{var _values$stock,_values$bonus_stock;setLoadingBtn(true);const body={stock_id:(_values$stock=values.stock)===null||_values$stock===void 0?void 0:_values$stock.value,value:values.stock_quantity,bonus_stock_id:(_values$bonus_stock=values.bonus_stock)===null||_values$bonus_stock===void 0?void 0:_values$bonus_stock.value,bonus_quantity:values.bonus_stock_quantity,expired_at:moment(values.expired_at).format('YYYY-MM-DD'),status:values.status,type:'count'};handleSubmit(body).finally(()=>setLoadingBtn(false));};return/*#__PURE__*/_jsxs(Form,{form:form,name:'product_bonus_form',layout:'vertical',onFinish:onFinish,initialValues:{status:true,...activeMenu.data// ...getInitialTimes(),\n},children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('products.stock'),name:'stock',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchProductsStock,placeholder:t('select.product.stock')})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('product.stock.quantity'),name:'stock_quantity',rules:[{required:true,message:t('required')},{type:'number',min:0,message:t('must.be.greater.than.0')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",placeholder:t('input.product.stock.quantity')})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('bonus.product.stock'),name:'bonus_stock',rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchProductsStock,placeholder:t('select.product.stock')})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('bonus.product.stock.quantity'),name:'bonus_stock_quantity',rules:[{required:true,message:t('required')},{type:'number',min:0,message:t('must.be.greater.than.0')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\",placeholder:t('input.bonus.product.stock.quantity')})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('expired.at'),name:\"expired_at\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DatePicker,{className:\"w-100\",placeholder:t('select.expired.at'),disabledDate:current=>moment().add(-1,'days')>=current})})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"status\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex flex-column justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})})})]});}","map":null,"metadata":{},"sourceType":"module"}