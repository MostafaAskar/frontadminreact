{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Card,Col,Form,message,Modal,Row,Space,Table}from'antd';import{DeleteOutlined}from'@ant-design/icons';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{setMenuData}from'redux/slices/menu';import productService from'services/seller/product';import{useTranslation}from'react-i18next';import{useParams}from'react-router-dom';import DeleteButton from'components/delete-button';import propertyService from'services/seller/property';import{DebounceSelect}from'components/search';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ProductProperty=_ref=>{let{next,prev}=_ref;const[form]=Form.useForm();const{t}=useTranslation();const dispatch=useDispatch();const{uuid}=useParams();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[dataSource,setDataSource]=useState([]);const[loadingBtn,setLoadingBtn]=useState(false);const[isFetching,setFetching]=useState(false);const[groupSelected,setGroupSelected]=useState(null);const column=[{key:'2',title:t('property.group'),dataIndex:'group',render:group=>{var _group$translation;return(group===null||group===void 0?void 0:(_group$translation=group.translation)===null||_group$translation===void 0?void 0:_group$translation.title)||'-';}},{key:'4',title:t('property.value'),dataIndex:'value',render:value=>(value===null||value===void 0?void 0:value.value)||'-'},{key:'5',title:t('options'),render:record=>{return/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(DeleteButton,{type:\"primary\",danger:true,icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),onClick:()=>onDeleteProduct(record)})});}}];useEffect(()=>{if(dataSource.length&&uuid){const properties=dataSource;dispatch(setMenuData({activeMenu,data:{...activeMenu.data,properties}}));}},[dataSource]);const addProperties=data=>{productService.properties(uuid,{properties:data}).then(()=>{message.success(t('product.properties.saved'));getPropduct(uuid);}).finally(()=>setLoadingBtn(false));};const onDeleteProduct=record=>{Modal.confirm({title:t('delete.product'),okText:t('yes'),okType:'danger',onOk:()=>{var _dataSource$filter;const data=dataSource===null||dataSource===void 0?void 0:(_dataSource$filter=dataSource.filter(item=>item.id!==record.id))===null||_dataSource$filter===void 0?void 0:_dataSource$filter.map(item=>{var _item$value;return item===null||item===void 0?void 0:(_item$value=item.value)===null||_item$value===void 0?void 0:_item$value.id;});addProperties(data);}});};const getPropduct=id=>{setFetching(true);productService.getById(id).then(_ref2=>{var _data$properties;let{data}=_ref2;setDataSource(data===null||data===void 0?void 0:(_data$properties=data.properties)===null||_data$properties===void 0?void 0:_data$properties.filter(item=>item===null||item===void 0?void 0:item.value));form.resetFields();}).catch(error=>{console.log(error);}).finally(()=>{setFetching(false);});};useEffect(()=>{if(uuid){getPropduct(uuid);}},[]);const onFinish=values=>{setLoadingBtn(true);const valuesProperties=values.propertyValue.map(item=>item.value);const oldIds=dataSource===null||dataSource===void 0?void 0:dataSource.map(item=>{var _item$value2;return item===null||item===void 0?void 0:(_item$value2=item.value)===null||_item$value2===void 0?void 0:_item$value2.id;});addProperties({...valuesProperties,...oldIds});};const fetchPropertyGroup=search=>{const params={search,perPage:10,page:1};return propertyService.getAllGroups(params).then(res=>res.data.map(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};}));};const fetchPropertyValue=search=>{const params={search,perPage:10,page:1,group_id:groupSelected===null||groupSelected===void 0?void 0:groupSelected.value};return propertyService.getAllValues(params).then(res=>res.data.map(item=>({label:item===null||item===void 0?void 0:item.value,value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id})));};return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Form,{name:\"property-form\",layout:\"vertical\",form:form,onFinish:onFinish,children:/*#__PURE__*/_jsxs(Row,{gutter:24,className:\"mb-3\",style:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Col,{span:10,children:/*#__PURE__*/_jsx(Form.Item,{name:'propertyGroup',label:t('property.group'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchPropertyGroup,placeholder:t('select.group'),onSelect:item=>{setGroupSelected(item);form.setFieldsValue({propertyValue:[]});},onClear:()=>{setGroupSelected(null);form.setFieldsValue({propertyValue:[]});}})})}),/*#__PURE__*/_jsx(Col,{span:10,children:/*#__PURE__*/_jsx(Form.Item,{name:'propertyValue',label:t('property.value'),rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchPropertyValue,placeholder:t('select.value'),refetchOptions:true,disabled:!groupSelected,mode:\"multiple\"})})}),/*#__PURE__*/_jsx(Col,{span:4,children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('save')})})]})}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},columns:column,dataSource:dataSource,pagination:false,rowKey:record=>record.id,loading:isFetching}),/*#__PURE__*/_jsxs(Space,{className:\"mt-4\",children:[/*#__PURE__*/_jsx(Button,{onClick:prev,children:t('prev')}),/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:next,children:t('next')})]})]});};export default ProductProperty;","map":null,"metadata":{},"sourceType":"module"}