{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Card,Select,Space,Table,Tabs,Tag}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{addMenu,disableRefetch,setMenuData}from'../../redux/slices/menu';import useDidUpdate from'../../helpers/useDidUpdate';import formatSortType from'../../helpers/formatSortType';import{useTranslation}from'react-i18next';import{fetchPayoutRequests}from'../../redux/slices/payoutRequests';import numberToPrice from'../../helpers/numberToPrice';import{EditOutlined}from'@ant-design/icons';import PayoutRequestModal from'./payoutRequestModal';import FilterColumns from'../../components/filter-column';import{useNavigate}from'react-router-dom';import moment from'moment';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const{TabPane}=Tabs;const roles=['processed','paid','rejected','canceled'];export default function PayoutRequests(){var _activeMenu$data;const{t}=useTranslation();const dispatch=useDispatch();const navigate=useNavigate();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[role,setRole]=useState('processed');const immutable=((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.role)||role;const data=activeMenu.data;const paramsData={sort:data===null||data===void 0?void 0:data.sort,column:data===null||data===void 0?void 0:data.column,perPage:data===null||data===void 0?void 0:data.perPage,page:data===null||data===void 0?void 0:data.page,status:immutable};const{payoutRequests,meta,loading,params}=useSelector(state=>state.payoutRequests,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const[modal,setModal]=useState(null);const goToUser=row=>{dispatch(addMenu({url:`/users/user/${row.uuid}`,id:'user_info',name:t('user.info')}));navigate(`/users/user/${row.uuid}`,{state:{user_id:row.id}});};const[columns,setColumns]=useState([{title:t('id'),dataIndex:'id',key:'id',sorter:true,is_show:true},{title:t('user'),dataIndex:'user',key:'user',is_show:true,render:user=>/*#__PURE__*/_jsx(\"div\",{className:\"text-hover\",onClick:()=>goToUser(user),children:user.firstname+' '+user.lastname})},{title:t('price'),dataIndex:'price',key:'price',is_show:true,render:price=>numberToPrice(price,defaultCurrency.symbol)},{title:t('status'),dataIndex:'status',key:'status',is_show:true,render:status=>/*#__PURE__*/_jsx(\"div\",{children:status==='processed'?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:t(status)}):status==='rejected'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(status)})})},{title:t('note'),dataIndex:'note',key:'note',is_show:true},{title:t('created.at'),dataIndex:'created_at',key:'created_at',is_show:true,render:created_at=>moment(created_at).format('YYYY-MM-DD HH:mm')},{title:t('options'),dataIndex:'uuid',key:'uuid',is_show:true,render:(uuid,row)=>/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(EditOutlined,{}),onClick:()=>setModal(row),disabled:row.status!=='processed'})})}]);useEffect(()=>{if(activeMenu.refetch){dispatch(fetchPayoutRequests(paramsData));dispatch(disableRefetch(activeMenu));}},[activeMenu.refetch]);useDidUpdate(()=>{dispatch(fetchPayoutRequests(paramsData));},[activeMenu.data]);function onChangePagination(pagination,filters,sorter){const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{perPage,page,column,sort}}));}const handleFilter=items=>{const data=activeMenu.data;dispatch(setMenuData({activeMenu,data:{...data,...items}}));};return/*#__PURE__*/_jsxs(Card,{title:t('payout.requests'),extra:/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})}),children:[/*#__PURE__*/_jsx(Tabs,{className:\"mt-3\",activeKey:immutable,onChange:key=>{handleFilter({role:key,page:1});setRole(key);},type:\"card\",children:roles.map(item=>/*#__PURE__*/_jsx(TabPane,{tab:t(item)},item))}),/*#__PURE__*/_jsx(Table,{scroll:{x:true},columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:payoutRequests,pagination:{pageSize:params.perPage,page:params.page,total:meta.total,defaultCurrent:params.page},rowKey:record=>record.id,onChange:onChangePagination,loading:loading}),modal&&/*#__PURE__*/_jsx(PayoutRequestModal,{data:modal,handleCancel:()=>setModal(null)})]});}","map":null,"metadata":{},"sourceType":"module"}