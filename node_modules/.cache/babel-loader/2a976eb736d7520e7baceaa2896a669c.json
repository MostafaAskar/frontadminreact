{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Input,Form,Row,Col,Button,Card,InputNumber,Switch}from'antd';import{toast}from'react-toastify';import{useNavigate,useParams}from'react-router-dom';import parcelTypeService from'services/parcelType';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'redux/slices/menu';import{useTranslation}from'react-i18next';import createImage from'helpers/createImage';import Loading from'components/loading';import MediaUpload from'components/upload';import{fetchParcelTypes}from'redux/slices/parcelTypes';import parcelOptionService from'services/parcel-option';import{RefetchSearch}from'components/refetch-search';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ParcelType(){var _activeMenu$data,_activeMenu$data2;const{t}=useTranslation();const navigate=useNavigate();const{id}=useParams();const dispatch=useDispatch();const[form]=Form.useForm();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);const[image,setImage]=useState((activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.image)||[]);const[special,setSpecial]=useState(activeMenu===null||activeMenu===void 0?void 0:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.special);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,...data}}));};},[]);const fetchParcel=id=>{setLoading(true);parcelTypeService.getById(id).then(res=>{let data=res.data;setImage([createImage(data.img)]);setSpecial(data.special);form.setFieldsValue({...data,options:data===null||data===void 0?void 0:data.options.map(option=>{var _option$translation;return{label:(_option$translation=option.translation)===null||_option$translation===void 0?void 0:_option$translation.title,value:option.id};})});}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const onFinish=values=>{var _values$options;setLoadingBtn(true);const body={...values,special:Boolean(values.special),special_price:values.special_price||0,special_price_per_km:values.special_price_per_km||0,images:image===null||image===void 0?void 0:image.map(item=>item.name),image:undefined,options:(_values$options=values.options)===null||_values$options===void 0?void 0:_values$options.map(option=>option.value)};const nextUrl='parcel-types';if(!id){parcelTypeService.create(body).then(()=>{dispatch(fetchParcelTypes());toast.success(t('successfully.created'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);}).finally(()=>setLoadingBtn(false));}else{parcelTypeService.update(id,body).then(()=>{dispatch(fetchParcelTypes());toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));navigate(`/${nextUrl}`);}).finally(()=>setLoadingBtn(false));}};const getOptions=async search=>{return parcelOptionService.getAll({search}).then(_ref=>{let{data}=_ref;return data.map(item=>{var _item$translation;return{label:item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title,value:item===null||item===void 0?void 0:item.id};});});};useEffect(()=>{if(activeMenu.refetch&&id){fetchParcel(id);}},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:id?t('edit.parcel.type'):t('add.parcel.type'),children:!loading?/*#__PURE__*/_jsxs(Form,{form:form,name:\"parcel-type\",layout:\"vertical\",initialValues:{...activeMenu.data},onFinish:onFinish,children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('title'),name:\"type\",rules:[{validator(_,value){if(!value){return Promise.reject(new Error(t('required')));}else if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(Input,{})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('image'),name:\"images\",rules:[{validator(){if((image===null||image===void 0?void 0:image.length)===0){return Promise.reject(new Error(t('required')));}return Promise.resolve();}}],children:/*#__PURE__*/_jsx(MediaUpload,{type:\"languages\",imageList:image,setImageList:setImage,form:form,multiple:false})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('start.price'),name:\"price\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('price.per.km'),name:\"price_per_km\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('min_width'),name:\"min_width\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:32678,className:\"w-100\",addonAfter:\"sm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('max_width'),name:\"max_width\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:32678,className:\"w-100\",addonAfter:\"sm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('min_height'),name:\"min_height\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:32678,className:\"w-100\",addonAfter:\"sm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('max_height'),name:\"max_height\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:32678,className:\"w-100\",addonAfter:\"sm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('min_length'),name:\"min_length\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:32678,className:\"w-100\",addonAfter:\"sm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('max_length'),name:\"max_length\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:32678,className:\"w-100\",addonAfter:\"sm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('min_weight'),name:\"min_g\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:32678,className:\"w-100\",addonAfter:\"gramm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('max_weight'),name:\"max_g\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:2147000000,className:\"w-100\",addonAfter:\"gramm\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('options'),name:\"options\",children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:getOptions,mode:\"multiple\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('max.range'),name:\"max_range\",children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\",addonAfter:\"km\"})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('special'),name:\"special\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{onChange:value=>setSpecial(value)})})}),!!special&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('start.price'),name:\"special_price\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('price.per.km'),name:\"special_price_per_km\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{min:0,className:\"w-100\"})})})]})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('save')})]}):/*#__PURE__*/_jsx(Loading,{})});}","map":null,"metadata":{},"sourceType":"module"}