{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Card,Col,Row}from'antd';import shopService from'services/shop';import brandService from'services/brand';import categoryService from'services/category';import useDidUpdate from'helpers/useDidUpdate';import{batch,shallowEqual,useDispatch,useSelector}from'react-redux';import{fetchRestProducts}from'redux/slices/product';import SearchInput from'components/search-input';import{useTranslation}from'react-i18next';import{setCartData,setProductsParams}from'redux/slices/cart';import{fetchRestPayments}from'redux/slices/payment';import{disableRefetch}from'redux/slices/menu';import{InfiniteSelect}from'components/infinite-select';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Filter=()=>{const{t}=useTranslation();const dispatch=useDispatch();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{currentBag,productsParams}=useSelector(state=>state.cart,shallowEqual);const[search,setSearch]=useState(productsParams===null||productsParams===void 0?void 0:productsParams.search);const[shop,setShop]=useState(productsParams===null||productsParams===void 0?void 0:productsParams.shop);const[category,setCategory]=useState(productsParams===null||productsParams===void 0?void 0:productsParams.category);const[brand,setBrand]=useState(productsParams===null||productsParams===void 0?void 0:productsParams.brand);const[links,setLinks]=useState(null);useEffect(()=>{setSearch(productsParams===null||productsParams===void 0?void 0:productsParams.search);setShop(productsParams===null||productsParams===void 0?void 0:productsParams.shop);setCategory(productsParams===null||productsParams===void 0?void 0:productsParams.category);setBrand(productsParams===null||productsParams===void 0?void 0:productsParams.brand);setLinks(null);},[productsParams]);const params={...productsParams,search,active:1,status:'published',page:1,perPage:12};async function fetchUserShop(_ref){let{search,page}=_ref;const params={search,page,status:'approved'};return shopService.search(params).then(res=>{setLinks(res===null||res===void 0?void 0:res.links);return res.data.map(item=>{var _item$translation$tit,_item$translation;return{label:(_item$translation$tit=item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title)!==null&&_item$translation$tit!==void 0?_item$translation$tit:'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}async function fetchUserBrand(_ref2){let{search,page=1}=_ref2;const params={search,page};return brandService.search(params).then(res=>{setLinks(res===null||res===void 0?void 0:res.links);return res.data.map(item=>{var _item$title;return{label:(_item$title=item===null||item===void 0?void 0:item.title)!==null&&_item$title!==void 0?_item$title:'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}async function fetchUserCategory(_ref3){let{search,page}=_ref3;const params={search,page,type:'main'};return categoryService.search(params).then(res=>{setLinks(res===null||res===void 0?void 0:res.links);return res.data.map(item=>{var _item$translation$tit2,_item$translation2;return{label:(_item$translation$tit2=item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title)!==null&&_item$translation$tit2!==void 0?_item$translation$tit2:'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}useDidUpdate(()=>{batch(()=>{dispatch(setProductsParams({search}));dispatch(fetchRestProducts(params));});},[brand,category,search,shop]);useEffect(()=>{if(activeMenu.refetch){batch(()=>{dispatch(fetchRestPayments(params));dispatch(setCartData({bag_id:currentBag}));dispatch(fetchRestProducts(params));dispatch(disableRefetch(activeMenu));});}},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(SearchInput,{className:\"w-100\",placeholder:t('search'),handleChange:setSearch})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(InfiniteSelect,{className:\"w-100\",hasMore:links===null||links===void 0?void 0:links.next,debounceTimeout:500,placeholder:t('select.shop'),fetchOptions:fetchUserShop,onChange:value=>{setShop(value);dispatch(setProductsParams({shop_id:value===null||value===void 0?void 0:value.value,shop:value}));},value:shop})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(InfiniteSelect,{className:\"w-100\",hasMore:links===null||links===void 0?void 0:links.next,allowClear:true,placeholder:t('select.category'),fetchOptions:fetchUserCategory,onChange:value=>{setCategory(value);dispatch(setProductsParams({category_id:value===null||value===void 0?void 0:value.value,category:value}));},value:category})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(InfiniteSelect,{hasMore:links===null||links===void 0?void 0:links.next,className:\"w-100\",placeholder:t('select.brand'),fetchOptions:fetchUserBrand,onChange:value=>{setBrand(value);dispatch(setProductsParams({brand_id:value===null||value===void 0?void 0:value.value,brand:value}));},value:brand,allowClear:true})})]})});};export default Filter;","map":null,"metadata":{},"sourceType":"module"}