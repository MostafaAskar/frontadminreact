{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{Button,Space,Card,DatePicker}from'antd';import{useNavigate,useParams}from'react-router-dom';import{ClearOutlined,PlusCircleOutlined}from'@ant-design/icons';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{addMenu,disableRefetch,setMenuData}from'../../../redux/slices/menu';import{useTranslation}from'react-i18next';import useDidUpdate from'../../../helpers/useDidUpdate';import{fetchOrders as fetchSellerOrders}from'../../../redux/slices/sellerOrders';import SearchInput from'../../../components/search-input';import{DebounceSelect}from'../../../components/search';import userService from'../../../services/seller/user';import{fetchRestOrderStatus}from'../../../redux/slices/orderStatus';import{Context}from'../../../context/context';import{toast}from'react-toastify';import orderService from'../../../services/seller/order';import Incorporate from'./dnd/Incorporate';import{clearItems,fetchAcceptedOrders,fetchCanceledOrders,fetchDeliveredOrders,fetchNewOrders,fetchOnAWayOrders,fetchReadyOrders,fetchCookingOrders,fetchPauseOrders}from'../../../redux/slices/sellerOrders';import{batch}from'react-redux';import OrderDeliveryman from'./orderDeliveryman';import OrderTypeSwitcher from'./order-type-switcher';import{clearOrder}from'../../../redux/slices/order';import ShowLocationsMap from'./show-locations.map';import DownloadModal from'./downloadModal';import CustomModal from'../../../components/modal';import moment from'moment';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const{RangePicker}=DatePicker;export default function SellerOrdersBoard(){var _activeMenu$data3;const dispatch=useDispatch();const navigate=useNavigate();const{t}=useTranslation();const[id,setId]=useState(null);const{setIsModalVisible}=useContext(Context);const[text,setText]=useState(null);const[loadingBtn,setLoadingBtn]=useState(false);const[locationsMap,setLocationsMap]=useState(null);const[dowloadModal,setDowloadModal]=useState(null);const[orderDeliveryDetails,setOrderDeliveryDetails]=useState(null);const[type,setType]=useState(null);const[dateRange,setDateRange]=useState(null);const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const urlParams=useParams();const orderType=urlParams===null||urlParams===void 0?void 0:urlParams.type;const data=activeMenu===null||activeMenu===void 0?void 0:activeMenu.data;const goToShow=row=>{dispatch(addMenu({url:`seller/order/details/${row.id}`,id:'order_details',name:t('order.details')}));navigate(`/seller/order/details/${row.id}`);};const orderDelete=()=>{setLoadingBtn(true);const params={...Object.assign({},...id.map((item,index)=>({[`ids[${index}]`]:item})))};orderService.delete(params).then(()=>{dispatch(clearItems());toast.success(t('successfully.deleted'));setIsModalVisible(false);fetchOrderAllItem({status:type});setText(null);}).finally(()=>{setId(null);setLoadingBtn(false);});};useDidUpdate(()=>{dispatch(clearItems());fetchOrderAllItem();},[data]);useEffect(()=>{if(activeMenu!==null&&activeMenu!==void 0&&activeMenu.refetch){const params={status:data===null||data===void 0?void 0:data.status,perPage:10,delivery_type:orderType};dispatch(fetchSellerOrders(params));dispatch(fetchRestOrderStatus({}));dispatch(disableRefetch(activeMenu));}},[activeMenu===null||activeMenu===void 0?void 0:activeMenu.refetch]);const handleFilter=(item,name)=>{batch(()=>{dispatch(clearItems());dispatch(setMenuData({activeMenu,data:{...data,[name]:item}}));});};async function getUsers(search){const params={search,perPage:10};return userService.getAll(params).then(_ref=>{let{data}=_ref;return data.map(item=>({label:`${item.firstname} ${item.lastname||''}`,value:item.id}));});}const fetchOrdersCase=params=>{var _activeMenu$data,_activeMenu$data2,_dateRange$,_dateRange$2;const paramsWithType={...params,delivery_type:orderType,delivery_date_from:type==='scheduled'?moment().add(1,'day').format('YYYY-MM-DD'):undefined,search:data!==null&&data!==void 0&&data.search?data.search:undefined,user_id:data===null||data===void 0?void 0:data.client_id,status:params===null||params===void 0?void 0:params.status,shop_id:((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.shop_id)!==null?(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.shop_id:null,date_from:(dateRange===null||dateRange===void 0?void 0:(_dateRange$=dateRange[0])===null||_dateRange$===void 0?void 0:_dateRange$.format('YYYY-MM-DD'))||undefined,date_to:(dateRange===null||dateRange===void 0?void 0:(_dateRange$2=dateRange[1])===null||_dateRange$2===void 0?void 0:_dateRange$2.format('YYYY-MM-DD'))||undefined};switch(params.status){case'new':dispatch(fetchNewOrders(paramsWithType));break;case'accepted':dispatch(fetchAcceptedOrders(paramsWithType));break;case'ready':dispatch(fetchReadyOrders(paramsWithType));break;case'on_a_way':dispatch(fetchOnAWayOrders(paramsWithType));break;case'delivered':dispatch(fetchDeliveredOrders(paramsWithType));break;case'canceled':dispatch(fetchCanceledOrders(paramsWithType));break;case'cooking':dispatch(fetchCookingOrders(paramsWithType));break;case'pause':dispatch(fetchPauseOrders(paramsWithType));break;default:console.log(`Sorry, we are out of`);}};const fetchOrderAllItem=()=>{fetchOrdersCase({status:'new'});fetchOrdersCase({status:'accepted'});fetchOrdersCase({status:'ready'});fetchOrdersCase({status:'on_a_way'});fetchOrdersCase({status:'delivered'});fetchOrdersCase({status:'canceled'});fetchOrdersCase({status:'cooking'});fetchOrdersCase({status:'pause'});};const handleClear=()=>{batch(()=>{dispatch(clearItems());dispatch(setMenuData({activeMenu,data:null}));});fetchOrderAllItem();};const handleCloseModal=()=>{setOrderDeliveryDetails(null);setLocationsMap(null);setDowloadModal(null);};const goToAddOrder=()=>{dispatch(clearOrder());dispatch(addMenu({id:'pos.system',url:'seller/pos-system',name:t('add.order')}));navigate('/seller/pos-system',{state:{delivery_type:orderType}});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Space,{className:\"justify-content-end w-100 mb-3\",children:[/*#__PURE__*/_jsx(OrderTypeSwitcher,{listType:\"seller/orders-board\"}),/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),onClick:goToAddOrder,style:{width:'100%'},children:t('add.order')})]}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[/*#__PURE__*/_jsx(SearchInput,{placeholder:t('search'),handleChange:search=>handleFilter(search,'search'),defaultValue:(_activeMenu$data3=activeMenu.data)===null||_activeMenu$data3===void 0?void 0:_activeMenu$data3.search,resetSearch:!(data!==null&&data!==void 0&&data.search)}),/*#__PURE__*/_jsx(DebounceSelect,{placeholder:t('select.client'),fetchOptions:getUsers,onSelect:user=>handleFilter(user.value,'client_id'),onDeselect:()=>handleFilter(null,'client_id'),style:{minWidth:200},value:data===null||data===void 0?void 0:data.client_id}),type!=='scheduled'&&/*#__PURE__*/_jsx(RangePicker,{defaultValue:dateRange,onChange:values=>{handleFilter(JSON.stringify(values),'data_time');setDateRange(values);},disabledDate:current=>{return current&&current>moment().endOf('day');},allowClear:true,style:{width:'100%'},onClear:()=>{dispatch(clearItems());setDateRange(null);}}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(ClearOutlined,{}),onClick:handleClear,children:t('clear')})]})}),/*#__PURE__*/_jsx(Incorporate,{goToShow:goToShow,fetchOrderAllItem:fetchOrderAllItem,fetchOrders:fetchOrdersCase,setLocationsMap:setLocationsMap,setId:setId,setIsModalVisible:setIsModalVisible,setText:setText,setDowloadModal:setDowloadModal,type:type,setType:setType,orderType:orderType}),/*#__PURE__*/_jsx(CustomModal,{click:orderDelete,text:text?t('delete'):t('all.delete'),loading:loadingBtn,setText:setId,setActive:setId}),orderDeliveryDetails&&/*#__PURE__*/_jsx(OrderDeliveryman,{orderDetails:orderDeliveryDetails,handleCancel:handleCloseModal}),locationsMap&&/*#__PURE__*/_jsx(ShowLocationsMap,{id:locationsMap,handleCancel:handleCloseModal}),dowloadModal&&/*#__PURE__*/_jsx(DownloadModal,{id:dowloadModal,handleCancel:handleCloseModal})]});}","map":null,"metadata":{},"sourceType":"module"}