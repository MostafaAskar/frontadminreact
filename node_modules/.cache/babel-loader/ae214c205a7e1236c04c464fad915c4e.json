{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Button,Col,Descriptions,Form,Image,Modal,Row,Space}from'antd';import{shallowEqual,useDispatch,useSelector}from'react-redux';import getImage from'../../../helpers/getImage';import{MinusOutlined,PlusOutlined}from'@ant-design/icons';import{addOrderItem}from'../../../redux/slices/order';import numberToPrice from'../../../helpers/numberToPrice';import{toast}from'react-toastify';import getImageFromStock from'../../../helpers/getImageFromStock';import{getExtras,sortExtras}from'../../../helpers/getExtras';import numberToQuantity from'../../../helpers/numberToQuantity';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ExtrasModal(_ref){var _data$translation,_data$stock,_data$translation2,_data$translation3,_showExtras$extras,_data$unit,_data$unit$translatio;let{extrasModal:data,setExtrasModal}=_ref;const[currentStock,setCurrentStock]=useState(data.stock);const[counter,setCounter]=useState(data.quantity||data.min_qty);const[extras,setExtras]=useState([]);const[stock,setStock]=useState([]);const[showExtras,setShowExtras]=useState(null);const[extrasIds,setExtrasIds]=useState([]);const{currency}=useSelector(state=>state.order.data,shallowEqual);const[form]=Form.useForm();const dispatch=useDispatch();useEffect(()=>{if(showExtras!==null&&showExtras!==void 0&&showExtras.stock){setCurrentStock({...showExtras.stock,extras:extrasIds});}},[showExtras]);useEffect(()=>{var _getExtras$extras;const myData=sortExtras(data);setExtras(myData.extras);setStock(myData.stock);setShowExtras(getExtras('',myData.extras,myData.stock));(_getExtras$extras=getExtras('',myData.extras,myData.stock).extras)===null||_getExtras$extras===void 0?void 0:_getExtras$extras.forEach(element=>{setExtrasIds(prev=>[...prev,element[0]]);});},[data]);const handleExtrasClick=e=>{var _extrasData$extras;const index=extrasIds.findIndex(item=>item.extra_group_id===e.extra_group_id);let array=extrasIds;if(index>-1)array=array.slice(0,index);array.push(e);const nextIds=array.map(item=>item.id).join(',');var extrasData=getExtras(nextIds,extras,stock);setShowExtras(extrasData);(_extrasData$extras=extrasData.extras)===null||_extrasData$extras===void 0?void 0:_extrasData$extras.forEach(element=>{const index=extrasIds.findIndex(item=>element[0].extra_group_id!=e.extra_group_id?item.extra_group_id===element[0].extra_group_id:item.extra_group_id===e.extra_group_id);if(element[0].level>=e.level){var itemData=element[0].extra_group_id!=e.extra_group_id?element[0]:e;if(index==-1)array.push(itemData);else{array[index]=itemData;}}});setExtrasIds(array);};const handleCancel=()=>{setExtrasModal(false);};const onFinish=values=>{const orderItem={...data,stock:currentStock,quantity:counter,id:currentStock.id,img:getImageFromStock(currentStock)||data.img};if(orderItem.quantity>currentStock.quantity){toast.warning(`You cannot order more than ${currentStock.quantity}`);return;}dispatch(addOrderItem(orderItem));setExtrasModal(null);};function addCounter(){if(counter===(currentStock===null||currentStock===void 0?void 0:currentStock.quantity)){return;}if(counter===data.max_qty){return;}setCounter(prev=>prev+1);}function reduceCounter(){if(counter===1){return;}if(counter<=data.min_qty){return;}setCounter(prev=>prev-1);}return/*#__PURE__*/_jsx(Modal,{visible:!!data,title:(_data$translation=data.translation)===null||_data$translation===void 0?void 0:_data$translation.title,onCancel:handleCancel,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>form.submit(),children:\"Add\"}),/*#__PURE__*/_jsx(Button,{type:\"default\",onClick:handleCancel,children:\"Cancel\"})],children:/*#__PURE__*/_jsxs(Form,{form:form,layout:\"vertical\",onFinish:onFinish,initialValues:{stock:(_data$stock=data.stock)===null||_data$stock===void 0?void 0:_data$stock.id},children:[/*#__PURE__*/_jsxs(Row,{gutter:24,children:[/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(Image,{src:getImage(getImageFromStock(currentStock)||data.img),alt:(_data$translation2=data.translation)===null||_data$translation2===void 0?void 0:_data$translation2.title,height:200,style:{objectFit:'contain'}})}),/*#__PURE__*/_jsx(Col,{span:16,children:/*#__PURE__*/_jsxs(Descriptions,{title:(_data$translation3=data.translation)===null||_data$translation3===void 0?void 0:_data$translation3.title,children:[/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"Price\",span:3,children:[/*#__PURE__*/_jsx(\"div\",{className:currentStock!==null&&currentStock!==void 0&&currentStock.discount?'strike':'',children:numberToPrice(currentStock===null||currentStock===void 0?void 0:currentStock.price,currency.symbol)}),currentStock!==null&&currentStock!==void 0&&currentStock.discount?/*#__PURE__*/_jsx(\"div\",{className:\"ml-2 font-weight-bold\",children:numberToPrice(currentStock===null||currentStock===void 0?void 0:currentStock.total_price,currency.symbol)}):'']}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"In stock\",span:3,children:numberToQuantity(currentStock===null||currentStock===void 0?void 0:currentStock.quantity,data.unit)}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"Tax\",span:3,children:numberToPrice(currentStock===null||currentStock===void 0?void 0:currentStock.tax,currency.symbol)})]})})]}),showExtras===null||showExtras===void 0?void 0:(_showExtras$extras=showExtras.extras)===null||_showExtras$extras===void 0?void 0:_showExtras$extras.map((item,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"extra-group\",children:/*#__PURE__*/_jsx(Space,{className:\"extras-select\",children:item.map(el=>{if(el.group.type==='color'){return/*#__PURE__*/_jsx(\"span\",{className:`extras-color-wrapper ${!!extrasIds.find(extra=>extra.id===el.id)?'selected':''}`,onClick:()=>handleExtrasClick(el),children:/*#__PURE__*/_jsx(\"i\",{className:\"extras-color\",style:{backgroundColor:el.value}})});}else if(el.group.type==='text'){return/*#__PURE__*/_jsx(\"span\",{className:`extras-text rounded ${!!extrasIds.find(extra=>extra.id===el.id)?'selected':''}`,onClick:()=>handleExtrasClick(el),children:el.value});}return/*#__PURE__*/_jsx(\"span\",{className:`extras-image rounded ${!!extrasIds.find(extra=>extra.id===el.id)?'selected':''}`,onClick:()=>handleExtrasClick(el),children:/*#__PURE__*/_jsx(\"img\",{src:getImage(el.value),alt:\"extra\"})});})},'extra-group'+idx)})),/*#__PURE__*/_jsx(Row,{gutter:12,className:\"mt-3\",children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(MinusOutlined,{}),onClick:reduceCounter}),(counter||1)*((data===null||data===void 0?void 0:data.interval)||1),data===null||data===void 0?void 0:(_data$unit=data.unit)===null||_data$unit===void 0?void 0:(_data$unit$translatio=_data$unit.translation)===null||_data$unit$translatio===void 0?void 0:_data$unit$translatio.title,/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(PlusOutlined,{}),onClick:addCounter})]})})})]})});}","map":null,"metadata":{},"sourceType":"module"}