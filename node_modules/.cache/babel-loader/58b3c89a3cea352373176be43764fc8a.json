{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Card,Col,Modal,Row,Steps,Tag}from'antd';import GoogleMapReact from'google-map-react';import{useTranslation}from'react-i18next';import parcelOrderService from'services/parcelOrder';import Loading from'components/loading';import{BsCalendar2Day,BsCheckLg,BsTruck}from'react-icons/bs';import{shallowEqual,useSelector}from'react-redux';import{MAP_API_KEY}from'configs/app-global';import FaUser from'assets/images/user.jpg';import FaStore from'assets/images/shop.png';import getDefaultLocation from'helpers/getDefaultLocation';import{FileDoneOutlined,ShoppingCartOutlined}from'@ant-design/icons';import{IoCheckmarkDoneSharp}from'react-icons/io5';import{AiOutlineCloseCircle}from'react-icons/ai';import getFullDateTime from'helpers/getFullDateTime';import getFullDate from'helpers/getFullDate';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const{Step}=Steps;const User=()=>/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',transform:'translate(-50%, -100%)'},children:/*#__PURE__*/_jsx(\"img\",{src:FaUser,width:\"50\",alt:\"Pin\"})});const Store=()=>/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',transform:'translate(-50%, -100%)'},children:/*#__PURE__*/_jsx(\"img\",{src:FaStore,width:\"50\",alt:\"Pin\"})});const colors=['blue','red','gold','volcano','cyan','lime'];const ShowLocationsMap=_ref=>{var _data$shop,_data$shop$translatio,_data$details,_data$transaction,_data$transaction$pay,_data$transaction2;let{id,handleCancel}=_ref;const{t}=useTranslation();const[loading,setLoading]=useState(null);const[data,setData]=useState(null);const[status,setStatus]=useState(null);const{settings}=useSelector(state=>state.globalSettings,shallowEqual);const center=getDefaultLocation(settings);const[current,setCurrent]=useState(0);const[shop,setShop]=useState(getDefaultLocation(settings));const[user,setUser]=useState(getDefaultLocation(settings));const[steps,setSteps]=useState([{id:0,name:'new',icon:/*#__PURE__*/_jsx(ShoppingCartOutlined,{})},{id:1,name:'accepted',icon:/*#__PURE__*/_jsx(FileDoneOutlined,{})},{id:3,name:'ready',icon:/*#__PURE__*/_jsx(BsCheckLg,{})},{id:4,name:'on_a_way',icon:/*#__PURE__*/_jsx(BsTruck,{})},{id:5,name:'delivered',icon:/*#__PURE__*/_jsx(IoCheckmarkDoneSharp,{})}]);function fetchOrder(){setLoading(true);parcelOrderService.getById(id).then(_ref2=>{var _steps$find;let{data}=_ref2;setSteps(data.status==='canceled'?[{id:1,name:'new',icon:/*#__PURE__*/_jsx(ShoppingCartOutlined,{})},{id:5,name:'canceled',icon:/*#__PURE__*/_jsx(AiOutlineCloseCircle,{})}]:steps);setCurrent(data.status==='canceled'?1:(_steps$find=steps.find(item=>item.name===data.status))===null||_steps$find===void 0?void 0:_steps$find.id);setStatus(data.status==='canceled'?'error':'success');setData(data);setUser({lat:data.address_from.latitude,lng:data.address_from.longitude});setShop({lat:data.address_to.latitude,lng:data.address_to.longitude});}).finally(()=>{setLoading(false);});}const{google_map_key}=useSelector(state=>state.globalSettings.settings,shallowEqual);useEffect(()=>{fetchOrder();},[]);const handleLoadMap=_ref3=>{let{map,maps}=_ref3;const markers=[shop,user].map(item=>({lat:Number(item.lat||'0'),lng:Number(item.lng||'0')}));let bounds=new maps.LatLngBounds();for(var i=0;i<markers.length;i++){bounds.extend(markers[i]);}map.fitBounds(bounds);};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Modal,{visible:!!id,title:t('show.locations'),onCancel:()=>handleCancel(),style:{minWidth:'80vw'},footer:[/*#__PURE__*/_jsx(Button,{type:\"default\",onClick:handleCancel,children:t('cancel')},'cancelBtn')],children:loading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Steps,{current:current,status:status,className:\"mb-5\",children:steps===null||steps===void 0?void 0:steps.map((item,index)=>/*#__PURE__*/_jsx(Step,{title:t(item.name),icon:item===null||item===void 0?void 0:item.icon},item.id+index))}),/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsxs(Col,{span:12,children:[/*#__PURE__*/_jsxs(\"h3\",{children:[t('order.id'),\" #\",data===null||data===void 0?void 0:data.id]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(BsCalendar2Day,{}),\" \",getFullDateTime(data===null||data===void 0?void 0:data.created_at)]}),/*#__PURE__*/_jsxs(\"p\",{children:[t('delivery.time'),\": \",getFullDateTime(data===null||data===void 0?void 0:data.delivery_date)]}),/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:data===null||data===void 0?void 0:(_data$shop=data.shop)===null||_data$shop===void 0?void 0:(_data$shop$translatio=_data$shop.translation)===null||_data$shop$translatio===void 0?void 0:_data$shop$translatio.title}),' ',data===null||data===void 0?void 0:(_data$details=data.details)===null||_data$details===void 0?void 0:_data$details.map((details,index)=>{var _details$stock;return/*#__PURE__*/_jsx(Tag,{color:colors[index],children:details===null||details===void 0?void 0:(_details$stock=details.stock)===null||_details$stock===void 0?void 0:_details$stock.product.translation.title});})]})]}),/*#__PURE__*/_jsxs(Col,{span:12,children:[/*#__PURE__*/_jsxs(\"p\",{children:[t('status'),': ',(data===null||data===void 0?void 0:data.status)==='new'?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:t(data===null||data===void 0?void 0:data.status)}):(data===null||data===void 0?void 0:data.status)==='canceled'?/*#__PURE__*/_jsx(Tag,{color:\"error\",children:t(data===null||data===void 0?void 0:data.status)}):/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:t(data===null||data===void 0?void 0:data.status)})]}),/*#__PURE__*/_jsxs(\"p\",{children:[t('order.type'),\": \",/*#__PURE__*/_jsx(\"strong\",{children:t('parcel')})]}),/*#__PURE__*/_jsxs(\"p\",{children:[t('payment.method'),': ',/*#__PURE__*/_jsx(\"strong\",{children:data===null||data===void 0?void 0:(_data$transaction=data.transaction)===null||_data$transaction===void 0?void 0:(_data$transaction$pay=_data$transaction.payment_system)===null||_data$transaction$pay===void 0?void 0:_data$transaction$pay.tag})]}),/*#__PURE__*/_jsxs(\"p\",{children:[t('payment.status'),': ',/*#__PURE__*/_jsx(\"strong\",{children:data===null||data===void 0?void 0:(_data$transaction2=data.transaction)===null||_data$transaction2===void 0?void 0:_data$transaction2.status})]})]}),/*#__PURE__*/_jsxs(Col,{span:24,className:\"mt-5\",children:[/*#__PURE__*/_jsx(\"h4\",{children:t('map')}),/*#__PURE__*/_jsx(\"div\",{className:\"map-container\",style:{height:400,width:'100%'},children:/*#__PURE__*/_jsxs(GoogleMapReact,{bootstrapURLKeys:{key:MAP_API_KEY||google_map_key},defaultZoom:15,center:center,yesIWantToUseGoogleMapApiInternals:true,options:{fullscreenControl:false},onGoogleApiLoaded:handleLoadMap,children:[/*#__PURE__*/_jsx(Store,{lat:shop===null||shop===void 0?void 0:shop.lat,lng:shop===null||shop===void 0?void 0:shop.lng}),/*#__PURE__*/_jsx(User,{lat:user===null||user===void 0?void 0:user.lat,lng:user===null||user===void 0?void 0:user.lng})]})})]})]})]})})});};export default ShowLocationsMap;","map":null,"metadata":{},"sourceType":"module"}