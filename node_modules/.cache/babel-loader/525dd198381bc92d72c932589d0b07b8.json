{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Card,Space,Table,Tag}from'antd';import{batch,shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,setMenuData}from'redux/slices/menu';import{useTranslation}from'react-i18next';import FilterColumns from'components/filter-column';import{fetchBonusList}from'redux/slices/bonus-list';import formatSortType from'helpers/formatSortType';import moment from'moment';import useDidUpdate from'helpers/useDidUpdate';import{jsx as _jsx}from\"react/jsx-runtime\";const BonusList=()=>{var _activeMenu$data,_activeMenu$data2,_activeMenu$data3;const{t}=useTranslation();const dispatch=useDispatch();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{bonus,meta,loading,params}=useSelector(state=>state.bonusList,shallowEqual);const data=activeMenu===null||activeMenu===void 0?void 0:activeMenu.data;const paramsData={sort:data===null||data===void 0?void 0:data.sort,column:data===null||data===void 0?void 0:data.column,perPage:data===null||data===void 0?void 0:data.perPage,page:data===null||data===void 0?void 0:data.page};const[columns,setColumns]=useState([{title:t('id'),dataIndex:'id',key:'id',sorter:true,is_show:true},{title:t('bonus.stock'),dataIndex:'bonusStock',key:'bonusStock',is_show:true,render:(bonusStock,row)=>{var _bonusStock$product,_bonusStock$product$t;return bonusStock===null||bonusStock===void 0?void 0:(_bonusStock$product=bonusStock.product)===null||_bonusStock$product===void 0?void 0:(_bonusStock$product$t=_bonusStock$product.translation)===null||_bonusStock$product$t===void 0?void 0:_bonusStock$product$t.title;}},{title:t('shop'),dataIndex:'shop',key:'shop',is_show:true,render:(_,row)=>{var _row$shop,_row$shop$translation;return(_row$shop=row.shop)===null||_row$shop===void 0?void 0:(_row$shop$translation=_row$shop.translation)===null||_row$shop$translation===void 0?void 0:_row$shop$translation.title;}},{title:t('expired.at'),dataIndex:'expired_at',key:'expired_at',is_show:true,render:expired_at=>/*#__PURE__*/_jsx(\"div\",{children:moment(new Date()).isBefore(expired_at)?/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:expired_at}):/*#__PURE__*/_jsx(Tag,{color:\"error\",children:expired_at})})}]);useEffect(()=>{if(activeMenu.refetch){batch(()=>{dispatch(fetchBonusList(paramsData));dispatch(disableRefetch(activeMenu));});}},[activeMenu.refetch]);useDidUpdate(()=>{dispatch(fetchBonusList(paramsData));},[activeMenu.data]);function onChangePagination(pagination,filter,sorter){const{pageSize:perPage,current:page}=pagination;const{field:column,order}=sorter;const sort=formatSortType(order);dispatch(setMenuData({activeMenu,data:{...activeMenu.data,perPage,page,column,sort}}));}return/*#__PURE__*/_jsx(Card,{title:t('bonuses.list'),extra:/*#__PURE__*/_jsx(Space,{children:/*#__PURE__*/_jsx(FilterColumns,{columns:columns,setColumns:setColumns})}),children:/*#__PURE__*/_jsx(Table,{scroll:{x:true},columns:columns===null||columns===void 0?void 0:columns.filter(item=>item.is_show),dataSource:bonus,pagination:{pageSize:params.perPage,page:((_activeMenu$data=activeMenu.data)===null||_activeMenu$data===void 0?void 0:_activeMenu$data.page)||1,total:meta.total,defaultCurrent:(_activeMenu$data2=activeMenu.data)===null||_activeMenu$data2===void 0?void 0:_activeMenu$data2.page,current:(_activeMenu$data3=activeMenu.data)===null||_activeMenu$data3===void 0?void 0:_activeMenu$data3.page},rowKey:record=>record.id,loading:loading,onChange:onChangePagination})});};export default BonusList;","map":null,"metadata":{},"sourceType":"module"}