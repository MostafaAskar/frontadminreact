{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Card,Col,Form,Input,Row,Spin,Switch}from'antd';import{toast}from'react-toastify';import{useNavigate,useParams}from'react-router-dom';import LanguageList from'../../components/language-list';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{disableRefetch,removeFromMenu,setMenuData}from'../../redux/slices/menu';import careerService from'../../services/career';import{useTranslation}from'react-i18next';import{fetchCareer}from'../../redux/slices/career';import{DebounceSelect}from'components/search';import categoryService from'services/category';import CkeEditor from'components/ckeEditor';import getTranslationFields from'helpers/getTranslationFields';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const CareerEdit=()=>{const{t}=useTranslation();const navigate=useNavigate();const dispatch=useDispatch();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const[loading,setLoading]=useState(false);const[form]=Form.useForm();const[loadingBtn,setLoadingBtn]=useState(false);const{id}=useParams();const{params}=useSelector(state=>state.career,shallowEqual);const{defaultLang,languages}=useSelector(state=>state.formLang,shallowEqual);useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));};},[]);function getLanguageFields(data){if(!data){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2,_translations$find3;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`description[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.description,[`address[${item.locale}]`]:(_translations$find3=translations.find(el=>el.locale===item.locale))===null||_translations$find3===void 0?void 0:_translations$find3.address};});return Object.assign({},...result);}const getCategory=alias=>{setLoading(true);careerService.getById(alias).then(res=>{var _res$data,_res$data2;let career=res.data;const body={...career,...getLanguageFields(career),category_id:{label:career.category.translation.title,value:career.category.id},active:res!==null&&res!==void 0&&(_res$data=res.data)!==null&&_res$data!==void 0&&_res$data.active?res===null||res===void 0?void 0:(_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.active:false};form.setFieldsValue(body);}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};const onFinish=values=>{setLoadingBtn(true);const body={...values,active:Number(values.active),category_id:values.category_id.value,type:values.type,title:getTranslationFields(languages,values,'title'),description:getTranslationFields(languages,values,'description'),address:getTranslationFields(languages,values,'address')};const nextUrl='catalog/career';careerService.update(id,body).then(()=>{toast.success(t('successfully.updated'));dispatch(removeFromMenu({...activeMenu,nextUrl}));dispatch(fetchCareer(params));navigate(`/${nextUrl}`);}).catch(err=>console.error(err.response.data.params)).finally(()=>setLoadingBtn(false));};async function fetchCareerList(search){const params={search:search.lenght>0?search:undefined,type:'career',active:1};return categoryService.getAll(params).then(res=>res.data.map(item=>({label:item.translation?item.translation.title:'no name',value:item.id})));}useEffect(()=>{if(activeMenu.refetch)getCategory(id);},[activeMenu.refetch]);return/*#__PURE__*/_jsx(Card,{title:t('edit.career'),extra:/*#__PURE__*/_jsx(LanguageList,{}),children:!loading?/*#__PURE__*/_jsxs(Form,{name:\"basic\",layout:\"vertical\",onFinish:onFinish,initialValues:{parent_id:{title:'---',value:0,key:0},active:true,...activeMenu.data},form:form,children:[/*#__PURE__*/_jsxs(Row,{gutter:12,children:[/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,index)=>/*#__PURE__*/_jsx(Form.Item,{label:t('name'),name:`title[${item.locale}]`,rules:[{required:(item===null||item===void 0?void 0:item.locale)===defaultLang,message:t('required')},{validator(_,value){if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{placeholder:t('name'),maxLength:50})},item.title+index))}),/*#__PURE__*/_jsx(Col,{span:12}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(CkeEditor,{form:form,lang:defaultLang,languages:languages})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('category'),name:\"category_id\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(DebounceSelect,{fetchOptions:fetchCareerList})})}),/*#__PURE__*/_jsx(Col,{span:12,children:languages.map((item,index)=>/*#__PURE__*/_jsx(Form.Item,{label:t('location'),name:`address[${item.locale}]`,rules:[{required:(item===null||item===void 0?void 0:item.locale)===defaultLang,message:t('required')},{validator(_,value){if(value&&(value===null||value===void 0?void 0:value.trim())===''){return Promise.reject(new Error(t('no.empty.space')));}else if(value&&(value===null||value===void 0?void 0:value.trim().length)<2){return Promise.reject(new Error(t('must.be.at.least.2')));}return Promise.resolve();}}],hidden:item.locale!==defaultLang,children:/*#__PURE__*/_jsx(Input,{maxLength:100})},item.locale+index))}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Form.Item,{label:t('active'),name:\"active\",valuePropName:\"checked\",children:/*#__PURE__*/_jsx(Switch,{})})}),/*#__PURE__*/_jsx(Col,{span:12}),/*#__PURE__*/_jsx(Col,{span:24,className:\"mb-5\"})]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})]}):/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center py-5\",children:/*#__PURE__*/_jsx(Spin,{size:\"large\",className:\"mt-5 pt-5\"})})});};export default CareerEdit;","map":null,"metadata":{},"sourceType":"module"}