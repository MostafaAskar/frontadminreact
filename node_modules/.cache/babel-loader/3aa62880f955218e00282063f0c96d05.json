{"ast":null,"code":"import React,{useEffect,useState}from'react';import{shallowEqual,useSelector,useDispatch}from'react-redux';import{useParams}from'react-router-dom';import{useTranslation}from'react-i18next';import{Button,Card,Col,Form,InputNumber,Row}from'antd';import{RefetchSearch}from'components/refetch-search';import regionService from'services/deliveryzone/region';import countryService from'services/deliveryzone/country';import cityService from'services/deliveryzone/city';import areaService from'services/deliveryzone/area';import{setMenuData,disableRefetch}from'redux/slices/menu';import deliveryPriceService from'services/seller/delivery-price';import Loading from'components/loading';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function PriceForm(_ref){let{form,handleSubmit}=_ref;const{t}=useTranslation();const dispatch=useDispatch();const{id}=useParams();const{activeMenu}=useSelector(state=>state.menu,shallowEqual);const{languages,defaultLang}=useSelector(state=>state.formLang,shallowEqual);const{defaultCurrency}=useSelector(state=>state.currency,shallowEqual);const[loading,setLoading]=useState(false);const[loadingBtn,setLoadingBtn]=useState(false);const[formData,setFormData]=useState({});const{country,region,city}=formData;useEffect(()=>{return()=>{const data=form.getFieldsValue(true);dispatch(setMenuData({activeMenu,data}));};},[]);useEffect(()=>{if(activeMenu.refetch&&id){getDeliveryPrice(id);}},[activeMenu.refetch]);function getLanguageFields(data){if(!(data!==null&&data!==void 0&&data.translations)){return{};}const{translations}=data;const result=languages.map(item=>{var _translations$find,_translations$find2;return{[`title[${item.locale}]`]:(_translations$find=translations.find(el=>el.locale===item.locale))===null||_translations$find===void 0?void 0:_translations$find.title,[`address[${item.locale}]`]:(_translations$find2=translations.find(el=>el.locale===item.locale))===null||_translations$find2===void 0?void 0:_translations$find2.address};});return Object.assign({},...result);}// fetch functions\nconst getDeliveryPrice=()=>{setLoading(true);deliveryPriceService.getById(id).then(_ref2=>{var _area$translation,_city$translation,_country$translation,_region$translation,_data$address,_data$shop,_data$shop$translatio,_data$shop2,_data$shop3;let{data}=_ref2;const{city,country,region,area,...rest}=data;const fieldName=`address[${defaultLang}]`;const deliveryzone={area:{label:area===null||area===void 0?void 0:(_area$translation=area.translation)===null||_area$translation===void 0?void 0:_area$translation.title,value:area===null||area===void 0?void 0:area.id},city:{label:city===null||city===void 0?void 0:(_city$translation=city.translation)===null||_city$translation===void 0?void 0:_city$translation.title,value:city===null||city===void 0?void 0:city.id},country:{label:country===null||country===void 0?void 0:(_country$translation=country.translation)===null||_country$translation===void 0?void 0:_country$translation.title,value:country===null||country===void 0?void 0:country.id},region:{label:region===null||region===void 0?void 0:(_region$translation=region.translation)===null||_region$translation===void 0?void 0:_region$translation.title,value:region===null||region===void 0?void 0:region.id}};const formData={...getLanguageFields(data),...deliveryzone,...rest,[fieldName]:(_data$address=data.address)===null||_data$address===void 0?void 0:_data$address[defaultLang],shop_id:{label:data===null||data===void 0?void 0:(_data$shop=data.shop)===null||_data$shop===void 0?void 0:(_data$shop$translatio=_data$shop.translation)===null||_data$shop$translatio===void 0?void 0:_data$shop$translatio.title,value:data===null||data===void 0?void 0:(_data$shop2=data.shop)===null||_data$shop2===void 0?void 0:_data$shop2.id,key:data===null||data===void 0?void 0:(_data$shop3=data.shop)===null||_data$shop3===void 0?void 0:_data$shop3.id}};form.setFieldsValue(formData);setFormData(deliveryzone);}).catch(error=>{console.error(error);}).finally(()=>{setLoading(false);dispatch(disableRefetch(activeMenu));});};async function fetchRegion(search){const params={search,status:1,perPage:10};return regionService.get(params).then(_ref3=>{let{data}=_ref3;return data.map(item=>{var _item$translation;return{label:(item===null||item===void 0?void 0:(_item$translation=item.translation)===null||_item$translation===void 0?void 0:_item$translation.title)||'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}async function fetchCountry(search){const params={search,status:1,perPage:10,region_id:region===null||region===void 0?void 0:region.value};return countryService.get(params).then(_ref4=>{let{data}=_ref4;return data.map(item=>{var _item$translation2;return{label:(item===null||item===void 0?void 0:(_item$translation2=item.translation)===null||_item$translation2===void 0?void 0:_item$translation2.title)||'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}async function fetchCity(search){const params={search,status:1,perPage:10,country_id:country===null||country===void 0?void 0:country.value};return cityService.get(params).then(_ref5=>{let{data}=_ref5;return data.map(item=>{var _item$translation3;return{label:(item===null||item===void 0?void 0:(_item$translation3=item.translation)===null||_item$translation3===void 0?void 0:_item$translation3.title)||'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}async function fetchArea(search){const params={search,status:1,perPage:10,city_id:city===null||city===void 0?void 0:city.value};return areaService.get(params).then(_ref6=>{let{data}=_ref6;return data.map(item=>{var _item$translation4;return{label:(item===null||item===void 0?void 0:(_item$translation4=item.translation)===null||_item$translation4===void 0?void 0:_item$translation4.title)||'no name',value:item===null||item===void 0?void 0:item.id,key:item===null||item===void 0?void 0:item.id};});});}// onFinish\nconst onFinish=values=>{setLoadingBtn(true);handleSubmit(values).finally(()=>setLoadingBtn(false));};return loading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsxs(Form,{form:form,name:!!id?t('edit.delivery.price'):t('add.delivery.price'),layout:\"vertical\",initialValues:{clickable:true,...activeMenu.data},onFinish:onFinish,children:[/*#__PURE__*/_jsxs(Row,{gutter:[24,24],children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsxs(Card,{title:t('deliveryzone'),className:\"h-100\",children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('region'),name:\"region\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchRegion,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,onChange:value=>{setFormData(prev=>({...prev,region:value}));form.resetFields(['city','area','country']);}})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('country'),name:\"country\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchCountry,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,onChange:value=>{setFormData(prev=>({...prev,country:value}));form.resetFields(['city','area']);},disabled:!Boolean(region===null||region===void 0?void 0:region.value)})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('city'),name:\"city\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchCity,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,disabled:!Boolean(country===null||country===void 0?void 0:country.value),onChange:value=>{setFormData(prev=>({...prev,city:value}));form.resetFields(['area']);}})})}),/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:t('area'),name:\"area\",rules:[{required:false,message:t('required')}],children:/*#__PURE__*/_jsx(RefetchSearch,{fetchOptions:fetchArea,dropdownRender:menu=>/*#__PURE__*/_jsx(_Fragment,{children:menu}),refetch:true,disabled:!Boolean(city===null||city===void 0?void 0:city.value)})})})]})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Card,{title:t('pricing'),className:\"h-100\",children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Form.Item,{label:`${t('price')} (${defaultCurrency===null||defaultCurrency===void 0?void 0:defaultCurrency.symbol})`,name:\"price\",rules:[{required:true,message:t('required')}],children:/*#__PURE__*/_jsx(InputNumber,{className:\"w-100\"})})})})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 d-flex justify-content-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pb-5\",children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loadingBtn,children:t('submit')})})})]});}","map":null,"metadata":{},"sourceType":"module"}